<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>AntV/G6入门</title>
    <url>/2022/03/07/%E5%89%8D%E7%AB%AF%E5%8F%AF%E8%A7%86%E5%8C%96/AntV-G6%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<p><a href="https://g6.antv.vision/zh/docs/manual/tutorial/preface">官方教程</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save @antv/g6</span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用 vue 作为模板</p>
</blockquote>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;v-container&gt;</span><br><span class="line">    &lt;!--步骤.1 容器 --&gt;</span><br><span class="line">    &lt;div id=&quot;mountNode&quot;&gt;&lt;/div&gt;</span><br><span class="line">  &lt;/v-container&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import G6 from &quot;@antv/g6&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;G6&quot;,</span><br><span class="line">  async mounted() &#123;</span><br><span class="line">    /*</span><br><span class="line">    ## 步骤.2 数据准备</span><br><span class="line">    引入 G6 的数据源为 JSON 格式的对象。该对象中需要有节点（nodes）和边（edges）字段，分别用数组表示：</span><br><span class="line">     */</span><br><span class="line"></span><br><span class="line">    // 初始化数据</span><br><span class="line">    const initData = &#123;</span><br><span class="line">      // 点集</span><br><span class="line">      nodes: [</span><br><span class="line">        &#123;</span><br><span class="line">          id: &quot;node1&quot;, // 节点的唯一标识</span><br><span class="line">          x: 100, // 节点横坐标</span><br><span class="line">          y: 200, // 节点纵坐标</span><br><span class="line">          label: &quot;起始点&quot;, // 节点文本</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          id: &quot;node2&quot;,</span><br><span class="line">          x: 300,</span><br><span class="line">          y: 200,</span><br><span class="line">          label: &quot;目标点&quot;,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">      // 边集</span><br><span class="line">      edges: [</span><br><span class="line">        // 表示一条从 node1 节点连接到 node2 节点的边</span><br><span class="line">        &#123;</span><br><span class="line">          source: &quot;node1&quot;, // 起始点 id</span><br><span class="line">          target: &quot;node2&quot;, // 目标点 id</span><br><span class="line">          label: &quot;我是连线&quot;, // 边的文本</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;;</span><br><span class="line">    /*</span><br><span class="line">    ## 步骤.3 图实例化</span><br><span class="line">    图实例化时，至少需要为图设置容器、宽、高：</span><br><span class="line">     */</span><br><span class="line">    const graph = new G6.Graph(&#123;</span><br><span class="line">      container: &quot;mountNode&quot;, // 指定挂载容器</span><br><span class="line">      width: 800, // 图的宽度</span><br><span class="line">      height: 500, // 图的高度</span><br><span class="line">    &#125;);</span><br><span class="line">    /*</span><br><span class="line">    ## 步骤.4 图的渲染</span><br><span class="line">    数据的加载和图的渲染是两个步骤，可以分开进行。</span><br><span class="line">     */</span><br><span class="line"></span><br><span class="line">    graph.data(initData); // 加载数据</span><br><span class="line"></span><br><span class="line">    graph.render(); // 渲染 调用 graph.render() 方法之后，G6 引擎会根据加载的数据进行图的绘制。</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h2 id="元素及其配置"><a href="#元素及其配置" class="headerlink" title="元素及其配置"></a>元素及其配置</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;G6&quot;,</span><br><span class="line">  async mounted() &#123;</span><br><span class="line">    const response = await fetch(</span><br><span class="line">      &quot;https://gw.alipayobjects.com/os/basement_prod/6cae02ab-4c29-44b2-b1fd-4005688febcb.json&quot;</span><br><span class="line">    );</span><br><span class="line">    const initData = await response.json();</span><br><span class="line">    // 将请求返回的数据遍历 设置每个节点的样式</span><br><span class="line">    const nodes = initData.nodes;</span><br><span class="line">    nodes.forEach((node) =&gt; &#123;</span><br><span class="line">      if (!node.style) &#123;</span><br><span class="line">        node.style = &#123;&#125;;</span><br><span class="line">      &#125;</span><br><span class="line">      switch (</span><br><span class="line">        node.class // 根据节点数据中的 class 属性配置图形</span><br><span class="line">      ) &#123;</span><br><span class="line">        case &quot;c0&quot;: &#123;</span><br><span class="line">          node.type = &quot;circle&quot;; // class = &#x27;c0&#x27; 时节点图形为 circle</span><br><span class="line">          break;</span><br><span class="line">        &#125;</span><br><span class="line">        case &quot;c1&quot;: &#123;</span><br><span class="line">          node.type = &quot;rect&quot;; // class = &#x27;c1&#x27; 时节点图形为 rect</span><br><span class="line">          node.size = [35, 20]; // class = &#x27;c1&#x27; 时节点大小</span><br><span class="line">          break;</span><br><span class="line">        &#125;</span><br><span class="line">        case &quot;c2&quot;: &#123;</span><br><span class="line">          node.type = &quot;ellipse&quot;; // class = &#x27;c2&#x27; 时节点图形为 ellipse</span><br><span class="line">          node.size = [35, 20]; // class = &#x27;c2&#x27; 时节点大小</span><br><span class="line">          break;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    // 遍历边数据  设置每个边的样式</span><br><span class="line">    const edges = initData.edges;</span><br><span class="line">    edges.forEach((edge) =&gt; &#123;</span><br><span class="line">      if (!edge.style) &#123;</span><br><span class="line">        // 边的样式会覆盖全局样式 所以需要把全局样式挪到这里</span><br><span class="line">        edge.style = &#123;</span><br><span class="line">          stroke: &quot;grey&quot;, // 边描边颜色</span><br><span class="line">          opacity: 0.6, // 边透明度</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">      edge.style.lineWidth = edge.weight; // 边的粗细映射边数据中的 weight 属性数值</span><br><span class="line">    &#125;);</span><br><span class="line">    // 初始化数据</span><br><span class="line">    // const initData = &#123;</span><br><span class="line">    //   // 点集 （节点集合）</span><br><span class="line">    //   nodes: [</span><br><span class="line">    //     /*</span><br><span class="line">    //     元素的属性</span><br><span class="line">    //     不论是节点还是边，它们的属性分为两种：</span><br><span class="line"></span><br><span class="line">    //     样式属性 style：对应 Canvas 中的各种样式，在元素状态 State 发生变化时，可以被改变；</span><br><span class="line">    //     其他属性：例如图形类型（ type）、id（id ）一类在元素状态 State 发生变化时不能被改变的属性。</span><br><span class="line">    //     例如，G6 设定 hover 或 click 节点，造成节点状态的改变，只能自动改变节点的样式属性（如 fill、stroke 等），其他属性（如 type  等）不能被改变。如果需要改变其他属性，要通过  graph.updateItem 手动配置。样式属性是一个名为  style  的对象， style 字段与其他属性并行。</span><br><span class="line">    //      */</span><br><span class="line">    //     // 以节点元素为例，其属性的数据结构如下：</span><br><span class="line">    //     &#123;</span><br><span class="line">    //       id: &quot;node0&quot;, // 元素的 id</span><br><span class="line">    //       x: 0, // 节点横坐标</span><br><span class="line">    //       y: 0, // 节点纵坐标</span><br><span class="line">    //       type: &quot;rect&quot;, // 元素的图形</span><br><span class="line">    //       size: 40, // 元素的大小</span><br><span class="line">    //       label: &quot;node0&quot;, // 标签文字</span><br><span class="line">    //       visible: true, // 控制初次渲染显示与隐藏，若为 false，代表隐藏。默认不隐藏</span><br><span class="line">    //       // 标签配置属性</span><br><span class="line">    //       labelCfg: &#123;</span><br><span class="line">    //         positions: &quot;left&quot;, // 标签的属性，标签在元素中的位置</span><br><span class="line">    //         // 包裹标签样式属性的字段 style 与标签其他属性在数据结构上并行</span><br><span class="line">    //         style: &#123;</span><br><span class="line">    //           fontSize: 12, // 标签的样式属性，文字字体大小</span><br><span class="line">    //           // ...            // 标签的其他样式属性</span><br><span class="line">    //         &#125;,</span><br><span class="line">    //       &#125;,</span><br><span class="line">    //       // ...,               // 其他属性</span><br><span class="line">    //       // 包裹样式属性的字段 style 与其他属性在数据结构上并行</span><br><span class="line">    //       style: &#123;</span><br><span class="line">    //         fill: &quot;#000&quot;, // 样式属性，元素的填充色</span><br><span class="line">    //         stroke: &quot;#888&quot;, // 样式属性，元素的描边色</span><br><span class="line">    //         // ...              // 其他样式属性</span><br><span class="line">    //       &#125;,</span><br><span class="line">    //     &#125;,</span><br><span class="line">    //     &#123;</span><br><span class="line">    //       id: &quot;node1&quot;, // 节点的唯一标识</span><br><span class="line">    //       x: 100, // 节点横坐标</span><br><span class="line">    //       y: 200, // 节点纵坐标</span><br><span class="line">    //       label: &quot;起始点&quot;, // 节点文本</span><br><span class="line">    //     &#125;,</span><br><span class="line">    //     &#123;</span><br><span class="line">    //       id: &quot;node2&quot;,</span><br><span class="line">    //       x: 300,</span><br><span class="line">    //       y: 200,</span><br><span class="line">    //       label: &quot;目标点&quot;,</span><br><span class="line">    //     &#125;,</span><br><span class="line">    //   ],</span><br><span class="line">    //   // 边集</span><br><span class="line">    //   edges: [</span><br><span class="line">    //     /*</span><br><span class="line">    //     边元素的属性数据结构与节点元素相似，只是其他属性中多了 source 和 target 字段，代表起始和终止节点的 id。</span><br><span class="line">    //      */</span><br><span class="line">    //     // 表示一条从 node0 节点连接到 node1 节点的边</span><br><span class="line">    //     &#123;</span><br><span class="line">    //       source: &quot;node0&quot;, // 起始点 id</span><br><span class="line">    //       target: &quot;node1&quot;, // 目标点 id</span><br><span class="line">    //       label: &quot;我是连线&quot;, // 边的文本</span><br><span class="line">    //     &#125;,</span><br><span class="line">    //     // 表示一条从 node1 节点连接到 node2 节点的边</span><br><span class="line">    //     &#123;</span><br><span class="line">    //       source: &quot;node1&quot;, // 起始点 id</span><br><span class="line">    //       target: &quot;node2&quot;, // 目标点 id</span><br><span class="line">    //       label: &quot;我是连线&quot;, // 边的文本</span><br><span class="line">    //     &#125;,</span><br><span class="line">    //   ],</span><br><span class="line">    // &#125;;</span><br><span class="line">    const graph = new G6.Graph(&#123;</span><br><span class="line">      fitView: true, // 设置是否将图适配到画布中</span><br><span class="line">      fitViewPadding: [0, 0, 0, 10], // 画布上四周的留白宽度。</span><br><span class="line">      animate: true, // 是否启用图的动画。</span><br><span class="line">      // 图上行为模式的集合。由于比较复杂，按需参见：G6 中的 Mode 教程。</span><br><span class="line">      modes: &#123;</span><br><span class="line">        default: [</span><br><span class="line">          // 拖拽节点</span><br><span class="line">          &quot;drag-node&quot;,</span><br><span class="line">          // 拖拽整个画布</span><br><span class="line">          &quot;drag-canvas&quot;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">      // 节点默认的属性，包括节点的一般属性和样式属性（style）</span><br><span class="line">      defaultNode: &#123;</span><br><span class="line">        size: 30, // 节点大小</span><br><span class="line">        /*</span><br><span class="line">          type node节点图形类型</span><br><span class="line">          G6 支持以下图形：</span><br><span class="line">          - circle：圆；</span><br><span class="line">          - rect：矩形；</span><br><span class="line">          - ellipse：椭圆；</span><br><span class="line">          - polygon：多边形；</span><br><span class="line">          - image：图片；</span><br><span class="line">          - marker：标记；</span><br><span class="line">          - path：路径；</span><br><span class="line">          - text：文本；</span><br><span class="line">          - dom(svg)：DOM（图渲染方式 renderer 为 &#x27;svg&#x27; 时可用）。</span><br><span class="line">         */</span><br><span class="line">        // type: &quot;circle&quot;,</span><br><span class="line">        // color: &quot;#ff00ff&quot;,</span><br><span class="line">        // 节点样式配置 文档 https://g6.antv.vision/zh/docs/api/shapeProperties#%E9%80%9A%E7%94%A8%E5%B1%9E%E6%80%A7</span><br><span class="line">        style: &#123;</span><br><span class="line">          //////////////////////////////////////////////////////////////////////</span><br><span class="line">          //通用属性</span><br><span class="line">          //////////////////////////////////////////////////////////////////////</span><br><span class="line">          // 图形名称标识，G6 3.3 版本以上必须配置。</span><br><span class="line">          name: &quot;bitbw&quot;,</span><br><span class="line">          // 设置用于填充绘画的颜色(RGB 或 16 进制)、渐变或模式，对应 Canvas 属性 fillStyle 。取值示例：rgb(18, 150, 231)，#c193af，l(0) 0:#ffffff 0.5:#7ec2f3 1:#1890ff， r(0.5, 0.5, 0.1) 0:#ffffff 1:#1890ff。</span><br><span class="line">          fill: &quot;steelblue&quot;,</span><br><span class="line">          // 节点描边色</span><br><span class="line">          stroke: &quot;#666&quot;,</span><br><span class="line">          // 边宽度</span><br><span class="line">          lineWidth: 6,</span><br><span class="line">          // 描边虚线，Number[] 类型中数组元素分别代表实、虚长度。</span><br><span class="line">          lineDash: [1, 1],</span><br><span class="line">          // 设置用于阴影的颜色。</span><br><span class="line">          shadowColor: &quot;#000000&quot;,</span><br><span class="line">          // 设置用于阴影的模糊级别，数值越大，越模糊。 (扩散范围)</span><br><span class="line">          shadowBlur: 20,</span><br><span class="line">          // 设置阴影距形状的水平距离。(x 轴偏移量)</span><br><span class="line">          shadowOffsetX: 10,</span><br><span class="line">          // 设置阴影距形状的垂直距离。(Y 轴偏移量)</span><br><span class="line">          shadowOffsetY: 10,</span><br><span class="line">          // 设置绘图的当前 alpha 或透明值，范围 [0, 1]，对应 Canvas 属性 globalAlpha。</span><br><span class="line">          opacity: 0.3,</span><br><span class="line">          // 设置填充的 alpha 或透明值，优先级高于 opacity，范围 [0, 1]。</span><br><span class="line">          fillOpacity: 0.9,</span><br><span class="line">          // 设置描边的 alpha 或透明值，优先级高于 opacity，范围 [0, 1]。</span><br><span class="line">          strokeOpacity: 0.9,</span><br><span class="line">          // 鼠标在该节点上时的鼠标样式，CSS 的 cursor 选项都支持。</span><br><span class="line">          cursor: &quot;help&quot;,</span><br><span class="line">          //////////////////////////////////////////////////////////////////////</span><br><span class="line">          // 各个图形属性  见文档</span><br><span class="line">          //////////////////////////////////////////////////////////////////////</span><br><span class="line">        &#125;,</span><br><span class="line">        // 节点上的标签文本配置</span><br><span class="line">        labelCfg: &#123;</span><br><span class="line">          // 节点上的标签文本样式配置</span><br><span class="line">          style: &#123;</span><br><span class="line">            fill: &quot;#fff&quot;, // 节点标签文字颜色</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      // 边默认的属性，包括边的一般属性和样式属性（style）</span><br><span class="line">      defaultEdge: &#123;</span><br><span class="line">        type: &quot;polyline&quot;,</span><br><span class="line">        color: &quot;#ffff00&quot;,</span><br><span class="line">        // ...                 // 边的其他配置</span><br><span class="line">        // 边样式配置</span><br><span class="line">        style: &#123;</span><br><span class="line">          opacity: 0.6, // 边透明度</span><br><span class="line">          stroke: &quot;grey&quot;, // 边描边颜色</span><br><span class="line">        &#125;,</span><br><span class="line">        // 边上的标签文本配置</span><br><span class="line">        labelCfg: &#123;</span><br><span class="line">          autoRotate: true, // 边上的标签文本根据边的方向旋转</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      // 边在除默认状态外，其他状态下的样式属性（style）。例如鼠标放置（hover）、选中（select）等状态</span><br><span class="line">      nodeStateStyles: &#123;</span><br><span class="line">        hover: &#123;&#125;,</span><br><span class="line">        select: &#123;&#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      container: &quot;mountNode&quot;, // 指定挂载容器</span><br><span class="line">      width: 1000, // 图的宽度</span><br><span class="line">      height: 1000, // 图的高度</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    graph.data(initData); // 加载数据</span><br><span class="line"></span><br><span class="line">    graph.render(); // 渲染 调用 graph.render() 方法之后，G6 引擎会根据加载的数据进行图的绘制。</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="布局Layout"><a href="#布局Layout" class="headerlink" title="布局Layout"></a>布局Layout</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;G6&quot;,</span><br><span class="line">  async mounted() &#123;</span><br><span class="line">    /* </span><br><span class="line">    当数据中没有节点位置信息，或者数据中的位置信息不满足需求时，需要借助一些布局算法对图进行布局。G6 提供了 9 种一般图的布局和 4 种树图的布局：</span><br><span class="line">    一般图：</span><br><span class="line"></span><br><span class="line">    Random Layout：随机布局；</span><br><span class="line">    Force Layout：经典力导向布局：</span><br><span class="line"></span><br><span class="line">    力导向布局：一个布局网络中，粒子与粒子之间具有引力和斥力，从初始的随机无序的布局不断演变，逐渐趋于平衡稳定的布局方式称之为力导向布局。适用于描述事物间关系，比如人物关系、计算机网络关系等。</span><br><span class="line"></span><br><span class="line">    Circular Layout：环形布局；</span><br><span class="line">    Radial Layout：辐射状布局；</span><br><span class="line">    MDS Layout：高维数据降维算法布局；</span><br><span class="line">    Fruchterman Layout：Fruchterman 布局，一种力导布局；</span><br><span class="line">    Dagre Layout：层次布局；</span><br><span class="line">    Concentric Layout：同心圆布局，将重要（默认以度数为度量）的节点放置在布局中心；</span><br><span class="line">    Grid Layout：格子布局，将节点有序（默认是数据顺序）排列在格子上。</span><br><span class="line">    树图布局：</span><br><span class="line"></span><br><span class="line">    Dendrogram Layout：树状布局（叶子节点布局对齐到同一层）；</span><br><span class="line">    CompactBox Layout：紧凑树布局；</span><br><span class="line">    Mindmap Layout：脑图布局；</span><br><span class="line">    Indented Layout：缩进布局。</span><br><span class="line">     */</span><br><span class="line"></span><br><span class="line">    /* </span><br><span class="line">      配置布局</span><br><span class="line">     */</span><br><span class="line">    const graph = new G6.Graph(&#123;</span><br><span class="line">      //////////////////////////////////////////////////////////////////////////</span><br><span class="line">      // Object，可选，布局的方法及其配置项，默认为 random 布局。</span><br><span class="line">      layout: &#123;</span><br><span class="line">        type: &quot;force&quot;, // 指定为力导向布局</span><br><span class="line">        preventOverlap: true, // 防止节点重叠</span><br><span class="line">        linkDistance: 100, // 指定边距离为100</span><br><span class="line">        // nodeSize: 30, // 节点大小，用于算法中防止节点重叠时的碰撞检测。由于已经在上一节的元素配置中设置了每个节点的 size 属性，则不需要在此设置 nodeSize。</span><br><span class="line">      &#125;,</span><br><span class="line">      //////////////////////////////////////////////////////////////////////////</span><br><span class="line">      animate: true, // 是否启用图的动画。</span><br><span class="line">      // 图上行为模式的集合。由于比较复杂，按需参见：G6 中的 Mode 教程。</span><br><span class="line">      modes: &#123;</span><br><span class="line">        default: [</span><br><span class="line">          // 拖拽节点</span><br><span class="line">          &quot;drag-node&quot;,</span><br><span class="line">          // 拖拽整个画布</span><br><span class="line">          &quot;drag-canvas&quot;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">      defaultNode: &#123;</span><br><span class="line">        size: 30,</span><br><span class="line">        labelCfg: &#123;</span><br><span class="line">          style: &#123;</span><br><span class="line">            fill: &quot;#fff&quot;,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      defaultEdge: &#123;</span><br><span class="line">        labelCfg: &#123;</span><br><span class="line">          autoRotate: true,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      container: &quot;mountNode&quot;, // 指定挂载容器</span><br><span class="line">      width: 1000, // 图的宽度</span><br><span class="line">      height: 1000, // 图的高度</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    const main = async () =&gt; &#123;</span><br><span class="line">      const response = await fetch(</span><br><span class="line">        &quot;https://gw.alipayobjects.com/os/basement_prod/6cae02ab-4c29-44b2-b1fd-4005688febcb.json&quot;</span><br><span class="line">      );</span><br><span class="line">      const remoteData = await response.json();</span><br><span class="line"></span><br><span class="line">      const nodes = remoteData.nodes;</span><br><span class="line">      const edges = remoteData.edges;</span><br><span class="line">      nodes.forEach((node) =&gt; &#123;</span><br><span class="line">        if (!node.style) &#123;</span><br><span class="line">          node.style = &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        node.style.lineWidth = 1;</span><br><span class="line">        node.style.stroke = &quot;#666&quot;;</span><br><span class="line">        node.style.fill = &quot;steelblue&quot;;</span><br><span class="line">        switch (node.class) &#123;</span><br><span class="line">          case &quot;c0&quot;: &#123;</span><br><span class="line">            node.type = &quot;circle&quot;;</span><br><span class="line">            break;</span><br><span class="line">          &#125;</span><br><span class="line">          case &quot;c1&quot;: &#123;</span><br><span class="line">            node.type = &quot;rect&quot;;</span><br><span class="line">            node.size = [35, 20];</span><br><span class="line">            break;</span><br><span class="line">          &#125;</span><br><span class="line">          case &quot;c2&quot;: &#123;</span><br><span class="line">            node.type = &quot;ellipse&quot;;</span><br><span class="line">            node.size = [35, 20];</span><br><span class="line">            break;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      edges.forEach((edge) =&gt; &#123;</span><br><span class="line">        if (!edge.style) &#123;</span><br><span class="line">          edge.style = &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        edge.style.lineWidth = edge.weight;</span><br><span class="line">        edge.style.opacity = 0.6;</span><br><span class="line">        edge.style.stroke = &quot;grey&quot;;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      graph.data(remoteData);</span><br><span class="line">      graph.render();</span><br><span class="line">    &#125;;</span><br><span class="line">    main();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="交互行为Behavior"><a href="#交互行为Behavior" class="headerlink" title="交互行为Behavior"></a>交互行为Behavior</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;G6&quot;,</span><br><span class="line">  async mounted() &#123;</span><br><span class="line">    /* </span><br><span class="line">    交互行为 Behavior</span><br><span class="line">    G6 中的交互行为。G6 内置了一系列交互行为，用户可以直接使用。简单地理解，就是可以一键开启这些交互行为：</span><br><span class="line"></span><br><span class="line">    drag-canvas：拖拽画布；</span><br><span class="line">    zoom-canvas：缩放画布。</span><br><span class="line"></span><br><span class="line">    交互管理 Mode</span><br><span class="line">    Mode 是 G6 交互行为的管理机制，一个 mode 是多种行为 Behavior 的组合，允许用户通过切换不同的模式进行交互行为的管理。由于该概念较为复杂，在本入门教程中，读者不需要对该机制深入理解。如有需求，参见 交互模式 Mode。</span><br><span class="line"></span><br><span class="line">    交互状态 State</span><br><span class="line">    状态 State 是 G6 中的状态机制。用户可以为图中的元素（节点/边）设置不同的状态及不同状态下的样式。在状态发生变化时，G6 自动更新元素的样式。例如，可以为节点设置状态 &#x27;click&#x27; 为 true 或 false，并为节点设置 &#x27;click&#x27; 的样式为加粗节点边框。当 &#x27;click&#x27; 状态被切换为 true 时，节点的边框将会被加粗，&#x27;click&#x27; 状态被切换为 false 时，节点的样式恢复到默认。在下面的使用方法中，将会有具体例子。</span><br><span class="line">     */</span><br><span class="line"></span><br><span class="line">    const graph = new G6.Graph(&#123;</span><br><span class="line">      //////////////////////////////////////////////////////////////////////////</span><br><span class="line">      //  交互管理 Mode</span><br><span class="line">      //////////////////////////////////////////////////////////////////////////</span><br><span class="line">      modes: &#123;</span><br><span class="line">        // 默认模式</span><br><span class="line">        default: [</span><br><span class="line">          // 拖拽节点</span><br><span class="line">          &quot;drag-node&quot;,</span><br><span class="line">          // 拖拽整个画布</span><br><span class="line">          &quot;drag-canvas&quot;,</span><br><span class="line">          // 放缩画布</span><br><span class="line">          &quot;zoom-canvas&quot;,</span><br><span class="line">        ],</span><br><span class="line">        // 编辑模式</span><br><span class="line">        edit: [],</span><br><span class="line">      &#125;,</span><br><span class="line">      //////////////////////////////////////////////////////////////////////////</span><br><span class="line">      // 交互状态 State</span><br><span class="line">      //////////////////////////////////////////////////////////////////////////</span><br><span class="line">      // 节点不同状态下的样式集合</span><br><span class="line">      nodeStateStyles: &#123;</span><br><span class="line">        // 鼠标 hover 上节点，即 hover 状态为 true 时的样式</span><br><span class="line">        hover: &#123;</span><br><span class="line">          fill: &quot;lightsteelblue&quot;,</span><br><span class="line">        &#125;,</span><br><span class="line">        // 鼠标点击节点，即 click 状态为 true 时的样式</span><br><span class="line">        click: &#123;</span><br><span class="line">          stroke: &quot;#000&quot;,</span><br><span class="line">          lineWidth: 3,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      // 边不同状态下的样式集合</span><br><span class="line">      edgeStateStyles: &#123;</span><br><span class="line">        // 鼠标点击边，即 click 状态为 true 时的样式</span><br><span class="line">        click: &#123;</span><br><span class="line">          stroke: &quot;steelblue&quot;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      //////////////////////////////////////////////////////////////////////////</span><br><span class="line"></span><br><span class="line">      // Object，可选，布局的方法及其配置项，默认为 random 布局。</span><br><span class="line">      layout: &#123;</span><br><span class="line">        type: &quot;force&quot;, // 指定为力导向布局</span><br><span class="line">        preventOverlap: true, // 防止节点重叠</span><br><span class="line">        linkDistance: 100, // 指定边距离为100</span><br><span class="line">        // nodeSize: 30, // 节点大小，用于算法中防止节点重叠时的碰撞检测。由于已经在上一节的元素配置中设置了每个节点的 size 属性，则不需要在此设置 nodeSize。</span><br><span class="line">      &#125;,</span><br><span class="line">      animate: true, // 是否启用图的动画。</span><br><span class="line"></span><br><span class="line">      defaultNode: &#123;</span><br><span class="line">        size: 30,</span><br><span class="line">        labelCfg: &#123;</span><br><span class="line">          style: &#123;</span><br><span class="line">            fill: &quot;#fff&quot;,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      defaultEdge: &#123;</span><br><span class="line">        labelCfg: &#123;</span><br><span class="line">          autoRotate: true,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      container: &quot;mountNode&quot;, // 指定挂载容器</span><br><span class="line">      width: 1000, // 图的宽度</span><br><span class="line">      height: 1000, // 图的高度</span><br><span class="line">    &#125;);</span><br><span class="line">    /* </span><br><span class="line">    监听事件并切换元素状态</span><br><span class="line">    G6 中所有元素监听都挂载在图实例上，如下代码中的 graph 对象是 G6.Graph 的实例，graph.on()  函数监听了某元素类型（node / edge）的某种事件（click / mouseenter / mouseleave / ... 所有事件参见：Event API）。</span><br><span class="line">    // 在图实例 graph 上监听</span><br><span class="line">    graph.on(&#x27;元素类型:事件名&#x27;, (e) =&gt; &#123;</span><br><span class="line">      // do something</span><br><span class="line">    &#125;);</span><br><span class="line">     */</span><br><span class="line">    //////////////////////////////////////////////////////////////////////////</span><br><span class="line">    // 监听事件并切换元素状态</span><br><span class="line">    //////////////////////////////////////////////////////////////////////////</span><br><span class="line">    // 鼠标进入节点</span><br><span class="line">    graph.on(&quot;node:mouseenter&quot;, (e) =&gt; &#123;</span><br><span class="line">      const nodeItem = e.item; // 获取鼠标进入的节点元素对象</span><br><span class="line">      graph.setItemState(nodeItem, &quot;hover&quot;, true); // 设置当前节点的 hover 状态为 true</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // 鼠标离开节点</span><br><span class="line">    graph.on(&quot;node:mouseleave&quot;, (e) =&gt; &#123;</span><br><span class="line">      const nodeItem = e.item; // 获取鼠标离开的节点元素对象</span><br><span class="line">      graph.setItemState(nodeItem, &quot;hover&quot;, false); // 设置当前节点的 hover 状态为 false</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // 点击节点</span><br><span class="line">    graph.on(&quot;node:click&quot;, (e) =&gt; &#123;</span><br><span class="line">      // 先将所有当前是 click 状态的节点置为非 click 状态</span><br><span class="line">      const clickNodes = graph.findAllByState(&quot;node&quot;, &quot;click&quot;);</span><br><span class="line">      console.log(&quot;Bowen: mounted -&gt; clickNodes&quot;, clickNodes)</span><br><span class="line">      clickNodes.forEach((cn) =&gt; &#123;</span><br><span class="line">        graph.setItemState(cn, &quot;click&quot;, false);</span><br><span class="line">      &#125;);</span><br><span class="line">      const nodeItem = e.item; // 获取被点击的节点元素对象</span><br><span class="line">      graph.setItemState(nodeItem, &quot;click&quot;, true); // 设置当前节点的 click 状态为 true</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // 点击边</span><br><span class="line">    graph.on(&quot;edge:click&quot;, (e) =&gt; &#123;</span><br><span class="line">      // 先将所有当前是 click 状态的边置为非 click 状态</span><br><span class="line">      const clickEdges = graph.findAllByState(&quot;edge&quot;, &quot;click&quot;);</span><br><span class="line">      clickEdges.forEach((ce) =&gt; &#123;</span><br><span class="line">        graph.setItemState(ce, &quot;click&quot;, false);</span><br><span class="line">      &#125;);</span><br><span class="line">      const edgeItem = e.item; // 获取被点击的边元素对象</span><br><span class="line">      graph.setItemState(edgeItem, &quot;click&quot;, true); // 设置当前边的 click 状态为 true</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    const main = async () =&gt; &#123;</span><br><span class="line">      const response = await fetch(</span><br><span class="line">        &quot;https://gw.alipayobjects.com/os/basement_prod/6cae02ab-4c29-44b2-b1fd-4005688febcb.json&quot;</span><br><span class="line">      );</span><br><span class="line">      const remoteData = await response.json();</span><br><span class="line"></span><br><span class="line">      const nodes = remoteData.nodes;</span><br><span class="line">      const edges = remoteData.edges;</span><br><span class="line">      nodes.forEach((node) =&gt; &#123;</span><br><span class="line">        if (!node.style) &#123;</span><br><span class="line">          node.style = &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        node.style.lineWidth = 1;</span><br><span class="line">        node.style.stroke = &quot;#666&quot;;</span><br><span class="line">        node.style.fill = &quot;steelblue&quot;;</span><br><span class="line">        switch (node.class) &#123;</span><br><span class="line">          case &quot;c0&quot;: &#123;</span><br><span class="line">            node.type = &quot;circle&quot;;</span><br><span class="line">            break;</span><br><span class="line">          &#125;</span><br><span class="line">          case &quot;c1&quot;: &#123;</span><br><span class="line">            node.type = &quot;rect&quot;;</span><br><span class="line">            node.size = [35, 20];</span><br><span class="line">            break;</span><br><span class="line">          &#125;</span><br><span class="line">          case &quot;c2&quot;: &#123;</span><br><span class="line">            node.type = &quot;ellipse&quot;;</span><br><span class="line">            node.size = [35, 20];</span><br><span class="line">            break;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      edges.forEach((edge) =&gt; &#123;</span><br><span class="line">        if (!edge.style) &#123;</span><br><span class="line">          edge.style = &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        edge.style.lineWidth = edge.weight;</span><br><span class="line">        edge.style.opacity = 0.6;</span><br><span class="line">        edge.style.stroke = &quot;grey&quot;;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      graph.data(remoteData);</span><br><span class="line">      graph.render();</span><br><span class="line">    &#125;;</span><br><span class="line">    main();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="插件与交互工具"><a href="#插件与交互工具" class="headerlink" title="插件与交互工具"></a>插件与交互工具</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">import G6 from &quot;@antv/g6&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;G6&quot;,</span><br><span class="line">  async mounted() &#123;</span><br><span class="line">    /* </span><br><span class="line">    插件与工具</span><br><span class="line">    为辅助用户在图上探索，G6 提供了一些辅助工具，其中一部分是插件工具，另一部分是交互工具。</span><br><span class="line"></span><br><span class="line">    本文将为 Tutorial 案例 添加缩略图插件、网格插件、节点提示框、边提示框。</span><br><span class="line"></span><br><span class="line">    插件</span><br><span class="line">    使用插件时，有三个步骤：</span><br><span class="line">      Step 1: 引入插件；</span><br><span class="line">      Step 2: 实例化插件；</span><br><span class="line">      Step 3: 在实例化图时将插件的实例配置到图上</span><br><span class="line">    </span><br><span class="line">    交互工具</span><br><span class="line">    交互工具是指配置到图上交互模式中的工具。使用交互工具时，有两个步骤：</span><br><span class="line">      Step 1: 在实例化图时配置 modes；</span><br><span class="line">      Step 2: 为交互工具定义样式。</span><br><span class="line">     */</span><br><span class="line">    ////////////////////////////////////////////////////////////////////////////</span><br><span class="line">    // 插件</span><br><span class="line">    ////////////////////////////////////////////////////////////////////////////</span><br><span class="line">    //Minimap 缩略图 (Minimap) 是一种常见的用于快速预览和探索图的工具，可作为导航辅助用户探索大规模图。</span><br><span class="line">    // 实例化 minimap 插件 （minimap 原理新建了一个 canvas 定位到主体画布上）</span><br><span class="line">    const minimap = new G6.Minimap(&#123;</span><br><span class="line">      size: [100, 200],</span><br><span class="line">      className: &quot;minimap&quot;,</span><br><span class="line">      type: &quot;delegate&quot;,</span><br><span class="line">    &#125;);</span><br><span class="line">    //Image Minimap 用于优化 minimap 性能  前期展示用于替代 minimap 的 image</span><br><span class="line">    // 实例化 Image Minimap 插件</span><br><span class="line">    // const imageMinimap = new G6.ImageMinimap(&#123;</span><br><span class="line">    //   width: 200,</span><br><span class="line">    //   // 用于在 minimap 位置显示的 image</span><br><span class="line">    //   graphImg:</span><br><span class="line">    //     &quot;https://gw.alipayobjects.com/mdn/rms_f8c6a0/afts/img/A*eD7nT6tmYgAAAAAAAAAAAABkARQnAQ&quot;,</span><br><span class="line">    // &#125;);</span><br><span class="line">    // 实例化 grid 插件 grid 原理新建了一个非常大的 div 背景图片为网格  定位到主体画布上 并设置 z-index -1 ）</span><br><span class="line">    const grid = new G6.Grid();</span><br><span class="line">    console.log(&quot;Bowen: mounted -&gt; grid&quot;, grid);</span><br><span class="line">    // 实例化图</span><br><span class="line">    const graph = new G6.Graph(&#123;</span><br><span class="line">      plugins: [minimap, grid], // 将 grid 实例配置到图上</span><br><span class="line">      ////////////////////////////////////////////////////////////////////////////</span><br><span class="line">      modes: &#123;</span><br><span class="line">        // 默认模式</span><br><span class="line">        default: [</span><br><span class="line">          // 拖拽节点</span><br><span class="line">          &quot;drag-node&quot;,</span><br><span class="line">          // 拖拽整个画布</span><br><span class="line">          &quot;drag-canvas&quot;,</span><br><span class="line">          // 放缩画布</span><br><span class="line">          &quot;zoom-canvas&quot;,</span><br><span class="line">          ////////////////////////////////////////////////////////////////////////////</span><br><span class="line">          // 交互工具</span><br><span class="line">          ////////////////////////////////////////////////////////////////////////////</span><br><span class="line">          &#123;</span><br><span class="line">            // 提示框 tooltip</span><br><span class="line">            // 本质为一个 div 定位到画布上， formatText返回的内容为div中内容 同时需要给 .g6-tooltip 样式</span><br><span class="line">            type: &quot;tooltip&quot;,</span><br><span class="line">            formatText(model) &#123;</span><br><span class="line">              // 提示框文本内容</span><br><span class="line">              const text =</span><br><span class="line">                &quot;label: &quot; + model.label + &quot;&lt;br/&gt; class: &quot; + model.class;</span><br><span class="line">              return text;</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">        // 编辑模式</span><br><span class="line">        edit: [],</span><br><span class="line">      &#125;,</span><br><span class="line">      // 节点不同状态下的样式集合</span><br><span class="line">      nodeStateStyles: &#123;</span><br><span class="line">        // 鼠标 hover 上节点，即 hover 状态为 true 时的样式</span><br><span class="line">        hover: &#123;</span><br><span class="line">          fill: &quot;lightsteelblue&quot;,</span><br><span class="line">        &#125;,</span><br><span class="line">        // 鼠标点击节点，即 click 状态为 true 时的样式</span><br><span class="line">        click: &#123;</span><br><span class="line">          stroke: &quot;#000&quot;,</span><br><span class="line">          lineWidth: 3,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      // 边不同状态下的样式集合</span><br><span class="line">      edgeStateStyles: &#123;</span><br><span class="line">        // 鼠标点击边，即 click 状态为 true 时的样式</span><br><span class="line">        click: &#123;</span><br><span class="line">          stroke: &quot;steelblue&quot;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      // Object，可选，布局的方法及其配置项，默认为 random 布局。</span><br><span class="line">      layout: &#123;</span><br><span class="line">        type: &quot;force&quot;, // 指定为力导向布局</span><br><span class="line">        preventOverlap: true, // 防止节点重叠</span><br><span class="line">        linkDistance: 100, // 指定边距离为100</span><br><span class="line">        // nodeSize: 30, // 节点大小，用于算法中防止节点重叠时的碰撞检测。由于已经在上一节的元素配置中设置了每个节点的 size 属性，则不需要在此设置 nodeSize。</span><br><span class="line">      &#125;,</span><br><span class="line">      animate: true, // 是否启用图的动画。</span><br><span class="line"></span><br><span class="line">      defaultNode: &#123;</span><br><span class="line">        size: 30,</span><br><span class="line">        labelCfg: &#123;</span><br><span class="line">          style: &#123;</span><br><span class="line">            fill: &quot;#fff&quot;,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      defaultEdge: &#123;</span><br><span class="line">        labelCfg: &#123;</span><br><span class="line">          autoRotate: true,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      container: &quot;mountNode&quot;, // 指定挂载容器</span><br><span class="line">      width: 800, // 图的宽度</span><br><span class="line">      height: 500, // 图的高度</span><br><span class="line">    &#125;);</span><br><span class="line">    // 鼠标进入节点</span><br><span class="line">    graph.on(&quot;node:mouseenter&quot;, (e) =&gt; &#123;</span><br><span class="line">      const nodeItem = e.item; // 获取鼠标进入的节点元素对象</span><br><span class="line">      graph.setItemState(nodeItem, &quot;hover&quot;, true); // 设置当前节点的 hover 状态为 true</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // 鼠标离开节点</span><br><span class="line">    graph.on(&quot;node:mouseleave&quot;, (e) =&gt; &#123;</span><br><span class="line">      const nodeItem = e.item; // 获取鼠标离开的节点元素对象</span><br><span class="line">      graph.setItemState(nodeItem, &quot;hover&quot;, false); // 设置当前节点的 hover 状态为 false</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // 点击节点</span><br><span class="line">    graph.on(&quot;node:click&quot;, (e) =&gt; &#123;</span><br><span class="line">      // 先将所有当前是 click 状态的节点置为非 click 状态</span><br><span class="line">      const clickNodes = graph.findAllByState(&quot;node&quot;, &quot;click&quot;);</span><br><span class="line">      console.log(&quot;Bowen: mounted -&gt; clickNodes&quot;, clickNodes);</span><br><span class="line">      clickNodes.forEach((cn) =&gt; &#123;</span><br><span class="line">        graph.setItemState(cn, &quot;click&quot;, false);</span><br><span class="line">      &#125;);</span><br><span class="line">      const nodeItem = e.item; // 获取被点击的节点元素对象</span><br><span class="line">      graph.setItemState(nodeItem, &quot;click&quot;, true); // 设置当前节点的 click 状态为 true</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // 点击边</span><br><span class="line">    graph.on(&quot;edge:click&quot;, (e) =&gt; &#123;</span><br><span class="line">      // 先将所有当前是 click 状态的边置为非 click 状态</span><br><span class="line">      const clickEdges = graph.findAllByState(&quot;edge&quot;, &quot;click&quot;);</span><br><span class="line">      clickEdges.forEach((ce) =&gt; &#123;</span><br><span class="line">        graph.setItemState(ce, &quot;click&quot;, false);</span><br><span class="line">      &#125;);</span><br><span class="line">      const edgeItem = e.item; // 获取被点击的边元素对象</span><br><span class="line">      graph.setItemState(edgeItem, &quot;click&quot;, true); // 设置当前边的 click 状态为 true</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    const main = async () =&gt; &#123;</span><br><span class="line">      const response = await fetch(</span><br><span class="line">        &quot;https://gw.alipayobjects.com/os/basement_prod/6cae02ab-4c29-44b2-b1fd-4005688febcb.json&quot;</span><br><span class="line">      );</span><br><span class="line">      const remoteData = await response.json();</span><br><span class="line"></span><br><span class="line">      const nodes = remoteData.nodes;</span><br><span class="line">      const edges = remoteData.edges;</span><br><span class="line">      nodes.forEach((node) =&gt; &#123;</span><br><span class="line">        if (!node.style) &#123;</span><br><span class="line">          node.style = &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        node.style.lineWidth = 1;</span><br><span class="line">        node.style.stroke = &quot;#666&quot;;</span><br><span class="line">        node.style.fill = &quot;steelblue&quot;;</span><br><span class="line">        switch (node.class) &#123;</span><br><span class="line">          case &quot;c0&quot;: &#123;</span><br><span class="line">            node.type = &quot;circle&quot;;</span><br><span class="line">            break;</span><br><span class="line">          &#125;</span><br><span class="line">          case &quot;c1&quot;: &#123;</span><br><span class="line">            node.type = &quot;rect&quot;;</span><br><span class="line">            node.size = [35, 20];</span><br><span class="line">            break;</span><br><span class="line">          &#125;</span><br><span class="line">          case &quot;c2&quot;: &#123;</span><br><span class="line">            node.type = &quot;ellipse&quot;;</span><br><span class="line">            node.size = [35, 20];</span><br><span class="line">            break;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      edges.forEach((edge) =&gt; &#123;</span><br><span class="line">        if (!edge.style) &#123;</span><br><span class="line">          edge.style = &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        edge.style.lineWidth = edge.weight;</span><br><span class="line">        edge.style.opacity = 0.6;</span><br><span class="line">        edge.style.stroke = &quot;grey&quot;;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      graph.data(remoteData);</span><br><span class="line">      graph.render();</span><br><span class="line">    &#125;;</span><br><span class="line">    main();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">/* 提示框的样式 */</span><br><span class="line">.g6-tooltip &#123;</span><br><span class="line">  border: 1px solid #e2e2e2;</span><br><span class="line">  border-radius: 4px;</span><br><span class="line">  font-size: 12px;</span><br><span class="line">  color: #545454;</span><br><span class="line">  background-color: rgba(255, 255, 255, 0.9);</span><br><span class="line">  padding: 10px 8px;</span><br><span class="line">  box-shadow: rgb(174, 174, 174) 0px 0px 10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// g6 主体位置</span><br><span class="line">canvas &#123;</span><br><span class="line">  position: relative;</span><br><span class="line">  z-index: 1;</span><br><span class="line">&#125;</span><br><span class="line">// 网格位置</span><br><span class="line">.g6-grid-container &#123;</span><br><span class="line">  z-index: 0 !important;</span><br><span class="line">  *,</span><br><span class="line">  ::before,</span><br><span class="line">  ::after &#123;</span><br><span class="line">    // 覆盖 vuetify  background-repeat: no-repeat;</span><br><span class="line">    background-repeat: repeat;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端可视化</category>
      </categories>
      <tags>
        <tag>AntV</tag>
      </tags>
  </entry>
  <entry>
    <title>CSS常见问题汇总</title>
    <url>/2020/06/08/CSS/CSS%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h2 id="flex-布局"><a href="#flex-布局" class="headerlink" title="flex 布局"></a>flex 布局</h2><h2 id="flex-布局下子元素-宽度或高度不生效"><a href="#flex-布局下子元素-宽度或高度不生效" class="headerlink" title="flex 布局下子元素 宽度或高度不生效"></a>flex 布局下子元素 宽度或高度不生效</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.father</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.child1</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 不生效 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100px</span>; </span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.child3</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">flex</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;father&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;child1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;child2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;child3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>child1 设置高度无效</p>
<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.child1</span>&#123;</span><br><span class="line">  <span class="comment">/* 生效 */</span></span><br><span class="line">  <span class="attribute">flex</span>:<span class="number">0</span> <span class="number">0</span> <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>CSS里的pointer-events属性</title>
    <url>/2020/12/30/CSS/CSS%E9%87%8C%E7%9A%84pointer-events%E5%B1%9E%E6%80%A7/</url>
    <content><![CDATA[<h2 id="因为-pointer-events-出现的问题"><a href="#因为-pointer-events-出现的问题" class="headerlink" title="因为 pointer-events 出现的问题"></a>因为 pointer-events 出现的问题</h2><p>在 Vuetify 项目中，因为在 input 中使用了 tooltip ，意愿是文字溢出隐藏显示… ,</p>
<p>但 input 在 disabled 的状态内部文字的 tooptip 居然不显示了</p>
<p>在控制台发现了这个样式</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.v-input--is-disabled</span><span class="selector-pseudo">:not</span>(<span class="selector-class">.v-input--is-readonly</span>) &#123;</span><br><span class="line">  <span class="attribute">pointer-events</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>pointer-events: none; 这个很不常用， 下面看下这个属性具体是干什么的 <a href="https://www.webhek.com/post/pointer-events.html">原文</a></p>
<h2 id="pointer-events"><a href="#pointer-events" class="headerlink" title="pointer-events"></a>pointer-events</h2><p>现代浏览器里 CSS 的职责范围和 JavaScript 的越来越模糊分不清。比如 CSS 里<code>-webkit-touch-callout</code>属性在 iOS 里能禁止当用户点击时弹出气泡框。而本文要说的<code>pointer-events</code>的风格更像 JavaScript，它能够：</p>
<ul>
<li>阻止用户的点击动作产生任何效果</li>
<li>阻止缺省鼠标指针的显示</li>
<li>阻止 CSS 里的<code>hover</code>和<code>active</code>状态的变化触发事件</li>
<li>阻止 JavaScript 点击动作触发的事件</li>
</ul>
<p>一个 CSS 属性能做所有的这么多事情！</p>
<h3 id="The-CSS"><a href="#The-CSS" class="headerlink" title="The CSS"></a>The CSS</h3><p>这个<code>pointer-events</code>属性有很多可以使用的属性值，但大部分都是针对 SVG 的：<code>auto</code>, <code>none</code>, <code>visiblePainted*</code>, <code>visibleFill*</code>, <code>visibleStroke*</code>, <code>visible*</code>, <code>painted*</code>, <code>fill*</code>, <code>stroke*</code>, <code>all*</code>, 以及 <code>inherit</code>。其中<code>none</code>值能阻止点击、状态变化和鼠标指针变化：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.disabled</span> &#123;</span><br><span class="line">  <span class="attribute">pointer-events</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一些需要注意的关于<code>pointer-events</code>的事项：</p>
<ul>
<li>子元素可以声明<code>pointer-events</code>来解禁父元素的阻止鼠标事件限制。</li>
<li>如果你对一个元素设置了 click 事件监听器，然后你移除了<code>pointer-events</code>样式声明，或把它的值改变为<code>auto</code>，监听器会重新生效。基本上，监听器会遵守<code>pointer-events</code>的设定。</li>
</ul>
<h2 id="处理问题"><a href="#处理问题" class="headerlink" title="处理问题"></a>处理问题</h2><p>为了只让 tooltip 显示，而 input 的本身的禁用还在，可以直接在 tooltip 中的显示文字上添加 pointer-events: auto; 即可</p>
<figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 内容部分</span></span><br><span class="line"><span class="selector-class">.tooltip-default-text</span> &#123;</span><br><span class="line">  <span class="attribute">pointer-events</span>: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>CSS</tag>
        <tag>Vuetify</tag>
      </tags>
  </entry>
  <entry>
    <title>Canvas入门</title>
    <url>/2021/07/05/%E5%89%8D%E7%AB%AF%E5%8F%AF%E8%A7%86%E5%8C%96/Canvas%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>前端可视化</category>
      </categories>
      <tags>
        <tag>Canvas</tag>
      </tags>
  </entry>
  <entry>
    <title>Canvas常见问题汇总</title>
    <url>/2022/07/05/%E5%89%8D%E7%AB%AF%E5%8F%AF%E8%A7%86%E5%8C%96/Canvas%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h2 id="drawImage-远端图片再使用-getImageData-时报错-Uncaught-in-promise-DOMException-Failed-to-execute-‘getImageData’-on-‘CanvasRenderingContext2D’-The-canvas-has-been-tainted-by-cross-origin-data"><a href="#drawImage-远端图片再使用-getImageData-时报错-Uncaught-in-promise-DOMException-Failed-to-execute-‘getImageData’-on-‘CanvasRenderingContext2D’-The-canvas-has-been-tainted-by-cross-origin-data" class="headerlink" title="drawImage 远端图片再使用 getImageData 时报错  Uncaught (in promise) DOMException: Failed to execute ‘getImageData’ on ‘CanvasRenderingContext2D’: The canvas has been tainted by cross-origin data"></a>drawImage 远端图片再使用 getImageData 时报错  Uncaught (in promise) DOMException: Failed to execute ‘getImageData’ on ‘CanvasRenderingContext2D’: The canvas has been tainted by cross-origin data</h2><p>意思是使用的图片跨域了</p>
<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>图片 dom 或标签添加属性</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;source&quot;</span> <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span> <span class="attr">src</span>=<span class="string">&quot;xxx&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// DOM</span></span><br><span class="line">image.<span class="property">crossorigin</span> = <span class="string">&quot;anonymous&quot;</span></span><br></pre></td></tr></table></figure>

<p>同时图片的静态资源服务器要配合添加允许CORS跨域的请求头</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Access-Control-Allow-Credentials</span><span class="punctuation">: </span>true</span><br><span class="line"><span class="attribute">Access-Control-Allow-Headers</span><span class="punctuation">: </span>Accept-Ranges, Content-Encoding,  Content-Range, content-type,Content-Length, Authorization,Origin,Accept,X-Requested-With</span><br><span class="line"><span class="attribute">Access-Control-Allow-Methods</span><span class="punctuation">: </span>POST, GET, OPTIONS, PUT</span><br><span class="line"><span class="attribute">Access-Control-Allow-Origin</span><span class="punctuation">: </span>*</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端可视化</category>
      </categories>
      <tags>
        <tag>Canvas</tag>
      </tags>
  </entry>
  <entry>
    <title>DOM&amp;BOM常见问题汇总</title>
    <url>/2021/03/25/js/DOM-BOM%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h1 id="getBoundingClientRect-获取不准确"><a href="#getBoundingClientRect-获取不准确" class="headerlink" title="getBoundingClientRect 获取不准确"></a>getBoundingClientRect 获取不准确</h1><h2 id="getBoundingClientRect"><a href="#getBoundingClientRect" class="headerlink" title="getBoundingClientRect"></a>getBoundingClientRect</h2><p>用于获取元素的定位: <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/getBoundingClientRect">官方文档</a></p>
<p>通常包含这几个属性</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">bottom</span>: <span class="number">497</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">177</span>,</span><br><span class="line">    <span class="attr">left</span>: <span class="number">131.296875</span>,</span><br><span class="line">    <span class="attr">right</span>: <span class="number">1181.6875</span>,</span><br><span class="line">    <span class="attr">top</span>: <span class="number">320</span>,</span><br><span class="line">    <span class="attr">width</span>: <span class="number">1050.390625</span>,</span><br><span class="line">    <span class="attr">x</span>: <span class="number">131.296875</span>,</span><br><span class="line">    <span class="attr">y</span>: <span class="number">320</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取不准确"><a href="#获取不准确" class="headerlink" title="获取不准确"></a>获取不准确</h3><h3 id="原因："><a href="#原因：" class="headerlink" title="原因："></a>原因：</h3><blockquote>
<p>但是在元素有 css 动画进行中获取元素的定位会导，获取的定位不准确现象，为此需要在动画结束后再获取元素的定位</p>
</blockquote>
<h3 id="其他注意事项："><a href="#其他注意事项：" class="headerlink" title="其他注意事项："></a>其他注意事项：</h3><p>该 API 返回的 <code>DOMRect</code> 对象在现代浏览器中可以被修改。而对于返回值为 <code>DOMRectReadOnly</code> 的旧版本，返回值并不能被修改。在 IE 和 Edge 浏览器中，无法向他们返回的 <a href="https://msdn.microsoft.com/en-us/library/hh826029(VS.85).aspx"><code>ClientRect</code></a> 对象添加缺失的属性，对象可以防止 <code>x</code> 和 <code>y</code> 的回填。</p>
<p>由于兼容性问题（见下文），尽量仅使用 <code>left</code>, <code>top</code>, <code>right</code>, 和 <code>bottom</code>.属性是最安全的。</p>
<p>返回的 <code>DOMRect</code>对象中的属性不是自己的属性。 当使用<code>in</code> 和 <code>for...in</code> 运算符时能成功查找到返回的属性，但使用其他 API（例如 Object.keys（））查找时将失败。 而且，ES2015 和更高版本的功能（如 Object.assign（）和对象 rest&#x2F;spread）将无法复制返回的属性</p>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>DOM&amp;BOM</tag>
      </tags>
  </entry>
  <entry>
    <title>Data URI详细介绍</title>
    <url>/2020/12/31/HTML/Data-URI%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/</url>
    <content><![CDATA[<p>最近学习 webpack 遇到了 Data URI 这种格式，觉得很有趣稍微学习一下，转载一篇别人写的比较好的文章；</p>
<p>原文地址：<a href="https://blog.csdn.net/qq_38128179/article/details/100663085">https://blog.csdn.net/qq_38128179/article/details/100663085</a></p>
<h2 id="一、URI-介绍"><a href="#一、URI-介绍" class="headerlink" title="一、URI 介绍"></a>一、URI 介绍</h2><p>URI（统一资源标识符） 是 uniform resource identifier 的缩写，它定义了接受内容的协议以及附带的相关内容，如果附带的相关内容是一个地址，那么此时的 URI 也是一个 URL （uniform resource locator<code> </code>)。</p>
<h2 id="二、什么是-data-URI-scheme？"><a href="#二、什么是-data-URI-scheme？" class="headerlink" title="二、什么是 data URI scheme？"></a>二、什么是 data URI scheme？</h2><p>Data URI scheme 简称 Data URI，经常会被<strong>错误</strong>地写成 data URLs。即前缀为 data：协议的的 URL，其允许内容创建者向文档中嵌入小文件。</p>
<blockquote>
<p>假设我们有一个图片需要显示在网页上</p>
<p>1、通常我们会使用 http 链接，这种取得资料的方法称为 <strong>http URI scheme</strong>：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// 从外部请求一张图片</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://pic1.win4000.com/wallpaper/c/53cdd1f7c1f21.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、使用 <strong>data URI scheme</strong> 获取资料可以写成：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// 在HTML中嵌入一个小红点的图片</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">alt</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过 data RUI scheme，我们把图像内容内置在 HTML 中，节省了一个 HTTP 请求。</p>
</blockquote>
<h2 id="三、Data-URI-scheme-的语法"><a href="#三、Data-URI-scheme-的语法" class="headerlink" title="三、Data URI scheme 的语法"></a>三、<strong>Data URI scheme 的语法</strong></h2><blockquote>
<p><strong>data:①[<mime type>]②[;charset&#x3D;<charset>]③[;<encoding>]④,<encoded data>⑤</strong></p>
</blockquote>
<p><strong>【1】第 ① 部分 data：</strong> 协议头，它标识这个内容为一个 data URI 资源。</p>
<p><strong>【2】第 ② 部分 MIME 类型（可选项）：</strong>浏览器通常使用 MIME 类型（而不是文件扩展名）来确定如何处理文档；因此服务器设置正确以将正确的 MIME 类型附加到响应对象的头部是非常重要的。MIME 类型对大小写不敏感，但是传统写法都是小写。</p>
<table>
<thead>
<tr>
<th><strong>类型</strong></th>
<th><strong>描述</strong></th>
<th>**示例（语法：type&#x2F;subtype 类型&#x2F;子类型****）**</th>
</tr>
</thead>
<tbody><tr>
<td>text</td>
<td>表明文件是普通文件，理论上是人类可读的</td>
<td><strong>text&#x2F;plain，text&#x2F;html，text&#x2F;css，text&#x2F;javascript</strong></td>
</tr>
<tr>
<td>image</td>
<td>表明文件某种是图像文件，gif 动态图也属于 image 类型</td>
<td><strong>image&#x2F;gif，image&#x2F;png，image&#x2F;jpeg，image&#x2F;bmp，image&#x2F;webp，image&#x2F;x-icon，image&#x2F;vnd.microsoft.icon</strong></td>
</tr>
<tr>
<td>audio</td>
<td>表明文件是某种音频文件</td>
<td><strong>audio&#x2F;midi，audio&#x2F;mpeg，audio&#x2F;webm，audio&#x2F;ogg，audio&#x2F;wav</strong></td>
</tr>
<tr>
<td>video</td>
<td>表明文件是某种视频文件</td>
<td><strong>video&#x2F;webm，video&#x2F;ogg</strong></td>
</tr>
<tr>
<td>application</td>
<td>表明文件是某种二进制数据</td>
<td><strong>application&#x2F;octet-stream，application&#x2F;pkcs12，application&#x2F;vnd.mspowerpoint，application&#x2F;xhtml+xml，application&#x2F;xml，application&#x2F;pdf</strong></td>
</tr>
</tbody></table>
<p><strong>【3】第 ③ 部分 <a href="%E5%8F%AF%E9%80%89%E9%A1%B9">;charset&#x3D;<charset></a>：</strong> 源文本的字符集编码方式，默认编码是 charset&#x3D;US-ASCII, 即数据部分的每个字符都会自动编码为 %xx</p>
<p><strong>【4】第 ④ 部分 [;<encoding>] ：</strong> 数据编码方式（默认 US-ASCII，BASE64 两种）</p>
<p><strong>【5】第 ⑤ 部分 ,<encoded data></strong> <strong>：</strong> 编码后的数据</p>
<blockquote>
<p>关于 base64 可以参考阮一峰写的文章：<a href="http://www.ruanyifeng.com/blog/2008/06/base64.html">http://www.ruanyifeng.com/blog/2008/06/base64.html</a></p>
</blockquote>
<h2 id="四、Data-URI-scheme-的利弊"><a href="#四、Data-URI-scheme-的利弊" class="headerlink" title="四、Data URI scheme 的利弊"></a>四、<strong>Data URI scheme 的利弊</strong></h2><blockquote>
<p><strong>利：</strong></p>
<ul>
<li>减少 HTTP 请求</li>
<li>当访问外部资源很麻烦或受限时（比如服务器 ip 被墙）</li>
<li>当图片是在服务器端用程序动态生成，每个访问用户显示的都不同时</li>
<li>当图片的体积太小，占用一个 HTTP 会话不值得时</li>
<li>没有图片更新要重新上传，还要清理缓存的问题</li>
</ul>
<p><strong>弊：</strong></p>
<ul>
<li>Base64 编码的数据体积通常是原数据的体积 4&#x2F;3，也就是 Data URL 形式的图片会比二进制格式的图片体积大 1&#x2F;3</li>
<li>Data URL 形式的图片不会被浏览器缓存，这意味着每次访问页面时都被下载一次。</li>
<li>增加了 CSS 文件的尺寸</li>
<li>IE678 兼容性</li>
<li>不适合 lazy loading</li>
<li>不利于维护</li>
<li>移动端不宜使用 Data URI 技术（解码耗 CPU）</li>
</ul>
</blockquote>
<h2 id="五、Data-URI-scheme-的应用实例"><a href="#五、Data-URI-scheme-的应用实例" class="headerlink" title="五、Data URI scheme 的应用实例"></a>五、<strong>Data URI scheme 的应用实例</strong></h2><p><strong>【1】在 Html 的 Img 对象中使用</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBQAAF...&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>【2】在 Css 的 background-image 属性中使用</strong></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span><span class="selector-class">.image</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBQAAF...</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>【3】在 Html 的 css 链接处使用</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span></span></span><br><span class="line"><span class="tag">  <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">href</span>=<span class="string">&quot;data:text/css;base64,LyogKioqKiogVGVtcGxhdGUgKioq...&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>【4】在 Html 的 javaScript 链接处使用</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">&quot;data:text/javascript;base64,LyogKioqKiogVGVtcGxhdGUgKioq...&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>【5】data RUI scheme 也可以直接在浏览器的地址栏中输入进行访问</strong></p>
<p><strong>①</strong>在浏览器中输入以下的 Url，会得到一个加粗的”Hello, world!”。也就是说，data:后面的数据直接用做网页的内容，而不是网页的地址。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">data</span>: text / html,</span><br><span class="line">  (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">b</span>&gt;</span>Hello, world!<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line">  );</span><br></pre></td></tr></table></figure>

<p><strong>②</strong>下面的例子会显示出 “你好，中文！”。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">data</span>:text/plain;charset=<span class="variable constant_">UTF</span>-<span class="number">8</span>;base64,5L2g5aW977yM5Lit5paH77yB</span><br></pre></td></tr></table></figure>

<h2 id="六、兼容-IE678-MHTML"><a href="#六、兼容-IE678-MHTML" class="headerlink" title="六、兼容 IE678 - MHTML"></a>六、兼容 IE678 - MHTML</h2><p>MHTML 即 MIME HTML（Multipurpose Internet Mail Extensions HyperText Markup Language），就是将 Data URI 以附件的形式附加到页面页面上，具体示例如下：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** FilePath: http://example.com/test.css */</span></span><br><span class="line"><span class="comment">/*!@ignore</span></span><br><span class="line"><span class="comment">Content-Type: multipart/related; boundary=&quot;_ANY_SEPARATOR&quot;</span></span><br><span class="line"><span class="comment">--_ANY_SEPARATOR</span></span><br><span class="line"><span class="comment">Content-Location:myidBackground</span></span><br><span class="line"><span class="comment">Content-Transfer-Encoding:base64</span></span><br><span class="line"><span class="comment">iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==</span></span><br><span class="line"><span class="comment">--_ANY_SEPARATOR--</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="selector-class">.myid</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==&quot;</span>);</span><br><span class="line">  *<span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">mhtml:http://example.com/test.css!myidBackground</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面注释的部分就是一个附件， 这个附件的内容是一个名为 myidBackground 的 Base64 编码图片，然后在 class 为 myid 的 css 中使用。</p>
<p>注意：1、boundary 字段值可自定义；</p>
<p>​ 2、附件的末行必须为 boundary 字段值；</p>
<p>​ 3、附件内容不能被压缩工具擦写掉；</p>
<p>​ 4、由于高版本的 IE 在使用 IE8 兼容模式时能认识*这个 css hack 符号，但却不支持 mhtml，所以会导致背景图片失效。应该采用 IE 的条件注释更为稳妥。</p>
<h2 id="七、base64-转换工具"><a href="#七、base64-转换工具" class="headerlink" title="七、base64 转换工具"></a>七、base64 转换工具</h2><p><a href="http://www.pjhome.net/web/html5/encodeDataUrl.htm">Encode Data URL </a></p>
<p><a href="http://www.atool9.com/img2base64.php">aTool 在线工具</a></p>
<p><a href="https://duri.me/">Duri.me</a></p>
<p><a href="https://dataurl.sveinbjorn.org/#dataurlmaker">DATAURL</a></p>
]]></content>
      <categories>
        <category>HTML</category>
      </categories>
      <tags>
        <tag>CSS</tag>
        <tag>js</tag>
        <tag>HTML</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker入门</title>
    <url>/2021/07/02/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/Docker%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<p>阮一峰教程：</p>
<p><a href="https://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html">Docker 入门教程</a><br><a href="https://www.ruanyifeng.com/blog/2018/02/docker-wordpress-tutorial.html">Docker 微服务教程</a></p>
<h2 id="以-Jenkins-为例的使用过程"><a href="#以-Jenkins-为例的使用过程" class="headerlink" title="以 Jenkins 为例的使用过程"></a>以 Jenkins 为例的使用过程</h2><p>下载镜像</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull jenkins/jenkins</span><br></pre></td></tr></table></figure>

<p>启动容器</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">docker run -d -p <span class="number">8868</span>:<span class="number">8080</span> -p <span class="number">10241</span>:<span class="number">50000</span> -v C:<span class="regexp">/test/</span>jenkins:<span class="regexp">/var/</span>jenkins_home -v C:<span class="regexp">/test/</span>localtime:<span class="regexp">/etc/</span>localtime --name myjenkins <span class="number">9927</span>cde587ad</span><br></pre></td></tr></table></figure>

<p>创建并启动 Jenkins 容器</p>
<p><strong>-d 后台运行镜像</strong></p>
<p><strong>-p 10240:8080 将镜像的 8080 端口映射到服务器的 10240 端口。</strong></p>
<p><strong>-p 10241:50000 将镜像的 50000 端口映射到服务器的 10241 端口</strong></p>
<p><strong>-v &#x2F;var&#x2F;jenkins_**mount**:&#x2F;var&#x2F;jenkins_mount &#x2F;var&#x2F;jenkins_home 目录为容器 jenkins 工作目录，我们将硬盘上的一个目录挂载到这个位置，方便后续更新镜像后继续使用原来的工作目录。这里我们设置的就是上面我们创建的 &#x2F;var&#x2F;jenkins_mount 目录 (文件映射)</strong></p>
<p><strong>-v &#x2F;etc&#x2F;localtime:&#x2F;etc&#x2F;localtime 让容器使用和服务器同样的时间设置。</strong></p>
<p><strong>–name myjenkins 给容器起一个别名</strong></p>
<p>查看 jenkins 是否启动成功，如下图出现端口号，就为启动成功了</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">docker ps -l</span></span><br></pre></td></tr></table></figure>

<p>查看 docker 容器日志</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">docker logs myjenkins</span></span><br></pre></td></tr></table></figure>

<h2 id="Docker-查看镜像仓库中镜像的版本信息"><a href="#Docker-查看镜像仓库中镜像的版本信息" class="headerlink" title="Docker-查看镜像仓库中镜像的版本信息"></a>Docker-查看镜像仓库中镜像的版本信息</h2><p>浏览器中查看</p>
<p>直接在浏览器中个输入下面URL格式的地址查询</p>
<p><a href="https://registry.hub.docker.com/v1/repositories/%7Bdocker_img%7D/tags">https://registry.hub.docker.com/v1/repositories/{docker_img}/tags</a></p>
<p>例如：node<br><a href="https://registry.hub.docker.com/v1/repositories/node/tags">https://registry.hub.docker.com/v1/repositories/node/tags</a></p>
]]></content>
      <categories>
        <category>工具使用</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker 利用buildx插件构建多平台镜像</title>
    <url>/2022/09/06/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/Docker%E5%88%A9%E7%94%A8buildx%E6%8F%92%E4%BB%B6%E6%9E%84%E5%BB%BA%E5%A4%9A%E5%B9%B3%E5%8F%B0%E9%95%9C%E5%83%8F/</url>
    <content><![CDATA[<h2 id="安装-Docker-Buildx"><a href="#安装-Docker-Buildx" class="headerlink" title="安装 Docker Buildx"></a>安装 Docker Buildx</h2><p><a href="https://docs.docker.com/build/buildx/install/">安装 Docker Buildx</a></p>
<h2 id="运行-Docker-镜像分发的跨平台模拟器"><a href="#运行-Docker-镜像分发的跨平台模拟器" class="headerlink" title="运行 Docker 镜像分发的跨平台模拟器"></a>运行 Docker 镜像分发的跨平台模拟器</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run --privileged --<span class="built_in">rm</span> tonistiigi/binfmt --install all</span><br></pre></td></tr></table></figure>

<h2 id="创建-docker-container-驱动程序的新构建器"><a href="#创建-docker-container-驱动程序的新构建器" class="headerlink" title="创建 docker-container 驱动程序的新构建器"></a>创建 docker-container 驱动程序的新构建器</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker buildx create --name container --driver docker-container</span><br></pre></td></tr></table></figure>

<p>然后我们应该能够在我们的可用构建器列表中看到它：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker buildx <span class="built_in">ls</span></span><br></pre></td></tr></table></figure>

<h3 id="创建项目文件夹添加-Dockerfile"><a href="#创建项目文件夹添加-Dockerfile" class="headerlink" title="创建项目文件夹添加 Dockerfile"></a>创建项目文件夹添加 Dockerfile</h3><p>创建文件夹  <code>mkdir docker_buildx_demo_01</code> <code>cd docker_buildx_demo_01</code><br>创建 Dockerfile <code>touch Dockerfile</code></p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># syntax=docker/dockerfile:1 $TARGETPLATFORM 表示目标平台</span></span><br><span class="line"><span class="keyword">FROM</span> --platform=$TARGETPLATFORM golang:alpine AS build</span><br><span class="line"><span class="keyword">ARG</span> TARGETPLATFORM</span><br><span class="line"><span class="keyword">ARG</span> BUILDPLATFORM</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;I am running on <span class="variable">$BUILDPLATFORM</span>, building for <span class="variable">$TARGETPLATFORM</span>&quot;</span> &gt; /log</span></span><br><span class="line"><span class="keyword">FROM</span> --platform=$TARGETPLATFORM alpine:latest</span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=build /log /log</span></span><br></pre></td></tr></table></figure>

<h2 id="单独为个别平台构建镜像并输出文件"><a href="#单独为个别平台构建镜像并输出文件" class="headerlink" title="单独为个别平台构建镜像并输出文件"></a>单独为个别平台构建镜像并输出文件</h2><p><a href="https://docs.docker.com/build/buildx/multiplatform-images/">构建多平台镜像</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># x86</span></span><br><span class="line">docker buildx build  --platform linux/amd64 -t docker_buildx_demo:x86 -o <span class="built_in">type</span>=docker,dest=./docker_buildx_demo_x86.tar  .</span><br><span class="line"><span class="comment"># ppc64le</span></span><br><span class="line">docker buildx build  --platform linux/ppc64le -t docker_buildx_demo:ppc64le -o <span class="built_in">type</span>=docker,dest=./docker_buildx_demo_ppc64le.tar  .</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="各个平台分别加载加载文件"><a href="#各个平台分别加载加载文件" class="headerlink" title="各个平台分别加载加载文件"></a>各个平台分别加载加载文件</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># x86</span></span><br><span class="line"> docker load -i docker_buildx_demo_x86.tar</span><br><span class="line"><span class="comment"># ppc64le</span></span><br><span class="line"> docker load -i docker_buildx_demo_ppc64le.tar </span><br></pre></td></tr></table></figure>

<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a href="https://blog.csdn.net/easylife206/article/details/118004740">巧用 Docker Buildx 构建多种系统架构镜像</a></p>
]]></content>
      <categories>
        <category>工具使用</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>ESlint的使用</title>
    <url>/2022/01/27/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/ESlint%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="官方网站"><a href="#官方网站" class="headerlink" title="官方网站"></a>官方网站</h2><p><a href="https://eslint.bootcss.com/docs/user-guide/getting-started">eslint 官网</a><br><a href="https://github.com/prettier/eslint-plugin-prettier#eslint-plugin-prettier-">eslint-plugin-prettier 官网</a><br><a href="https://www.npmjs.com/package/lint-staged">lint-staged 官网</a><br><a href="https://prettier.io/docs/en/cli.html#--write">prettier 官网</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install eslint --save-dev</span><br></pre></td></tr></table></figure>

<h3 id="配合-prettier-安装"><a href="#配合-prettier-安装" class="headerlink" title="配合 prettier 安装"></a>配合 prettier 安装</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install eslint eslint-config-prettier eslint-plugin-prettier prettier --save-dev</span><br></pre></td></tr></table></figure>

<h2 id="初始化配置"><a href="#初始化配置" class="headerlink" title="初始化配置"></a>初始化配置</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./node_modules/.bin/eslint --init</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npx eslint --init</span><br></pre></td></tr></table></figure>

<p>根据提示进行配置</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npx eslint --init</span><br><span class="line">You can also run this <span class="built_in">command</span> directly using <span class="string">&#x27;npm init @eslint/config&#x27;</span>.</span><br><span class="line">√ How would you like to use ESLint? · style</span><br><span class="line">√ What <span class="built_in">type</span> of modules does your project use? · none</span><br><span class="line">√ Which framework does your project use? · none</span><br><span class="line">√ Does your project use TypeScript? · No / Yes</span><br><span class="line">√ Where does your code run? · browser</span><br><span class="line">√ How would you like to define a style <span class="keyword">for</span> your project? · prompt</span><br><span class="line">√ What format <span class="keyword">do</span> you want your config file to be <span class="keyword">in</span>? · JavaScript</span><br><span class="line">√ What style of indentation <span class="keyword">do</span> you use? · tab</span><br><span class="line">√ What quotes <span class="keyword">do</span> you use <span class="keyword">for</span> strings? · double</span><br><span class="line">√ What line endings <span class="keyword">do</span> you use? · unix</span><br><span class="line">√ Do you require semicolons? · No / Yes</span><br><span class="line">A config file was generated, but the config file itself may not follow your linting rules.</span><br><span class="line">Successfully created .eslintrc.js file <span class="keyword">in</span> C:\ls-project03\miniprogr</span><br></pre></td></tr></table></figure>

<p>运行 <code>eslint --init</code> 之后，<code>.eslintrc</code> 文件会在你的文件夹中自动创建</p>
<h3 id="配合-prettier-的配置"><a href="#配合-prettier-的配置" class="headerlink" title="配合 prettier 的配置"></a>配合 prettier 的配置</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">env</span>: &#123;</span><br><span class="line">    <span class="attr">browser</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">es2021</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 添加 prettier 预设配置</span></span><br><span class="line"> + <span class="attr">extends</span>: [<span class="string">&quot;plugin:prettier/recommended&quot;</span>],</span><br><span class="line">  <span class="attr">parserOptions</span>: &#123;</span><br><span class="line">    <span class="attr">ecmaVersion</span>: <span class="string">&quot;latest&quot;</span>,</span><br><span class="line">    <span class="attr">sourceType</span>: <span class="string">&quot;module&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">  <span class="comment">// prettier 错误变为警告</span></span><br><span class="line">  +  <span class="string">&quot;prettier/prettier&quot;</span>: [<span class="string">&quot;warn&quot;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="设置排除文件"><a href="#设置排除文件" class="headerlink" title="设置排除文件"></a>设置排除文件</h2><h3 id="eslintignore"><a href="#eslintignore" class="headerlink" title=".eslintignore"></a>.eslintignore</h3><p>项目目录添加<code>.eslintignore</code> 文件,添加需要 eslint 排除的文件 默认排除 node_modules</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">node_modules</span></span><br></pre></td></tr></table></figure>

<h3 id="prettierignore"><a href="#prettierignore" class="headerlink" title=".prettierignore"></a>.prettierignore</h3><p>项目目录添加<code>.prettierignore</code> 文件,添加需要 prettier 排除的文件 tip:prettier 默认排除 node_modules</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">node_modules</span></span><br></pre></td></tr></table></figure>

<h2 id="添加-npm-脚本"><a href="#添加-npm-脚本" class="headerlink" title="添加 npm 脚本"></a>添加 npm 脚本</h2><p>package.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"> + <span class="attr">&quot;lint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prettier --write .&quot;</span><span class="punctuation">,</span></span><br><span class="line"> + <span class="attr">&quot;lint:js&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eslint --fix .&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p><code>prettier --write . </code> 修复项目目录下所有文件,&#96;&#96;.prettierignore<code> </code>会被排除</p>
<p><code>eslint --fix . </code> 修复项目目录下所有 js 文件,&#96;&#96;.eslintignore<code> </code>会被排除</p>
<h2 id="设置-commit-时自动-lint"><a href="#设置-commit-时自动-lint" class="headerlink" title="设置 commit 时自动 lint"></a>设置 commit 时自动 lint</h2><p>安装 husky 和 lint-staged 并自动配置</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npx mrm@2 lint-staged</span><br></pre></td></tr></table></figure>

<p>修改 package.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;lint-staged&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   - <span class="attr">&quot;*.js&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eslint --cache --fix&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="comment">// 使用 prettier 进行 lint</span></span><br><span class="line">   +<span class="attr">&quot;*&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prettier --ignore-unknown --write&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>前端工程化</category>
      </categories>
      <tags>
        <tag>ESlint</tag>
        <tag>prettier</tag>
      </tags>
  </entry>
  <entry>
    <title>Electron项目中常见问题汇总</title>
    <url>/2021/06/07/Electron/Electron%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h2 id="环境依赖"><a href="#环境依赖" class="headerlink" title="环境依赖"></a>环境依赖</h2><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><blockquote>
<p>Windows 环境依赖需要 Visual Studio 和 python<br>Visual Studio 和 python 在安装 node 时会提示安装 window 对应的编译环境勾选安装即可， 或使用脚本安装编译环境，也可以使用 npm 全局安装 <a href="https://github.com/felixrieseberg/windows-build-tools">windows-build-tools</a></p>
</blockquote>
<p><img data-src="https://bitbw.top/public/img/my_gallery/20220113140323.png" alt="image-20220113102005114"></p>
<h3 id="MacOS"><a href="#MacOS" class="headerlink" title="MacOS"></a>MacOS</h3><blockquote>
<p>MacOS 环境依赖需要 CommandLineTools (Xcode命令行工具)和 python</p>
</blockquote>
<h2 id="electron-更新到-12-后提示-Require-is-not-defined"><a href="#electron-更新到-12-后提示-Require-is-not-defined" class="headerlink" title="electron 更新到 12 后提示 Require is not defined"></a>electron 更新到 12 后提示 Require is not defined</h2><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>将项目从 electron 6 升级到 electron 12 后，启动项目渲染进程控制台提示：Require is not defined</p>
<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>项目使用 vue-cli-plugin-electron-builder 搭建，在 vue-cli-plugin-electron-builder 的 github 问题上找到对应答案</p>
<p>问题地址：<a href="https://github.com/nklayman/vue-cli-plugin-electron-builder/issues/1349">https://github.com/nklayman/vue-cli-plugin-electron-builder/issues/1349</a></p>
<p>在 new BrowserWindow 中添加 nodeIntegration 和 contextIsolation 的对应配置</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> win = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">webPreferences</span>: &#123;</span><br><span class="line">    <span class="comment">// Use pluginOptions.nodeIntegration, leave this alone</span></span><br><span class="line">    <span class="comment">// See nklayman.github.io/vue-cli-plugin-electron-builder/guide/security.html#node-integration for more info</span></span><br><span class="line">    <span class="attr">nodeIntegration</span>: process.<span class="property">env</span>.<span class="property">ELECTRON_NODE_INTEGRATION</span>,</span><br><span class="line">    <span class="attr">contextIsolation</span>: !process.<span class="property">env</span>.<span class="property">ELECTRON_NODE_INTEGRATION</span>,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>同时修改 vue.config.js</p>
<p>官方说明：<a href="https://nklayman.github.io/vue-cli-plugin-electron-builder/guide/security.html#node-integration">https://nklayman.github.io/vue-cli-plugin-electron-builder/guide/security.html#node-integration</a></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="attr">pluginOptions</span>: &#123;</span><br><span class="line">    <span class="attr">electronBuilder</span>: &#123;</span><br><span class="line">      <span class="attr">nodeIntegration</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">//...</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>fs.existsSync is not a function</p>
<h2 id="使用-vue-cli-plugin-electron-builder-的项目修改主进程和渲染进程入口文件"><a href="#使用-vue-cli-plugin-electron-builder-的项目修改主进程和渲染进程入口文件" class="headerlink" title="使用 vue-cli-plugin-electron-builder 的项目修改主进程和渲染进程入口文件"></a>使用 vue-cli-plugin-electron-builder 的项目修改主进程和渲染进程入口文件</h2><p>修改 vue.config.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="attr">pluginOptions</span>: &#123;</span><br><span class="line">    <span class="attr">electronBuilder</span>: &#123;</span><br><span class="line">      <span class="attr">mainProcessFile</span>: <span class="string">&quot;src/main/index.js&quot;</span>,</span><br><span class="line">      <span class="attr">rendererProcessFile</span>: <span class="string">&quot;src/renderer/index.js&quot;</span>,</span><br><span class="line">      <span class="attr">mainProcessWatch</span>: [<span class="string">&quot;src/main&quot;</span>],</span><br><span class="line">      <span class="comment">//...</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="使用-ipcRenderer-sendSync-进程通信后程序卡住（阻塞）问题"><a href="#使用-ipcRenderer-sendSync-进程通信后程序卡住（阻塞）问题" class="headerlink" title="使用 ipcRenderer.sendSync 进程通信后程序卡住（阻塞）问题"></a>使用 ipcRenderer.sendSync 进程通信后程序卡住（阻塞）问题</h2><p>使用 ipcRenderer.sendSync 方法进行通信 ,对应的 ipcMain.on 中必须使用 event.returnValue 返回结果</p>
<p>否则 sendSync 会将阻塞整个渲染进程 ，导致程序卡住</p>
<h3 id="官方文档中的警告"><a href="#官方文档中的警告" class="headerlink" title="官方文档中的警告"></a>官方文档中的警告</h3><blockquote>
<p>⚠️<strong>警告</strong>：发送同步消息会阻塞整个渲染器进程，直到收到回复，所以只能作为最后的手段使用此方法。使用异步版本要好得多，<a href="https://www.electronjs.org/docs/api/ipc-renderer#ipcrendererinvokechannel-args"><code>invoke()</code></a>.</p>
</blockquote>
<p>所以尽量使用 ipcRenderer. send 而非 sendSync 方法，<br>或者再每个 ipcMain.on 中都添加返回值 event.returnValue ，但是如果操作中报错可能还会导致卡死（阻塞）</p>
<h3 id="建议"><a href="#建议" class="headerlink" title="建议"></a>建议</h3><p> 如果只需要让主进程执要返行一些操作不需要返回值 就使用 <code>ipcRenderer.send</code> 和 <code>ipcMain.on</code> 组合<br> 如果需要主进程返回值 就使用 <code>ipcRenderer.invoke</code> 和 <code>ipcMain.handle</code> 组合<br> <code>ipcRenderer.sendSync</code> 在任何情况下都不使用</p>
<h2 id="electron-vue-项目添加-vue-devTools-Unrecognized-manifest-key-‘browser-action‘-Permission-‘contextMenus‘"><a href="#electron-vue-项目添加-vue-devTools-Unrecognized-manifest-key-‘browser-action‘-Permission-‘contextMenus‘" class="headerlink" title="electron+vue 项目添加 vue-devTools Unrecognized manifest key ‘browser_action‘. Permission ‘contextMenus‘"></a>electron+vue 项目添加 vue-devTools Unrecognized manifest key ‘browser_action‘. Permission ‘contextMenus‘</h2><h3 id="构建-vue-devtools"><a href="#构建-vue-devtools" class="headerlink" title="构建 vue-devtools"></a>构建 vue-devtools</h3><p>手动 clone 项目<code>vue-devtools</code><br><code>git clone https://github.com/vuejs/vue-devtools.git</code><br>然后切换到<code>add-remote-devtools</code>分支，默认的是<code>main</code>分支：<br><code>git checkout add-remote-devtools</code><br>进入<code>vue-devtools</code>根目录：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">yarn run build</span><br></pre></td></tr></table></figure>

<p>run build</p>
<p><em>这一步会出现一个特别恶心的 webpack,webpack-cli 互相依赖缺失的问题，提示没有 webpack 模块，然后全局安装 webpack 模块，npm install -g webpack，这时候运行 webpack 指令，会发现缺失 webpack-cli，再次全局安装 webpack-cli，npm install -g webpack-cli，这时候运行 webpack-cli 指令，又莫名其妙的提示缺失 webpack 模块。</em></p>
<p><em>原因就是 webpack4.0 的问题，解决办法就是安装指定版本的 webpack：npm install -g <a href="mailto:&#119;&#x65;&#98;&#x70;&#97;&#99;&#107;&#x40;&#x33;&#46;&#x36;&#46;&#48;">&#119;&#x65;&#98;&#x70;&#97;&#99;&#107;&#x40;&#x33;&#46;&#x36;&#46;&#48;</a>，而不是默认，默认会出现 4 以上版本，甚至 5.1 版本或者更高。</em></p>
<p><em>但是有的系统如果以前全局安装过 webpack，还是会报这些相互依赖的问题，或者是环境变量导致的 webpack,webpack-cli 安装进了 node 目录，而以前有的 webpack 安装进了 C:\Users\Administrator\AppData\Roaming\npm 这个目录。解决办法就是删除 C:\Users\Administrator\AppData\Roaming\npm 目录下的 webpack。</em></p>
<h3 id="修改代码"><a href="#修改代码" class="headerlink" title="修改代码"></a>修改代码</h3><p>然后将 build 生成的 shells 目录中的 chrome 目录拷贝出来，这个就是 build 生成的 vue-devtools 插件<br>浏览器安装容易，直接打开插件管理，切换开发模式，加载已解压插件，选择刚刚的 chrome 目录就行了。但是 electron 项目中安装会有点麻烦：</p>
<p>找到 background.js 文件 (如果没有 background.js 找到 main&#x2F;index.js)，找到这段代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.<span class="title function_">on</span>(<span class="string">&quot;ready&quot;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (isDevelopment &amp;&amp; !process.<span class="property">env</span>.<span class="property">IS_TEST</span>) &#123;</span><br><span class="line">    <span class="comment">// Install Vue Devtools</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="title function_">installExtension</span>(<span class="variable constant_">VUEJS_DEVTOOLS</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Vue Devtools failed to install:&quot;</span>, e.<span class="title function_">toString</span>());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">createWindow</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这个是默认安装<code>vue-devtools</code>部分，不过因为网络(墙)问题，安装不上：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Failed to fetch extension, trying 4 more times</span><br><span class="line">Failed to fetch extension, trying 3 more times</span><br><span class="line">Failed to fetch extension, trying 2 more times</span><br><span class="line">Failed to fetch extension, trying 1 more times</span><br><span class="line">Failed to fetch extension, trying 0 more times</span><br><span class="line">Vue Devtools failed to install: Error: net::ERR_CONNECTION_TIMED_OUT</span><br></pre></td></tr></table></figure>

<p>所以要修改一下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.<span class="title function_">on</span>(<span class="string">&quot;ready&quot;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (isDevelopment &amp;&amp; !process.<span class="property">env</span>.<span class="property">IS_TEST</span>) &#123;</span><br><span class="line">    <span class="comment">// Install Vue Devtools</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// await installExtension(VUEJS_DEVTOOLS);</span></span><br><span class="line">      <span class="comment">// 新增的：安装vue-devtools</span></span><br><span class="line">      <span class="keyword">const</span> &#123; session &#125; = <span class="built_in">require</span>(<span class="string">&quot;electron&quot;</span>);</span><br><span class="line">      <span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line">      session.<span class="property">defaultSession</span>.<span class="title function_">loadExtension</span>(</span><br><span class="line">        path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;../../vue-devtools/chrome&quot;</span>) <span class="comment">//这个是刚刚build好的插件目录</span></span><br><span class="line">      );</span><br><span class="line">      <span class="comment">//这个是刚开始找的方法不行，换上边的方法</span></span><br><span class="line">      <span class="comment">// BrowserWindow.addDevToolsExtension(path.resolve(__dirname, &quot;../../vue-devtools/chrome&quot;)  );</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Vue Devtools failed to install:&quot;</span>, e.<span class="title function_">toString</span>());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">createWindow</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>提示</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(node:9068) ExtensionLoadWarning: Warnings loading extension at ...\vue-devtools\chrome: Unrecognized manifest key &#x27;browser_action&#x27;. Permission &#x27;contextMenus&#x27; is unknown or URL pattern is malformed.</span><br></pre></td></tr></table></figure>

<p>解决：<br>在 vue-devtools&#x2F;chrome&#x2F;manifest.json 删掉相应的字段</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/electron20201111130214278.png" alt="img"></p>
<h3 id="问题-1"><a href="#问题-1" class="headerlink" title="问题"></a>问题</h3><h4 id="报-Cannot-read-property-‘VUE-DEVTOOLS-UID’-of-undefined"><a href="#报-Cannot-read-property-‘VUE-DEVTOOLS-UID’-of-undefined" class="headerlink" title="报 Cannot read property ‘VUE_DEVTOOLS_UID’ of undefined"></a>报 Cannot read property ‘<strong>VUE_DEVTOOLS_UID</strong>’ of undefined</h4><p>在 main.js 中加入如下代码即可：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Vue.config.devtools = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<h4 id="打包出来的-vue-devtools-可能是最新版的外观可能不太适应"><a href="#打包出来的-vue-devtools-可能是最新版的外观可能不太适应" class="headerlink" title="打包出来的 vue-devtools 可能是最新版的外观可能不太适应"></a>打包出来的 vue-devtools 可能是最新版的外观可能不太适应</h4><p>直接在 github 官方地址 <a href="https://github.com/vuejs/devtools/tags">https://github.com/vuejs/devtools/tags</a>下载自己用的比较顺手的版本</p>
<p>我比较喜欢 v5.3.3</p>
<p>然后相同的方法 构建 复制 粘贴就行</p>
<h2 id="MacOS-系统更新后-下载依赖报找不到-xcode"><a href="#MacOS-系统更新后-下载依赖报找不到-xcode" class="headerlink" title="MacOS 系统更新后 下载依赖报找不到 xcode"></a>MacOS 系统更新后 下载依赖报找不到 xcode</h2><p>MacOS 下打包 electron 项目需要 xcode ,同 windows 一样 （win 需要 visual studio），但是 xcode 太大了而且一般不需要整个 xcode ,这时可以使用<a href="https://zhuanlan.zhihu.com/p/172365580">命令行工具</a>(Command Line Tools, CLT)，同样 win 也可以通过 node 进行配置命令命令行工具（在 node 安装时可以选择这些依赖）</p>
<p><strong>但是</strong>: MacOS 系统更新后 CLT 需要重新下载 ，不然下载依赖时会报找不到 xcode 的错误</p>
<h2 id="MacOS-提示-Error-Cannot-create-BrowserWindow-before-app-is-ready-at-I-init"><a href="#MacOS-提示-Error-Cannot-create-BrowserWindow-before-app-is-ready-at-I-init" class="headerlink" title="MacOS 提示 Error: Cannot create BrowserWindow before app is ready at I.init"></a>MacOS 提示 Error: Cannot create BrowserWindow before app is ready at I.init</h2><h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>应用还在加载中就点击了一下 触发了 <code>app.on(&quot;activate&quot;)</code> ，同时触发了 new BrowserWindow 此时 app 还没到 <code>ready</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.<span class="title function_">on</span>(<span class="string">&quot;activate&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// On macOS it&#x27;s common to re-create a window in the app when the</span></span><br><span class="line">  <span class="comment">// dock icon is clicked and there are no other windows open.</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">BrowserWindow</span>.<span class="title function_">getAllWindows</span>().<span class="property">length</span> === <span class="number">0</span>) <span class="title function_">createWindow</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="解决-1"><a href="#解决-1" class="headerlink" title="解决"></a>解决</h3><p>多加一个判断条件 <code>isReady</code> 开始为<code>false</code> 在 <code>ready</code> 时设置为 <code>true</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title class_">BrowserWindow</span>.<span class="title function_">getAllWindows</span>().<span class="property">length</span> === <span class="number">0</span> &amp;&amp; isReady) <span class="title function_">createWindow</span>();</span><br></pre></td></tr></table></figure>

<h2 id="MacOS-12-3-打包报-Exit-code-ENOENT-spawn-x2F-usr-x2F-bin-x2F-python-ENOEN"><a href="#MacOS-12-3-打包报-Exit-code-ENOENT-spawn-x2F-usr-x2F-bin-x2F-python-ENOEN" class="headerlink" title="MacOS 12.3 打包报 Exit code: ENOENT. spawn &#x2F;usr&#x2F;bin&#x2F;python ENOEN"></a>MacOS 12.3 打包报 Exit code: ENOENT. spawn &#x2F;usr&#x2F;bin&#x2F;python ENOEN</h2><h3 id="原因-1"><a href="#原因-1" class="headerlink" title="原因"></a>原因</h3><p>因为 macos monterey 12.3 删除了 python 2.7 <a href="https://developer.apple.com/documentation/macos-release-notes/macos-12_3-release-notes">https://developer.apple.com/documentation/macos-release-notes/macos-12_3-release-notes</a></p>
<h3 id="解决-2"><a href="#解决-2" class="headerlink" title="解决"></a>解决</h3><p><a href="https://github.com/electron-userland/electron-builder/pull/6789">https://github.com/electron-userland/electron-builder/pull/6789</a></p>
<p>将<code>electron-builder</code>升级到最新</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm i electron-builder@next</span><br></pre></td></tr></table></figure>

<p>注意:如果项目中使用的是<code>vue-cli-plugin-electron-builder</code> 需要手动进入包内部更新</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 进入 node_modules</span></span><br><span class="line"> <span class="built_in">cd</span> node_modules/vue-cli-plugin-electron-builder</span><br><span class="line"><span class="comment"># 更新 electron-builder</span></span><br><span class="line">npm i electron-builder@next</span><br></pre></td></tr></table></figure>

<h2 id="vue-cli使用vue-cli-plugin-electron-builder插件，运行时不启动electron程序"><a href="#vue-cli使用vue-cli-plugin-electron-builder插件，运行时不启动electron程序" class="headerlink" title="vue-cli使用vue-cli-plugin-electron-builder插件，运行时不启动electron程序"></a>vue-cli使用vue-cli-plugin-electron-builder插件，运行时不启动electron程序</h2><h3 id="原因-2"><a href="#原因-2" class="headerlink" title="原因"></a>原因</h3><p>当一个项目有yarn.lock但是电脑运行环境没有yarn环境时，就会出现启动不了electron程序的情况<br><a href="https://blog.csdn.net/fyt0215/article/details/106293049">vue-cli使用vue-cli-plugin-electron-builder插件，运行时不启动electron程序</a></p>
<h3 id="解决-3"><a href="#解决-3" class="headerlink" title="解决"></a>解决</h3><p>删除yarn.lock 或者使用  yarn 装包</p>
<h2 id="常用文档汇总"><a href="#常用文档汇总" class="headerlink" title="常用文档汇总"></a>常用文档汇总</h2><p>electron <a href="https://www.electronjs.org/">https://www.electronjs.org/</a></p>
<h3 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h3><p>electron-builder <a href="https://www.electron.build/">https://www.electron.build/</a></p>
<h3 id="框架集成"><a href="#框架集成" class="headerlink" title="框架集成"></a>框架集成</h3><p>vue-cli-plugin-electron-builder <a href="https://nklayman.github.io/vue-cli-plugin-electron-builder/">https://nklayman.github.io/vue-cli-plugin-electron-builder/</a></p>
]]></content>
      <categories>
        <category>Electron</category>
      </categories>
      <tags>
        <tag>Electron</tag>
        <tag>electron-builder</tag>
      </tags>
  </entry>
  <entry>
    <title>Git 常用命令</title>
    <url>/2021/06/24/Git/Git-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<h2 id="config"><a href="#config" class="headerlink" title="config"></a>config</h2><p> git 全局配置文件在 ~ 目录下 .gitconfig 文件<br> git 项目配置文件在 项目目录下 .git 文件夹下 config 文件</p>
<h2 id="remote-远程仓库"><a href="#remote-远程仓库" class="headerlink" title="remote 远程仓库"></a>remote 远程仓库</h2><h3 id="git-远程分支详解"><a href="#git-远程分支详解" class="headerlink" title="git 远程分支详解"></a>git 远程分支详解</h3><p> 参考<a href="https://blog.csdn.net/weixin_39616416/article/details/111160820">Git refspec与远程分支的重要操作</a></p>
<h3 id="查看本地关联的远程仓库"><a href="#查看本地关联的远程仓库" class="headerlink" title="查看本地关联的远程仓库"></a>查看本地关联的远程仓库</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git remote -v</span><br><span class="line"><span class="comment"># 远程仓库名  远程仓库地址</span></span><br><span class="line"><span class="comment"># origin  https://github.com/xxx/my-blog.git (fetch)</span></span><br><span class="line"><span class="comment"># origin  https://github.com/xxx/my-blog.git (push)</span></span><br></pre></td></tr></table></figure>

<h3 id="本地设置远程仓库"><a href="#本地设置远程仓库" class="headerlink" title="本地设置远程仓库"></a>本地设置远程仓库</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  git remote add （添加远程仓库） origin（远程仓库名随便起） https://github.com/xxx/my-blog.git （远程仓库地址）</span></span><br><span class="line">git remote add origin https://github.com/xxx/my-blog.git</span><br><span class="line"><span class="comment">#  git push 推送代码 -u 同时为当前推送设置上游分支  origin master （origin 就是上面起的远程仓库名 master 分支名）</span></span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure>

<h3 id="修改远程仓库地址"><a href="#修改远程仓库地址" class="headerlink" title="修改远程仓库地址"></a>修改远程仓库地址</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># git remote set-url origin（远程仓库名） https://github.com/xxx/my-blog1.git （远程仓库地址）</span></span><br><span class="line">git remote set-url origin https://github.com/xxx/my-blog1.git</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="查看-GIT-未推送的提交记录"><a href="#查看-GIT-未推送的提交记录" class="headerlink" title="查看 GIT 未推送的提交记录"></a>查看 GIT 未推送的提交记录</h2><h4 id="1-查看到未传送到远程代码库的提交次数"><a href="#1-查看到未传送到远程代码库的提交次数" class="headerlink" title="1 查看到未传送到远程代码库的提交次数"></a>1 查看到未传送到远程代码库的提交次数</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure>

<p>显示结果类似于这样：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is ahead of <span class="string">&#x27;origin/master&#x27;</span> by 2 commits.</span><br><span class="line">  (use <span class="string">&quot;git push&quot;</span> to publish your <span class="built_in">local</span> commits)</span><br><span class="line"></span><br><span class="line">nothing to commit, working tree clean</span><br></pre></td></tr></table></figure>

<h4 id="2-查看到未传送到远程代码库的提交描述-x2F-说明"><a href="#2-查看到未传送到远程代码库的提交描述-x2F-说明" class="headerlink" title="2 查看到未传送到远程代码库的提交描述&#x2F;说明"></a>2 查看到未传送到远程代码库的提交描述&#x2F;说明</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git cherry -v</span><br></pre></td></tr></table></figure>

<p>显示结果类似于这样：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">+ afd5134be3bee5285d6c2ee2c82fc323012d74bb Update commit 1</span><br><span class="line">+ 37a165ec0586f4af745bf538bc139fda6f1df672 Update commit 2</span><br></pre></td></tr></table></figure>

<h4 id="3-查看到未传送到远程代码库的提交详情"><a href="#3-查看到未传送到远程代码库的提交详情" class="headerlink" title="3 查看到未传送到远程代码库的提交详情"></a>3 查看到未传送到远程代码库的提交详情</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">log</span> master ^origin/master</span><br></pre></td></tr></table></figure>

<p>这是一个 git log 命令的过滤，^origin&#x2F;master 可改成其它分支。<br>显示结果类似于这样：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">commit 37a165ec0586f4af745bf538bc139fda6f1df672 (HEAD -&gt; master)</span><br><span class="line">Author: xxxx &lt;xxxxx@163.com&gt;</span><br><span class="line">Date:   Mon Jul 26 17:46:34 2021 +0800</span><br><span class="line"></span><br><span class="line">    Update commit 1</span><br><span class="line"></span><br><span class="line">commit afd5134be3bee5285d6c2ee2c82fc323012d74bb</span><br><span class="line">Author: xxx &lt;xxxx@163.com&gt;</span><br><span class="line">Date:   Mon Jul 26 09:54:24 2021 +0800</span><br><span class="line"></span><br><span class="line">    Update commit 2</span><br></pre></td></tr></table></figure>

<p>总结<br>git status 只能查看未传送提交的次数<br>git cherry -v 只能查看未传送提交的描述&#x2F;说明<br>git log master ^origin&#x2F;master 则可以查看未传送提交的详细信息</p>
<h2 id="Github-相关"><a href="#Github-相关" class="headerlink" title="Github 相关"></a>Github 相关</h2><p>新建仓库</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;# test111&quot;</span> &gt;&gt; README.md</span><br><span class="line">git init</span><br><span class="line">git add README.md</span><br><span class="line">git commit -m <span class="string">&quot;first commit&quot;</span></span><br><span class="line">git branch -M main</span><br><span class="line">git remote add origin https://github.com/bitbw/test111.git</span><br><span class="line">git push -u origin main</span><br></pre></td></tr></table></figure>

<p>已有仓库</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git remote add origin https://github.com/bitbw/test111.git</span><br><span class="line">git branch -M main</span><br><span class="line">git push -u origin main</span><br></pre></td></tr></table></figure>

<h2 id="git设置代理"><a href="#git设置代理" class="headerlink" title="git设置代理"></a>git设置代理</h2><h3 id="设置局部代理"><a href="#设置局部代理" class="headerlink" title="设置局部代理"></a>设置局部代理</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git config --<span class="built_in">local</span> http.proxy 127.0.0.1:1080</span><br></pre></td></tr></table></figure>

<h3 id="端口要设置为本地代理的端口"><a href="#端口要设置为本地代理的端口" class="headerlink" title="端口要设置为本地代理的端口"></a>端口要设置为本地代理的端口</h3><h3 id="设置全局代理"><a href="#设置全局代理" class="headerlink" title="设置全局代理"></a>设置全局代理</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git config --global http.proxy 127.0.0.1:1080</span><br></pre></td></tr></table></figure>

<p>为全局的 git 项目都设置代理</p>
<p>取消代理设置</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git config --<span class="built_in">local</span> --<span class="built_in">unset</span> http.proxy</span><br><span class="line">git config --global --<span class="built_in">unset</span> http.proxy</span><br></pre></td></tr></table></figure>

<h3 id="git-clone-同时设置代理"><a href="#git-clone-同时设置代理" class="headerlink" title="git clone 同时设置代理"></a>git clone 同时设置代理</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> -c http.proxy=http://127.0.0.1:1080  https://github.com/xxx.git</span><br></pre></td></tr></table></figure>

<p>设置快捷别名</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git config --global alias.cloneProxy = <span class="built_in">clone</span> -c http.proxy=http://127.0.0.1:1080</span><br></pre></td></tr></table></figure>

<h2 id="git-大小写问题"><a href="#git-大小写问题" class="headerlink" title="git 大小写问题"></a>git 大小写问题</h2><p>问题复现:</p>
<ol>
<li>.新建一个 a.js 文件(大小写不敏感的状态下)，并提交</li>
<li>.修改本地 a.js 变为 A.js，文件内容无变更，无法提交</li>
<li>执行git config core.ignorecase false，修改 大小写敏感 规则，然后提交，查看结果，此时会存在 大小写 同时存在的文件</li>
<li>此时某种机缘下，再次执行 git config core.ignorecase true，大小写不敏感，</li>
<li>此时执行 git push ， 即把最新的更新都更新到了 a.js 中</li>
<li>此时再修改 大小写敏感规则为敏感， 执行 git pull ，并不会拿到最新的更新。比如自己想要的是第一次修改后的 A.js ，但是服务器有一个没7. 有更新的 A.js 和 有更新的 a.js,而你只能拿到前者，所以就会遇到各种各样的坑……</li>
</ol>
<h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><p>执行git config –global core.ignorecase false，全局设置 大小写敏感 。</p>
<ol>
<li>文件变更比较少的情况<br>直接使用以下命令重命名文件，在 git 中不要直接修改文件名，最好的办法是使用下面的方式，</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">mv</span> -f [你想要删掉的文件] [你想要留下的文件]</span><br><span class="line">git <span class="built_in">mv</span> -f a.js A.js</span><br><span class="line"></span><br><span class="line"><span class="comment">## 等同于：</span></span><br><span class="line"></span><br><span class="line">git <span class="built_in">rm</span> a.js</span><br><span class="line">git add A.js</span><br></pre></td></tr></table></figure>

<p>这个命令的目的就是删除不需要的大小写同名文件，修改后 git push 提交变更即可。</p>
<ol start="2">
<li>变更比较多，并且拥有分支较高权限</li>
</ol>
<ul>
<li>在 github 删除该分支</li>
<li>本地执行 git rm -r –cached . (注意后面‘点号’)</li>
<li>然后重新 git push，就ok了<br>此法不太好，有点暴力，容易出问题，但适用于 变更发生于近期的情况。</li>
</ul>
<p>总结：<br>其实看解决办法的话，只是一个很小的问题，但是出现的 bug 确实是让人很头疼的，因为 mac windows 在不设置大小写敏感规则的时候默认大小写是不敏感，项目部署的机器是 Linux 的，而 Linux 是大小写敏感的。所以这样的问题平时不易发现，本地调试的时候大部分时候并不会出错误，只有在项目部署的时候问题才会显示出来。</p>
<h2 id="git-push同时推送到两个远程仓库"><a href="#git-push同时推送到两个远程仓库" class="headerlink" title="git push同时推送到两个远程仓库"></a>git push同时推送到两个远程仓库</h2><p><a href="https://www.jianshu.com/p/edc85a20ada9">原文地址</a></p>
<p>进入你的项目目录，打开.git&#x2F;config文件(.git是隐藏目录，需要打开显示隐藏文件…)</p>
<p>在url &#x3D; xxx下再加一行其他远程库的路径，例如，开源中国的：</p>
<p>此后，你只需要git push origin master，即可同时推送到两个不同仓库的master。</p>
<h2 id="git-别名配置"><a href="#git-别名配置" class="headerlink" title="git 别名配置"></a>git 别名配置</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git config --global alias.co checkout</span><br><span class="line">git config --global alias.br branch</span><br><span class="line">git config --global alias.ci commit</span><br><span class="line">git config --global alias.st status</span><br></pre></td></tr></table></figure>

<h2 id="git-根据用户名统和时间查看代码统计"><a href="#git-根据用户名统和时间查看代码统计" class="headerlink" title="git 根据用户名统和时间查看代码统计"></a>git 根据用户名统和时间查看代码统计</h2><p><a href="https://www.csdn.net/tags/OtTaEg4sNzU1NC1ibG9n.html">参考:git 时间 查看代码统计</a><br><a href="https://blog.csdn.net/fsjwin/article/details/122267764">参考:gitlab代码查看行数</a><br><a href="https://www.csdn.net/tags/MtjaYg3sNjE1NTMtYmxvZwO0O0OO0O0O.html">参考:git log排除文件</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 代码量统计</span></span><br><span class="line"><span class="comment"># 说明 &quot;:(exclude)nouse&quot; 为需要排除的文件  -- since开始时间 --until 结束时间   git log &#x27;分支名称&#x27;</span></span><br><span class="line">git <span class="built_in">log</span> --format=<span class="string">&#x27;%aN&#x27;</span> | <span class="built_in">sort</span> -u | <span class="keyword">while</span> <span class="built_in">read</span> name; <span class="keyword">do</span> <span class="built_in">echo</span> -en <span class="string">&quot;<span class="variable">$name</span>\t&quot;</span>; git <span class="built_in">log</span> <span class="string">&#x27;bowen&#x27;</span> --author=<span class="string">&quot;<span class="variable">$name</span>&quot;</span> --since=2022-02-07 --until=2022-8-15 --pretty=tformat: --numstat  -- . <span class="string">&quot;:(exclude)nouse_backup&quot;</span>  <span class="string">&quot;:(exclude)package-lock.json&quot;</span> <span class="string">&quot;:(exclude)yarn.lock&quot;</span>   | awk <span class="string">&#x27;&#123; add += $1; subs += $2; loc += $1 - $2 &#125; END &#123; printf &quot;added lines: %s, removed lines: %s, total lines: %s\n&quot;, add, subs, loc &#125;&#x27;</span> -; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="git-worktree-的使用"><a href="#git-worktree-的使用" class="headerlink" title="git worktree 的使用"></a>git worktree 的使用</h2><p>参考 <a href="https://www.cnblogs.com/jasongrass/p/11178079.html">git worktree 使用笔记</a></p>
<h3 id="工作模式"><a href="#工作模式" class="headerlink" title="工作模式"></a>工作模式</h3><ul>
<li>worktree add 新的文件夹</li>
<li>打开的文件夹下载依赖后修改</li>
<li>测试没问题后  git push -u origin HEAD:目标分支</li>
<li>删除新的文件夹  git worktree prune 清理</li>
</ul>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>worktree 不允许两个 worktree 使用同一个分支。如果有这个需要怎么办？</p>
<ul>
<li>新建一个分支，reset 到目标分支，再基于这个新分支工作，效果一样。</li>
<li>新建一个分支，使用 git push -u origin HEAD:目标分支， 目标分支再 pull</li>
</ul>
<p>使用后不使再用的 worktree 删除后 ，运行 git worktree prune 清理</p>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>GitHub Actions 的使用</title>
    <url>/2021/04/23/Github/GitHub-Actions-%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="自动部署：GitHub-Actions"><a href="#自动部署：GitHub-Actions" class="headerlink" title="自动部署：GitHub Actions"></a>自动部署：GitHub Actions</h2><p>阮一峰关于 GitHub Actions 的教程： <a href="http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html">http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html</a></p>
<blockquote>
<p>注意：因为部署插件不断更新需要根据新的插件改相应配置</p>
</blockquote>
<h3 id="生成-token-秘钥"><a href="#生成-token-秘钥" class="headerlink" title="生成 token 秘钥"></a>生成 <strong>token</strong> 秘钥</h3><blockquote>
<p>官网：<a href="https://docs.github.com/en/actions/reference/encrypted-secrets">https://docs.github.com/en/actions/reference/encrypted-secrets</a></p>
<p>注意：github-pages-deploy-action V4 开始不需要添加 token</p>
</blockquote>
<h3 id="添加配置文件"><a href="#添加配置文件" class="headerlink" title="添加配置文件"></a>添加配置文件</h3><ul>
<li>在项目目录下新建<code>.github\workflows</code></li>
<li>随便命名一个 yml 配置文件 我的命名<code>main.yml</code></li>
<li>yml文件 具体配置填写见 <a href="https://docs.github.com/en/actions/learn-github-actions/workflow-syntax-for-github-actions">文档</a> 或下面示例</li>
</ul>
<h3 id="填写配置"><a href="#填写配置" class="headerlink" title="填写配置"></a>填写配置</h3><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 工作流名称，不设置的话默认取配置文件名</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">Build</span> <span class="string">and</span> <span class="string">Deploy</span></span><br><span class="line"><span class="comment"># 指定触发 workflow 的条件</span></span><br><span class="line"><span class="comment"># 指定触发事件时，可以限定分支或标签</span></span><br><span class="line"><span class="comment"># 当前是 只有 branches 分支上触发 push 事件时才执行工作流任务</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">main</span></span><br><span class="line"><span class="comment"># 工作流执行的一个或多个任务</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="comment"># 任务名称</span></span><br><span class="line">  <span class="attr">build-and-deploy:</span></span><br><span class="line">    <span class="comment"># 任务运行的容器类型（虚拟机环境）</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="comment"># 任务执行的步骤</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="comment"># 步骤名称</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">🛎️</span>    <span class="comment"># 拉取代码</span></span><br><span class="line">        <span class="comment"># 使用的操作 actions，可以使用公共仓库，本地仓库，别人的仓库的action</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span> <span class="comment"># 将代码拷贝到虚机中</span></span><br><span class="line">      <span class="comment"># 设置 nodejs 版本</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SetNodeVersion</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="string">&#x27;14&#x27;</span></span><br><span class="line">      <span class="comment"># nodejs 版本检查</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NodeCheck</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">node</span> <span class="string">-v</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">and</span> <span class="string">Build</span> <span class="string">🔧</span> <span class="comment"># This example project is built using npm and outputs the result to the &#x27;build&#x27; folder. Replace with the commands required to build your project, or remove this step entirely if your site is pre-built.</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          npm ci</span></span><br><span class="line"><span class="string">          npm run build</span></span><br><span class="line"><span class="string"></span>        <span class="comment"># 构建发布 Github pages</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">🚀</span></span><br><span class="line">        <span class="comment"># 使用github-pages-deploy-action: https://github.com/JamesIves/github-pages-deploy-action/tree/master</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">JamesIves/github-pages-deploy-action@v4.2.2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="comment"># 存储库中要部署的文件夹。</span></span><br><span class="line">          <span class="comment"># 该步骤会将项目中 FOLDER 指定文件夹下的文件推送到 BRANCH 分支，作为Github Pages 部署的内容。</span></span><br><span class="line">          <span class="attr">branch:</span> <span class="string">gh-pages</span> <span class="comment"># The branch the action should deploy to.</span></span><br><span class="line">          <span class="attr">folder:</span> <span class="string">dist</span> <span class="comment"># The folder the action should deploy.</span></span><br></pre></td></tr></table></figure>

<h4 id="关于-github-pages-deploy-action"><a href="#关于-github-pages-deploy-action" class="headerlink" title="关于 github-pages-deploy-action"></a>关于 github-pages-deploy-action</h4><p>注意：</p>
<ul>
<li><p>JamesIves&#x2F;github-pages-deploy-action@master 无法使用，继续使用会报错</p>
</li>
<li><p>github-pages-deploy-action V4 开始不需要添加 token ，如果添加会报 128 错误</p>
</li>
<li><p>github 关于 128 错误的解答：<a href="https://github.com/JamesIves/github-pages-deploy-action/issues/624">https://github.com/JamesIves/github-pages-deploy-action/issues/624</a></p>
</li>
</ul>
<h5 id="github-pages-deploy-action-v2"><a href="#github-pages-deploy-action-v2" class="headerlink" title="github-pages-deploy-action@v2"></a>github-pages-deploy-action@v2</h5><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">GitHub</span> <span class="string">Actions</span> <span class="string">Build</span> <span class="string">and</span> <span class="string">Deploy</span> <span class="string">Demo</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build-and-deploy:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">and</span> <span class="string">Deploy</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">JamesIves/github-pages-deploy-action@releases/v2</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="attr">ACCESS_TOKEN:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.ACCESS_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">BASE_BRANCH:</span> <span class="string">master</span></span><br><span class="line">          <span class="attr">BRANCH:</span> <span class="string">gh-pages</span></span><br><span class="line">          <span class="attr">FOLDER:</span> <span class="string">public</span></span><br><span class="line">          <span class="attr">BUILD_SCRIPT:</span> <span class="string">npm</span> <span class="string">install</span> <span class="string">&amp;&amp;</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">build</span></span><br></pre></td></tr></table></figure>

<h5 id="github-pages-deploy-action-v4"><a href="#github-pages-deploy-action-v4" class="headerlink" title="github-pages-deploy-action@v4"></a>github-pages-deploy-action@v4</h5><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">GitHub</span> <span class="string">Actions</span> <span class="string">Build</span> <span class="string">and</span> <span class="string">Deploy</span> <span class="string">Demo</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build-and-deploy:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">and</span> <span class="string">Build</span> <span class="string">🔧</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          npm install</span></span><br><span class="line"><span class="string">          npm run build</span></span><br><span class="line"><span class="string"></span>      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span></span><br><span class="line">        <span class="comment"># JamesIves/github-pages-deploy-action@4.1.1 not need token</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">JamesIves/github-pages-deploy-action@4.1.1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">branch:</span> <span class="string">gh-pages</span></span><br><span class="line">          <span class="attr">folder:</span> <span class="string">public</span></span><br></pre></td></tr></table></figure>

<h2 id="GitHub-Pages"><a href="#GitHub-Pages" class="headerlink" title="GitHub Pages"></a>GitHub Pages</h2><h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><p><a href="https://docs.github.com/en/pages/getting-started-with-github-pages/creating-a-github-pages-site">https://docs.github.com/en/pages/getting-started-with-github-pages/creating-a-github-pages-site</a></p>
<h2 id="常用-GitHub-Actions-配置"><a href="#常用-GitHub-Actions-配置" class="headerlink" title="常用 GitHub-Actions 配置"></a>常用 GitHub-Actions 配置</h2><h3 id="通过-ssh-命令-连接远程服务器并部署"><a href="#通过-ssh-命令-连接远程服务器并部署" class="headerlink" title="通过 ssh 命令 连接远程服务器并部署"></a>通过 ssh 命令 连接远程服务器并部署</h3><p>use :<a href="https://github.com/marketplace/actions/ssh-remote-commands">appleboy&#x2F;ssh-action@master</a></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># This is a basic workflow to help you get started with Actions</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">CICD</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls when the workflow will run</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="comment"># Triggers the workflow on push or pull request events but only for the master branch</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span> [ <span class="string">master</span> ]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Allows you to run this workflow manually from the Actions tab</span></span><br><span class="line">  <span class="attr">workflow_dispatch:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># A workflow run is made up of one or more jobs that can run sequentially or in parallel</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="comment"># This workflow contains a single job called &quot;build&quot;</span></span><br><span class="line">  <span class="attr">cicd_job:</span></span><br><span class="line">    <span class="comment"># The type of runner that the job will run on</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="comment"># Steps represent a sequence of tasks that will be executed as part of the job</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="comment"># Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v3</span></span><br><span class="line">      <span class="comment"># ssh link remote server and executing script</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">executing</span> <span class="string">remote</span> <span class="string">ssh</span> <span class="string">commands</span> <span class="string">using</span> <span class="string">password</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">appleboy/ssh-action@master</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="attr">WELCOME:</span> <span class="string">&quot;executing remote ssh commands using password&quot;</span></span><br><span class="line">          <span class="attr">SERVER_HOME:</span> <span class="string">&quot;node-express-server&quot;</span> </span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">host:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.DC_HOST</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">username:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.DC_USER</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">password:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.DC_PASS</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">port:</span> <span class="number">22</span></span><br><span class="line">          <span class="attr">envs:</span> <span class="string">WELCOME,SERVER_HOME</span></span><br><span class="line">          <span class="attr">script:</span> <span class="string">|</span></span><br><span class="line"><span class="string">            echo $WELCOME </span></span><br><span class="line"><span class="string">            echo whoami </span></span><br><span class="line"><span class="string">            whoami  </span></span><br><span class="line"><span class="string">            echo git version</span></span><br><span class="line"><span class="string">            git  --version </span></span><br><span class="line"><span class="string">            echo node version</span></span><br><span class="line"><span class="string">            node -v</span></span><br><span class="line"><span class="string">            echo npm version</span></span><br><span class="line"><span class="string">            npm -v</span></span><br><span class="line"><span class="string">            cd ~ </span></span><br><span class="line"><span class="string">            echo ~ ls</span></span><br><span class="line"><span class="string">            ls -la </span></span><br><span class="line"><span class="string">            echo $SERVER_HOME ls</span></span><br><span class="line"><span class="string">            cd $SERVER_HOME</span></span><br><span class="line"><span class="string">            ls -la </span></span><br><span class="line"><span class="string">            npm run deploy  </span></span><br><span class="line"><span class="string"></span>         </span><br></pre></td></tr></table></figure>

<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><p> 使用 appleboy&#x2F;ssh-action@master 有可能会报 npm 或 node 命令找不到的情况<br> 最好在 usr&#x2F;bin 建立一个<a href="https://blog.bitbw.top/Nodejs/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85Nodejs/">node相关命令的软连接</a></p>
]]></content>
      <categories>
        <category>Github</category>
      </categories>
      <tags>
        <tag>GitHub Actions</tag>
        <tag>github</tag>
        <tag>ci/cd</tag>
      </tags>
  </entry>
  <entry>
    <title>GitHub Pages 的使用</title>
    <url>/2021/04/26/Github/GitHub-Pages-%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h2><p><a href="https://docs.github.com/en/pages/getting-started-with-github-pages/creating-a-github-pages-site">https://docs.github.com/en/pages/getting-started-with-github-pages/creating-a-github-pages-site</a></p>
<h2 id="使用自定义域名"><a href="#使用自定义域名" class="headerlink" title="使用自定义域名"></a>使用自定义域名</h2><h3 id="首先买一个自己域名"><a href="#首先买一个自己域名" class="headerlink" title="首先买一个自己域名"></a>首先买一个自己域名</h3><p>我是在阿里云买的域名：<a href="https://www.aliyun.com/?utm_content=se_1008364713">https://www.aliyun.com/?utm_content=se_1008364713</a></p>
<h3 id="设置-DNS-解析"><a href="#设置-DNS-解析" class="headerlink" title="设置 DNS 解析"></a>设置 DNS 解析</h3><ul>
<li>进入控制台-&gt;进入 DNS 云解析-&gt;域名解析-&gt;解析设置</li>
</ul>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20210426174435458.png" alt="image-20210426174435458"></p>
<ul>
<li>首次设置点击添加记录</li>
</ul>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20210426174712072.png" alt="image-20210426174712072"></p>
<ul>
<li>记录类型：选择 CNAME</li>
<li>主机记录：自己设置一个二级域名，我给我的博客用，所以以 blog 开头</li>
<li>记录值：githu 用户名.github.io.</li>
</ul>
<h3 id="项目中添加-CNAME-文件"><a href="#项目中添加-CNAME-文件" class="headerlink" title="项目中添加 CNAME 文件"></a>项目中添加 CNAME 文件</h3><p>使用 Github Action 自动构建项目时将 CNAME 添加到 public 文件夹下面</p>
<p>（我的项目 vue-cli 直接放到 public，如果使用 webpack 看看具体在哪个文件夹下）</p>
<p>将主机记录的地址填入即可</p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line">blog.zhangbowen.<span class="built_in">xyz</span></span><br></pre></td></tr></table></figure>

<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><h3 id="publicPath-的问题"><a href="#publicPath-的问题" class="headerlink" title="publicPath 的问题"></a>publicPath 的问题</h3><p>publicPath 配置不对会导致 js 等文件出现 404 的问题</p>
<ul>
<li>配置了自定义域名的情况 直接写<code>publicPath: &quot;./&quot;,</code></li>
<li>没配置自定义域名</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"> <span class="comment">// git page 需要指定公共路径为仓库名 否则会找不到index.html 中连接的资源</span></span><br><span class="line"><span class="attr">publicPath</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;production&quot;</span> ? <span class="string">&quot;/仓库名称/&quot;</span> : <span class="string">&quot;./&quot;</span>,</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Github</category>
      </categories>
      <tags>
        <tag>github</tag>
        <tag>GitHub Pages</tag>
      </tags>
  </entry>
  <entry>
    <title>HTML入门</title>
    <url>/2016/05/21/HTML/HTML%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<p><img data-src="https://bitbw.top/public/img/my_gallery/%E4%B8%8B%E8%BD%BD.jpg" alt="下载"></p>
<h2 id="开发工具"><a href="#开发工具" class="headerlink" title="开发工具"></a>开发工具</h2><ul>
<li>chrome</li>
<li>sublime</li>
<li>photoshop</li>
</ul>
<h2 id="主要浏览器"><a href="#主要浏览器" class="headerlink" title="主要浏览器"></a>主要浏览器</h2><ul>
<li>IE</li>
<li>火狐（Firefox）</li>
<li>谷歌（chrome）</li>
<li>safari</li>
<li>opera</li>
</ul>
<h2 id="浏览器内核"><a href="#浏览器内核" class="headerlink" title="浏览器内核"></a>浏览器内核</h2><ul>
<li>Trident(IE 内核)</li>
<li>Gecko(firefox)</li>
<li>webkit(Safari)</li>
<li>Chromium&#x2F;Blink(chrome)</li>
<li>Presto(Opera)</li>
</ul>
<h2 id="HTML-骨架格式"><a href="#HTML-骨架格式" class="headerlink" title="HTML 骨架格式"></a>HTML 骨架格式</h2><ul>
<li><p>1 HTML 标签：</p>
<p>作用所有 HTML 中标签的一个根节点。 最大的标签 根标签</p>
</li>
<li><p>2 head 标签： 文档的头部</p>
<p>文档的头部描述了文档的各种属性和信息，包括文档的标题、在 Web 中的位置以及和其他文档的关系等。绝大多数文档头部包含的数据都不会真正作为内容显示给读者。注意在 head 标签中我们必须要设置的标签是 title</p>
</li>
<li><p>3.title 标签： 文档的标题</p>
<p>作用：让页面拥有一个属于自己的标题。</p>
</li>
<li><p>4.body 标签：文档的主体 以后我们的页面内容 基本都是放到 body 里面的</p>
<p>body 元素包含文档的所有内容（比如文本、超链接、图像、表格和列表等等。）</p>
</li>
</ul>
<h2 id="HTML-标签分类"><a href="#HTML-标签分类" class="headerlink" title="HTML 标签分类"></a>HTML 标签分类</h2><ul>
<li>1.双标签 &lt;标签名&gt; 内容 &lt;&#x2F;标签名&gt; 比如 <code>&lt;body&gt;</code>我是文字 <code>&lt;/body&gt;</code></li>
<li>1.嵌套(包含)关系 <code>&lt;head&gt; &lt;title&gt; &lt;/title&gt; &lt;/head&gt;</code></li>
</ul>
<h2 id="HTML-标签关系"><a href="#HTML-标签关系" class="headerlink" title="HTML 标签关系"></a>HTML 标签关系</h2><ul>
<li>1.嵌套(包含)关系 <code>&lt;head&gt; &lt;title&gt; &lt;/title&gt; &lt;/head&gt;</code></li>
<li>2.并列关系 <code>&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;</code></li>
</ul>
<h2 id="sublime-一些常用快捷键"><a href="#sublime-一些常用快捷键" class="headerlink" title="sublime 一些常用快捷键"></a>sublime 一些常用快捷键</h2><p><img data-src="https://bitbw.top/public/img/my_gallery/1574421790594.png" alt="1574421790594"></p>
<h2 id="字符集"><a href="#字符集" class="headerlink" title="字符集"></a>字符集</h2><ul>
<li>utf-8 是目前最常用的字符集编码方式，常用的字符集编码方式还有 gbk 和 gb2312。</li>
<li>gb2312 简单中文 包括 6763 个汉字</li>
<li>BIG5 繁体中文 港澳台等用</li>
<li>GBK 包含全部中文字符 是 GB2312 的扩展，加入对繁体字的支持，兼容 GB2312</li>
<li>UTF-8 则包含全世界所有国家需要用到的字符</li>
<li>记住一点，以后我们统统使用 UTF-8 字符集, 这样就避免出现字符集不统一而引起乱码的情况了。</li>
</ul>
<h2 id="HTML-常用标签"><a href="#HTML-常用标签" class="headerlink" title="HTML 常用标签"></a>HTML 常用标签</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">标题标签 (熟记) head 头部. 标题 title 文档标题 HTML提供了6个等级的标题</span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h4</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h5</span>&gt;</span></span><br><span class="line">          和</span><br><span class="line">          <span class="tag">&lt;<span class="name">h6</span>&gt;</span></span><br><span class="line">            段落标签( 熟记)</span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>文本内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            水平线标签(认识)</span><br><span class="line">            <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">            是单标签 换行标签(熟记) <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="文本格式化标签-熟记"><a href="#文本格式化标签-熟记" class="headerlink" title="文本格式化标签(熟记)"></a>文本格式化标签(熟记)</h2><p><img data-src="/./html1/1574422211138.png" alt="1574422211138"></p>
<h2 id="img-标记属性"><a href="#img-标记属性" class="headerlink" title="img 标记属性"></a>img 标记属性</h2><ul>
<li>src 图像的路径</li>
<li>alt 图像不能显示时的替换文本</li>
<li>title 鼠标悬停时显示的内容</li>
<li>width 设置图像的宽度</li>
<li>height 设置图像的高度</li>
<li>border 设置图像边框的宽度</li>
</ul>
<h2 id="链接标签-重点"><a href="#链接标签-重点" class="headerlink" title="链接标签(重点)"></a>链接标签(重点)</h2><p><code>&lt;a href=&quot;跳转目标&quot; target=&quot;目标窗口的弹出方式&quot;&gt;文本或图像&lt;/a&gt;</code></p>
<p>target：用于指定链接页面的打开方式，其取值有 self 和_blank 两种，其中 self 为默认值，blank 为在新窗口中打开方式。</p>
<h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><blockquote>
<p>1.外部链接 需要添加 http:&#x2F;&#x2F; <a href="http://www.baidu.com/">www.baidu.com</a> 2.内部链接 直接链接内部页面名称即可 比如<code>&lt; a href=&quot;index.html&quot;&gt; 首页 &lt;/a &gt;</code> 3.如果当时没有确定链接目标时，通常将链接标签的 href 属性值定义为“#”(即 href&#x3D;”#”)，表示该链接暂时为一个空链接。 4.不仅可以创建文本超链接，在网页中各种网页元素，如图像、表格、音频、视频等都可以添加超链接。</p>
</blockquote>
<h2 id="锚点定位-（难点）"><a href="#锚点定位-（难点）" class="headerlink" title="锚点定位 （难点）"></a>锚点定位 （难点）</h2><p>vk control control 1.使用相应的 id 名标注跳转目标的位置。</p>
<p><code>&lt;h3 id=&quot;two&quot;&gt;第2集&lt;/h3&gt;</code></p>
<p>2.使用“a href&#x3D;”#id 名&gt;“链接文本”<code>&lt;/a&gt;</code>创建链接文本（被点击的）<code>&lt;a href=&quot;#two&quot;&gt;</code></p>
<h2 id="base-标签-基本的"><a href="#base-标签-基本的" class="headerlink" title="base 标签 基本的"></a>base 标签 基本的</h2><ul>
<li>base 可以设置整体链接的打开状态</li>
<li>base 写到 <code>&lt;head&gt; &lt;/head&gt;</code> 之间</li>
<li>把所有的连接 都默认添加 target&#x3D;”_blank”</li>
</ul>
<h2 id="特殊字符标签-（理解）"><a href="#特殊字符标签-（理解）" class="headerlink" title="特殊字符标签 （理解）"></a>特殊字符标签 （理解）</h2><p><img data-src="https://bitbw.top/public/img/my_gallery/1574422894085.png" alt="1574422894085"></p>
<h2 id="路径-重点、难点"><a href="#路径-重点、难点" class="headerlink" title="路径(重点、难点)"></a>路径(重点、难点)</h2><h3 id="相对路径"><a href="#相对路径" class="headerlink" title="相对路径"></a>相对路径</h3><p>1.图像文件和 HTML 文件位于同一文件夹：只需输入图像文件的名称即可，如<code>&lt;img src=&quot;logo.gif&quot; /&gt;</code>。</p>
<p>2.图像文件位于 HTML 文件的下一级文件夹：输入文件夹名和文件名，之间用“&#x2F;”隔开，如<code>&lt;img src=&quot;img/img01/logo.gif&quot; /&gt;</code>。</p>
<p>3.图像文件位于 HTML 文件的上一级文件夹：在文件名之前加入“..&#x2F;” ，如果是上两级，则需要使用 “..&#x2F; ..&#x2F;”，以此类推，如<code>&lt;img src=&quot;../logo.gif&quot; /&gt;</code>。</p>
<h3 id="绝对路径"><a href="#绝对路径" class="headerlink" title="绝对路径"></a>绝对路径</h3><p>绝对路径以 Web 站点根目录为参考基础的目录路径。之所以称为绝对，意指当所有网页引用同一个文件时，所使用的路径都是一样的</p>
<p>“D:\web\img\logo.gif”，或完整的网络地址，例如“<a href="http://www.itcast.cn/image/logo.gif">http://www.itcast.cn/image/logo.gif</a>”。</p>
]]></content>
      <categories>
        <category>HTML</category>
      </categories>
      <tags>
        <tag>HTML</tag>
      </tags>
  </entry>
  <entry>
    <title>HTTPS常见问题汇总</title>
    <url>/2021/12/28/%E7%BD%91%E7%BB%9C%E5%BA%94%E7%94%A8/HTTPS%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><h3 id="通过-IP-地址-https-协议访问服务的问题"><a href="#通过-IP-地址-https-协议访问服务的问题" class="headerlink" title="通过 IP 地址 + https 协议访问服务的问题"></a>通过 IP 地址 + https 协议访问服务的问题</h3><p>通过 IP 地址 + https 协议访问服务在浏览器中会触发 证书不安全警告<br>在 nodejs 中会提示 <code>Error [ERR_TLS_CERT_ALTNAME_INVALID]: Hostname/IP does not match certificate&#39;s altnames: IP: xx.xxx.xx.xx is not in the cert&#39;s list</code></p>
<blockquote>
<p>PS: HTTPS 的证书通过域名绑定 就只能通过域名访问不要通过 IP 地址来访问</p>
</blockquote>
]]></content>
      <categories>
        <category>网络应用</category>
      </categories>
      <tags>
        <tag>HTTPS</tag>
      </tags>
  </entry>
  <entry>
    <title>Iterator和Generator</title>
    <url>/2021/03/25/js/Iterator%E5%92%8CGenerator/</url>
    <content><![CDATA[<p>Iterator 和 Generator</p>
<h2 id="Iterator（迭代器）"><a href="#Iterator（迭代器）" class="headerlink" title="Iterator（迭代器）"></a>Iterator（迭代器）</h2><p>详细文档：<a href="https://es6.ruanyifeng.com/#docs/iterator">ECMAScript 6 入门-Iterator 和 for…of 循环</a></p>
<h3 id="Iterator（迭代器）的概念"><a href="#Iterator（迭代器）的概念" class="headerlink" title="Iterator（迭代器）的概念"></a>Iterator（迭代器）的概念</h3><p>Iterator 即遍历器对象</p>
<p>Generator 函数调用后可以返回一个遍历器对象 Iterator</p>
<p>所有可以使用 for of 遍历的对象内部都实现时了 Iterator 接口 比如：</p>
<p>通过<code>Arrary.prototype[Symbol.iterator]()</code>可以返回 Iterator</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;<span class="comment">// Arrary 内部的遍历器对象</span></span><br><span class="line">    <span class="attr">__proto__</span>: <span class="title class_">Array</span> <span class="title class_">Iterator</span>&#123;</span><br><span class="line">        <span class="attr">next</span>: ƒ <span class="title function_">next</span>()			<span class="comment">// 调用 next 方法将 指针指向下一个元素</span></span><br><span class="line">        <span class="title class_">Symbol</span>(<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>): <span class="string">&quot;Array Iterator&quot;</span></span><br><span class="line">        <span class="attr">__proto__</span>: <span class="title class_">Object</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当然也可直接实现一个遍历器对象</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> it = <span class="title function_">makeIterator</span>([<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>]);</span><br><span class="line"></span><br><span class="line">it.<span class="title function_">next</span>(); <span class="comment">// &#123; value: &quot;a&quot;, done: false &#125;</span></span><br><span class="line">it.<span class="title function_">next</span>(); <span class="comment">// &#123; value: &quot;b&quot;, done: false &#125;</span></span><br><span class="line">it.<span class="title function_">next</span>(); <span class="comment">// &#123; value: undefined, done: true &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">makeIterator</span>(<span class="params">array</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> nextIndex = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">next</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> nextIndex &lt; array.<span class="property">length</span></span><br><span class="line">        ? &#123; <span class="attr">value</span>: array[nextIndex++], <span class="attr">done</span>: <span class="literal">false</span> &#125;</span><br><span class="line">        : &#123; <span class="attr">value</span>: <span class="literal">undefined</span>, <span class="attr">done</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用 next 方法， 返回<code>&#123; value: xxx, done: boolean &#125;</code>,通过判断 done 是否为 true，来判断遍历是否结束</p>
<h3 id="调用-Iterator-接口的场合"><a href="#调用-Iterator-接口的场合" class="headerlink" title="调用 Iterator 接口的场合"></a>调用 Iterator 接口的场合</h3><p>有一些场合会默认调用 Iterator 接口（即<code>Symbol.iterator</code>方法），除了下文会介绍的<code>for...of</code>循环，还有几个别的场合。</p>
<p><strong>（1）解构赋值</strong></p>
<p>对数组和 Set 结构进行解构赋值时，会默认调用<code>Symbol.iterator</code>方法。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>().<span class="title function_">add</span>(<span class="string">&quot;a&quot;</span>).<span class="title function_">add</span>(<span class="string">&quot;b&quot;</span>).<span class="title function_">add</span>(<span class="string">&quot;c&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [x, y] = set;</span><br><span class="line"><span class="comment">// x=&#x27;a&#x27;; y=&#x27;b&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [first, ...rest] = set;</span><br><span class="line"><span class="comment">// first=&#x27;a&#x27;; rest=[&#x27;b&#x27;,&#x27;c&#x27;];</span></span><br></pre></td></tr></table></figure>

<p><strong>（2）扩展运算符</strong></p>
<p>扩展运算符（…）也会调用默认的 Iterator 接口。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 例一</span></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">[...str]; <span class="comment">//  [&#x27;h&#x27;,&#x27;e&#x27;,&#x27;l&#x27;,&#x27;l&#x27;,&#x27;o&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 例二</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>];</span><br><span class="line">[<span class="string">&quot;a&quot;</span>, ...arr, <span class="string">&quot;d&quot;</span>];</span><br><span class="line"><span class="comment">// [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;]</span></span><br></pre></td></tr></table></figure>

<p>上面代码的扩展运算符内部就调用 Iterator 接口。</p>
<p>实际上，这提供了一种简便机制，可以将任何部署了 Iterator 接口的数据结构，转为数组。也就是说，只要某个数据结构部署了 Iterator 接口，就可以对它使用扩展运算符，将其转为数组。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [...iterable];</span><br></pre></td></tr></table></figure>

<p><strong>（3）yield*</strong></p>
<p><code>yield*</code>后面跟的是一个可遍历的结构，它会调用该结构的遍历器接口。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> generator = <span class="keyword">function</span>* () &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">yield</span>* [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">5</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> iterator = <span class="title function_">generator</span>();</span><br><span class="line"></span><br><span class="line">iterator.<span class="title function_">next</span>(); <span class="comment">// &#123; value: 1, done: false &#125;</span></span><br><span class="line">iterator.<span class="title function_">next</span>(); <span class="comment">// &#123; value: 2, done: false &#125;</span></span><br><span class="line">iterator.<span class="title function_">next</span>(); <span class="comment">// &#123; value: 3, done: false &#125;</span></span><br><span class="line">iterator.<span class="title function_">next</span>(); <span class="comment">// &#123; value: 4, done: false &#125;</span></span><br><span class="line">iterator.<span class="title function_">next</span>(); <span class="comment">// &#123; value: 5, done: false &#125;</span></span><br><span class="line">iterator.<span class="title function_">next</span>(); <span class="comment">// &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>（4）其他场合</strong></p>
<p>由于数组的遍历会调用遍历器接口，所以任何接受数组作为参数的场合，其实都调用了遍历器接口。下面是一些例子。</p>
<ul>
<li>for…of</li>
<li>Array.from()</li>
<li>Map(), Set(), WeakMap(), WeakSet()（比如<code>new Map([[&#39;a&#39;,1],[&#39;b&#39;,2]])</code>）</li>
<li>Promise.all()</li>
<li>Promise.race()</li>
</ul>
<h2 id="Generator（生成器）"><a href="#Generator（生成器）" class="headerlink" title="Generator（生成器）"></a>Generator（生成器）</h2><p>详细文档：<a href="https://es6.ruanyifeng.com/#docs/generator">ECMAScript 6 入门-Generator 函数的语法</a></p>
<p>建议看：JavaScript 高级程序设计（第 4 版）中关于生成器的描述</p>
<h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><p>Generator 函数 是生成器函数，Generator 函数 返回 Generator（生成器）</p>
<p>Generator 是一个状态机，封装了多个内部状态（本人的理解：是一个可以控制内部执行步骤的 函数）</p>
<p>Generator 生成器 内部实现了 Iterator （迭代器）接口，因此具有 next() 方法。调用这个方法会让生</p>
<p>成器开始或恢复执行</p>
<h3 id="控制内部执行步骤"><a href="#控制内部执行步骤" class="headerlink" title="控制内部执行步骤"></a>控制内部执行步骤</h3><ul>
<li><p>调用 generatorFn 生成器函数的时候并不会执行内部代码</p>
</li>
<li><p>generator 调用 next 方法， 开始执行 generatorFn 内部代码</p>
</li>
<li><p>遇到 yield 关键字将停止执行代码，并将 yield 后面的值返回</p>
</li>
<li><p>再次调用 next 方法 将从上一个 yield 所在行开始执行</p>
</li>
<li><p>如果 next 中有参数将传递给开始执行所在行的 yield，如果是首次调用 next 将没有 yield 可以供其赋值</p>
</li>
<li><p>遇到 return 关键字将返回 { value: return 后面的值, done: true }</p>
</li>
<li><p>如果函数内没有 return 也没有 yield 的了 将返回 { value: undefined, done: true }</p>
</li>
</ul>
<h4 id="正常执行顺序"><a href="#正常执行顺序" class="headerlink" title="正常执行顺序"></a>正常执行顺序</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">generatorFn</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;0-&gt;yield1&quot;</span>);</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">&quot;yield1&quot;</span>; <span class="comment">// 停止 返回 yield1</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;yield1-&gt;yield2&quot;</span>);</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">&quot;yield2&quot;</span>; <span class="comment">// 停止 返回 yield2</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;yield2-&gt;end&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> generator = <span class="title function_">generatorFn</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;next1&quot;</span>, generator.<span class="title function_">next</span>());</span><br><span class="line"><span class="comment">// 0-&gt;yield1</span></span><br><span class="line"><span class="comment">// next1 &#123; value: &#x27;yield1&#x27;, done: false &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;next2&quot;</span>, generator.<span class="title function_">next</span>());</span><br><span class="line"><span class="comment">// yield1-&gt;yield2</span></span><br><span class="line"><span class="comment">// next2 &#123; value: &#x27;yield2&#x27;, done: false &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;next3&quot;</span>, generator.<span class="title function_">next</span>());</span><br><span class="line"><span class="comment">// yield2-&gt;end</span></span><br><span class="line"><span class="comment">// next3 &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="next-传参"><a href="#next-传参" class="headerlink" title="next 传参"></a>next 传参</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">generatorFn</span>(<span class="params">params</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(params);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;yield1&quot;</span>, <span class="keyword">yield</span> <span class="string">&quot;yield1&quot;</span>); <span class="comment">// 遇到 yield ，yield所在行的代码都不会执行，但是 yield 后边的参数会返回</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;yield2&quot;</span>, <span class="keyword">yield</span> <span class="string">&quot;yield2&quot;</span>); <span class="comment">// 不会执行console.log，下次调用next时才会执行console.log以及后面的代码</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;end&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> generator = <span class="title function_">generatorFn</span>(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ***第一次的bar并不会赋值给yield1关键字 因为这一次调用是为了开始执行生成器函数，第二次调用yield1的值变成baz***</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;next1&quot;</span>, generator.<span class="title function_">next</span>(<span class="string">&quot;bar&quot;</span>));</span><br><span class="line"><span class="comment">// foo</span></span><br><span class="line"><span class="comment">// next1 &#123; value: &#x27;yield1&#x27;, done: false &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;next2&quot;</span>, generator.<span class="title function_">next</span>(<span class="string">&quot;baz&quot;</span>));</span><br><span class="line"><span class="comment">// yield1 baz</span></span><br><span class="line"><span class="comment">// next2 &#123; value: &#x27;yield2&#x27;, done: false &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;next3&quot;</span>, generator.<span class="title function_">next</span>(<span class="string">&quot;qux&quot;</span>));</span><br><span class="line"><span class="comment">// yield2 qux</span></span><br><span class="line"><span class="comment">// end</span></span><br><span class="line"><span class="comment">// next3 &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="带-return-的"><a href="#带-return-的" class="headerlink" title="带 return 的"></a>带 return 的</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">helloWorldGenerator</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">&quot;world&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;ending&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> hw = <span class="title function_">helloWorldGenerator</span>();</span><br><span class="line"></span><br><span class="line">hw.<span class="title function_">next</span>();</span><br><span class="line"><span class="comment">// &#123; value: &#x27;hello&#x27;, done: false &#125;</span></span><br><span class="line"></span><br><span class="line">hw.<span class="title function_">next</span>();</span><br><span class="line"><span class="comment">// &#123; value: &#x27;world&#x27;, done: false &#125;</span></span><br><span class="line"></span><br><span class="line">hw.<span class="title function_">next</span>();</span><br><span class="line"><span class="comment">// &#123; value: &#x27;ending&#x27;, done: true &#125;</span></span><br><span class="line"></span><br><span class="line">hw.<span class="title function_">next</span>();</span><br><span class="line"><span class="comment">// &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>js</tag>
        <tag>es6</tag>
      </tags>
  </entry>
  <entry>
    <title>JS中常见获取随机数的方法</title>
    <url>/2021/07/02/js/JS%E4%B8%AD%E5%B8%B8%E8%A7%81%E8%8E%B7%E5%8F%96%E9%9A%8F%E6%9C%BA%E6%95%B0%E7%9A%84%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<h2 id="JS-获取固定区间的随机数"><a href="#JS-获取固定区间的随机数" class="headerlink" title="JS 获取固定区间的随机数"></a>JS 获取固定区间的随机数</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> start = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> end = <span class="number">20</span>;</span><br><span class="line"><span class="comment">// parseInt</span></span><br><span class="line"><span class="built_in">parseInt</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (end - start + <span class="number">1</span>)) + start;</span><br><span class="line"><span class="comment">// floor</span></span><br><span class="line"><span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (end - start + <span class="number">1</span>)) + start;</span><br><span class="line"><span class="comment">// ceil</span></span><br><span class="line"><span class="title class_">Math</span>.<span class="title function_">ceil</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (end - start + <span class="number">1</span>));</span><br><span class="line"><span class="comment">// 注意 round 首尾不是等比例 首尾比例是其他的 1/2</span></span><br><span class="line"><span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (max - min)) + min;</span><br></pre></td></tr></table></figure>

<h2 id="JS-简单生成由字母数字组合随机字符串示例"><a href="#JS-简单生成由字母数字组合随机字符串示例" class="headerlink" title="JS 简单生成由字母数字组合随机字符串示例"></a>JS 简单生成由字母数字组合随机字符串示例</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> ** randomWord 产生任意长度随机字母数字组合</span></span><br><span class="line"><span class="comment"> ** randomFlag-是否任意长度 min-任意长度最小位[固定位数] max-任意长度最大位 , true 使用min - max  false 使用 min</span></span><br><span class="line"><span class="comment"> ** xuanfeng 2014-08-28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">randomWord</span>(<span class="params">randomFlag, min, max</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> str = <span class="string">&quot;&quot;</span>,</span><br><span class="line">    range = min,</span><br><span class="line">    arr = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&quot;</span>; <span class="comment">// 随机产生</span></span><br><span class="line">  <span class="keyword">if</span> (randomFlag) &#123;</span><br><span class="line">    range = <span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (max - min)) + min;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; range; i++) &#123;</span><br><span class="line">    pos = <span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (arr.<span class="property">length</span> - <span class="number">1</span>));</span><br><span class="line">    str += arr[pos];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScriptpt SourceMap 学习</title>
    <url>/2020/08/18/js/JavaScriptpt-SourceMap-%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h2 id="学习资料"><a href="#学习资料" class="headerlink" title="学习资料"></a>学习资料</h2><p><a href="https://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html">阮一峰 JavaScript Source Map 详解</a></p>
<h2 id="Source-map的格式"><a href="#Source-map的格式" class="headerlink" title="Source map的格式"></a>Source map的格式</h2><p>看一下项目中由 vue-cli 生成的 source map</p>
<p>源文件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 下面代码是在一行显示</span></span><br><span class="line">(<span class="variable language_">window</span>[<span class="string">&quot;webpackJsonp&quot;</span>]=<span class="variable language_">window</span>[<span class="string">&quot;webpackJsonp&quot;</span>]||[]).<span class="title function_">push</span>([[<span class="string">&quot;404&quot;</span>],&#123;<span class="string">&quot;077b&quot;</span>:<span class="keyword">function</span>(<span class="params">n,c,t</span>)&#123;<span class="string">&quot;use strict&quot;</span>;<span class="title function_">t</span>(<span class="string">&quot;cfb7&quot;</span>)&#125;,<span class="string">&quot;8cdb&quot;</span>:<span class="keyword">function</span>(<span class="params">n,c,t</span>)&#123;<span class="string">&quot;use strict&quot;</span>;t.<span class="title function_">r</span>(c);<span class="keyword">var</span> e=<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> n=<span class="variable language_">this</span>,c=n.<span class="property">$createElement</span>,t=n.<span class="property">_self</span>.<span class="property">_c</span>||c;<span class="keyword">return</span> <span class="title function_">t</span>(<span class="string">&quot;div&quot;</span>,&#123;<span class="attr">staticClass</span>:<span class="string">&quot;container&quot;</span>&#125;,[n.<span class="title function_">_v</span>(<span class="string">&quot;404&quot;</span>)])&#125;,s=[],i=&#123;&#125;,u=i,a=(<span class="title function_">t</span>(<span class="string">&quot;077b&quot;</span>),<span class="title function_">t</span>(<span class="string">&quot;0c7c&quot;</span>)),l=<span class="title class_">Object</span>(a[<span class="string">&quot;a&quot;</span>])(u,e,s,!<span class="number">1</span>,<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>);c[<span class="string">&quot;default&quot;</span>]=l.<span class="property">exports</span>&#125;,<span class="attr">cfb7</span>:<span class="keyword">function</span>(<span class="params">n,c,t</span>)&#123;&#125;&#125;]);</span><br><span class="line"><span class="comment">//# sourceMappingURL=404.f6b2607e.js.map</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> render = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> _vm = <span class="variable language_">this</span></span><br><span class="line">  <span class="keyword">var</span> _h = _vm.<span class="property">$createElement</span></span><br><span class="line">  <span class="keyword">var</span> _c = _vm.<span class="property">_self</span>.<span class="property">_c</span> || _h</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">_c</span>(</span><br><span class="line">    <span class="string">&quot;div&quot;</span>,</span><br><span class="line">    _vm.<span class="title function_">_b</span>(&#123; <span class="attr">staticClass</span>: <span class="string">&quot;container&quot;</span> &#125;, <span class="string">&quot;div&quot;</span>, <span class="literal">false</span>),</span><br><span class="line">    [_vm.<span class="title function_">_v</span>(<span class="string">&quot;404&quot;</span>)]</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> staticRenderFns = []</span><br><span class="line">render.<span class="property">_withStripped</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; render, staticRenderFns &#125;</span><br></pre></td></tr></table></figure>

<p>source map</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sources&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;webpack:///./src/views/404.vue?1c47&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;webpack:///./src/views/404.vue?abb9&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;webpack:///src/views/404.vue&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;webpack:///./src/views/404.vue?ead0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;webpack:///./src/views/404.vue&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;names&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;render&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;_vm&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;this&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;_h&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;$createElement&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;_c&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;_self&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;staticClass&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;_v&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;staticRenderFns&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;component&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 压缩后的代码只有一行所以没有; 号</span></span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="string">&quot;uGAAA,W,2CCAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,YAAY,aAAa,CAACN,EAAIO,GAAG,UACvIC,EAAkB,GCGP,KCJ4V,I,wBCQvWC,EAAY,eACd,EACAV,EACAS,GACA,EACA,KACA,KACA,MAIa,aAAAC,E&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;file&quot;</span><span class="punctuation">:</span> <span class="string">&quot;js/404.f6b2607e.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sourcesContent&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;export * f..... &quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sourceRoot&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight nestedtext"><table><tr><td class="code"><pre><span class="line">　　<span class="bullet">-</span> <span class="string">version：Source map的版本，目前为3。</span></span><br><span class="line"></span><br><span class="line">　　<span class="bullet">-</span> <span class="string">file：转换后的文件名。</span></span><br><span class="line"></span><br><span class="line">　　<span class="bullet">-</span> <span class="string">sourceRoot：转换前的文件所在的目录。如果与转换前的文件在同一目录，该项为空。</span></span><br><span class="line"></span><br><span class="line">　　<span class="bullet">-</span> <span class="string">sources：转换前的文件。该项是一个数组，表示可能存在多个文件合并。</span></span><br><span class="line"></span><br><span class="line">　　<span class="bullet">-</span> <span class="string">names：转换前的所有变量名和属性名。</span></span><br><span class="line"></span><br><span class="line">　　<span class="bullet">-</span> <span class="string">mappings：记录位置信息的字符串，下文详细介绍。</span></span><br></pre></td></tr></table></figure>

<h2 id="mappings属性"><a href="#mappings属性" class="headerlink" title="mappings属性"></a>mappings属性</h2><p>下面才是真正有趣的部分：两个文件的各个位置是如何一一对应的。</p>
<p>关键就是map文件的mappings属性。这是一个很长的字符串，它分成三层。</p>
<blockquote>
<p>　第一层是<strong>行对应</strong>，以分号（;）表示，每个分号对应转换后源码的一行。所以，第一个分号前的内容，就对应源码的第一行，以此类推。</p>
<p>　第二层是<strong>位置对应</strong>，以逗号（,）表示，每个逗号对应转换后源码的一个位置。所以，第一个逗号前的内容，就对应该行源码的第一个位置，以此类推。</p>
<p>　第三层是<strong>位置转换</strong>，以<a href="https://en.wikipedia.org/wiki/Variable-length_quantity">VLQ编码</a>表示，代表该位置对应的转换前的源码位置。</p>
</blockquote>
<p>举例来说，假定mappings属性的内容如下：</p>
<blockquote>
<p>　mappings:”AAAAA,BBBBB;CCCCC”</p>
</blockquote>
<p>就表示，转换后的源码分成两行，第一行有两个位置，第二行有一个位置。</p>
<h2 id="位置对应的原理"><a href="#位置对应的原理" class="headerlink" title="位置对应的原理"></a>位置对应的原理</h2><p>每个位置使用五位，表示五个字段。</p>
<p>从左边算起，</p>
<blockquote>
<p>　- 第一位，表示这个位置在（转换后的代码的）的第几列。</p>
<p>　- 第二位，表示这个位置属于sources属性中的哪一个文件。</p>
<p>　- 第三位，表示这个位置属于转换前代码的第几行。</p>
<p>　- 第四位，表示这个位置属于转换前代码的第几列。</p>
<p>　- 第五位，表示这个位置属于names属性中的哪一个变量。</p>
</blockquote>
<p>有几点需要说明。首先，所有的值都是以0作为基数的。其次，第五位不是必需的，如果该位置没有对应names属性中的变量，可以省略第五位。再次，每一位都采用VLQ编码表示；由于VLQ编码是变长的，所以每一位可以由多个字符构成。</p>
<p>如果某个位置是AAAAA，由于A在VLQ编码中表示0，因此这个位置的五个位实际上都是0。它的意思是，该位置在转换后代码的第0列，对应sources属性中第0个文件，属于转换前代码的第0行第0列，对应names属性中的第0个变量。</p>
<h2 id="VLQ编码"><a href="#VLQ编码" class="headerlink" title="VLQ编码"></a>VLQ编码</h2><p>最后，谈谈如何用<a href="https://en.wikipedia.org/wiki/Variable-length_quantity">VLQ编码</a>表示数值。</p>
<p>这种编码最早用于MIDI文件，后来被多种格式采用。它的特点就是可以非常精简地表示很大的数值。</p>
<p>VLQ编码是变长的。如果（整）数值在-15到+15之间（含两个端点），用一个字符表示；超出这个范围，就需要用多个字符表示。它规定，每个字符使用6个两进制位，正好可以借用<a href="https://en.wikipedia.org/wiki/Base_64">Base 64</a>编码的字符表。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/20220318142001.png" alt="img"></p>
<p>在这6个位中，左边的第一位（最高位）表示是否”连续”（continuation）。如果是1，代表这６个位后面的6个位也属于同一个数；如果是0，表示该数值到这6个位结束。</p>
<blockquote>
<p>　Continuation<br>　|　　　　　Sign<br>　|　　　　　|<br>　V　　　　　V<br>　１０１０１１</p>
</blockquote>
<p>这6个位中的右边最后一位（最低位）的含义，取决于这6个位是否是某个数值的VLQ编码的第一个字符。如果是的，这个位代表”符号”（sign），0为正，1为负（Source map的符号固定为0）；如果不是，这个位没有特殊含义，被算作数值的一部分。</p>
<h2 id="VLQ编码：实例"><a href="#VLQ编码：实例" class="headerlink" title="VLQ编码：实例"></a>VLQ编码：实例</h2><p>下面看一个例子，如何对数值16进行VLQ编码。</p>
<blockquote>
<p>　第一步，将16改写成二进制形式10000。</p>
<p>　第二步，在最右边补充符号位。因为16大于0，所以符号位为0，整个数变成100000。</p>
<p>　第三步，从右边的最低位开始，将整个数每隔5位，进行分段，即变成1和00000两段。如果最高位所在的段不足5位，则前面补0，因此两段变成00001和00000。</p>
<p>　第四步，将两段的顺序倒过来，即00000和00001。</p>
<p>　第五步，在每一段的最前面添加一个”连续位”，除了最后一段为0，其他都为1，即变成100000和000001。</p>
<p>　第六步，将每一段转成Base 64编码。</p>
</blockquote>
<p>查表可知，100000为g，000001为B。因此，数值16的VLQ编码为gB。上面的过程，看上去好像很复杂，做起来其实很简单，具体的实现请看官方的<a href="https://github.com/mozilla/source-map/blob/master/lib/source-map/base64-vlq.js">base64-vlq.js</a>文件，里面有详细的注释。</p>
<p>转换VLQ编码 <a href="https://www.murzwin.com/base64vlq.html">https://www.murzwin.com/base64vlq.html</a></p>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript位运算符</title>
    <url>/2020/08/18/js/JavaScript%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6/</url>
    <content><![CDATA[<h2 id="w3school"><a href="#w3school" class="headerlink" title="w3school"></a>w3school</h2><p><a href="https://www.w3school.com.cn/js/js_bitwise.asp">https://www.w3school.com.cn/js/js_bitwise.asp</a></p>
<h2 id="JavaScript-位运算符"><a href="#JavaScript-位运算符" class="headerlink" title="JavaScript 位运算符"></a>JavaScript 位运算符</h2><table>
<thead>
<tr>
<th align="left">运算符</th>
<th align="left">名称</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">&amp;</td>
<td align="left">AND</td>
<td align="left">如果两位都是 1 则设置每位为 1</td>
</tr>
<tr>
<td align="left">|</td>
<td align="left">OR</td>
<td align="left">如果两位之一为 1 则设置每位为 1</td>
</tr>
<tr>
<td align="left">^</td>
<td align="left">XOR</td>
<td align="left">如果两位只有一位为 1 则设置每位为 1</td>
</tr>
<tr>
<td align="left">~</td>
<td align="left">NOT</td>
<td align="left">反转所有位</td>
</tr>
<tr>
<td align="left">&lt;&lt;</td>
<td align="left">零填充左位移</td>
<td align="left">通过从右推入零向左位移，并使最左边的位脱落。</td>
</tr>
<tr>
<td align="left">&gt;&gt;</td>
<td align="left">有符号右位移</td>
<td align="left">通过从左推入最左位的拷贝来向右位移，并使最右边的位脱落。</td>
</tr>
<tr>
<td align="left">&gt;&gt;&gt;</td>
<td align="left">零填充右位移</td>
<td align="left">通过从左推入零来向右位移，并使最右边的位脱落。</td>
</tr>
</tbody></table>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><table>
<thead>
<tr>
<th align="left">操作</th>
<th align="left">结果</th>
<th align="left">等同于</th>
<th align="left">结果</th>
</tr>
</thead>
<tbody><tr>
<td align="left">5 &amp; 1</td>
<td align="left">1</td>
<td align="left">0101 &amp; 0001</td>
<td align="left">0001</td>
</tr>
<tr>
<td align="left">5 | 1</td>
<td align="left">5</td>
<td align="left">0101 | 0001</td>
<td align="left">0101</td>
</tr>
<tr>
<td align="left">5 ^ 1</td>
<td align="left">4</td>
<td align="left">0101 ^ 0001</td>
<td align="left">0100</td>
</tr>
<tr>
<td align="left">~ 5</td>
<td align="left">10</td>
<td align="left">~0101</td>
<td align="left">1010</td>
</tr>
<tr>
<td align="left">5 &lt;&lt; 1</td>
<td align="left">10</td>
<td align="left">0101 &lt;&lt; 1</td>
<td align="left">1010</td>
</tr>
<tr>
<td align="left">5 &gt;&gt; 1</td>
<td align="left">2</td>
<td align="left">0101 &gt;&gt; 1</td>
<td align="left">0010</td>
</tr>
<tr>
<td align="left">5 &gt;&gt;&gt; 1</td>
<td align="left">2</td>
<td align="left">0101 &gt;&gt;&gt; 1</td>
<td align="left">0010</td>
</tr>
</tbody></table>
<h2 id="JavaScript-使用-32-位按位运算数"><a href="#JavaScript-使用-32-位按位运算数" class="headerlink" title="JavaScript 使用 32 位按位运算数"></a>JavaScript 使用 32 位按位运算数</h2><p>JavaScript 将数字存储为 64 位浮点数，但所有按位运算都以 32 位二进制数执行。</p>
<p>在执行位运算之前，JavaScript 将数字转换为 32 位有符号整数。</p>
<p>执行按位操作后，结果将转换回 64 位 JavaScript 数。</p>
<p>上面的例子使用 4 位无符号二进制数。所以 ~ 5 返回 10。</p>
<p>由于 JavaScript 使用 32 位有符号整数，JavaScript 将返回 -6。</p>
<p>00000000000000000000000000000101 (5)</p>
<p>11111111111111111111111111111010 (~5 &#x3D; -6)</p>
<p>有符号整数使用最左边的位作为减号。</p>
<h2 id="位运算-AND"><a href="#位运算-AND" class="headerlink" title="位运算 AND"></a>位运算 AND</h2><p>当对一对数位执行位运算 AND 时，如果数位均为 1 则返回 1。</p>
<h3 id="单位示例："><a href="#单位示例：" class="headerlink" title="单位示例："></a>单位示例：</h3><table>
<thead>
<tr>
<th align="left">运算</th>
<th align="left">结果</th>
</tr>
</thead>
<tbody><tr>
<td align="left">0 &amp; 0</td>
<td align="left">0</td>
</tr>
<tr>
<td align="left">0 &amp; 1</td>
<td align="left">0</td>
</tr>
<tr>
<td align="left">1 &amp; 0</td>
<td align="left">0</td>
</tr>
<tr>
<td align="left">1 &amp; 1</td>
<td align="left">1</td>
</tr>
</tbody></table>
<h3 id="四位示例："><a href="#四位示例：" class="headerlink" title="四位示例："></a>四位示例：</h3><table>
<thead>
<tr>
<th align="left">运算</th>
<th align="left">结果</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1111 &amp; 0000</td>
<td align="left">0000</td>
</tr>
<tr>
<td align="left">1111 &amp; 0001</td>
<td align="left">0001</td>
</tr>
<tr>
<td align="left">1111 &amp; 0010</td>
<td align="left">0010</td>
</tr>
<tr>
<td align="left">1111 &amp; 0100</td>
<td align="left">0100</td>
</tr>
</tbody></table>
<h2 id="位运算-OR"><a href="#位运算-OR" class="headerlink" title="位运算 OR"></a>位运算 OR</h2><p>当对一对数位执行位运算 OR 时，如果其中一位是 1 则返回 1：</p>
<h3 id="单位示例"><a href="#单位示例" class="headerlink" title="单位示例"></a>单位示例</h3><table>
<thead>
<tr>
<th align="left">运算</th>
<th align="left">结果</th>
</tr>
</thead>
<tbody><tr>
<td align="left">0 | 0</td>
<td align="left">0</td>
</tr>
<tr>
<td align="left">0 | 1</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">1 | 0</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">1 | 1</td>
<td align="left">1</td>
</tr>
</tbody></table>
<h3 id="四位运算："><a href="#四位运算：" class="headerlink" title="四位运算："></a>四位运算：</h3><table>
<thead>
<tr>
<th align="left">操作</th>
<th align="left">结果</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1111 | 0000</td>
<td align="left">1111</td>
</tr>
<tr>
<td align="left">1111 | 0001</td>
<td align="left">1111</td>
</tr>
<tr>
<td align="left">1111 | 0010</td>
<td align="left">1111</td>
</tr>
<tr>
<td align="left">1111 | 0100</td>
<td align="left">1111</td>
</tr>
</tbody></table>
<h2 id="位运算-XOR"><a href="#位运算-XOR" class="headerlink" title="位运算 XOR"></a>位运算 XOR</h2><p>当对一对数位进行位运算 XOR 时，如果数位是不同的则返回 1：</p>
<h3 id="单位示例：-1"><a href="#单位示例：-1" class="headerlink" title="单位示例："></a>单位示例：</h3><table>
<thead>
<tr>
<th align="left">运算</th>
<th align="left">结果</th>
</tr>
</thead>
<tbody><tr>
<td align="left">0 ^ 0</td>
<td align="left">0</td>
</tr>
<tr>
<td align="left">0 ^ 1</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">1 ^ 0</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">1 ^ 1</td>
<td align="left">0</td>
</tr>
</tbody></table>
<h3 id="四位示例：-1"><a href="#四位示例：-1" class="headerlink" title="四位示例："></a>四位示例：</h3><table>
<thead>
<tr>
<th align="left">运算</th>
<th align="left">结果</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1111 ^ 0000</td>
<td align="left">1111</td>
</tr>
<tr>
<td align="left">1111 ^ 0001</td>
<td align="left">1110</td>
</tr>
<tr>
<td align="left">1111 ^ 0010</td>
<td align="left">1101</td>
</tr>
<tr>
<td align="left">1111 ^ 0100</td>
<td align="left">1011</td>
</tr>
</tbody></table>
<h2 id="JavaScript-位运算-AND-amp"><a href="#JavaScript-位运算-AND-amp" class="headerlink" title="JavaScript 位运算 AND (&amp;)"></a>JavaScript 位运算 AND (&amp;)</h2><p>如果位数都是 1，则位运算 AND 返回 1：</p>
<table>
<thead>
<tr>
<th align="left">十进制</th>
<th align="left">二进制</th>
</tr>
</thead>
<tbody><tr>
<td align="left">5</td>
<td align="left">00000000000000000000000000000101</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">00000000000000000000000000000001</td>
</tr>
<tr>
<td align="left">5 &amp; 1</td>
<td align="left">00000000000000000000000000000001 (1)</td>
</tr>
</tbody></table>
<h3 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h3><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">var</span> x = <span class="number">5</span> &amp; <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h2 id="JavaScript-位运算-OR"><a href="#JavaScript-位运算-OR" class="headerlink" title="JavaScript 位运算 OR (|)"></a>JavaScript 位运算 OR (|)</h2><p>如果数位之一是 1，则位运算 OR 返回 1：</p>
<table>
<thead>
<tr>
<th align="left">十进制</th>
<th align="left">二进制</th>
</tr>
</thead>
<tbody><tr>
<td align="left">5</td>
<td align="left">00000000000000000000000000000101</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">00000000000000000000000000000001</td>
</tr>
<tr>
<td align="left">5 | 1</td>
<td align="left">00000000000000000000000000000101 (5)</td>
</tr>
</tbody></table>
<h3 id="实例-2"><a href="#实例-2" class="headerlink" title="实例"></a>实例</h3><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">var</span> x = <span class="number">5</span> | <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h2 id="JavaScript-位运算-XOR"><a href="#JavaScript-位运算-XOR" class="headerlink" title="JavaScript 位运算 XOR (^)"></a>JavaScript 位运算 XOR (^)</h2><p>如果数位是不同的，则 XOR 返回 1：</p>
<table>
<thead>
<tr>
<th align="left">十进制</th>
<th align="left">二进制</th>
</tr>
</thead>
<tbody><tr>
<td align="left">5</td>
<td align="left">00000000000000000000000000000101</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">00000000000000000000000000000001</td>
</tr>
<tr>
<td align="left">5 ^ 1</td>
<td align="left">00000000000000000000000000000100 (4)</td>
</tr>
</tbody></table>
<h3 id="实例-3"><a href="#实例-3" class="headerlink" title="实例"></a>实例</h3><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">var</span> x = <span class="number">5</span> ^ <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h2 id="JavaScript-位运算-NOT"><a href="#JavaScript-位运算-NOT" class="headerlink" title="JavaScript 位运算 NOT (~)"></a>JavaScript 位运算 NOT (~)</h2><table>
<thead>
<tr>
<th align="left">十进制</th>
<th align="left">二进制</th>
</tr>
</thead>
<tbody><tr>
<td align="left">5</td>
<td align="left">00000000000000000000000000000101</td>
</tr>
<tr>
<td align="left">~5</td>
<td align="left">11111111111111111111111111111010 (-6)</td>
</tr>
</tbody></table>
<h3 id="实例-4"><a href="#实例-4" class="headerlink" title="实例"></a>实例</h3><figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">var x</span> = ~5;</span><br></pre></td></tr></table></figure>

<h2 id="JavaScript（零填充）位运算左移（-lt-lt-）"><a href="#JavaScript（零填充）位运算左移（-lt-lt-）" class="headerlink" title="JavaScript（零填充）位运算左移（&lt;&lt;）"></a>JavaScript（零填充）位运算左移（&lt;&lt;）</h2><p>这是零填充的左移。一个或多个零数位从右被推入，最左侧的数位被移除：</p>
<table>
<thead>
<tr>
<th align="left">十进制</th>
<th align="left">二进制</th>
</tr>
</thead>
<tbody><tr>
<td align="left">5</td>
<td align="left">00000000000000000000000000000101</td>
</tr>
<tr>
<td align="left">5 &lt;&lt; 1</td>
<td align="left">00000000000000000000000000001010 (10)</td>
</tr>
</tbody></table>
<h3 id="实例-5"><a href="#实例-5" class="headerlink" title="实例"></a>实例</h3><figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">var x <span class="operator">=</span> <span class="number">5</span> &lt;&lt; <span class="number">1</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>

<h2 id="JavaScript（有符号）位运算右移（-gt-gt-）"><a href="#JavaScript（有符号）位运算右移（-gt-gt-）" class="headerlink" title="JavaScript（有符号）位运算右移（&gt;&gt;）"></a>JavaScript（有符号）位运算右移（&gt;&gt;）</h2><p>这是保留符号的右移。最左侧的数位被从左侧推入，最右侧的数位被移出：</p>
<table>
<thead>
<tr>
<th align="left">十进制</th>
<th align="left">二进制</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-5</td>
<td align="left">11111111111111111111111111111011</td>
</tr>
<tr>
<td align="left">-5 &gt;&gt; 1</td>
<td align="left">11111111111111111111111111111101 (-3)</td>
</tr>
</tbody></table>
<h3 id="实例-6"><a href="#实例-6" class="headerlink" title="实例"></a>实例</h3><figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">var x <span class="operator">=</span> -<span class="number">5</span> &gt;&gt; <span class="number">1</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>

<h2 id="JavaScript（零填充）右移（-gt-gt-gt-）"><a href="#JavaScript（零填充）右移（-gt-gt-gt-）" class="headerlink" title="JavaScript（零填充）右移（&gt;&gt;&gt;）"></a>JavaScript（零填充）右移（&gt;&gt;&gt;）</h2><p>这是零填充的右移。一个或多个零数位从左侧被推入，最右侧的数位被移出：</p>
<table>
<thead>
<tr>
<th align="left">十进制</th>
<th align="left">二进制</th>
</tr>
</thead>
<tbody><tr>
<td align="left">5</td>
<td align="left">00000000000000000000000000000101</td>
</tr>
<tr>
<td align="left">5 &gt;&gt;&gt; 1</td>
<td align="left">00000000000000000000000000000010 (2)</td>
</tr>
</tbody></table>
<h3 id="实例-7"><a href="#实例-7" class="headerlink" title="实例"></a>实例</h3><figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">var x <span class="operator">=</span> <span class="number">5</span> &gt;&gt;&gt; <span class="number">1</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>

<h2 id="32-bit-有符号整数（二进制数）"><a href="#32-bit-有符号整数（二进制数）" class="headerlink" title="32-bit 有符号整数（二进制数）"></a>32-bit 有符号整数（二进制数）</h2><p>仅设置一位的 32 位整数很好理解：</p>
<table>
<thead>
<tr>
<th align="left">二进制表示</th>
<th align="left">十进制值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">00000000000000000000000000000001</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">00000000000000000000000000000010</td>
<td align="left">2</td>
</tr>
<tr>
<td align="left">00000000000000000000000000000100</td>
<td align="left">4</td>
</tr>
<tr>
<td align="left">00000000000000000000000000001000</td>
<td align="left">8</td>
</tr>
<tr>
<td align="left">00000000000000000000000000010000</td>
<td align="left">16</td>
</tr>
<tr>
<td align="left">00000000000000000000000000100000</td>
<td align="left">32</td>
</tr>
<tr>
<td align="left">00000000000000000000000001000000</td>
<td align="left">64</td>
</tr>
</tbody></table>
<p>多设置一些数位揭示了二进制的模式：</p>
<table>
<thead>
<tr>
<th align="left">二进制表示</th>
<th align="left">十进制值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">00000000000000000000000000000101</td>
<td align="left">5 (4 + 1)</td>
</tr>
<tr>
<td align="left">00000000000000000000000000101000</td>
<td align="left">40 (32 + 8)</td>
</tr>
<tr>
<td align="left">00000000000000000000000000101101</td>
<td align="left">45 (32 + 8 + 4 + 1)</td>
</tr>
</tbody></table>
<p>负数是正数的二进制补码加 1：</p>
<table>
<thead>
<tr>
<th align="left">二进制表示</th>
<th align="left">十进制值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">00000000000000000000000000000101</td>
<td align="left">5</td>
</tr>
<tr>
<td align="left">11111111111111111111111111111011</td>
<td align="left">-5</td>
</tr>
<tr>
<td align="left">00000000000000000000000000101000</td>
<td align="left">40</td>
</tr>
<tr>
<td align="left">11111111111111111111111111011000</td>
<td align="left">-40</td>
</tr>
<tr>
<td align="left">11111111111111111111111111011001</td>
<td align="left">-41</td>
</tr>
</tbody></table>
<h2 id="把十进制转换为二进制"><a href="#把十进制转换为二进制" class="headerlink" title="把十进制转换为二进制"></a>把十进制转换为二进制</h2><h3 id="实例-8"><a href="#实例-8" class="headerlink" title="实例"></a>实例</h3><figure class="highlight ada"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title">dec2bin</span>(dec)&#123;</span><br><span class="line">	// 字符串数字转化为数字</span><br><span class="line">    <span class="keyword">return</span> <span class="type">(dec</span> &gt;&gt;&gt; <span class="number">0</span>).toString(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="把二进制转换为十进制"><a href="#把二进制转换为十进制" class="headerlink" title="把二进制转换为十进制"></a>把二进制转换为十进制</h2><h3 id="实例-9"><a href="#实例-9" class="headerlink" title="实例"></a>实例</h3><figure class="highlight ada"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title">bin2dec</span>(bin)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">parseInt(bin,</span> <span class="number">2</span>).toString(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="parseInt-toString-实现各个进制的转换"><a href="#parseInt-toString-实现各个进制的转换" class="headerlink" title="parseInt+toString 实现各个进制的转换"></a>parseInt+toString 实现各个进制的转换</h2><ul>
<li><p>parseInt:将任意进制的数字转化为十进制</p>
</li>
<li><p>toString:将十进制的数字转化为任意进制</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">parseInt</span>(num, <span class="number">8</span>); <span class="comment">//八进制转十进制</span></span><br><span class="line"><span class="built_in">parseInt</span>(num, <span class="number">16</span>); <span class="comment">//十六进制转十进制</span></span><br><span class="line"><span class="built_in">parseInt</span>(num).<span class="title function_">toString</span>(<span class="number">8</span>); <span class="comment">//十进制转八进制</span></span><br><span class="line"><span class="built_in">parseInt</span>(num).<span class="title function_">toString</span>(<span class="number">16</span>); <span class="comment">//十进制转十六进制</span></span><br><span class="line"><span class="built_in">parseInt</span>(num, <span class="number">2</span>).<span class="title function_">toString</span>(<span class="number">8</span>); <span class="comment">//二进制转八进制</span></span><br><span class="line"><span class="built_in">parseInt</span>(num, <span class="number">2</span>).<span class="title function_">toString</span>(<span class="number">16</span>); <span class="comment">//二进制转十六进制</span></span><br><span class="line"><span class="built_in">parseInt</span>(num, <span class="number">8</span>).<span class="title function_">toString</span>(<span class="number">2</span>); <span class="comment">//八进制转二进制</span></span><br><span class="line"><span class="built_in">parseInt</span>(num, <span class="number">8</span>).<span class="title function_">toString</span>(<span class="number">16</span>); <span class="comment">//八进制转十六进制</span></span><br><span class="line"><span class="built_in">parseInt</span>(num, <span class="number">16</span>).<span class="title function_">toString</span>(<span class="number">2</span>); <span class="comment">//十六进制转二进制</span></span><br><span class="line"><span class="built_in">parseInt</span>(num, <span class="number">16</span>).<span class="title function_">toString</span>(<span class="number">8</span>); <span class="comment">//十六进制转八进制</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>以 0X、0x 开头的表示为十六进制。 0xf &#x2F;&#x2F;15</li>
<li>以 0、0O、0o 开头的表示为八进制。0o12 &#x2F;&#x2F;10</li>
<li>以 0B、0b 开头的表示为二进制格式。 0b11&#x2F;&#x2F;3</li>
</ul>
</blockquote>
<p>以上在 js 中可直接使用，可自动转化为对应的 10 进制</p>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>Jenkins的使用</title>
    <url>/2021/07/02/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/Jenkins%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><p><a href="https://www.likecs.com/show-103109.html">https://www.likecs.com/show-103109.html</a></p>
<h3 id="war-包"><a href="#war-包" class="headerlink" title="war 包"></a>war 包</h3><blockquote>
<p>前提：需要 java 环境</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">java -jar ./jenkins.war(jenkins.war文件的路径) --Port=8080（端口）</span><br></pre></td></tr></table></figure>

<h2 id="基于-node-环境构建-react-或-vue-项目"><a href="#基于-node-环境构建-react-或-vue-项目" class="headerlink" title="基于 node 环境构建 react 或 vue 项目"></a>基于 node 环境构建 react 或 vue 项目</h2><p>官方教程：<a href="https://www.jenkins.io/zh/doc/tutorials/build-a-node-js-and-react-app-with-npm/">https://www.jenkins.io/zh/doc/tutorials/build-a-node-js-and-react-app-with-npm/</a></p>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><h4 id="Docker-在-WSL，windows-下出现-Cannot-connect-to-the-Docker-daemon-at-unix-x2F-x2F-x2F-var-x2F-run-x2F-docker-sock-问题"><a href="#Docker-在-WSL，windows-下出现-Cannot-connect-to-the-Docker-daemon-at-unix-x2F-x2F-x2F-var-x2F-run-x2F-docker-sock-问题" class="headerlink" title="Docker 在 WSL，windows 下出现:Cannot connect to the Docker daemon at unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock 问题"></a>Docker 在 WSL，windows 下出现:Cannot connect to the Docker daemon at unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock 问题</h4><p><a href="https://blog.csdn.net/weixin_48031922/article/details/116529198">https://blog.csdn.net/weixin_48031922/article/details/116529198</a></p>
<p>ps：</p>
<p>-v &#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock \</p>
<p>上面这条命令是使容器内系统，可以直接使用当前运行容器的系统的 docker</p>
<p>也就是说 在容器内使用 <code>docker ps -a </code>可以看到当前系统中所有运行的容器，包括当前容器本身</p>
<blockquote>
<p>最佳解决方案是直接在 ubutun 子系统中使用，docker run …</p>
<p>&#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock 就不会出现错误 ，win 上我实在不知道 &#x2F;var&#x2F;run&#x2F;docker.sock 在哪</p>
</blockquote>
<h4 id="出现-WorkflowScript-3-Invalid-agent-type-“docker”-specified"><a href="#出现-WorkflowScript-3-Invalid-agent-type-“docker”-specified" class="headerlink" title="出现 WorkflowScript: 3: Invalid agent type “docker” specified"></a>出现 WorkflowScript: 3: Invalid agent type “docker” specified</h4><p>下载 <code>Docker Pipeline</code> 插件 即可解决</p>
<h2 id="使用流水线语法实现构建后上传服务器"><a href="#使用流水线语法实现构建后上传服务器" class="headerlink" title="使用流水线语法实现构建后上传服务器"></a>使用流水线语法实现构建后上传服务器</h2><p>基于这篇文章：<a href="https://blog.csdn.net/wangzan18/article/details/105864373/">https://blog.csdn.net/wangzan18/article/details/105864373/</a></p>
<h3 id="sshPublisher-文档："><a href="#sshPublisher-文档：" class="headerlink" title="sshPublisher 文档："></a>sshPublisher 文档：</h3><p><a href="https://www.jenkins.io/doc/pipeline/steps/publish-over-ssh/#-sshpublisher-%20send%20build%20artifacts%20over%20ssh">https://www.jenkins.io/doc/pipeline/steps/publish-over-ssh/#-sshpublisher-%20send%20build%20artifacts%20over%20ssh</a></p>
<h3 id="注意点："><a href="#注意点：" class="headerlink" title="注意点："></a>注意点：</h3><h4 id="Publish-over-SSH-插件-，"><a href="#Publish-over-SSH-插件-，" class="headerlink" title="Publish over SSH 插件 ，"></a><strong>Publish over SSH</strong> 插件 ，</h4><p>配置 <strong>Publish over SSH</strong></p>
<p>系统管理-&gt;系统配置-&gt;Publish over SSH</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/Publish%20over%20SSH%E9%85%8D%E7%BD%AE.png" alt="配置 **Publish over SSH** "></p>
<p>ps:</p>
<p>这里配置的私钥就是使用 ssh 免密登录时生成的私钥</p>
<p>全部了解 ssh 见 我的文章 Linux 命令入门 <a href="https://blog.bitbw.top/Linux/Linux%E5%91%BD%E4%BB%A4%E5%85%A5%E9%97%A8/">https://blog.bitbw.top/Linux/Linux%E5%91%BD%E4%BB%A4%E5%85%A5%E9%97%A8/</a></p>
<h4 id="免密码登录"><a href="#免密码登录" class="headerlink" title="免密码登录"></a>免密码登录</h4><h5 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h5><ul>
<li>配置公钥<ul>
<li>执行 <code>ssh-keygen</code> 即可生成 SSH 钥匙，一路回车即可</li>
</ul>
</li>
<li>上传公钥到服务器<ul>
<li>执行 <code>ssh-copy-id -p port user@remote</code>，可以让远程服务器记住我们的公钥</li>
<li>上传后的公钥在远端用户家目录下<code>.ssh</code>文件夹 <code>authorized_keys</code> 中</li>
</ul>
</li>
</ul>
<p>执行<code>ssh-keygen</code>后会在当前用户家目录下生成<code>.ssh</code>文件夹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> <span class="built_in">cd</span> .ssh/</span><br><span class="line"> ll</span><br><span class="line"><span class="comment">#total 20</span></span><br><span class="line"><span class="comment">#drwx------  2 bowen bowen 4096 Aug  2 14:34 ./</span></span><br><span class="line"><span class="comment">#drwxr-xr-x 13 bowen bowen 4096 Aug  4 09:24 ../</span></span><br><span class="line"><span class="comment">#-rw-------  1 bowen bowen 3243 Aug  2 14:32 id_rsa</span></span><br><span class="line"><span class="comment">#-rw-r--r--  1 bowen bowen  747 Aug  2 14:32 id_rsa.pub</span></span><br><span class="line"><span class="comment">#-rw-r--r--  1 bowen bowen  222 Aug  2 13:43 known_hosts</span></span><br></pre></td></tr></table></figure>

<p>id_rsa 就是私钥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> id_rsa</span><br></pre></td></tr></table></figure>

<p>全部复制放到 key 字段中</p>
<h4 id="问题-1"><a href="#问题-1" class="headerlink" title="问题"></a>问题</h4><h5 id="测试连接报错：jenkins-plugins-publish-over-BapPublisherException-Failed-to-add-SSH-key"><a href="#测试连接报错：jenkins-plugins-publish-over-BapPublisherException-Failed-to-add-SSH-key" class="headerlink" title="测试连接报错：jenkins.plugins.publish_over.BapPublisherException: Failed to add SSH key"></a>测试连接报错：jenkins.plugins.publish_over.BapPublisherException: Failed to add SSH key</h5><p>解决：<a href="http://www.wallcopper.com/linux/3689.htmljenkins">http://www.wallcopper.com/linux/3689.htmljenkins</a></p>
<p>无密码 ssh 时报错:jenkins.plugins.publish_over.BapPublisherException: Failed to add SSH key. Message [invalid privatekey: [B@6a581993]<br>com.jcraft.jsch.JSchException: invalid privatekey, 部分库（如：JSch）不支持 OPENSSH PRIVATE KEY 格式的私钥</p>
<p>1、jenkins 使用 <code>ssh-keygen -m PEM -t rsa -b 4096</code> 来生成 key 就可以用了。<br>-m 参数指定密钥的格式，PEM（也就是 RSA 格式）是之前使用的旧格式</p>
<h5 id="ssh-copy-id-上传时报：IT-IS-POSSIBLE-THAT-SOMEONE-IS-DOING-SOMETHING-NASTY"><a href="#ssh-copy-id-上传时报：IT-IS-POSSIBLE-THAT-SOMEONE-IS-DOING-SOMETHING-NASTY" class="headerlink" title="ssh-copy-id 上传时报：IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!"></a>ssh-copy-id 上传时报：IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!</h5><p>解决：<a href="https://blog.csdn.net/weixin_44545265/article/details/88362272">https://blog.csdn.net/weixin_44545265/article/details/88362272</a></p>
<p>文件传输不过去，只需要删除.ssh 目录下的 known_hosts 文件就能传输了<br><code>[root@xx]# rm -rf ~/.ssh/known_hosts</code></p>
<h4 id="我的-jenkinsfile"><a href="#我的-jenkinsfile" class="headerlink" title="我的 jenkinsfile"></a>我的 jenkinsfile</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent &#123;</span><br><span class="line">        docker &#123;</span><br><span class="line">            image <span class="string">&#x27;node:12-alpine&#x27;</span></span><br><span class="line">            args <span class="string">&#x27;-p 3000:3000&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        <span class="title function_ invoke__">stage</span>(<span class="string">&#x27;Build&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh <span class="string">&#x27;npm install&#x27;</span></span><br><span class="line">                sh <span class="string">&#x27;npm run buildtest&#x27;</span></span><br><span class="line">                sh <span class="string">&#x27;ls -lha&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">	<span class="title function_ invoke__">stage</span>(<span class="string">&#x27;Deploy&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                <span class="title function_ invoke__">sshPublisher</span>(<span class="attr">publishers</span>: [<span class="title function_ invoke__">sshPublisherDesc</span>(<span class="attr">configName</span>: <span class="string">&#x27;IPSServer&#x27;</span>, <span class="attr">transfers</span>: [<span class="title function_ invoke__">sshTransfer</span>(<span class="attr">cleanRemote</span>: <span class="literal">false</span>, <span class="attr">excludes</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">execCommand</span>: <span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">                echo &quot;dist_temp/ ls&quot;</span></span><br><span class="line"><span class="string">                ls /home/ipsconfig/deployment/docker_front/product_config/test/dist_temp/</span></span><br><span class="line"><span class="string">                rm -rf /home/ipsconfig/deployment/docker_front/product_config/test/dist/</span></span><br><span class="line"><span class="string">                mkdir /home/ipsconfig/deployment/docker_front/product_config/test/dist/</span></span><br><span class="line"><span class="string">                cp -r /home/ipsconfig/deployment/docker_front/product_config/test/dist_temp/.   /home/ipsconfig/deployment/docker_front/product_config/test/dist/</span></span><br><span class="line"><span class="string">                echo &quot;dist/ ls&quot;</span></span><br><span class="line"><span class="string">                ls /home/ipsconfig/deployment/docker_front/product_config/test/dist/</span></span><br><span class="line"><span class="string">                rm -rf /home/ipsconfig/deployment/docker_front/product_config/test/dist_temp/</span></span><br><span class="line"><span class="string">                docker restart product-nginx-test</span></span><br><span class="line"><span class="string">                &#x27;</span><span class="string">&#x27;&#x27;</span>, <span class="attr">execTimeout</span>: <span class="number">120000</span>, <span class="attr">flatten</span>: <span class="literal">false</span>, <span class="attr">makeEmptyDirs</span>: <span class="literal">false</span>, <span class="attr">noDefaultExcludes</span>: <span class="literal">false</span>, <span class="attr">patternSeparator</span>: <span class="string">&#x27;[, ]+&#x27;</span>, <span class="attr">remoteDirectory</span>: <span class="string">&#x27;/home/ipsconfig/deployment/docker_front/product_config/test/dist_temp/&#x27;</span>, <span class="attr">remoteDirectorySDF</span>: <span class="literal">false</span>, <span class="attr">removePrefix</span>: <span class="string">&#x27;dist&#x27;</span>, <span class="attr">sourceFiles</span>: <span class="string">&#x27;dist/**&#x27;</span>)], <span class="attr">usePromotionTimestamp</span>: <span class="literal">false</span>, <span class="attr">useWorkspaceInPromotion</span>: <span class="literal">false</span>, <span class="attr">verbose</span>: <span class="literal">true</span>)])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="sshPublisher-显示操作日志"><a href="#sshPublisher-显示操作日志" class="headerlink" title="sshPublisher 显示操作日志"></a>sshPublisher 显示操作日志</h4><p>sshPublisher(publishers: [sshPublisherDesc()])内添加 verbose: true</p>
<p>verbose：选择为 Jenkins 控制台启用大量信息 - 仅对帮助追踪问题非常有用。</p>
<h2 id="构建触发器"><a href="#构建触发器" class="headerlink" title="构建触发器"></a>构建触发器</h2><h3 id="使用轮询-SCM-实现收到-git-post-commit-即构建"><a href="#使用轮询-SCM-实现收到-git-post-commit-即构建" class="headerlink" title="使用轮询 SCM 实现收到 git post-commit 即构建"></a>使用轮询 SCM 实现收到 git post-commit 即构建</h3><p><img data-src="https://bitbw.top/public/img/my_gallery/%E4%BD%BF%E7%94%A8%E8%BD%AE%E8%AF%A2SCM%20%E5%AE%9E%E7%8E%B0%E6%94%B6%E5%88%B0%20git%20post-commit%20%E5%8D%B3%E6%9E%84%E5%BB%BA-20210818150222789.png" alt="image-20210818150222789"></p>
<p>日程表使用 cron 语法</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment">#每15分钟(可能在:07,22,37,52):</span></span><br><span class="line"><span class="built_in">H</span>/<span class="number">15</span> * * * *</span><br><span class="line">每小时前半小时每十分钟一次(三次，可能在:<span class="number">04</span>,<span class="number">14</span>,<span class="number">24</span>)</span><br><span class="line"><span class="built_in">H</span>(<span class="number">0</span><span class="literal">-29</span>)/<span class="number">10</span> * * * *</span><br><span class="line"><span class="comment">#每两个小时，在每小时后45分钟，从早上9:45开始，下午3:45结束，每周一次:</span></span><br><span class="line"><span class="number">45</span> <span class="number">9</span><span class="literal">-16</span>/<span class="number">2</span> * * <span class="number">1</span><span class="literal">-5</span></span><br><span class="line"><span class="comment">#在工作日早上8点到下午4点之间每两个小时一次(可能在上午9:38，上午11:38，下午1:38，下午3:38):</span></span><br><span class="line"><span class="built_in">H</span> <span class="built_in">H</span>(<span class="number">8</span><span class="literal">-15</span>)/<span class="number">2</span> * * <span class="number">1</span><span class="literal">-5</span></span><br><span class="line">每月<span class="number">1</span>号和<span class="number">15</span>号每天一次，<span class="number">12</span>月除外:</span><br><span class="line"><span class="built_in">H</span> <span class="built_in">H</span> <span class="number">1</span>,<span class="number">15</span> <span class="number">1</span><span class="literal">-11</span> *</span><br></pre></td></tr></table></figure>

<p>规则有点难可以使用 cron 在线解析工具：<a href="http://cron.qqe2.com/">http://cron.qqe2.com/</a></p>
<p>使用轮询 SCM 检查到 commit 更新 就会触发构建</p>
]]></content>
      <categories>
        <category>工具使用</category>
      </categories>
      <tags>
        <tag>ci/cd</tag>
        <tag>Jenkins</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux命令入门</title>
    <url>/2021/02/06/Linux/Linux%E5%91%BD%E4%BB%A4%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<blockquote>
<p>本文汇总了 本人学习 <code>Linux入门</code> 的所有教程</p>
</blockquote>
<h1 id="常用-Linux-命令的基本使用"><a href="#常用-Linux-命令的基本使用" class="headerlink" title="常用 Linux 命令的基本使用"></a>常用 Linux 命令的基本使用</h1><h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><ul>
<li>理解学习 Linux 终端命令的原因</li>
<li>常用 Linux 命令体验</li>
</ul>
<h2 id="01-学习-Linux-终端命令的原因"><a href="#01-学习-Linux-终端命令的原因" class="headerlink" title="01. 学习 Linux 终端命令的原因"></a>01. 学习 Linux 终端命令的原因</h2><ul>
<li>Linux 刚面世时并没有图形界面，所有的操作全靠命令完成，如 <strong>磁盘操作</strong>、<strong>文件存取</strong>、<strong>目录操作</strong>、<strong>进程管理</strong>、<strong>文件权限</strong> 设定等</li>
<li>在职场中，大量的 <strong>服务器维护工作</strong> 都是在 <strong>远程</strong> 通过 <strong>SSH 客户端</strong> 来完成的，并没有图形界面，所有的维护工作都需要通过命令来完成</li>
<li>在职场中，作为后端程序员，必须要或多或少的掌握一些 Linux 常用的终端命令</li>
<li>Linux 发行版本的命令大概有 200 多个，但是常用的命令只有 10 多个而已</li>
</ul>
<blockquote>
<p>学习终端命令的技巧：</p>
<ul>
<li>不需要死记硬背，对于常用命令，用的多了，自然就记住了</li>
<li>不要尝试一次学会所有的命令，有些命令是非常不常用的，临时遇到，临时百度就可以</li>
</ul>
</blockquote>
<h2 id="02-常用-Linux-命令的基本使用"><a href="#02-常用-Linux-命令的基本使用" class="headerlink" title="02. 常用 Linux 命令的基本使用"></a>02. 常用 Linux 命令的基本使用</h2><table>
<thead>
<tr>
<th>序号</th>
<th>命令</th>
<th>对应英文</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>01</td>
<td>ls</td>
<td>list</td>
<td>查看当前文件夹下的内容</td>
</tr>
<tr>
<td>02</td>
<td>pwd</td>
<td>print work directory</td>
<td>查看当前所在文件夹</td>
</tr>
<tr>
<td>03</td>
<td>cd [目录名]</td>
<td>change directory</td>
<td>切换文件夹</td>
</tr>
<tr>
<td>04</td>
<td>touch [文件名]</td>
<td>touch</td>
<td>如果文件不存在，新建文件</td>
</tr>
<tr>
<td>05</td>
<td>mkdir [目录名]</td>
<td>make directory</td>
<td>创建目录</td>
</tr>
<tr>
<td>06</td>
<td>rm [文件名]</td>
<td>remove</td>
<td>删除指定的文件名</td>
</tr>
<tr>
<td>07</td>
<td>clear</td>
<td>clear</td>
<td>清屏</td>
</tr>
</tbody></table>
<blockquote>
<p>小技巧</p>
<ul>
<li><code>ctrl + shift + = </code> <strong>放大</strong>终端窗口的字体显示</li>
<li><code>ctrl + - </code> <strong>缩小</strong>终端窗口的字体显示</li>
</ul>
</blockquote>
<h3 id="03-自动补全"><a href="#03-自动补全" class="headerlink" title="03. 自动补全"></a>03. 自动补全</h3><ul>
<li>在敲出 <code>文件</code>／<code>目录</code>／<code>命令</code> 的前几个字母之后，按下 <code>tab</code> 键<ul>
<li>如果输入的没有歧义，系统会自动补全</li>
<li>如果还存在其他 <code>文件</code>／<code>目录</code>／<code>命令</code>，再按一下 <code>tab</code> 键，系统会提示可能存在的命令</li>
</ul>
</li>
</ul>
<blockquote>
<p>小技巧</p>
<ul>
<li>按 <code>上</code>／<code>下</code> 光标键可以在曾经使用过的命令之间来回切换</li>
<li>如果想要退出选择，并且不想执行当前选中的命令，可以按 <code>ctrl + c</code></li>
</ul>
</blockquote>
<h1 id="Linux-终端命令格式"><a href="#Linux-终端命令格式" class="headerlink" title="Linux 终端命令格式"></a>Linux 终端命令格式</h1><h2 id="目标-1"><a href="#目标-1" class="headerlink" title="目标"></a>目标</h2><ul>
<li>了解终端命令格式</li>
<li>知道如何查阅终端命令帮助信息</li>
</ul>
<h2 id="01-终端命令格式"><a href="#01-终端命令格式" class="headerlink" title="01. 终端命令格式"></a>01. 终端命令格式</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">command</span> [-options] [parameter]</span><br></pre></td></tr></table></figure>

<p>说明：</p>
<ul>
<li><code>command</code>：命令名，相应功能的英文单词或单词的缩写</li>
<li><code>[-options]</code>：选项，可用来对命令进行控制，也可以省略</li>
<li><code>parameter</code>：传给命令的参数，可以是 <strong>零个</strong>、<strong>一个</strong> 或者 <strong>多个</strong></li>
</ul>
<blockquote>
<p><code>[]</code> 代表可选</p>
</blockquote>
<h2 id="02-查阅命令帮助信息（知道）"><a href="#02-查阅命令帮助信息（知道）" class="headerlink" title="02. 查阅命令帮助信息（知道）"></a>02. 查阅命令帮助信息（知道）</h2><blockquote>
<p>提示</p>
<ul>
<li>现阶段只需要 <strong>知道</strong> 通过以下两种方式可以查询命令的帮助信息</li>
<li>先学习<strong>常用命令</strong>及<strong>常用选项</strong>的使用即可，工作中如果遇到问题可以借助 <strong>网络搜索</strong></li>
</ul>
</blockquote>
<h3 id="2-1-help"><a href="#2-1-help" class="headerlink" title="2.1 --help"></a>2.1 <code>--help</code></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">command</span> --<span class="built_in">help</span></span><br></pre></td></tr></table></figure>

<p>说明：</p>
<ul>
<li>显示 <code>command</code> 命令的帮助信息</li>
</ul>
<h3 id="2-2-man"><a href="#2-2-man" class="headerlink" title="2.2 man"></a>2.2 man</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">man <span class="built_in">command</span></span><br></pre></td></tr></table></figure>

<p>说明：</p>
<ul>
<li>查阅 <code>command</code> 命令的使用手册</li>
</ul>
<blockquote>
<p><code>man</code> 是 <strong>manual</strong> 的缩写，是 Linux 提供的一个 <strong>手册</strong>，包含了绝大部分的命令、函数的详细使用说明</p>
</blockquote>
<p>使用 <code>man</code> 时的操作键：</p>
<table>
<thead>
<tr>
<th>操作键</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>空格键</td>
<td>显示手册页的下一屏</td>
</tr>
<tr>
<td>Enter 键</td>
<td>一次滚动手册页的一行</td>
</tr>
<tr>
<td>b</td>
<td>回滚一屏</td>
</tr>
<tr>
<td>f</td>
<td>前滚一屏</td>
</tr>
<tr>
<td>q</td>
<td>退出</td>
</tr>
<tr>
<td>&#x2F;word</td>
<td>搜索 <strong>word</strong> 字符串</td>
</tr>
</tbody></table>
<h1 id="文件和目录常用命令"><a href="#文件和目录常用命令" class="headerlink" title="文件和目录常用命令"></a>文件和目录常用命令</h1><h2 id="目标-2"><a href="#目标-2" class="headerlink" title="目标"></a>目标</h2><ul>
<li>查看目录内容<ul>
<li><code>ls</code></li>
</ul>
</li>
<li>切换目录<ul>
<li><code>cd</code></li>
</ul>
</li>
<li>创建和删除操作<ul>
<li><code>touch</code></li>
<li><code>rm</code></li>
<li><code>mkdir</code></li>
</ul>
</li>
<li>拷贝和移动文件<ul>
<li><code>cp</code></li>
<li><code>mv</code></li>
</ul>
</li>
<li>查看文件内容<ul>
<li><code>cat</code></li>
<li><code>more</code></li>
<li><code>grep</code></li>
</ul>
</li>
<li>其他<ul>
<li><code>echo</code></li>
<li>重定向 <code>&gt;</code> 和 <code>&gt;&gt;</code></li>
<li>管道 <code>|</code></li>
</ul>
</li>
</ul>
<h2 id="01-查看目录内容"><a href="#01-查看目录内容" class="headerlink" title="01. 查看目录内容"></a>01. 查看目录内容</h2><h3 id="1-1-终端实用技巧"><a href="#1-1-终端实用技巧" class="headerlink" title="1.1 终端实用技巧"></a>1.1 终端实用技巧</h3><h4 id="1-gt-自动补全"><a href="#1-gt-自动补全" class="headerlink" title="1&gt; 自动补全"></a>1&gt; 自动补全</h4><ul>
<li>在敲出 <code>文件</code>／<code>目录</code>／<code>命令</code> 的前几个字母之后，按下 <code>tab</code> 键<ul>
<li>如果输入的没有歧义，系统会自动补全</li>
<li>如果还存在其他 <code>文件</code>／<code>目录</code>／<code>命令</code>，再按一下 <code>tab</code> 键，系统会提示可能存在的命令</li>
</ul>
</li>
</ul>
<h4 id="2-gt-曾经使用过的命令"><a href="#2-gt-曾经使用过的命令" class="headerlink" title="2&gt; 曾经使用过的命令"></a>2&gt; 曾经使用过的命令</h4><ul>
<li>按 <code>上</code>／<code>下</code> 光标键可以在曾经使用过的命令之间来回切换</li>
<li>如果想要退出选择，并且不想执行当前选中的命令，可以按 <code>ctrl + c</code></li>
</ul>
<h3 id="1-2-ls-命令说明"><a href="#1-2-ls-命令说明" class="headerlink" title="1.2 ls 命令说明"></a>1.2 <code>ls</code> 命令说明</h3><ul>
<li><code>ls</code> 是英文单词 <strong>list</strong> 的简写，其功能为列出目录的内容，是用户最常用的命令之一，类似于 <strong>DOS</strong> 下的 <code>dir</code> 命令</li>
</ul>
<h4 id="Linux-下文件和目录的特点"><a href="#Linux-下文件和目录的特点" class="headerlink" title="Linux 下文件和目录的特点"></a>Linux 下文件和目录的特点</h4><ul>
<li>Linux <strong>文件</strong> 或者 <strong>目录</strong> 名称最长可以有 <code>256</code> 个字符</li>
<li>以 <code>.</code> 开头的文件为隐藏文件，需要用 -a 参数才能显示</li>
<li><strong>.</strong> 代表当前目录</li>
<li><strong>..</strong> 代表上一级目录</li>
</ul>
<h3 id="1-3-ls-常用选项"><a href="#1-3-ls-常用选项" class="headerlink" title="1.3 ls 常用选项"></a>1.3 ls 常用选项</h3><table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>-a</td>
<td>显示指定目录下所有子目录与文件，包括隐藏文件</td>
</tr>
<tr>
<td>-l</td>
<td>以列表方式显示文件的详细信息</td>
</tr>
<tr>
<td>-h</td>
<td>配合 -l 以人性化的方式显示文件大小</td>
</tr>
</tbody></table>
<h4 id="计算机中文件大小的表示方式（科普）"><a href="#计算机中文件大小的表示方式（科普）" class="headerlink" title="计算机中文件大小的表示方式（科普）"></a>计算机中文件大小的表示方式（科普）</h4><table>
<thead>
<tr>
<th>单位</th>
<th>英文</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>字节</td>
<td>B（Byte）</td>
<td>在计算机中作为一个数字单元，一般为 8 位二进制数</td>
</tr>
<tr>
<td>千</td>
<td>K（Kibibyte）</td>
<td>1 KB &#x3D; 1024 B，千字节 （1024 &#x3D; 2 ** 10）</td>
</tr>
<tr>
<td>兆</td>
<td>M（Mebibyte）</td>
<td>1 MB &#x3D; 1024 KB，百万字节</td>
</tr>
<tr>
<td>千兆</td>
<td>G（Gigabyte）</td>
<td>1 GB &#x3D; 1024 MB，十亿字节，千兆字节</td>
</tr>
<tr>
<td>太</td>
<td>T（Terabyte）</td>
<td>1 TB &#x3D; 1024 GB，万亿字节，太字节</td>
</tr>
<tr>
<td>拍</td>
<td>P（Petabyte）</td>
<td>1 PB &#x3D; 1024 TB，千万亿字节，拍字节</td>
</tr>
<tr>
<td>艾</td>
<td>E（Exabyte）</td>
<td>1 EB &#x3D; 1024 PB，百亿亿字节，艾字节</td>
</tr>
<tr>
<td>泽</td>
<td>Z（Zettabyte）</td>
<td>1 ZB &#x3D; 1024 EB，十万亿亿字节，泽字节</td>
</tr>
<tr>
<td>尧</td>
<td>Y（Yottabyte）</td>
<td>1 YB &#x3D; 1024 ZB，一亿亿亿字节，尧字节</td>
</tr>
</tbody></table>
<h3 id="1-4-ls-通配符的使用"><a href="#1-4-ls-通配符的使用" class="headerlink" title="1.4 ls 通配符的使用"></a>1.4 ls 通配符的使用</h3><table>
<thead>
<tr>
<th>通配符</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>*</td>
<td>代表任意个数个字符</td>
</tr>
<tr>
<td>?</td>
<td>代表任意一个字符，至少 1 个</td>
</tr>
<tr>
<td>[]</td>
<td>表示可以匹配字符组中的任一一个</td>
</tr>
<tr>
<td>[abc]</td>
<td>匹配 a、b、c 中的任意一个</td>
</tr>
<tr>
<td>[a-f]</td>
<td>匹配从 a 到 f 范围内的的任意一个字符</td>
</tr>
</tbody></table>
<h2 id="02-切换目录"><a href="#02-切换目录" class="headerlink" title="02. 切换目录"></a>02. 切换目录</h2><h3 id="2-1-cd"><a href="#2-1-cd" class="headerlink" title="2.1 cd"></a>2.1 <code>cd</code></h3><ul>
<li><code>cd</code> 是英文单词 <strong>change directory</strong> 的简写，其功能为更改当前的工作目录，也是用户最常用的命令之一</li>
</ul>
<blockquote>
<p>注意：Linux 所有的 <strong>目录</strong> 和 <strong>文件名</strong> 都是大小写敏感的</p>
</blockquote>
<table>
<thead>
<tr>
<th>命令</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>cd</td>
<td>切换到当前用户的主目录(&#x2F;home&#x2F;用户目录)</td>
</tr>
<tr>
<td>cd ~</td>
<td>切换到当前用户的主目录(&#x2F;home&#x2F;用户目录)</td>
</tr>
<tr>
<td>cd .</td>
<td>保持在当前目录不变</td>
</tr>
<tr>
<td>cd ..</td>
<td>切换到上级目录</td>
</tr>
<tr>
<td>cd -</td>
<td>可以在最近两次工作目录之间来回切换</td>
</tr>
</tbody></table>
<h3 id="2-2-相对路径和绝对路径"><a href="#2-2-相对路径和绝对路径" class="headerlink" title="2.2 相对路径和绝对路径"></a>2.2 相对路径和绝对路径</h3><ul>
<li><strong>相对路径</strong> 在输入路径时，最前面不是 <strong>&#x2F;</strong> 或者 **~**，表示相对 <strong>当前目录</strong> 所在的目录位置</li>
<li><strong>绝对路径</strong> 在输入路径时，最前面是 <strong>&#x2F;</strong> 或者 **~**，表示从 <strong>根目录&#x2F;家目录</strong> 开始的具体目录位置</li>
</ul>
<h2 id="03-创建和删除操作"><a href="#03-创建和删除操作" class="headerlink" title="03. 创建和删除操作"></a>03. 创建和删除操作</h2><h3 id="3-1-touch"><a href="#3-1-touch" class="headerlink" title="3.1 touch"></a>3.1 <code>touch</code></h3><ul>
<li>创建文件或修改文件时间<ul>
<li>如果文件 <strong>不存在</strong>，可以创建一个空白文件</li>
<li>如果文件 <strong>已经存在</strong>，可以修改文件的末次修改日期</li>
</ul>
</li>
</ul>
<h3 id="3-2-mkdir"><a href="#3-2-mkdir" class="headerlink" title="3.2 mkdir"></a>3.2 <code>mkdir</code></h3><ul>
<li>创建一个新的目录</li>
</ul>
<table>
<thead>
<tr>
<th>选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>-p</td>
<td>可以递归创建目录</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>新建目录的名称</strong> 不能与当前目录中 <strong>已有的目录或文件</strong> 同名</p>
</blockquote>
<h3 id="3-3-rm"><a href="#3-3-rm" class="headerlink" title="3.3 rm"></a>3.3 <code>rm</code></h3><ul>
<li>删除文件或目录</li>
</ul>
<blockquote>
<p>使用 <code>rm</code> 命令要小心，因为文件删除后不能恢复</p>
</blockquote>
<table>
<thead>
<tr>
<th>选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>-f</td>
<td>强制删除，忽略不存在的文件，无需提示</td>
</tr>
<tr>
<td>-r</td>
<td>递归地删除目录下的内容，<strong>删除文件夹</strong> 时必须加此参数</td>
</tr>
</tbody></table>
<h2 id="04-拷贝和移动文件"><a href="#04-拷贝和移动文件" class="headerlink" title="04. 拷贝和移动文件"></a>04. 拷贝和移动文件</h2><table>
<thead>
<tr>
<th>序号</th>
<th>命令</th>
<th>对应英文</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>01</td>
<td>tree [目录名]</td>
<td>tree</td>
<td>以树状图列出文件目录结构</td>
</tr>
<tr>
<td>02</td>
<td>cp 源文件 目标文件</td>
<td>copy</td>
<td>复制文件或者目录</td>
</tr>
<tr>
<td>03</td>
<td>mv 源文件 目标文件</td>
<td>move</td>
<td>移动文件或者目录／文件或者目录重命名</td>
</tr>
</tbody></table>
<h3 id="4-1-tree"><a href="#4-1-tree" class="headerlink" title="4.1 tree"></a>4.1 <code>tree</code></h3><ul>
<li><code>tree</code> 命令可以以树状图列出文件目录结构</li>
</ul>
<table>
<thead>
<tr>
<th>选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>-d</td>
<td>只显示目录</td>
</tr>
</tbody></table>
<h3 id="4-2-cp"><a href="#4-2-cp" class="headerlink" title="4.2 cp"></a>4.2 <code>cp</code></h3><ul>
<li><code>cp</code> 命令的功能是将给出的 <strong>文件</strong> 或 <strong>目录</strong> 复制到另一个 <strong>文件</strong> 或 <strong>目录</strong> 中，相当于 <strong>DOS</strong> 下的 <code>copy</code> 命令</li>
</ul>
<table>
<thead>
<tr>
<th>选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>-i</td>
<td>覆盖文件前提示</td>
</tr>
<tr>
<td>-r</td>
<td>若给出的源文件是目录文件，则 cp 将递归复制该目录下的所有子目录和文件，目标文件必须为一个目录名</td>
</tr>
</tbody></table>
<h3 id="4-3-mv"><a href="#4-3-mv" class="headerlink" title="4.3 mv"></a>4.3 <code>mv</code></h3><ul>
<li><code>mv</code> 命令可以用来 <strong>移动</strong> <strong>文件</strong> 或 <strong>目录</strong>，也可以给 <strong>文件或目录重命名</strong></li>
</ul>
<table>
<thead>
<tr>
<th>选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>-i</td>
<td>覆盖文件前提示</td>
</tr>
</tbody></table>
<h2 id="05-查看文件内容"><a href="#05-查看文件内容" class="headerlink" title="05. 查看文件内容"></a>05. 查看文件内容</h2><table>
<thead>
<tr>
<th>序号</th>
<th>命令</th>
<th>对应英文</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>01</td>
<td>cat 文件名</td>
<td>concatenate</td>
<td>查看文件内容、创建文件、文件合并、追加文件内容等功能</td>
</tr>
<tr>
<td>02</td>
<td>more 文件名</td>
<td>more</td>
<td>分屏显示文件内容</td>
</tr>
<tr>
<td>03</td>
<td>grep 搜索文本 文件名</td>
<td>grep</td>
<td>搜索文本文件内容</td>
</tr>
</tbody></table>
<h3 id="5-1-cat"><a href="#5-1-cat" class="headerlink" title="5.1 cat"></a>5.1 <code>cat</code></h3><ul>
<li><code>cat</code> 命令可以用来 <strong>查看文件内容</strong>、<strong>创建文件</strong>、<strong>文件合并</strong>、<strong>追加文件内容</strong> 等功能</li>
<li><code>cat</code> 会一次显示所有的内容，适合 <strong>查看内容较少</strong> 的文本文件</li>
</ul>
<table>
<thead>
<tr>
<th>选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>-b</td>
<td>对非空输出行编号</td>
</tr>
<tr>
<td>-n</td>
<td>对输出的所有行编号</td>
</tr>
</tbody></table>
<blockquote>
<p>Linux 中还有一个 <code>nl</code> 的命令和 <code>cat -b</code> 的效果等价</p>
</blockquote>
<h3 id="5-2-more"><a href="#5-2-more" class="headerlink" title="5.2 more"></a>5.2 <code>more</code></h3><ul>
<li><code>more</code> 命令可以用于分屏显示文件内容，每次只显示一页内容</li>
<li>适合于 <strong>查看内容较多</strong>的文本文件</li>
</ul>
<p>使用 <code>more</code> 的操作键：</p>
<table>
<thead>
<tr>
<th>操作键</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>空格键</td>
<td>显示手册页的下一屏</td>
</tr>
<tr>
<td>Enter 键</td>
<td>一次滚动手册页的一行</td>
</tr>
<tr>
<td>b</td>
<td>回滚一屏</td>
</tr>
<tr>
<td>f</td>
<td>前滚一屏</td>
</tr>
<tr>
<td>q</td>
<td>退出</td>
</tr>
<tr>
<td>&#x2F;word</td>
<td>搜索 <strong>word</strong> 字符串</td>
</tr>
</tbody></table>
<h3 id="5-3-grep"><a href="#5-3-grep" class="headerlink" title="5.3 grep"></a>5.3 <code>grep</code></h3><ul>
<li>Linux 系统中 <code>grep</code> 命令是一种强大的文本搜索工具</li>
<li><code>grep</code>允许对文本文件进行 <strong>模式</strong>查找，所谓模式查找，又被称为正则表达式，在就业班会详细讲解</li>
</ul>
<table>
<thead>
<tr>
<th>选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>-n</td>
<td>显示匹配行及行号</td>
</tr>
<tr>
<td>-v</td>
<td>显示不包含匹配文本的所有行（相当于求反）</td>
</tr>
<tr>
<td>-i</td>
<td>忽略大小写</td>
</tr>
</tbody></table>
<ul>
<li>常用的两种模式查找</li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>^a</td>
<td>行首，搜寻以 <strong>a</strong> 开头的行</td>
</tr>
<tr>
<td>ke$</td>
<td>行尾，搜寻以 <strong>ke</strong> 结束的行</td>
</tr>
</tbody></table>
<h2 id="06-其他"><a href="#06-其他" class="headerlink" title="06. 其他"></a>06. 其他</h2><h3 id="6-1-echo-文字内容"><a href="#6-1-echo-文字内容" class="headerlink" title="6.1 echo 文字内容"></a>6.1 <code>echo 文字内容</code></h3><ul>
<li><code>echo</code> 会在终端中显示参数指定的文字，通常会和 <strong>重定向</strong> 联合使用</li>
</ul>
<h3 id="6-2-重定向-gt-和-gt-gt"><a href="#6-2-重定向-gt-和-gt-gt" class="headerlink" title="6.2 重定向 &gt; 和 &gt;&gt;"></a>6.2 重定向 <code>&gt;</code> 和 <code>&gt;&gt;</code></h3><ul>
<li>Linux 允许将命令执行结果 <strong>重定向</strong>到一个 <strong>文件</strong></li>
<li>将本应显示在<strong>终端上的内容</strong> <strong>输出／追加</strong> 到<strong>指定文件中</strong></li>
</ul>
<p>其中</p>
<ul>
<li><code>&gt;</code> 表示输出，会覆盖文件原有的内容</li>
<li><code>&gt;&gt;</code> 表示追加，会将内容追加到已有文件的末尾</li>
</ul>
<h3 id="6-3-管道"><a href="#6-3-管道" class="headerlink" title="6.3 管道 |"></a>6.3 管道 <code>|</code></h3><ul>
<li>Linux 允许将 <strong>一个命令的输出</strong> 可以<strong>通过管道</strong> 做为 <strong>另一个命令的输入</strong></li>
<li>可以理解现实生活中的管子，管子的一头塞东西进去，另一头取出来，这里 <code>|</code> 的左右分为两端，左端塞东西（写），右端取东西（读）</li>
</ul>
<p>常用的管道命令有：</p>
<ul>
<li><code>more</code>：分屏显示内容</li>
<li><code>grep</code>：在命令执行结果的基础上查询指定的文本</li>
</ul>
<h1 id="文件和目录常用命令-1"><a href="#文件和目录常用命令-1" class="headerlink" title="文件和目录常用命令"></a>文件和目录常用命令</h1><h2 id="目标-3"><a href="#目标-3" class="headerlink" title="目标"></a>目标</h2><ul>
<li>查看目录内容<ul>
<li><code>ls</code></li>
</ul>
</li>
<li>切换目录<ul>
<li><code>cd</code></li>
</ul>
</li>
<li>创建和删除操作<ul>
<li><code>touch</code></li>
<li><code>rm</code></li>
<li><code>mkdir</code></li>
</ul>
</li>
<li>拷贝和移动文件<ul>
<li><code>cp</code></li>
<li><code>mv</code></li>
</ul>
</li>
<li>查看文件内容<ul>
<li><code>cat</code></li>
<li><code>more</code></li>
<li><code>grep</code></li>
</ul>
</li>
<li>其他<ul>
<li><code>echo</code></li>
<li>重定向 <code>&gt;</code> 和 <code>&gt;&gt;</code></li>
<li>管道 <code>|</code></li>
</ul>
</li>
</ul>
<h2 id="01-查看目录内容-1"><a href="#01-查看目录内容-1" class="headerlink" title="01. 查看目录内容"></a>01. 查看目录内容</h2><h3 id="1-1-终端实用技巧-1"><a href="#1-1-终端实用技巧-1" class="headerlink" title="1.1 终端实用技巧"></a>1.1 终端实用技巧</h3><h4 id="1-gt-自动补全-1"><a href="#1-gt-自动补全-1" class="headerlink" title="1&gt; 自动补全"></a>1&gt; 自动补全</h4><ul>
<li>在敲出 <code>文件</code>／<code>目录</code>／<code>命令</code> 的前几个字母之后，按下 <code>tab</code> 键<ul>
<li>如果输入的没有歧义，系统会自动补全</li>
<li>如果还存在其他 <code>文件</code>／<code>目录</code>／<code>命令</code>，再按一下 <code>tab</code> 键，系统会提示可能存在的命令</li>
</ul>
</li>
</ul>
<h4 id="2-gt-曾经使用过的命令-1"><a href="#2-gt-曾经使用过的命令-1" class="headerlink" title="2&gt; 曾经使用过的命令"></a>2&gt; 曾经使用过的命令</h4><ul>
<li>按 <code>上</code>／<code>下</code> 光标键可以在曾经使用过的命令之间来回切换</li>
<li>如果想要退出选择，并且不想执行当前选中的命令，可以按 <code>ctrl + c</code></li>
</ul>
<h3 id="1-2-ls-命令说明-1"><a href="#1-2-ls-命令说明-1" class="headerlink" title="1.2 ls 命令说明"></a>1.2 <code>ls</code> 命令说明</h3><ul>
<li><code>ls</code> 是英文单词 <strong>list</strong> 的简写，其功能为列出目录的内容，是用户最常用的命令之一，类似于 <strong>DOS</strong> 下的 <code>dir</code> 命令</li>
</ul>
<h4 id="Linux-下文件和目录的特点-1"><a href="#Linux-下文件和目录的特点-1" class="headerlink" title="Linux 下文件和目录的特点"></a>Linux 下文件和目录的特点</h4><ul>
<li>Linux <strong>文件</strong> 或者 <strong>目录</strong> 名称最长可以有 <code>256</code> 个字符</li>
<li>以 <code>.</code> 开头的文件为隐藏文件，需要用 -a 参数才能显示</li>
<li><strong>.</strong> 代表当前目录</li>
<li><strong>..</strong> 代表上一级目录</li>
</ul>
<h3 id="1-3-ls-常用选项-1"><a href="#1-3-ls-常用选项-1" class="headerlink" title="1.3 ls 常用选项"></a>1.3 ls 常用选项</h3><table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>-a</td>
<td>显示指定目录下所有子目录与文件，包括隐藏文件</td>
</tr>
<tr>
<td>-l</td>
<td>以列表方式显示文件的详细信息</td>
</tr>
<tr>
<td>-h</td>
<td>配合 -l 以人性化的方式显示文件大小</td>
</tr>
</tbody></table>
<h4 id="计算机中文件大小的表示方式（科普）-1"><a href="#计算机中文件大小的表示方式（科普）-1" class="headerlink" title="计算机中文件大小的表示方式（科普）"></a>计算机中文件大小的表示方式（科普）</h4><table>
<thead>
<tr>
<th>单位</th>
<th>英文</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>字节</td>
<td>B（Byte）</td>
<td>在计算机中作为一个数字单元，一般为 8 位二进制数</td>
</tr>
<tr>
<td>千</td>
<td>K（Kibibyte）</td>
<td>1 KB &#x3D; 1024 B，千字节 （1024 &#x3D; 2 ** 10）</td>
</tr>
<tr>
<td>兆</td>
<td>M（Mebibyte）</td>
<td>1 MB &#x3D; 1024 KB，百万字节</td>
</tr>
<tr>
<td>千兆</td>
<td>G（Gigabyte）</td>
<td>1 GB &#x3D; 1024 MB，十亿字节，千兆字节</td>
</tr>
<tr>
<td>太</td>
<td>T（Terabyte）</td>
<td>1 TB &#x3D; 1024 GB，万亿字节，太字节</td>
</tr>
<tr>
<td>拍</td>
<td>P（Petabyte）</td>
<td>1 PB &#x3D; 1024 TB，千万亿字节，拍字节</td>
</tr>
<tr>
<td>艾</td>
<td>E（Exabyte）</td>
<td>1 EB &#x3D; 1024 PB，百亿亿字节，艾字节</td>
</tr>
<tr>
<td>泽</td>
<td>Z（Zettabyte）</td>
<td>1 ZB &#x3D; 1024 EB，十万亿亿字节，泽字节</td>
</tr>
<tr>
<td>尧</td>
<td>Y（Yottabyte）</td>
<td>1 YB &#x3D; 1024 ZB，一亿亿亿字节，尧字节</td>
</tr>
</tbody></table>
<h3 id="1-4-ls-通配符的使用-1"><a href="#1-4-ls-通配符的使用-1" class="headerlink" title="1.4 ls 通配符的使用"></a>1.4 ls 通配符的使用</h3><table>
<thead>
<tr>
<th>通配符</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>*</td>
<td>代表任意个数个字符</td>
</tr>
<tr>
<td>?</td>
<td>代表任意一个字符，至少 1 个</td>
</tr>
<tr>
<td>[]</td>
<td>表示可以匹配字符组中的任一一个</td>
</tr>
<tr>
<td>[abc]</td>
<td>匹配 a、b、c 中的任意一个</td>
</tr>
<tr>
<td>[a-f]</td>
<td>匹配从 a 到 f 范围内的的任意一个字符</td>
</tr>
</tbody></table>
<h2 id="02-切换目录-1"><a href="#02-切换目录-1" class="headerlink" title="02. 切换目录"></a>02. 切换目录</h2><h3 id="2-1-cd-1"><a href="#2-1-cd-1" class="headerlink" title="2.1 cd"></a>2.1 <code>cd</code></h3><ul>
<li><code>cd</code> 是英文单词 <strong>change directory</strong> 的简写，其功能为更改当前的工作目录，也是用户最常用的命令之一</li>
</ul>
<blockquote>
<p>注意：Linux 所有的 <strong>目录</strong> 和 <strong>文件名</strong> 都是大小写敏感的</p>
</blockquote>
<table>
<thead>
<tr>
<th>命令</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>cd</td>
<td>切换到当前用户的主目录(&#x2F;home&#x2F;用户目录)</td>
</tr>
<tr>
<td>cd ~</td>
<td>切换到当前用户的主目录(&#x2F;home&#x2F;用户目录)</td>
</tr>
<tr>
<td>cd .</td>
<td>保持在当前目录不变</td>
</tr>
<tr>
<td>cd ..</td>
<td>切换到上级目录</td>
</tr>
<tr>
<td>cd -</td>
<td>可以在最近两次工作目录之间来回切换</td>
</tr>
</tbody></table>
<h3 id="2-2-相对路径和绝对路径-1"><a href="#2-2-相对路径和绝对路径-1" class="headerlink" title="2.2 相对路径和绝对路径"></a>2.2 相对路径和绝对路径</h3><ul>
<li><strong>相对路径</strong> 在输入路径时，最前面不是 <strong>&#x2F;</strong> 或者 **~**，表示相对 <strong>当前目录</strong> 所在的目录位置</li>
<li><strong>绝对路径</strong> 在输入路径时，最前面是 <strong>&#x2F;</strong> 或者 **~**，表示从 <strong>根目录&#x2F;家目录</strong> 开始的具体目录位置</li>
</ul>
<h2 id="03-创建和删除操作-1"><a href="#03-创建和删除操作-1" class="headerlink" title="03. 创建和删除操作"></a>03. 创建和删除操作</h2><h3 id="3-1-touch-1"><a href="#3-1-touch-1" class="headerlink" title="3.1 touch"></a>3.1 <code>touch</code></h3><ul>
<li>创建文件或修改文件时间<ul>
<li>如果文件 <strong>不存在</strong>，可以创建一个空白文件</li>
<li>如果文件 <strong>已经存在</strong>，可以修改文件的末次修改日期</li>
</ul>
</li>
</ul>
<h3 id="3-2-mkdir-1"><a href="#3-2-mkdir-1" class="headerlink" title="3.2 mkdir"></a>3.2 <code>mkdir</code></h3><ul>
<li>创建一个新的目录</li>
</ul>
<table>
<thead>
<tr>
<th>选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>-p</td>
<td>可以递归创建目录</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>新建目录的名称</strong> 不能与当前目录中 <strong>已有的目录或文件</strong> 同名</p>
</blockquote>
<h3 id="3-3-rm-1"><a href="#3-3-rm-1" class="headerlink" title="3.3 rm"></a>3.3 <code>rm</code></h3><ul>
<li>删除文件或目录</li>
</ul>
<blockquote>
<p>使用 <code>rm</code> 命令要小心，因为文件删除后不能恢复</p>
</blockquote>
<table>
<thead>
<tr>
<th>选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>-f</td>
<td>强制删除，忽略不存在的文件，无需提示</td>
</tr>
<tr>
<td>-r</td>
<td>递归地删除目录下的内容，<strong>删除文件夹</strong> 时必须加此参数</td>
</tr>
</tbody></table>
<h2 id="04-拷贝和移动文件-1"><a href="#04-拷贝和移动文件-1" class="headerlink" title="04. 拷贝和移动文件"></a>04. 拷贝和移动文件</h2><table>
<thead>
<tr>
<th>序号</th>
<th>命令</th>
<th>对应英文</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>01</td>
<td>tree [目录名]</td>
<td>tree</td>
<td>以树状图列出文件目录结构</td>
</tr>
<tr>
<td>02</td>
<td>cp 源文件 目标文件</td>
<td>copy</td>
<td>复制文件或者目录</td>
</tr>
<tr>
<td>03</td>
<td>mv 源文件 目标文件</td>
<td>move</td>
<td>移动文件或者目录／文件或者目录重命名</td>
</tr>
</tbody></table>
<h3 id="4-1-tree-1"><a href="#4-1-tree-1" class="headerlink" title="4.1 tree"></a>4.1 <code>tree</code></h3><ul>
<li><code>tree</code> 命令可以以树状图列出文件目录结构</li>
</ul>
<table>
<thead>
<tr>
<th>选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>-d</td>
<td>只显示目录</td>
</tr>
</tbody></table>
<h3 id="4-2-cp-1"><a href="#4-2-cp-1" class="headerlink" title="4.2 cp"></a>4.2 <code>cp</code></h3><ul>
<li><code>cp</code> 命令的功能是将给出的 <strong>文件</strong> 或 <strong>目录</strong> 复制到另一个 <strong>文件</strong> 或 <strong>目录</strong> 中，相当于 <strong>DOS</strong> 下的 <code>copy</code> 命令</li>
</ul>
<table>
<thead>
<tr>
<th>选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>-i</td>
<td>覆盖文件前提示</td>
</tr>
<tr>
<td>-r</td>
<td>若给出的源文件是目录文件，则 cp 将递归复制该目录下的所有子目录和文件，目标文件必须为一个目录名</td>
</tr>
</tbody></table>
<h3 id="4-3-mv-1"><a href="#4-3-mv-1" class="headerlink" title="4.3 mv"></a>4.3 <code>mv</code></h3><ul>
<li><code>mv</code> 命令可以用来 <strong>移动</strong> <strong>文件</strong> 或 <strong>目录</strong>，也可以给 <strong>文件或目录重命名</strong></li>
</ul>
<table>
<thead>
<tr>
<th>选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>-i</td>
<td>覆盖文件前提示</td>
</tr>
</tbody></table>
<h2 id="05-查看文件内容-1"><a href="#05-查看文件内容-1" class="headerlink" title="05. 查看文件内容"></a>05. 查看文件内容</h2><table>
<thead>
<tr>
<th>序号</th>
<th>命令</th>
<th>对应英文</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>01</td>
<td>cat 文件名</td>
<td>concatenate</td>
<td>查看文件内容、创建文件、文件合并、追加文件内容等功能</td>
</tr>
<tr>
<td>02</td>
<td>more 文件名</td>
<td>more</td>
<td>分屏显示文件内容</td>
</tr>
<tr>
<td>03</td>
<td>grep 搜索文本 文件名</td>
<td>grep</td>
<td>搜索文本文件内容</td>
</tr>
</tbody></table>
<h3 id="5-1-cat-1"><a href="#5-1-cat-1" class="headerlink" title="5.1 cat"></a>5.1 <code>cat</code></h3><ul>
<li><code>cat</code> 命令可以用来 <strong>查看文件内容</strong>、<strong>创建文件</strong>、<strong>文件合并</strong>、<strong>追加文件内容</strong> 等功能</li>
<li><code>cat</code> 会一次显示所有的内容，适合 <strong>查看内容较少</strong> 的文本文件</li>
</ul>
<table>
<thead>
<tr>
<th>选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>-b</td>
<td>对非空输出行编号</td>
</tr>
<tr>
<td>-n</td>
<td>对输出的所有行编号</td>
</tr>
</tbody></table>
<blockquote>
<p>Linux 中还有一个 <code>nl</code> 的命令和 <code>cat -b</code> 的效果等价</p>
</blockquote>
<h3 id="5-2-more-1"><a href="#5-2-more-1" class="headerlink" title="5.2 more"></a>5.2 <code>more</code></h3><ul>
<li><code>more</code> 命令可以用于分屏显示文件内容，每次只显示一页内容</li>
<li>适合于 <strong>查看内容较多</strong>的文本文件</li>
</ul>
<p>使用 <code>more</code> 的操作键：</p>
<table>
<thead>
<tr>
<th>操作键</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>空格键</td>
<td>显示手册页的下一屏</td>
</tr>
<tr>
<td>Enter 键</td>
<td>一次滚动手册页的一行</td>
</tr>
<tr>
<td>b</td>
<td>回滚一屏</td>
</tr>
<tr>
<td>f</td>
<td>前滚一屏</td>
</tr>
<tr>
<td>q</td>
<td>退出</td>
</tr>
<tr>
<td>&#x2F;word</td>
<td>搜索 <strong>word</strong> 字符串</td>
</tr>
</tbody></table>
<h3 id="5-3-grep-1"><a href="#5-3-grep-1" class="headerlink" title="5.3 grep"></a>5.3 <code>grep</code></h3><ul>
<li>Linux 系统中 <code>grep</code> 命令是一种强大的文本搜索工具</li>
<li><code>grep</code>允许对文本文件进行 <strong>模式</strong>查找，所谓模式查找，又被称为正则表达式，在就业班会详细讲解</li>
</ul>
<table>
<thead>
<tr>
<th>选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>-n</td>
<td>显示匹配行及行号</td>
</tr>
<tr>
<td>-v</td>
<td>显示不包含匹配文本的所有行（相当于求反）</td>
</tr>
<tr>
<td>-i</td>
<td>忽略大小写</td>
</tr>
</tbody></table>
<ul>
<li>常用的两种模式查找</li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>^a</td>
<td>行首，搜寻以 <strong>a</strong> 开头的行</td>
</tr>
<tr>
<td>ke$</td>
<td>行尾，搜寻以 <strong>ke</strong> 结束的行</td>
</tr>
</tbody></table>
<h2 id="06-其他-1"><a href="#06-其他-1" class="headerlink" title="06. 其他"></a>06. 其他</h2><h3 id="6-1-echo-文字内容-1"><a href="#6-1-echo-文字内容-1" class="headerlink" title="6.1 echo 文字内容"></a>6.1 <code>echo 文字内容</code></h3><ul>
<li><code>echo</code> 会在终端中显示参数指定的文字，通常会和 <strong>重定向</strong> 联合使用</li>
</ul>
<h3 id="6-2-重定向-gt-和-gt-gt-1"><a href="#6-2-重定向-gt-和-gt-gt-1" class="headerlink" title="6.2 重定向 &gt; 和 &gt;&gt;"></a>6.2 重定向 <code>&gt;</code> 和 <code>&gt;&gt;</code></h3><ul>
<li>Linux 允许将命令执行结果 <strong>重定向</strong>到一个 <strong>文件</strong></li>
<li>将本应显示在<strong>终端上的内容</strong> <strong>输出／追加</strong> 到<strong>指定文件中</strong></li>
</ul>
<p>其中</p>
<ul>
<li><code>&gt;</code> 表示输出，会覆盖文件原有的内容</li>
<li><code>&gt;&gt;</code> 表示追加，会将内容追加到已有文件的末尾</li>
</ul>
<h3 id="6-3-管道-1"><a href="#6-3-管道-1" class="headerlink" title="6.3 管道 |"></a>6.3 管道 <code>|</code></h3><ul>
<li>Linux 允许将 <strong>一个命令的输出</strong> 可以<strong>通过管道</strong> 做为 <strong>另一个命令的输入</strong></li>
<li>可以理解现实生活中的管子，管子的一头塞东西进去，另一头取出来，这里 <code>|</code> 的左右分为两端，左端塞东西（写），右端取东西（读）</li>
</ul>
<p>常用的管道命令有：</p>
<ul>
<li><code>more</code>：分屏显示内容</li>
<li><code>grep</code>：在命令执行结果的基础上查询指定的文本</li>
</ul>
<h1 id="远程管理常用命令"><a href="#远程管理常用命令" class="headerlink" title="远程管理常用命令"></a>远程管理常用命令</h1><h2 id="目标-4"><a href="#目标-4" class="headerlink" title="目标"></a>目标</h2><ul>
<li>关机&#x2F;重启<ul>
<li><code>shutdown</code></li>
</ul>
</li>
<li>查看或配置网卡信息<ul>
<li><code>ifconfig</code></li>
<li><code>ping</code></li>
</ul>
</li>
<li>远程登录和复制文件<ul>
<li><code>ssh</code></li>
<li><code>scp</code></li>
</ul>
</li>
</ul>
<h2 id="01-关机-x2F-重启"><a href="#01-关机-x2F-重启" class="headerlink" title="01. 关机&#x2F;重启"></a>01. 关机&#x2F;重启</h2><table>
<thead>
<tr>
<th>序号</th>
<th>命令</th>
<th>对应英文</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>01</td>
<td>shutdown 选项 时间</td>
<td>shutdown</td>
<td>关机／重新启动</td>
</tr>
</tbody></table>
<h3 id="1-1-shutdown"><a href="#1-1-shutdown" class="headerlink" title="1.1 shutdown"></a>1.1 <code>shutdown</code></h3><ul>
<li><code>shutdown</code> 命令可以 <strong>安全</strong> <strong>关闭</strong> 或者 <strong>重新启动系统</strong></li>
</ul>
<table>
<thead>
<tr>
<th>选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>-r</td>
<td>重新启动</td>
</tr>
</tbody></table>
<blockquote>
<p>提示：</p>
<ul>
<li><strong>不指定选项和参数</strong>，默认表示 <strong>1 分钟</strong>之后 <strong>关闭电脑</strong></li>
<li>远程维护服务器时，最好不要关闭系统，而应该重新启动系统</li>
</ul>
</blockquote>
<ul>
<li>常用命令示例</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 重新启动操作系统，其中 now 表示现在</span></span><br><span class="line">$ shutdown -r now</span><br><span class="line"></span><br><span class="line"><span class="comment"># 立刻关机，其中 now 表示现在</span></span><br><span class="line">$ shutdown now</span><br><span class="line"></span><br><span class="line"><span class="comment"># 系统在今天的 20:25 会关机</span></span><br><span class="line">$ shutdown 20:25</span><br><span class="line"></span><br><span class="line"><span class="comment"># 系统再过十分钟后自动关机</span></span><br><span class="line">$ shutdown +10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取消之前指定的关机计划</span></span><br><span class="line">$ shutdown -c</span><br></pre></td></tr></table></figure>

<h2 id="02-查看或配置网卡信息"><a href="#02-查看或配置网卡信息" class="headerlink" title="02. 查看或配置网卡信息"></a>02. 查看或配置网卡信息</h2><table>
<thead>
<tr>
<th>序号</th>
<th>命令</th>
<th>对应英文</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>01</td>
<td>ifconfig</td>
<td>configure a network interface</td>
<td>查看&#x2F;配置计算机当前的网卡配置信息</td>
</tr>
<tr>
<td>02</td>
<td>ping ip 地址</td>
<td>ping</td>
<td>检测到目标 ip 地址 的连接是否正常</td>
</tr>
</tbody></table>
<h3 id="2-1-网卡-和-IP-地址"><a href="#2-1-网卡-和-IP-地址" class="headerlink" title="2.1 网卡 和 IP 地址"></a>2.1 网卡 和 IP 地址</h3><h4 id="网卡"><a href="#网卡" class="headerlink" title="网卡"></a>网卡</h4><ul>
<li>网卡是一个专门负责网络通讯的硬件设备</li>
<li><strong>IP 地址</strong>是设置在网卡上的地址信息</li>
</ul>
<blockquote>
<p>我们可以把 <strong>电脑</strong> 比作 <strong>电话</strong>，<strong>网卡</strong> 相当于 <strong>SIM 卡</strong>，<strong>IP 地址</strong> 相当于 <strong>电话号码</strong></p>
</blockquote>
<h4 id="IP-地址"><a href="#IP-地址" class="headerlink" title="IP 地址"></a>IP 地址</h4><ul>
<li><strong>每台联网的电脑上</strong>都有 <strong>IP 地址</strong>，<strong>是保证电脑之间正常通讯的重要设置</strong></li>
</ul>
<blockquote>
<p>注意：每台电脑的 IP 地址不能相同，否则会出现 IP 地址冲突，并且没有办法正常通讯</p>
<p>提示：有关 <strong>IP 地址</strong>的详细内容，在就业班会详细讲解！</p>
</blockquote>
<h3 id="2-2-ifconfig"><a href="#2-2-ifconfig" class="headerlink" title="2.2 ifconfig"></a>2.2 <code>ifconfig</code></h3><ul>
<li><code>ifconfig</code> 可以查看／配置计算机当前的网卡配置信息</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看网卡配置信息</span></span><br><span class="line">$ ifconfig</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看网卡对应的 IP 地址</span></span><br><span class="line">$ ifconfig | grep inet</span><br></pre></td></tr></table></figure>

<blockquote>
<p>提示：一台计算机中有可能会有一个 <strong>物理网卡</strong> 和 <strong>多个虚拟网卡</strong>，在 Linux 中物理网卡的名字通常以 <code>ensXX</code> 表示</p>
</blockquote>
<ul>
<li><code>127.0.0.1</code> 被称为 <strong>本地回环&#x2F;环回地址</strong>，一般用来测试本机网卡是否正常</li>
</ul>
<h3 id="2-3-ping"><a href="#2-3-ping" class="headerlink" title="2.3 ping"></a>2.3 <code>ping</code></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 检测到目标主机是否连接正常</span></span><br><span class="line">$ ping IP地址</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检测本地网卡工作正常</span></span><br><span class="line">$ ping 127.0.0.1</span><br></pre></td></tr></table></figure>

<ul>
<li><code>ping</code> 一般用于检测当前计算机到目标计算机之间的网络 <strong>是否通畅</strong>，<strong>数值越大，速度越慢</strong></li>
</ul>
<blockquote>
<ul>
<li><code>ping</code> 的工作原理与潜水艇的声纳相似，<code>ping</code> 这个命令就是取自 <strong>声纳的声音</strong></li>
<li>网络管理员之间也常将 <code>ping</code> 用作动词 —— <strong>ping 一下计算机 X，看他是否开着</strong></li>
</ul>
</blockquote>
<p>原理：网络上的机器都有 <strong>唯一确定的 IP 地址</strong>，我们给<strong>目标 IP 地址</strong>发送一个数据包，对方就要返回一个数据包，根据返回的数据包以及时间，我们可以确定目标主机的存在</p>
<blockquote>
<p>提示：在 Linux 中，想要终止一个终端程序的执行，绝大多数都可以使用 <code>CTRL + C</code></p>
</blockquote>
<h2 id="03-远程登录和复制文件"><a href="#03-远程登录和复制文件" class="headerlink" title="03. 远程登录和复制文件"></a>03. 远程登录和复制文件</h2><table>
<thead>
<tr>
<th>序号</th>
<th>命令</th>
<th>对应英文</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>01</td>
<td>ssh 用户名@ip</td>
<td>secure shell</td>
<td>关机／重新启动</td>
</tr>
<tr>
<td>02</td>
<td>scp 用户名@ip:文件名或路径 用户名@ip:文件名或路径</td>
<td>secure copy</td>
<td>远程复制文件</td>
</tr>
</tbody></table>
<h3 id="3-1-ssh-基础（重点）"><a href="#3-1-ssh-基础（重点）" class="headerlink" title="3.1 ssh 基础（重点）"></a>3.1 <code>ssh</code> 基础（重点）</h3><p>在 Linux 中 SSH 是 <strong>非常常用</strong> 的工具，通过 <strong>SSH 客户端</strong> 我们可以连接到运行了 <strong>SSH 服务器</strong> 的远程机器上</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/001_SSH%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="001_SSH示意图"></p>
<ul>
<li><strong>SSH 客户端</strong>是一种使用 <code>Secure Shell（SSH）</code> 协议连接到远程计算机的软件程序</li>
<li><code>SSH</code> 是目前较可靠，<strong>专为远程登录会话和其他网络服务</strong> 提供安全性的协议<ul>
<li>利用 <code>SSH 协议</code> 可以有效<strong>防止远程管理过程中的信息泄露</strong></li>
<li>通过 <code>SSH 协议</code> 可以对所有传输的数据进行加密，也能够防止 DNS 欺骗和 IP 欺骗</li>
</ul>
</li>
<li><code>SSH</code> 的另一项优点是传输的数据可以是经过压缩的，所以可以加快传输的速度</li>
</ul>
<h4 id="1-域名-和-端口号"><a href="#1-域名-和-端口号" class="headerlink" title="1) 域名 和 端口号"></a>1) 域名 和 端口号</h4><h5 id="域名"><a href="#域名" class="headerlink" title="域名"></a>域名</h5><ul>
<li>由一串 <strong>用点分隔</strong> 的名字组成，例如：<code>www.itcast.cn</code></li>
<li>是 <strong>IP 地址</strong> 的别名，方便用户记忆</li>
</ul>
<h5 id="端口号"><a href="#端口号" class="headerlink" title="端口号"></a>端口号</h5><ul>
<li><p><strong>IP 地址</strong>：通过 <strong>IP 地址</strong> 找到网络上的 <strong>计算机</strong></p>
</li>
<li><p><strong>端口号</strong>：通过 <strong>端口号</strong> 可以找到 <strong>计算机上运行的应用程序</strong></p>
<ul>
<li><strong>SSH 服务器</strong> 的默认端口号是 <code>22</code>，如果是默认端口号，在连接的时候，可以省略</li>
</ul>
</li>
<li><p>常见服务端口号列表：</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>序号</th>
<th>服务</th>
<th>端口号</th>
</tr>
</thead>
<tbody><tr>
<td>01</td>
<td>SSH 服务器</td>
<td>22</td>
</tr>
<tr>
<td>02</td>
<td>Web 服务器</td>
<td>80</td>
</tr>
<tr>
<td>03</td>
<td>HTTPS</td>
<td>443</td>
</tr>
<tr>
<td>04</td>
<td>FTP 服务器</td>
<td>21</td>
</tr>
</tbody></table>
<blockquote>
<p>提示：有关 <strong>端口号</strong>的详细内容，在就业班会详细讲解！</p>
</blockquote>
<h4 id="2-SSH-客户端的简单使用"><a href="#2-SSH-客户端的简单使用" class="headerlink" title="2) SSH 客户端的简单使用"></a>2) SSH 客户端的简单使用</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh [-p port] user@remote</span><br></pre></td></tr></table></figure>

<ul>
<li><code>user</code> 是在远程机器上的用户名，如果不指定的话默认为当前用户</li>
<li><code>remote</code> 是远程机器的地址，可以是 <strong>IP</strong>／<strong>域名</strong>，或者是 <strong>后面会提到的别名</strong></li>
<li><code>port</code> 是 <strong>SSH Server 监听的端口</strong>，如果不指定，就为默认值 <code>22</code></li>
</ul>
<blockquote>
<p>提示：</p>
<ul>
<li>使用 <code>exit</code> 退出当前用户的登录</li>
</ul>
<p>注意：</p>
<ul>
<li><code>ssh</code> 这个终端命令只能在 <code>Linux</code> 或者 <code>UNIX</code> 系统下使用</li>
<li>如果在 <code>Windows</code> 系统中，可以安装 <code>PuTTY</code> 或者 <code>XShell</code> 客户端软件即可</li>
</ul>
<p>提示：</p>
<ul>
<li>在工作中，SSH 服务器的端口号很有可能<strong>不是 22</strong>，如果遇到这种情况就需要使用 <code>-p</code> 选项，指定正确的端口号，否则无法正常连接到服务器</li>
</ul>
</blockquote>
<h4 id="3-Windows-下-SSH-客户端的安装"><a href="#3-Windows-下-SSH-客户端的安装" class="headerlink" title="3) Windows 下 SSH 客户端的安装"></a>3) Windows 下 SSH 客户端的安装</h4><ul>
<li><code>Putty</code> <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html">http://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html</a></li>
<li><code>XShell</code> <a href="http://xshellcn.com/">http://xshellcn.com</a></li>
</ul>
<blockquote>
<p>建议从官方网站下载正式的安装程序</p>
</blockquote>
<h3 id="3-2-scp（掌握）"><a href="#3-2-scp（掌握）" class="headerlink" title="3.2 scp（掌握）"></a>3.2 <code>scp</code>（掌握）</h3><ul>
<li>scp 就是 <code>secure copy</code>，是一个在 Linux 下用来进行 <strong>远程拷贝文件</strong> 的命令</li>
<li>它的<strong>地址格式与 ssh 基本相同</strong>，<strong>需要注意的是</strong>，在指定端口时用的是大写的 <code>-P</code> 而不是小写的</li>
</ul>
<p><img data-src="https://bitbw.top/public/img/my_gallery/002_SCP%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="002_SCP示意图"></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 把本地当前目录下的 01.py 文件 复制到 远程 家目录下的 Desktop/01.py</span></span><br><span class="line"><span class="comment"># 注意：`:` 后面的路径如果不是绝对路径，则以用户的家目录作为参照路径</span></span><br><span class="line">scp -P port 01.py user@remote:Desktop/01.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把远程 家目录下的 Desktop/01.py 文件 复制到 本地当前目录下的 01.py</span></span><br><span class="line">scp -P port user@remote:Desktop/01.py 01.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加上 -r 选项可以传送文件夹</span></span><br><span class="line"><span class="comment"># 把当前目录下的 demo 文件夹 复制到 远程 家目录下的 Desktop</span></span><br><span class="line">scp -r demo user@remote:Desktop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把远程 家目录下的 Desktop 复制到 当前目录下的 demo 文件夹</span></span><br><span class="line">scp -r user@remote:Desktop demo</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>-r</td>
<td>若给出的源文件是目录文件，则 scp 将递归复制该目录下的所有子目录和文件，目标文件必须为一个目录名</td>
</tr>
<tr>
<td>-P</td>
<td>若远程 SSH 服务器的端口不是 22，需要使用大写字母 -P 选项指定端口</td>
</tr>
</tbody></table>
<blockquote>
<p>注意：</p>
<ul>
<li><code>scp</code> 这个终端命令只能在 <code>Linux</code> 或者 <code>UNIX</code> 系统下使用</li>
<li>如果在 <code>Windows</code> 系统中，可以安装 <code>PuTTY</code>，使用 <code>pscp</code> 命令行工具或者安装 <code>FileZilla</code> 使用 <code>FTP</code> 进行文件传输</li>
</ul>
</blockquote>
<h4 id="FileZilla"><a href="#FileZilla" class="headerlink" title="FileZilla"></a><code>FileZilla</code></h4><ul>
<li>官方网站：<a href="https://www.filezilla.cn/download/client">https://www.filezilla.cn/download/client</a></li>
<li><code>FileZilla</code> 在传输文件时，使用的是 <code>FTP 服务</code> 而不是 <code>SSH 服务</code>，因此端口号应该设置为 <code>21</code></li>
</ul>
<h3 id="3-3-SSH-高级（知道）"><a href="#3-3-SSH-高级（知道）" class="headerlink" title="3.3 SSH 高级（知道）"></a>3.3 SSH 高级（知道）</h3><ul>
<li>免密码登录</li>
<li>配置别名</li>
</ul>
<blockquote>
<p>提示：有关 SSH 配置信息都保存在用户家目录下的 <code>.ssh</code> 目录下</p>
</blockquote>
<h4 id="1）免密码登录"><a href="#1）免密码登录" class="headerlink" title="1）免密码登录"></a>1）免密码登录</h4><h5 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h5><ul>
<li>配置公钥<ul>
<li>执行 <code>ssh-keygen</code> 即可生成 SSH 钥匙，一路回车即可</li>
</ul>
</li>
<li>上传公钥到服务器<ul>
<li>执行 <code>ssh-copy-id -p port user@remote</code>，可以让远程服务器记住我们的公钥</li>
</ul>
</li>
</ul>
<h5 id="示意图"><a href="#示意图" class="headerlink" title="示意图"></a>示意图</h5><p><img data-src="https://bitbw.top/public/img/my_gallery/003_SSH%20%E5%85%8D%E5%AF%86%E7%A0%81%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="001_组示意图"></p>
<blockquote>
<p>非对称加密算法</p>
<ul>
<li>使用 <strong>公钥</strong> 加密的数据，需要使用 <strong>私钥</strong> 解密</li>
<li>使用 <strong>私钥</strong> 加密的数据，需要使用 <strong>公钥</strong> 解密</li>
</ul>
</blockquote>
<h4 id="2-配置别名"><a href="#2-配置别名" class="headerlink" title="2) 配置别名"></a>2) 配置别名</h4><p>每次都输入 <code>ssh -p port user@remote</code>，时间久了会觉得很麻烦，特别是当 <code>user</code>, <code>remote</code> 和 <code>port</code> 都得输入，而且还不好记忆</p>
<p>而 <strong>配置别名</strong> 可以让我们进一步偷懒，譬如用：<code>ssh mac</code> 来替代上面这么一长串，那么就在 <code>~/.ssh/config</code> 里面追加以下内容：</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">Host mac</span><br><span class="line">    HostName ip地址</span><br><span class="line">    <span class="keyword">User</span> <span class="title">itheima</span></span><br><span class="line">    Port <span class="number">22</span></span><br></pre></td></tr></table></figure>

<p><strong>保存之后，即可用 <code>ssh mac</code> 实现远程登录了，<code>scp</code> 同样可以使用</strong></p>
<h1 id="用户权限相关命令"><a href="#用户权限相关命令" class="headerlink" title="用户权限相关命令"></a>用户权限相关命令</h1><h2 id="目标-5"><a href="#目标-5" class="headerlink" title="目标"></a>目标</h2><ul>
<li><strong>用户</strong> 和 <strong>权限</strong> 的基本概念</li>
<li><strong>用户管理</strong> 终端命令</li>
<li><strong>组管理</strong> 终端命令</li>
<li><strong>修改权限</strong> 终端命令</li>
</ul>
<h2 id="01-用户-和-权限-的基本概念"><a href="#01-用户-和-权限-的基本概念" class="headerlink" title="01. 用户 和 权限 的基本概念"></a>01. <strong>用户</strong> 和 <strong>权限</strong> 的基本概念</h2><h3 id="1-1-基本概念"><a href="#1-1-基本概念" class="headerlink" title="1.1 基本概念"></a>1.1 基本概念</h3><ul>
<li><strong>用户</strong> 是 Linux 系统工作中重要的一环，用户管理包括 <strong>用户</strong> 与 <strong>组</strong> 管理</li>
<li>在 Linux 系统中，不论是由本机或是远程登录系统，每个系统都<strong>必须拥有一个账号</strong>，并且<strong>对于不同的系统资源拥有不同的使用权限</strong></li>
<li>在 Linux 中，可以指定 <strong>每一个用户</strong> 针对 <strong>不同的文件或者目录</strong> 的 <strong>不同权限</strong></li>
<li>对 <strong>文件／目录</strong> 的权限包括：</li>
</ul>
<table>
<thead>
<tr>
<th align="center">序号</th>
<th align="center">权限</th>
<th align="center">英文</th>
<th align="center">缩写</th>
<th align="center">数字代号</th>
</tr>
</thead>
<tbody><tr>
<td align="center">01</td>
<td align="center">读</td>
<td align="center">read</td>
<td align="center">r</td>
<td align="center">4</td>
</tr>
<tr>
<td align="center">02</td>
<td align="center">写</td>
<td align="center">write</td>
<td align="center">w</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">03</td>
<td align="center">执行</td>
<td align="center">excute</td>
<td align="center">x</td>
<td align="center">1</td>
</tr>
</tbody></table>
<h3 id="1-2-组"><a href="#1-2-组" class="headerlink" title="1.2 组"></a>1.2 组</h3><ul>
<li>为了方便用户管理，提出了 <strong>组</strong> 的概念，如下图所示</li>
</ul>
<p><img data-src="https://bitbw.top/public/img/my_gallery/001_%E7%BB%84%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="001_组示意图"></p>
<ul>
<li>在实际应用中，可以预先针对 <strong>组</strong> 设置好权限，然后 <strong>将不同的用户添加到对应的组中</strong>，从而<strong>不用依次为每一个用户设置权限</strong></li>
</ul>
<h3 id="1-3-ls-l-扩展"><a href="#1-3-ls-l-扩展" class="headerlink" title="1.3 ls -l 扩展"></a>1.3 ls -l 扩展</h3><ul>
<li><p><code>ls -l</code> 可以查看文件夹下文件的详细信息，从左到右依次是：</p>
<ul>
<li><strong>权限</strong>，第 1 个字符如果是 <code>d</code> 表示目录</li>
<li><strong>硬链接数</strong>，通俗地讲，就是有多少种方式，可以访问到当前目录／文件</li>
<li><strong>拥有者</strong>，家目录下 文件／目录 的拥有者通常都是当前用户</li>
<li><strong>组</strong>，在 Linux 中，很多时候，会出现组名和用户名相同的情况，后续会讲</li>
<li><strong>大小</strong></li>
<li><strong>时间</strong></li>
<li><strong>名称</strong></li>
</ul>
</li>
</ul>
<p><img data-src="https://bitbw.top/public/img/my_gallery/002_%E6%9D%83%E9%99%90%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="002_权限示意图"></p>
<h3 id="1-4-chmod-简单使用（重要）"><a href="#1-4-chmod-简单使用（重要）" class="headerlink" title="1.4 chmod 简单使用（重要）"></a>1.4 <code>chmod</code> 简单使用（重要）</h3><ul>
<li><code>chmod</code> 可以修改 <strong>用户／组</strong> 对 <strong>文件／目录</strong> 的权限</li>
<li>命令格式如下：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +/-rwx 文件名|目录名</span><br></pre></td></tr></table></figure>

<blockquote>
<p>提示：以上方式会一次性修改 <code>拥有者</code> &#x2F; <code>组</code> 权限，有关 <code>chmod</code> 的高级用法，后续会讲</p>
</blockquote>
<h3 id="1-5-超级用户"><a href="#1-5-超级用户" class="headerlink" title="1.5 超级用户"></a>1.5 超级用户</h3><ul>
<li>Linux 系统中的 <code>root</code> 账号通常 <strong>用于系统的维护和管理</strong>，对操作系统的所有资源 <strong>具有所有访问权限</strong></li>
<li>在大多数版本的 Linux 中，都不推荐 <strong>直接使用 root 账号登录系统</strong></li>
<li>在 Linux 安装的过程中，系统会自动创建一个用户账号，而这个默认的用户就称为“标准用户”</li>
</ul>
<h4 id="sudo"><a href="#sudo" class="headerlink" title="sudo"></a>sudo</h4><ul>
<li><code>su</code> 是 <code>substitute user</code> 的缩写，表示 <strong>使用另一个用户的身份</strong></li>
<li><code>sudo</code> 命令用来以其他身份来执行命令，预设的身份为 <code>root</code></li>
<li>用户使用 <code>sudo</code> 时，必须先输入密码，之后有 <strong>5 分钟的有效期限</strong>，超过期限则必须重新输入密码</li>
</ul>
<blockquote>
<p>若其未经授权的用户企图使用 <code>sudo</code>，则会发出警告邮件给管理员</p>
</blockquote>
<h2 id="02-组管理-终端命令"><a href="#02-组管理-终端命令" class="headerlink" title="02. 组管理 终端命令"></a>02. <strong>组管理</strong> 终端命令</h2><blockquote>
<p>提示：<strong>创建组</strong> &#x2F; <strong>删除组</strong> 的终端命令都需要通过 <code>sudo</code> 执行</p>
</blockquote>
<table>
<thead>
<tr>
<th>序号</th>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>01</td>
<td>groupadd 组名</td>
<td>添加组</td>
</tr>
<tr>
<td>02</td>
<td>groupdel 组名</td>
<td>删除组</td>
</tr>
<tr>
<td>03</td>
<td>cat &#x2F;etc&#x2F;group</td>
<td>确认组信息</td>
</tr>
<tr>
<td>04</td>
<td>chgrp -R 组名 文件&#x2F;目录名</td>
<td>递归修改文件&#x2F;目录的所属组</td>
</tr>
</tbody></table>
<blockquote>
<p>提示：</p>
<ul>
<li>组信息保存在 <code>/etc/group</code> 文件中</li>
<li><code>/etc</code> 目录是专门用来保存 <strong>系统配置信息</strong> 的目录</li>
</ul>
</blockquote>
<p><img data-src="https://bitbw.top/public/img/my_gallery/001_%E7%BB%84%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="001_组示意图"></p>
<ul>
<li>在实际应用中，可以预先针对 <strong>组</strong> 设置好权限，然后 <strong>将不同的用户添加到对应的组中</strong>，从而<strong>不用依次为每一个用户设置权限</strong></li>
</ul>
<h4 id="演练目标"><a href="#演练目标" class="headerlink" title="演练目标"></a>演练目标</h4><ol>
<li>在 <code>python</code> 用户的桌面文件夹下创建 <code>Python学习</code> 目录</li>
<li>新建 <code>dev</code> 组</li>
<li>将 <code>Python学习</code> 目录的组修改为 <code>dev</code></li>
</ol>
<h2 id="03-用户管理-终端命令"><a href="#03-用户管理-终端命令" class="headerlink" title="03. 用户管理 终端命令"></a>03. <strong>用户管理</strong> 终端命令</h2><blockquote>
<p>提示：<strong>创建用户</strong> &#x2F; <strong>删除用户</strong> &#x2F; <strong>修改其他用户密码</strong> 的终端命令都需要通过 <code>sudo</code> 执行</p>
</blockquote>
<h3 id="3-1-创建用户／设置密码／删除用户"><a href="#3-1-创建用户／设置密码／删除用户" class="headerlink" title="3.1 创建用户／设置密码／删除用户"></a>3.1 创建用户／设置密码／删除用户</h3><table>
<thead>
<tr>
<th>序号</th>
<th>命令</th>
<th>作用</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>01</td>
<td>useradd -m -g 组 新建用户名</td>
<td>添加新用户</td>
<td><ul><li>-m 自动建立用户家目录</li><li>-g 指定用户所在的组，否则会建立一个和同名的组</li></ul></td>
</tr>
<tr>
<td>02</td>
<td>passwd 用户名</td>
<td>设置用户密码</td>
<td>如果是普通用户，直接用 passwd 可以修改自己的账户密码</td>
</tr>
<tr>
<td>03</td>
<td>userdel -r 用户名</td>
<td>删除用户</td>
<td>-r 选项会自动删除用户家目录</td>
</tr>
<tr>
<td>04</td>
<td>cat &#x2F;etc&#x2F;passwd | grep 用户名</td>
<td>确认用户信息</td>
<td>新建用户后，用户信息会保存在 &#x2F;etc&#x2F;passwd 文件中</td>
</tr>
</tbody></table>
<blockquote>
<p>提示：</p>
<ul>
<li>创建用户时，如果忘记添加 <code>-m</code> 选项指定新用户的家目录 —— 最简单的方法就是<strong>删除用户，重新创建</strong></li>
<li>创建用户时，默认会创建一个和<strong>用户名</strong>同名的<strong>组名</strong></li>
<li>用户信息保存在 <code>/etc/passwd</code> 文件中</li>
</ul>
</blockquote>
<h3 id="3-2-查看用户信息"><a href="#3-2-查看用户信息" class="headerlink" title="3.2 查看用户信息"></a>3.2 查看用户信息</h3><table>
<thead>
<tr>
<th>序号</th>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>01</td>
<td>id [用户名]</td>
<td>查看用户 UID 和 GID 信息</td>
</tr>
<tr>
<td>02</td>
<td>who</td>
<td>查看当前所有登录的用户列表</td>
</tr>
<tr>
<td>03</td>
<td>whoami</td>
<td>查看当前登录用户的账户名</td>
</tr>
</tbody></table>
<h4 id="passwd-文件"><a href="#passwd-文件" class="headerlink" title="passwd 文件"></a>passwd 文件</h4><p><code>/etc/passwd</code> 文件存放的是用户的信息，由 6 个分号组成的 7 个信息，分别是</p>
<ol>
<li>用户名</li>
<li>密码（x，表示加密的密码）</li>
<li>UID（用户标识）</li>
<li>GID（组标识）</li>
<li>用户全名或本地帐号</li>
<li>家目录</li>
<li>登录使用的 Shell，就是登录之后，使用的终端命令，<code>ubuntu</code> 默认是 <code>dash</code></li>
</ol>
<h4 id="usermod"><a href="#usermod" class="headerlink" title="usermod"></a>usermod</h4><ul>
<li><code>usermod</code> 可以用来设置 <strong>用户</strong> 的 <strong>主组</strong> ／ <strong>附加组</strong> 和 <strong>登录 Shell</strong>，命令格式如下：</li>
<li><strong>主组</strong>：通常在新建用户时指定，在 <code>etc/passwd</code> 的第 4 列 <strong>GID 对应的组</strong></li>
<li><strong>附加组</strong>：在 <code>etc/group</code> 中最后一列表示该组的用户列表，用于指定 <strong>用户的附加权限</strong></li>
</ul>
<blockquote>
<p>提示：设置了用户的附加组之后，需要重新登录才能生效！</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 修改用户的主组（passwd 中的 GID）</span></span><br><span class="line">usermod -g 组 用户名</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改用户的附加组</span></span><br><span class="line">usermod -G 组 用户名</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改用户登录 Shell</span></span><br><span class="line">usermod -s /bin/bash 用户名</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：默认使用 <code>useradd</code> 添加的用户是没有权限使用 <code>sudo</code> 以 <code>root</code> 身份执行命令的，可以使用以下命令，将用户添加到 <code>sudo</code> 附加组中</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">usermod -G sudo 用户名</span><br></pre></td></tr></table></figure>

<h4 id="which（重要）"><a href="#which（重要）" class="headerlink" title="which（重要）"></a>which（重要）</h4><blockquote>
<p>提示</p>
<ul>
<li><code>/etc/passwd</code> 是用于保存用户信息的文件</li>
<li><code>/usr/bin/passwd</code> 是用于修改用户密码的程序</li>
</ul>
</blockquote>
<ul>
<li><code>which</code> 命令可以查看执行命令所在位置，例如：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">which</span> <span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># /bin/ls</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">which</span> useradd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># /usr/sbin/useradd</span></span><br></pre></td></tr></table></figure>

<h5 id="bin-和-sbin"><a href="#bin-和-sbin" class="headerlink" title="bin 和 sbin"></a><code>bin</code> 和 <code>sbin</code></h5><ul>
<li>在 <code>Linux</code> 中，绝大多数可执行文件都是保存在 <code>/bin</code>、<code>/sbin</code>、<code>/usr/bin</code>、<code>/usr/sbin</code></li>
<li><code>/bin</code>（<code>binary</code>）是二进制执行文件目录，主要用于具体应用</li>
<li><code>/sbin</code>（<code>system binary</code>）是系统管理员专用的二进制代码存放目录，主要用于系统管理</li>
<li><code>/usr/bin</code>（<code>user commands for applications</code>）后期安装的一些软件</li>
<li><code>/usr/sbin</code>（<code>super user commands for applications</code>）超级用户的一些管理程序</li>
</ul>
<blockquote>
<p>提示：</p>
<ul>
<li><code>cd</code> 这个终端命令是内置在系统内核中的，没有独立的文件，因此用 <code>which</code> 无法找到 <code>cd</code> 命令的位置</li>
</ul>
</blockquote>
<h3 id="3-3-切换用户"><a href="#3-3-切换用户" class="headerlink" title="3.3 切换用户"></a>3.3 切换用户</h3><table>
<thead>
<tr>
<th>序号</th>
<th>命令</th>
<th>作用</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>01</td>
<td>su - 用户名</td>
<td>切换用户，并且切换目录</td>
<td>- 可以切换到用户家目录，否则保持位置不变</td>
</tr>
<tr>
<td>02</td>
<td>exit</td>
<td>退出当前登录账户</td>
<td></td>
</tr>
</tbody></table>
<ul>
<li><code>su</code> 不接用户名，可以切换到 <code>root</code>，但是不推荐使用，因为不安全</li>
<li><code>exit</code> 示意图如下：</li>
</ul>
<p><img data-src="https://bitbw.top/public/img/my_gallery/003_su%E5%92%8Cexit%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="003_su和exit示意图"></p>
<h2 id="04-修改文件权限"><a href="#04-修改文件权限" class="headerlink" title="04. 修改文件权限"></a>04. 修改文件权限</h2><table>
<thead>
<tr>
<th>序号</th>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>01</td>
<td>chown</td>
<td>修改拥有者</td>
</tr>
<tr>
<td>02</td>
<td>chgrp</td>
<td>修改组</td>
</tr>
<tr>
<td>03</td>
<td>chmod</td>
<td>修改权限</td>
</tr>
</tbody></table>
<ul>
<li>命令格式如下：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 修改文件|目录的拥有者</span></span><br><span class="line"><span class="built_in">chown</span> 用户名 文件名|目录名</span><br><span class="line"></span><br><span class="line"><span class="comment"># 递归修改文件|目录的组</span></span><br><span class="line"><span class="built_in">chgrp</span> -R 组名 文件名|目录名</span><br><span class="line"></span><br><span class="line"><span class="comment"># 递归修改文件权限</span></span><br><span class="line"><span class="built_in">chmod</span> -R 755 文件名|目录名</span><br></pre></td></tr></table></figure>

<ul>
<li><code>chmod</code> 在设置权限时，可以简单地使用三个数字分别对应 <strong>拥有者</strong> ／ <strong>组</strong> 和 <strong>其他</strong> 用户的权限</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 直接修改文件|目录的 读|写|执行 权限，但是不能精确到 拥有者|组|其他</span></span><br><span class="line"><span class="built_in">chmod</span> +/-rwx 文件名|目录名</span><br></pre></td></tr></table></figure>

<p><img data-src="https://bitbw.top/public/img/my_gallery/004_%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="004_文件权限示意图"></p>
<ul>
<li>常见数字组合有（<code>u</code>表示用户／<code>g</code>表示组／<code>o</code>表示其他）：<ul>
<li><code>777</code> &#x3D;&#x3D;&#x3D;&gt; <code>u=rwx,g=rwx,o=rwx</code></li>
<li><code>755</code> &#x3D;&#x3D;&#x3D;&gt; <code>u=rwx,g=rx,o=rx</code></li>
<li><code>644</code> &#x3D;&#x3D;&#x3D;&gt; <code>u=rw,g=r,o=r</code></li>
</ul>
</li>
</ul>
<h4 id="chmod-演练目标"><a href="#chmod-演练目标" class="headerlink" title="chmod 演练目标"></a><code>chmod</code> 演练目标</h4><ol>
<li>将 <code>01.py</code> 的权限修改为 <code>u=rwx,g=rx,o=r</code></li>
<li>将 <code>123.txt</code> 的权限修改为 <code>u=rw,g=r,o=-</code></li>
<li>将 <code>test</code> 目录以及目录下的 <strong>所有</strong> 文件权限修改为 <code>u=rwx,g=rwx,o=rx</code></li>
</ol>
<h1 id="系统信息相关命令"><a href="#系统信息相关命令" class="headerlink" title="系统信息相关命令"></a>系统信息相关命令</h1><ul>
<li>本节内容主要是为了方便通过远程终端维护服务器时，查看服务器上当前 <strong>系统日期和时间</strong> ／ <strong>磁盘空间占用情况</strong> ／ <strong>程序执行情况</strong></li>
<li>本小结学习的终端命令基本都是查询命令，通过这些命令对系统资源的使用情况有个了解</li>
</ul>
<h2 id="目标-6"><a href="#目标-6" class="headerlink" title="目标"></a>目标</h2><ul>
<li>时间和日期<ul>
<li><code>date</code></li>
<li><code>cal</code></li>
</ul>
</li>
<li>磁盘和目录空间<ul>
<li><code>df</code></li>
<li><code>du</code></li>
</ul>
</li>
<li>进程信息<ul>
<li><code>ps</code></li>
<li><code>top</code></li>
<li><code>kill</code></li>
</ul>
</li>
</ul>
<h2 id="01-时间和日期"><a href="#01-时间和日期" class="headerlink" title="01. 时间和日期"></a>01. 时间和日期</h2><table>
<thead>
<tr>
<th>序号</th>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>01</td>
<td>date</td>
<td>查看系统时间</td>
</tr>
<tr>
<td>02</td>
<td>cal</td>
<td><code>calendar</code> 查看日历，<code>-y</code> 选项可以查看一年的日历</td>
</tr>
</tbody></table>
<h2 id="02-磁盘信息"><a href="#02-磁盘信息" class="headerlink" title="02. 磁盘信息"></a>02. 磁盘信息</h2><table>
<thead>
<tr>
<th>序号</th>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>01</td>
<td>df -h</td>
<td><code>disk free</code> 显示磁盘剩余空间</td>
</tr>
<tr>
<td>02</td>
<td>du -h [目录名]</td>
<td><code>disk usage</code> 显示目录下的文件大小</td>
</tr>
</tbody></table>
<ul>
<li>选项说明</li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>-h</td>
<td>以人性化的方式显示文件大小</td>
</tr>
</tbody></table>
<h2 id="03-进程信息"><a href="#03-进程信息" class="headerlink" title="03. 进程信息"></a>03. 进程信息</h2><ul>
<li>所谓 <strong>进程</strong>，通俗地说就是 <strong>当前正在执行的一个程序</strong></li>
</ul>
<table>
<thead>
<tr>
<th>序号</th>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>01</td>
<td>ps aux</td>
<td><code>process status</code> 查看进程的详细状况</td>
</tr>
<tr>
<td>02</td>
<td>top</td>
<td>动态显示运行中的进程并且排序</td>
</tr>
<tr>
<td>03</td>
<td>kill [-9] 进程代号</td>
<td>终止指定代号的进程，<code>-9</code> 表示强行终止</td>
</tr>
</tbody></table>
<blockquote>
<p><code>ps</code> 默认只会显示当前用户通过终端启动的应用程序</p>
</blockquote>
<ul>
<li><code>ps</code> 选项说明</li>
</ul>
<table>
<thead>
<tr>
<th>选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>a</td>
<td>显示终端上的所有进程，包括其他用户的进程</td>
</tr>
<tr>
<td>u</td>
<td>显示进程的详细状态</td>
</tr>
<tr>
<td>x</td>
<td>显示没有控制终端的进程</td>
</tr>
</tbody></table>
<blockquote>
<p>提示：使用 <code>kill</code> 命令时，最好只终止由当前用户开启的进程，而不要终止 <code>root</code> 身份开启的进程，否则可能导致系统崩溃</p>
</blockquote>
<blockquote>
<ul>
<li>要退出 <code>top</code> 可以直接输入 <code>q</code></li>
</ul>
</blockquote>
<h1 id="其他命令"><a href="#其他命令" class="headerlink" title="其他命令"></a>其他命令</h1><h2 id="目标-7"><a href="#目标-7" class="headerlink" title="目标"></a>目标</h2><ul>
<li>查找文件<ul>
<li><code>find</code></li>
</ul>
</li>
<li>软链接<ul>
<li><code>ln</code></li>
</ul>
</li>
<li>打包和压缩<ul>
<li><code>tar</code></li>
</ul>
</li>
<li>软件安装<ul>
<li><code>apt-get</code></li>
</ul>
</li>
</ul>
<h2 id="01-查找文件"><a href="#01-查找文件" class="headerlink" title="01. 查找文件"></a>01. 查找文件</h2><ul>
<li><code>find</code> 命令功能非常强大，通常用来在 <strong>特定的目录下</strong> <strong>搜索</strong> 符合条件的文件</li>
</ul>
<table>
<thead>
<tr>
<th>序号</th>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>01</td>
<td>find [路径] -name “*.py”</td>
<td>查找指定路径下扩展名是 <code>.py</code> 的文件，包括子目录</td>
</tr>
</tbody></table>
<ul>
<li>如果省略路径，表示在当前文件夹下查找</li>
<li>之前学习的通配符，在使用 <code>find</code> 命令时同时可用</li>
<li>有关 <code>find</code> 的高级使用，在就业班会讲</li>
</ul>
<h3 id="演练目标-1"><a href="#演练目标-1" class="headerlink" title="演练目标"></a>演练目标</h3><ul>
<li><ol>
<li>搜索桌面目录下，文件名包含 <code>1</code> 的文件</li>
</ol>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find -name <span class="string">&quot;*1*&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><ol start="2">
<li>搜索桌面目录下，所有以 <code>.txt</code> 为扩展名的文件</li>
</ol>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find -name <span class="string">&quot;*.txt&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><ol start="3">
<li>搜索桌面目录下，以数字 <code>1</code> 开头的文件</li>
</ol>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find -name <span class="string">&quot;1*&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="02-软链接"><a href="#02-软链接" class="headerlink" title="02. 软链接"></a>02. 软链接</h2><table>
<thead>
<tr>
<th>序号</th>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>01</td>
<td>ln -s 被链接的源文件 链接文件</td>
<td>建立文件的软链接，用通俗的方式讲<strong>类似于</strong> Windows 下的<strong>快捷方式</strong></td>
</tr>
</tbody></table>
<ul>
<li><p>注意：</p>
</li>
<li><ol>
<li>没有 <code>-s</code> 选项建立的是一个 <strong>硬链接文件</strong></li>
</ol>
<ul>
<li>两个文件占用相同大小的硬盘空间，<strong>工作中几乎不会建立文件的硬链接</strong></li>
</ul>
</li>
<li><ol start="2">
<li><strong>源文件要使用绝对路径</strong>，不能使用相对路径，这样可以方便移动链接文件后，仍然能够正常使用</li>
</ol>
</li>
</ul>
<h3 id="演练目标-2"><a href="#演练目标-2" class="headerlink" title="演练目标"></a>演练目标</h3><ul>
<li><ol>
<li>将桌面目录下的 <code>01.py</code> <strong>移动</strong>到 <code>demo/b/c</code> 目录下</li>
</ol>
</li>
<li><ol start="2">
<li>在桌面目录下新建 <code>01.py</code> 的 <strong>软链接</strong> <code>FirstPython</code></li>
</ol>
<ul>
<li>分别使用 <strong>相对路径</strong> 和 <strong>绝对路径</strong> 建立 <code>FirstPython</code> 的软链接</li>
</ul>
</li>
<li><ol start="3">
<li>将 <code>FirstPython</code> <strong>移动</strong>到 <code>demo</code> 目录下，对比使用 <strong>相对路径</strong> 和 <strong>绝对路径</strong> 的区别</li>
</ol>
</li>
</ul>
<h3 id="硬链接简介（知道）"><a href="#硬链接简介（知道）" class="headerlink" title="硬链接简介（知道）"></a>硬链接简介（知道）</h3><ul>
<li>在使用 <code>ln</code> 创建链接时，如果没有 <code>-s</code> 选项，会创建一个 <strong>硬链接</strong>，而不是软链接</li>
</ul>
<h4 id="硬链接演练"><a href="#硬链接演练" class="headerlink" title="硬链接演练"></a>硬链接演练</h4><ul>
<li><ol>
<li>在 <code>~/Desktop/demo</code> 目录下建立 <code>~/Desktop/demo/b/c/01.py</code> 的硬链接 <code>01_hard</code></li>
</ol>
</li>
<li><ol start="2">
<li>使用 <code>ls -l</code> 查看文件的<strong>硬链接数</strong>（硬链接——有多少种方式可以访问文件或者目录）</li>
</ol>
</li>
<li><ol start="3">
<li>删除 <code>~/Desktop/demo/b/c/01.py</code>，并且使用 <code>tree</code> 来确认 <code>demo</code> 目录下的三个链接文件</li>
</ol>
</li>
</ul>
<h4 id="文件软硬链接的示意图"><a href="#文件软硬链接的示意图" class="headerlink" title="文件软硬链接的示意图"></a>文件软硬链接的示意图</h4><p><img data-src="https://bitbw.top/public/img/my_gallery/001_%E6%96%87%E4%BB%B6%E8%BD%AF%E7%A1%AC%E9%93%BE%E6%8E%A5%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="001_文件软硬链接示意图"></p>
<blockquote>
<p>在 Linux 中，<strong>文件名</strong> 和 <strong>文件的数据</strong> 是分开存储的</p>
</blockquote>
<ul>
<li>提示：<ul>
<li>在 Linux 中，只有文件的 <code>硬链接数 == 0</code> 才会被删除</li>
<li>使用 <code>ls -l</code> 可以查看一个文件的硬链接的数量</li>
<li>在日常工作中，几乎不会建立文件的硬链接，知道即可</li>
</ul>
</li>
</ul>
<h2 id="03-打包压缩"><a href="#03-打包压缩" class="headerlink" title="03. 打包压缩"></a>03. 打包压缩</h2><ul>
<li><strong>打包压缩</strong> 是日常工作中备份文件的一种方式</li>
<li>在不同操作系统中，常用的打包压缩方式是不同的<ul>
<li><code>Windows</code> 常用 <code>rar</code></li>
<li><code>Mac</code> 常用 <code>zip</code></li>
<li><code>Linux</code> 常用 <code>tar.gz</code></li>
</ul>
</li>
</ul>
<h3 id="3-1-打包-／-解包"><a href="#3-1-打包-／-解包" class="headerlink" title="3.1 打包 ／ 解包"></a>3.1 打包 ／ 解包</h3><ul>
<li><code>tar</code> 是 Linux 中最常用的 <strong>备份</strong>工具，此命令可以 <strong>把一系列文件</strong> 打包到 <strong>一个大文件中</strong>，也可以把一个 <strong>打包的大文件恢复成一系列文件</strong></li>
<li><code>tar</code> 的命令格式如下：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 打包文件</span></span><br><span class="line">tar -cvf 打包文件.tar 被打包的文件／路径...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解包文件</span></span><br><span class="line">tar -xvf 打包文件.tar</span><br></pre></td></tr></table></figure>

<ul>
<li><code>tar</code> 选项说明</li>
</ul>
<table>
<thead>
<tr>
<th>选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>c</td>
<td>生成档案文件，创建打包文件</td>
</tr>
<tr>
<td>x</td>
<td>解开档案文件</td>
</tr>
<tr>
<td>v</td>
<td>列出归档解档的详细过程，显示进度</td>
</tr>
<tr>
<td>f</td>
<td>指定档案文件名称，f 后面一定是 .tar 文件，所以必须放选项最后</td>
</tr>
</tbody></table>
<blockquote>
<p>注意：<code>f</code> 选项必须放在最后，其他选项顺序可以随意</p>
</blockquote>
<h4 id="打包解包演练"><a href="#打包解包演练" class="headerlink" title="打包解包演练"></a>打包解包演练</h4><ol>
<li>删除桌面下的所有内容</li>
<li>在桌面下新建三个空白文件 <code>01.py</code>、<code>02.py</code>、<code>03.py</code></li>
<li>将这三个文件打一个 <code>py.tar</code> 的包</li>
<li>新建 <code>tar</code> 目录，并且将 <code>py.tar</code> 移动到 <code>tar</code> 目录下</li>
<li>解包 <code>py.tar</code></li>
</ol>
<h3 id="3-2-压缩／解压缩"><a href="#3-2-压缩／解压缩" class="headerlink" title="3.2 压缩／解压缩"></a>3.2 压缩／解压缩</h3><h4 id="1-gzip"><a href="#1-gzip" class="headerlink" title="1) gzip"></a>1) <code>gzip</code></h4><ul>
<li><code>tar</code> 与 <code>gzip</code> 命令结合可以使用实现文件 <strong>打包和压缩</strong><ul>
<li><code>tar</code> 只负责打包文件，但不压缩</li>
<li>用 <code>gzip</code> 压缩 <code>tar</code> 打包后的文件，其扩展名一般用 <code>xxx.tar.gz</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>在 <code>Linux</code> 中，最常见的压缩文件格式就是 <code>xxx.tar.gz</code></p>
</blockquote>
<ul>
<li><p>在 <code>tar</code> 命令中有一个选项 <strong>-z</strong> 可以调用 <code>gzip</code>，从而可以方便的实现压缩和解压缩的功能</p>
</li>
<li><p>命令格式如下：</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 压缩文件</span></span><br><span class="line">tar -zcvf 打包文件.tar.gz 被压缩的文件／路径...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压缩文件</span></span><br><span class="line">tar -zxvf 打包文件.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压缩到指定路径</span></span><br><span class="line">tar -zxvf 打包文件.tar.gz -C 目标路径</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>选项</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>-C</td>
<td>解压缩到指定目录，注意：要解压缩的目录必须存在</td>
</tr>
</tbody></table>
<h4 id="2-bzip2-two"><a href="#2-bzip2-two" class="headerlink" title="2) bzip2(two)"></a>2) <code>bzip2(two)</code></h4><ul>
<li><p><code>tar</code> 与 <code>bzip2</code> 命令结合可以使用实现文件 <strong>打包和压缩</strong>（用法和 <code>gzip</code> 一样）</p>
<ul>
<li><code>tar</code> 只负责打包文件，但不压缩，</li>
<li>用 <code>bzip2</code> 压缩 <code>tar</code> 打包后的文件，其扩展名一般用 <code>xxx.tar.bz2</code></li>
</ul>
</li>
<li><p>在 <code>tar</code> 命令中有一个选项 <strong>-j</strong> 可以调用 <code>bzip2</code>，从而可以方便的实现压缩和解压缩的功能</p>
</li>
<li><p>命令格式如下：</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 压缩文件</span></span><br><span class="line">tar -jcvf 打包文件.tar.bz2 被压缩的文件／路径...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压缩文件</span></span><br><span class="line">tar -jxvf 打包文件.tar.bz2</span><br></pre></td></tr></table></figure>

<h2 id="04-软件安装"><a href="#04-软件安装" class="headerlink" title="04. 软件安装"></a>04. 软件安装</h2><h2 id="4-1-通过-apt-安装／卸载软件"><a href="#4-1-通过-apt-安装／卸载软件" class="headerlink" title="4.1 通过 apt 安装／卸载软件"></a>4.1 通过 apt 安装／卸载软件</h2><ul>
<li>apt 是 <code>Advanced Packaging Tool</code>，是 Linux 下的一款安装包管理工具</li>
<li>可以在终端中方便的 <strong>安装</strong>／<strong>卸载</strong>／<strong>更新软件包</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. 安装软件</span></span><br><span class="line">$ sudo apt install 软件包</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 卸载软件</span></span><br><span class="line">$ sudo apt remove 软件名</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 更新已安装的包</span></span><br><span class="line">$ sudo apt upgrade</span><br></pre></td></tr></table></figure>

<h3 id="安装演练"><a href="#安装演练" class="headerlink" title="安装演练"></a>安装演练</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 一个小火车提示</span></span><br><span class="line">$ sudo apt install sl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一个比较漂亮的查看当前进程排名的软件</span></span><br><span class="line">$ sudo apt install htop</span><br></pre></td></tr></table></figure>

<h2 id="4-2-配置软件源"><a href="#4-2-配置软件源" class="headerlink" title="4.2 配置软件源"></a>4.2 配置软件源</h2><ul>
<li>如果希望在 <code>ubuntu</code> 中安装软件，<strong>更加快速</strong>，可以通过设置<strong>镜像源</strong>，选择一个访问网速更快的服务器，来提供软件下载／安装服务</li>
<li>提示：更换服务器之后，需要一个相对比较长时间的更新过程，需要耐心等待。更新完成后，再安装软件都会从新设置的服务器下载软件了</li>
</ul>
<blockquote>
<p>所谓镜像源，就是<strong>所有服务器的内容是相同的（镜像）</strong>，但是根据所在位置不同，国内服务器通常速度会更快一些！</p>
</blockquote>
<p><img data-src="https://bitbw.top/public/img/my_gallery/003_%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="003_镜像服务器示意图"></p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/001_ubuntu%E8%AE%BE%E7%BD%AE%E8%BD%AF%E4%BB%B6%E6%BA%90.png" alt="001_ubuntu设置软件源"></p>
<h1 id="Linux-主要目录速查表"><a href="#Linux-主要目录速查表" class="headerlink" title="Linux 主要目录速查表"></a><code>Linux</code> 主要目录速查表</h1><ul>
<li>&#x2F;：根目录，<strong>一般根目录下只存放目录</strong>，在 linux 下有且只有一个根目录，所有的东西都是从这里开始<ul>
<li>当在终端里输入 <code>/home</code>，其实是在告诉电脑，先从 <code>/</code>（根目录）开始，再进入到 <code>home</code> 目录</li>
</ul>
</li>
<li>&#x2F;bin、&#x2F;usr&#x2F;bin：可执行二进制文件的目录，如常用的命令 ls、tar、mv、cat 等</li>
<li>&#x2F;boot：放置 linux 系统启动时用到的一些文件，如 linux 的内核文件：<code>/boot/vmlinuz</code>，系统引导管理器：<code>/boot/grub</code></li>
<li>&#x2F;dev：存放 linux 系统下的设备文件，访问该目录下某个文件，相当于访问某个设备，常用的是挂载光驱<code>mount /dev/cdrom /mnt</code></li>
<li>&#x2F;etc：系统配置文件存放的目录，不建议在此目录下存放可执行文件，重要的配置文件有<ul>
<li>&#x2F;etc&#x2F;inittab</li>
<li>&#x2F;etc&#x2F;fstab</li>
<li>&#x2F;etc&#x2F;init.d</li>
<li>&#x2F;etc&#x2F;X11</li>
<li>&#x2F;etc&#x2F;sysconfig</li>
<li>&#x2F;etc&#x2F;xinetd.d</li>
</ul>
</li>
<li>&#x2F;home：系统默认的用户家目录，新增用户账号时，用户的家目录都存放在此目录下<ul>
<li><code>~</code> 表示当前用户的家目录</li>
<li><code>~edu</code> 表示用户 <code>edu</code> 的家目录</li>
</ul>
</li>
<li>&#x2F;lib、&#x2F;usr&#x2F;lib、&#x2F;usr&#x2F;local&#x2F;lib：系统使用的函数库的目录，程序在执行过程中，需要调用一些额外的参数时需要函数库的协助</li>
<li>&#x2F;lost+fount：系统异常产生错误时，会将一些遗失的片段放置于此目录下</li>
<li>&#x2F;mnt: &#x2F;media：光盘默认挂载点，通常光盘挂载于 &#x2F;mnt&#x2F;cdrom 下，也不一定，可以选择任意位置进行挂载</li>
<li>&#x2F;opt：给主机额外安装软件所摆放的目录</li>
<li>&#x2F;proc：此目录的数据都在内存中，如系统核心，外部设备，网络状态，由于数据都存放于内存中，所以不占用磁盘空间，比较重要的文件有：&#x2F;proc&#x2F;cpuinfo、&#x2F;proc&#x2F;interrupts、&#x2F;proc&#x2F;dma、&#x2F;proc&#x2F;ioports、&#x2F;proc&#x2F;net&#x2F;* 等</li>
<li>&#x2F;root：系统管理员 root 的家目录</li>
<li>&#x2F;sbin、&#x2F;usr&#x2F;sbin、&#x2F;usr&#x2F;local&#x2F;sbin：放置系统管理员使用的可执行命令，如 fdisk、shutdown、mount 等。与 &#x2F;bin 不同的是，这几个目录是给系统管理员 root 使用的命令，一般用户只能”查看”而不能设置和使用</li>
<li>&#x2F;tmp：一般用户或正在执行的程序临时存放文件的目录，任何人都可以访问，重要数据不可放置在此目录下</li>
<li>&#x2F;srv：服务启动之后需要访问的数据目录，如 www 服务需要访问的网页数据存放在 &#x2F;srv&#x2F;www 内</li>
<li>&#x2F;usr：应用程序存放目录<ul>
<li>&#x2F;usr&#x2F;bin：存放应用程序</li>
<li>&#x2F;usr&#x2F;share：存放共享数据</li>
<li>&#x2F;usr&#x2F;lib：存放不能直接运行的，却是许多程序运行所必需的一些函数库文件</li>
<li>&#x2F;usr&#x2F;local：存放软件升级包</li>
<li>&#x2F;usr&#x2F;share&#x2F;doc：系统说明文件存放目录</li>
<li>&#x2F;usr&#x2F;share&#x2F;man：程序说明文件存放目录</li>
</ul>
</li>
<li>&#x2F;var：放置系统执行过程中经常变化的文件<ul>
<li>&#x2F;var&#x2F;log：随时更改的日志文件</li>
<li>&#x2F;var&#x2F;spool&#x2F;mail：邮件存放的目录</li>
<li>&#x2F;var&#x2F;run：程序或服务启动后，其 PID 存放在该目录下</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux系统安装Nodejs和卸载Nodejs</title>
    <url>/2020/12/13/Nodejs/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85Nodejs/</url>
    <content><![CDATA[<p><a href="https://www.cnblogs.com/fireblackman/p/15688513.html">ubuntu 安装 node 的三种方式</a></p>
<blockquote>
<p>不推荐安装最新的 node 版本 好多 npm 包都没有对应的最新 node 版本的编译好的包</p>
</blockquote>
<h2 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h2><ul>
<li>本机系统：CentOS Linux release 7.5</li>
<li>Node.js：v12.18.1</li>
</ul>
<h2 id="获取-Node-js-安装包"><a href="#获取-Node-js-安装包" class="headerlink" title="获取 Node.js 安装包"></a>获取 Node.js 安装包</h2><ul>
<li>Node.js 安装包及源码下载地址为：<a href="https://nodejs.org/en/download/">https://nodejs.org/en/download/</a>，你可以根据不同平台系统选择你需要的 Node.js 安装包，这里选择的是 [LTS] Linux Binaries (x64)。</li>
<li>官方下载地址 <a href="https://nodejs.org/dist/latest-v12.x/">https://nodejs.org/dist/latest-v12.x/</a></li>
</ul>
<h2 id="Linux-上安装-Node-js"><a href="#Linux-上安装-Node-js" class="headerlink" title="Linux 上安装 Node.js"></a>Linux 上安装 Node.js</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://nodejs.org/dist/v12.18.1/node-v12.18.1-linux-x64.tar.xz    // 下载</span><br><span class="line">tar xf node-v12.18.1-linux-x64.tar.xz                                   // 解压</span><br><span class="line"><span class="built_in">cd</span> node-v12.18.1-linux-x64                                              // 进入解压目录</span><br></pre></td></tr></table></figure>

<p>解压文件的 bin 目录底下包含了 node、npm 等命令（npm 全局安装的包），我们可以修改 linux 系统的环境变量（profile）来设置直接运行命令：</p>
<p><strong>老规矩先备份，养成修改重要文件之前先备份的好习惯。</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> /etc/profile /etc/profile.bak</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x2F;etc&#x2F;profile 文件介绍： <a href="https://www.cnblogs.com/xiaoshuxiaoshu/p/4689447.html">https://www.cnblogs.com/xiaoshuxiaoshu/p/4689447.html</a></p>
</blockquote>
<p>然后 vim &#x2F;etc&#x2F;profile，在最下面添加 export PATH&#x3D;$PATH: 后面跟上 node 下 bin 目录的路径</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">export NODE_HOME=/root/node-v12.18.1-linux-x64 export PATH=NODE_HOME/bin:$PATH</span><br></pre></td></tr></table></figure>

<p>如果 profile 不可修改 添加可写权</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span>  a=rw  /etc/profile</span><br></pre></td></tr></table></figure>

<p>立即生效</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>

<p>检查是否生效</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">env</span></span><br></pre></td></tr></table></figure>

<p>建立软连接 （报已经存在错误： 先删除目标目录下的文件在操作）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s /root/node-v12.18.1-linux-x64/bin/node /usr/local/bin/node</span><br><span class="line"><span class="built_in">ln</span> -s /root/node-v12.18.1-linux-x64/bin/npm /usr/local/bin/npm</span><br></pre></td></tr></table></figure>

<p>添加 sudo （报已经存在错误： 先删除目标目录下的文件在操作）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo <span class="built_in">ln</span> -s /root/node-v12.18.1-linux-x64/bin/node  /usr/bin/node</span><br><span class="line">sudo <span class="built_in">ln</span> -s /root/node-v12.18.1-linux-x64/lib/node  /usr/lib/node</span><br><span class="line">sudo <span class="built_in">ln</span> -s /root/node-v12.18.1-linux-x64/bin/npm  /usr/bin/npm</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># node -v</span></span><br><span class="line">v12.18.1</span><br></pre></td></tr></table></figure>

<p>OK！安装成功！</p>
<h2 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h2><p>用上面步骤安装后可以直接删除 node-v12.18.1-linux-x64 文件夹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf /root/node-v12.18.1-linux-x64</span><br></pre></td></tr></table></figure>

<p>进入 &#x2F;usr&#x2F;local&#x2F;lib 删除所有 node 和 node_modules 文件夹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf /usr/lib/node  /usr/lib/node_modules</span><br></pre></td></tr></table></figure>

<p>进入 &#x2F;usr&#x2F;local&#x2F;include 删除所有 node 和 node_modules 文件夹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf /usr/local/include/node  /usr/local/include/node_modules</span><br></pre></td></tr></table></figure>

<p>进入 &#x2F;usr&#x2F;local&#x2F;bin 删除 node 的可执行文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf /usr/local/bin/node</span><br></pre></td></tr></table></figure>

<p>接着找到上面建立的软连接 依次删除即可</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf /usr/bin/npm</span><br></pre></td></tr></table></figure>

<p>卸载完成！</p>
<p>现在如果需要其他版本的 node ，就可以按上面的步骤从新安装一个其他版本的 node 了</p>
<h2 id="ubuntu-安装-node-的三种方式"><a href="#ubuntu-安装-node-的三种方式" class="headerlink" title="ubuntu 安装 node 的三种方式"></a>ubuntu 安装 node 的三种方式</h2><h3 id="直接使用ubuntu软件源安装"><a href="#直接使用ubuntu软件源安装" class="headerlink" title="直接使用ubuntu软件源安装"></a>直接使用ubuntu软件源安装</h3><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">sudo</span> apt update</span><br><span class="line"><span class="attribute">sudo</span> apt install nodejs npm</span><br><span class="line"><span class="attribute">nodejs</span> --version</span><br><span class="line"><span class="attribute">v10</span>.<span class="number">19</span>.<span class="number">0</span></span><br><span class="line"><span class="attribute">npm</span> -v</span><br></pre></td></tr></table></figure>

<h3 id="从nodesource安装nodejs和npm"><a href="#从nodesource安装nodejs和npm" class="headerlink" title="从nodesource安装nodejs和npm"></a>从nodesource安装nodejs和npm</h3><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 安装仓库</span></span><br><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/nodesource/</span>distributions</span><br><span class="line">Installation instructions</span><br><span class="line">Node.js v17.x:</span><br><span class="line"></span><br><span class="line"><span class="comment"># Using Ubuntu</span></span><br><span class="line">curl -fsSL https:<span class="regexp">//</span>deb.nodesource.com/setup_17.x | sudo -E bash -</span><br><span class="line">sudo apt-get install -y nodejs</span><br><span class="line"></span><br><span class="line"><span class="comment"># Using Debian, as root</span></span><br><span class="line">curl -fsSL https:<span class="regexp">//</span>deb.nodesource.com/setup_17.x | bash -</span><br><span class="line">apt-get install -y nodejs</span><br><span class="line">Node.js v16.x:</span><br><span class="line"></span><br><span class="line"><span class="comment"># Using Ubuntu</span></span><br><span class="line">curl -fsSL https:<span class="regexp">//</span>deb.nodesource.com/setup_16.x | sudo -E bash -</span><br><span class="line">sudo apt-get install -y nodejs</span><br><span class="line"></span><br><span class="line"><span class="comment"># Using Debian, as root</span></span><br><span class="line">curl -fsSL https:<span class="regexp">//</span>deb.nodesource.com/setup_16.x | bash -</span><br><span class="line">apt-get install -y nodejs</span><br><span class="line">Node.js v14.x:</span><br><span class="line"></span><br><span class="line"><span class="comment"># Using Ubuntu</span></span><br><span class="line">curl -fsSL https:<span class="regexp">//</span>deb.nodesource.com/setup_14.x | sudo -E bash -</span><br><span class="line">sudo apt-get install -y nodejs</span><br><span class="line"></span><br><span class="line"><span class="comment"># Using Debian, as root</span></span><br><span class="line">curl -fsSL https:<span class="regexp">//</span>deb.nodesource.com/setup_14.x | bash -</span><br><span class="line">apt-get install -y nodejs</span><br><span class="line">Node.js v12.x:</span><br><span class="line"></span><br><span class="line"><span class="comment"># Using Ubuntu</span></span><br><span class="line">curl -fsSL https:<span class="regexp">//</span>deb.nodesource.com/setup_12.x | sudo -E bash -</span><br><span class="line">sudo apt-get install -y nodejs</span><br><span class="line"></span><br><span class="line"><span class="comment"># Using Debian, as root</span></span><br><span class="line">curl -fsSL https:<span class="regexp">//</span>deb.nodesource.com/setup_12.x | bash -</span><br><span class="line">apt-get install -y nodejs</span><br><span class="line">Node.js LTS (v16.x):</span><br><span class="line"></span><br><span class="line"><span class="comment"># Using Ubuntu</span></span><br><span class="line">curl -fsSL https:<span class="regexp">//</span>deb.nodesource.com/setup_lts.x | sudo -E bash -</span><br><span class="line">sudo apt-get install -y nodejs</span><br><span class="line"></span><br><span class="line"><span class="comment"># Using Debian, as root</span></span><br><span class="line">curl -fsSL https:<span class="regexp">//</span>deb.nodesource.com/setup_lts.x | bash -</span><br><span class="line">apt-get install -y nodejs</span><br><span class="line">Node.js Current (v17.x):</span><br><span class="line"></span><br><span class="line"><span class="comment"># Using Ubuntu</span></span><br><span class="line">curl -fsSL https:<span class="regexp">//</span>deb.nodesource.com/setup_current.x | sudo -E bash -</span><br><span class="line">sudo apt-get install -y nodejs</span><br><span class="line"></span><br><span class="line"><span class="comment"># Using Debian, as root</span></span><br><span class="line">curl -fsSL https:<span class="regexp">//</span>deb.nodesource.com/setup_current.x | bash -</span><br><span class="line">apt-get install -y nodejs</span><br><span class="line">Optional: install build tools</span><br><span class="line"></span><br><span class="line">To compile and install native addons from npm you may also need to install build tools:</span><br><span class="line"></span><br><span class="line"><span class="comment"># use `sudo` on Ubuntu or run this as root on debian</span></span><br><span class="line">apt-get install -y build-essential</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="nvm安装"><a href="#nvm安装" class="headerlink" title="nvm安装"></a>nvm安装</h3><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 通过脚本安装</span></span><br><span class="line">curl -o- https:<span class="regexp">//</span>raw.githubusercontent.com<span class="regexp">/nvm-sh/</span>nvm<span class="regexp">/v0.39.0/i</span>nstall.sh | bash</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim .bashrc</span><br><span class="line"><span class="comment"># 添加如下代码</span></span><br><span class="line"><span class="built_in">export</span> NVM_DIR=<span class="string">&quot;<span class="subst">$([ -z <span class="string">&quot;<span class="variable">$&#123;XDG_CONFIG_HOME-&#125;</span>&quot;</span> ] &amp;&amp; printf %s <span class="string">&quot;<span class="variable">$&#123;HOME&#125;</span>/.nvm&quot;</span> || printf %s <span class="string">&quot;<span class="variable">$&#123;XDG_CONFIG_HOME&#125;</span>/nvm&quot;</span>)</span>&quot;</span></span><br><span class="line">[ -s <span class="string">&quot;<span class="variable">$NVM_DIR</span>/nvm.sh&quot;</span> ] &amp;&amp; \. <span class="string">&quot;<span class="variable">$NVM_DIR</span>/nvm.sh&quot;</span> <span class="comment"># This loads nvm# 保存退出后，执行下面命令让配置生效source .bashrc</span></span><br></pre></td></tr></table></figure>

<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">master<span class="variable">@master</span><span class="symbol">:~</span><span class="variable">$ </span>nvm -v</span><br><span class="line"><span class="number">0.39</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Nodejs</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Nodejs</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL忘记密码修改</title>
    <url>/2021/04/22/SQL/MySQL%E5%BF%98%E8%AE%B0%E5%AF%86%E7%A0%81%E4%BF%AE%E6%94%B9/</url>
    <content><![CDATA[<h2 id="MySQL8-0"><a href="#MySQL8-0" class="headerlink" title="MySQL8.0"></a>MySQL8.0</h2><p>1.停止 MySQL 服务</p>
<p>打开命令窗口 cmd，输入命令：net stop mysql，停止 MySQL 服务<br>或者<br>打开服务 找到 MySQL 右键停止</p>
<p>2.开启跳过密码验证登录的 MySQL 服务<br>输入命令<br>mysqld –console –skip-grant-tables –shared-memory</p>
<p>3.再打开一个新的 cmd，无密码登录 MySQL，输入登录命令：mysql -u root -p</p>
<p>无需输入密码直接回车</p>
<p>4.密码置为空，命令如下：<br>use mysql; –进入 mysql</p>
<p>update user set authentication_string&#x3D;’’ where user&#x3D;’root’;–将字段置为空</p>
<p>flush privileges;–刷新 MySQL 的系统权限相关表,否则会被拒绝</p>
<p>ALTER user ‘root‘@’localhost’ IDENTIFIED BY ‘’;–修改密码为空</p>
<p>5.再次进入 mysql -u root -p 试试修改后的密码是否生效，没问题重启 MySQL 即可</p>
]]></content>
      <categories>
        <category>SQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Next.js入门</title>
    <url>/2022/08/10/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/Next-js%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<h2 id="Next-特点"><a href="#Next-特点" class="headerlink" title="Next 特点"></a>Next 特点</h2><p>next 适合用于公司官网、文章类、电商类等对于 SEO 需求高的网站。<br>中后台管理系统无需 SEO 所以也不一定需要使用 Next</p>
<h2 id="创建-Next-js-应用"><a href="#创建-Next-js-应用" class="headerlink" title="创建 Next.js 应用"></a>创建 Next.js 应用</h2><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npx create-next-app nextjs-blog --use-npm --example <span class="string">&quot;https://github.com/vercel/next-learn/tree/master/basics/learn-starter&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> nextjs-blog</span><br><span class="line"></span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><p>Next 中路由就是对应的文件路径</p>
<p>例如，在开发中：</p>
<p>pages&#x2F;index.js与&#x2F;路线相关联。<br>pages&#x2F;posts&#x2F;first-post.js与&#x2F;posts&#x2F;first-post路线相关联。</p>
<h3 id="Link"><a href="#Link" class="headerlink" title="Link"></a>Link</h3><p><code>&lt;Link&gt;</code> 用于在页面中导航</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Link</span> <span class="keyword">from</span> <span class="string">&#x27;next/link&#x27;</span>;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">className</span>=<span class="string">&quot;title&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  Read <span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&quot;/posts/first-post&quot;</span>&gt;</span>this page!<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>在 Next.js 的生产版本中，每当Link组件出现在浏览器的视口中时，Next.js 都会在后台自动预取链接页面的代码。当您单击链接时，目标页面的代码已经在后台加载，页面转换几乎是即时的！</p>
</blockquote>
<h2 id="资源-css-等"><a href="#资源-css-等" class="headerlink" title="资源 css 等"></a>资源 css 等</h2><h3 id="静态文件服务"><a href="#静态文件服务" class="headerlink" title="静态文件服务"></a>静态文件服务</h3><p>Next 可以以 <code>public</code> 为基础,在根目录中的一个文件夹下提供静态文件服务，从基本 <code>baseURL</code>&#x2F; 开始引用 <code>public</code> 其中的文件<br>例如：public&#x2F;me.png 对应 <code>http://localhost:3000/me.png</code><br>这点跟 <code>vue-cli</code> 和 <code>rca</code> 类似</p>
<h3 id="css"><a href="#css" class="headerlink" title="css"></a>css</h3><p>Next 支持 <a href="https://nextjs.org/docs/basic-features/built-in-css-support#adding-component-level-css">CSS Modules</a></p>
<blockquote>
<p>重要提示：要使用CSS 模块，CSS 文件名必须以.module.css</p>
</blockquote>
<h4 id="使用-Sass"><a href="#使用-Sass" class="headerlink" title="使用 Sass"></a>使用 Sass</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm install -D sass</span><br></pre></td></tr></table></figure>

<h3 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h3><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Image</span> <span class="keyword">from</span> <span class="string">&#x27;next/image&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">YourComponent</span> = (<span class="params"></span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Image</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">src</span>=<span class="string">&quot;/images/profile.jpg&quot;</span> // <span class="attr">Route</span> <span class="attr">of</span> <span class="attr">the</span> <span class="attr">image</span> <span class="attr">file</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">height</span>=<span class="string">&#123;144&#125;</span> // <span class="attr">Desired</span> <span class="attr">size</span> <span class="attr">with</span> <span class="attr">correct</span> <span class="attr">aspect</span> <span class="attr">ratio</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">width</span>=<span class="string">&#123;144&#125;</span> // <span class="attr">Desired</span> <span class="attr">size</span> <span class="attr">with</span> <span class="attr">correct</span> <span class="attr">aspect</span> <span class="attr">ratio</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">alt</span>=<span class="string">&quot;Your Name&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  /&gt;</span></span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="head"><a href="#head" class="headerlink" title="head"></a>head</h3><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Head</span> <span class="keyword">from</span> <span class="string">&#x27;next/head&#x27;</span>;</span><br><span class="line"><span class="comment">// 直接会渲染到 head 标签中</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Create Next App<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/favicon.ico&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">Head</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="全局样式"><a href="#全局样式" class="headerlink" title="全局样式"></a>全局样式</h2><p>要加载全局 CSS文件，请创建一个名为的文件pages&#x2F;_app.js，其内容如下</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// `pages/_app.js`</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;../styles/global.css&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params">&#123; Component, pageProps &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...pageProps</span>&#125; /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该App组件是所有不同页面通用的顶级组件。例如，您可以使用此App组件在页面之间导航时保​​持状态</p>
<h3 id="添加-layout-组件"><a href="#添加-layout-组件" class="headerlink" title="添加 layout 组件"></a>添加 layout 组件</h3><p><a href="https://nextjs.org/learn/basics/assets-metadata-css/polishing-layout">layout 组件</a></p>
<p>。</p>
<h2 id="预渲染"><a href="#预渲染" class="headerlink" title="预渲染"></a>预渲染</h2><h3 id="两种形式的预渲染"><a href="#两种形式的预渲染" class="headerlink" title="两种形式的预渲染"></a>两种形式的预渲染</h3><p>Next.js 有两种预渲染形式：静态生成和服务器端渲染。不同之处在于它何时为页面生成 HTML</p>
<ul>
<li>静态生成是在构建时生成 HTML 的预渲染方法。然后在每个请求上重用预呈现的 HTML</li>
<li>服务器端渲染是在每个请求上生成 HTML 的预渲染方法。</li>
</ul>
<h3 id="静态生成"><a href="#静态生成" class="headerlink" title="静态生成"></a>静态生成</h3><h4 id="getStaticProps"><a href="#getStaticProps" class="headerlink" title="getStaticProps"></a>getStaticProps</h4><p>getStaticProps 仅在服务器端运行</p>
<p>开发与生产</p>
<ul>
<li>在开发（npm run dev或yarn dev）中，getStaticProps在每个请求上运行。</li>
<li>在生产中，getStaticProps 在构建时运行。但是，可以使用返回的fallback键来增强此行为 getStaticPaths</li>
</ul>
<p>我们建议尽可能使用静态生成（有数据和无数据），因为您的页面可以构建一次并由 CDN 提供服务，这比让服务器在每次请求时呈现页面要快得多。</p>
<p>您可以将静态生成用于多种类型的页面，包括：</p>
<ul>
<li>营销页面</li>
<li>博客文章</li>
<li>电子商务产品列表</li>
<li>帮助和文档</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 服务端</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getStaticProps</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> allPostsData = <span class="title function_">getSortedPostsData</span>();</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">props</span>: &#123;</span><br><span class="line">      allPostsData,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 客户端</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params">&#123; allPostsData &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Layout</span> <span class="attr">home</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">&#123;</span>`$&#123;<span class="attr">utilStyles.headingMd</span>&#125; $&#123;<span class="attr">utilStyles.padding1px</span>&#125;`&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h2</span> <span class="attr">className</span>=<span class="string">&#123;utilStyles.headingLg&#125;</span>&gt;</span>Blog<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">className</span>=<span class="string">&#123;utilStyles.list&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;allPostsData.map((&#123; id, date, title &#125;) =&gt; (</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&#123;utilStyles.listItem&#125;</span> <span class="attr">key</span>=<span class="string">&#123;id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              &#123;title&#125;</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">              &#123;id&#125;</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">              &#123;date&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          ))&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>注意事项</strong></p>
<ul>
<li>因为它仅在构建时运行，所以您将无法使用仅在请求期间可用的数据，例如查询参数或 HTTP 标头。</li>
<li>仅允许在页面中, getStaticProps只能从页面导出。您不能从非页面文件中导出它。这种限制的原因之一是 React 需要在呈现页面之前拥有所有必需的数据</li>
<li>因为它仅在构建时运行 所以无法获取实时数据（仅适用于类似 静态博客 这种案例）</li>
</ul>
<h3 id="服务器端渲染"><a href="#服务器端渲染" class="headerlink" title="服务器端渲染"></a>服务器端渲染</h3><p>如果您需要在请求时而不是在构建时获取数据，您可以尝试服务器端渲染：</p>
<p>getServerSideProps</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getServerSideProps</span>(<span class="params">context</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">props</span>: &#123;</span><br><span class="line">      <span class="comment">// props for your component</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>与 SEO 无关的私人、用户特定页面使用服务器端渲染</p>
<h3 id="预渲染-总结"><a href="#预渲染-总结" class="headerlink" title="预渲染 总结"></a>预渲染 总结</h3><p>优先使用<code>静态生成</code> 实在不能使用<code>静态生成</code>的地方再使用<code>服务器端渲染</code>或<code>客户端渲染</code></p>
<h4 id="静态生成原理"><a href="#静态生成原理" class="headerlink" title="静态生成原理"></a>静态生成原理</h4><p>每个文件对应一个页面,每个页面构建时都会先执行一下 <code>getStaticProps</code>,将 <code>props</code>传递给页面组件,然后根据页面组件生成对应的<code>html</code>, 浏览器直接请求对应的<code>html</code>会包含样式，所以即使禁用<code>javascript</code>还是可以正常浏览</p>
<h2 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h2><p>动态路由同静态生成类似,需要有静态数据用于生成对应的路由和页面</p>
<p>我们希望每个帖子都有 <code>path/posts/id</code><br>首先，我们将在pages&#x2F;posts创建一个名为<code>[id].js</code>的页面。 注意是<code>[id]</code>需要带 <code>[]</code></p>
<h3 id="getStaticPaths"><a href="#getStaticPaths" class="headerlink" title="getStaticPaths"></a>getStaticPaths</h3><p><code>[id].js</code> 文件导出 <code>getStaticPaths</code> 函数</p>
<p>[id].js</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Post</span>(<span class="params">&#123; postData &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Layout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* Add this <span class="tag">&lt;<span class="name">Head</span>&gt;</span> tag */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;postData.title&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">article</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span> <span class="attr">className</span>=<span class="string">&#123;utilStyles.headingXl&#125;</span>&gt;</span>&#123;postData.title&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;postData.date&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">dangerouslySetInnerHTML</span>=<span class="string">&#123;&#123;</span> <span class="attr">__html:</span> <span class="attr">postData.contentHtml</span> &#125;&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">article</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  );</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br><span class="line"><span class="language-xml">/* </span></span><br><span class="line"><span class="language-xml">paths 是所有 id 的集合 （所有 [host]/posts/* 的集合, ps:告诉 next 构建时需要生成哪些页面和路由）</span></span><br><span class="line"><span class="language-xml">paths [</span></span><br><span class="line"><span class="language-xml">  &#123; params: &#123; id: &#x27;pre-rendering&#x27; &#125; &#125;,</span></span><br><span class="line"><span class="language-xml">  &#123; params: &#123; id: &#x27;ssg-ssr&#x27; &#125; &#125;,</span></span><br><span class="line"><span class="language-xml">  &#123; params: &#123; id: &#x27;vue原理&#x27; &#125; &#125;</span></span><br><span class="line"><span class="language-xml">] </span></span><br><span class="line"><span class="language-xml">params 中的参数和文件名 [id].js 需要对应  [id].js =&gt; params.id</span></span><br><span class="line"><span class="language-xml">*/</span></span><br><span class="line"><span class="language-xml">export async function getStaticPaths() &#123;</span></span><br><span class="line"><span class="language-xml">  // Return a list of possible value for id</span></span><br><span class="line"><span class="language-xml">  // Returns an array that looks like this:</span></span><br><span class="line"><span class="language-xml">  // &#123; params: &#123; id: &#x27;pre-rendering&#x27; &#125; &#125;,</span></span><br><span class="line"><span class="language-xml">  // &#123; params: &#123; id: &#x27;ssg-ssr&#x27; &#125; &#125;,</span></span><br><span class="line"><span class="language-xml">  let paths = getAllPostIds();</span></span><br><span class="line"><span class="language-xml">  return &#123;</span></span><br><span class="line"><span class="language-xml">    paths,</span></span><br><span class="line"><span class="language-xml">    fallback: true, // 如果fallback是false，则任何无法匹配的路径getStaticPaths都将导致404 页面。 true 则会报错</span></span><br><span class="line"><span class="language-xml">  &#125;;</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">// 这里返回的 props 将传递给  Post 组件</span></span><br><span class="line"><span class="language-xml">// 构建时 next 直接根据 postData 生成对应页面</span></span><br><span class="line"><span class="language-xml">export async function getStaticProps(&#123; params &#125;) &#123;</span></span><br><span class="line"><span class="language-xml">  // Fetch necessary data for the blog post using params.id</span></span><br><span class="line"><span class="language-xml">  // postData : &#123; contentHtml date  title&#125;</span></span><br><span class="line"><span class="language-xml">  const postData = await getPostData(params.id);</span></span><br><span class="line"><span class="language-xml">  return &#123;</span></span><br><span class="line"><span class="language-xml">    props: &#123;</span></span><br><span class="line"><span class="language-xml">      postData,</span></span><br><span class="line"><span class="language-xml">    &#125;,</span></span><br><span class="line"><span class="language-xml">  &#125;;</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br></pre></td></tr></table></figure>

<h3 id="getStaticPaths-中的-fallback-参数"><a href="#getStaticPaths-中的-fallback-参数" class="headerlink" title="getStaticPaths 中的  fallback 参数"></a>getStaticPaths 中的  fallback 参数</h3><p>如果fallback是</p>
<ul>
<li>false，则任何无法匹配的路径getStaticPaths都将导致404 页面。</li>
<li>true 则会报错</li>
<li>如果fallback是blocking，那么新路径将在服务器端呈现getStaticProps，并缓存以供将来的请求使用，因此每个路径仅发生一次。</li>
</ul>
<h3 id="多重路径动态路由"><a href="#多重路径动态路由" class="headerlink" title="多重路径动态路由"></a>多重路径动态路由</h3><p>…通过在括号内添加三个点 ( ) 可以扩展动态路由以捕获所有路径例如：</p>
<ul>
<li>pages&#x2F;posts&#x2F;[…id].js匹配&#x2F;posts&#x2F;a, 但也&#x2F;posts&#x2F;a&#x2F;b,&#x2F;posts&#x2F;a&#x2F;b&#x2F;c等等。<br>如果你这样做， in getStaticPaths，你必须返回一个数组作为id键的值，如下所示：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">params</span>: &#123;</span><br><span class="line">      <span class="comment">// Statically Generates /posts/a/b/c</span></span><br><span class="line">      <span class="attr">id</span>: [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>并且params.id将是一个数组getStaticProps:</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getStaticProps</span>(<span class="params">&#123; params &#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// params.id will be like [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="router"><a href="#router" class="headerlink" title="router"></a>router</h3><p>如果你想访问 Next.js 路由器，你可以通过useRouter从next&#x2F;router.</p>
<h3 id="404页"><a href="#404页" class="headerlink" title="404页"></a>404页</h3><p>要创建自定义 404 页面，请创建pages&#x2F;404.js. 该文件是在构建时静态生成的</p>
<h2 id="API-接口"><a href="#API-接口" class="headerlink" title="API 接口"></a>API 接口</h2><p>使用 Next 创建 api 接口,跟创建页面类似，可以使用文件路由的形式 <code>pages/api</code> 下创建对应的接口文件</p>
<p>在  <code>pages/api</code> 下 创建 <code>hello.js</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">handler</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(&#123; <span class="attr">text</span>: <span class="string">&#x27;Hello&#x27;</span> &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>尝试在<a href="http://localhost:3000/api/hello">http://localhost:3000/api/hello</a>访问它。你应该看到{“text”:”Hello”}。</p>
<h3 id="文章接口实现（利用-next-API）"><a href="#文章接口实现（利用-next-API）" class="headerlink" title="文章接口实现（利用 next API）"></a>文章接口实现（利用 next API）</h3><h4 id="创建文件"><a href="#创建文件" class="headerlink" title="创建文件"></a>创建文件</h4><ul>
<li><code>pages/api/post/index.js</code>  -&gt; <a href="http://localhost:3000/api/post">http://localhost:3000/api/post</a> &#x2F;&#x2F; 获取所有文章数据</li>
<li><code>pages/api/post/[postId].js</code>  -&gt; <a href="http://localhost:3000/api/post/postId">http://localhost:3000/api/post/postId</a> &#x2F;&#x2F; 获取单个文章数据</li>
<li><code>pages/api/post/ids.js</code>  -&gt; <a href="http://localhost:3000/api/post/ids">http://localhost:3000/api/post/ids</a> &#x2F;&#x2F; 获取所有文章的id</li>
</ul>
<p><code>pages/api/post/index.js</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 查询全部</span></span><br><span class="line"><span class="keyword">import</span> &#123; getSortedPostsData &#125; <span class="keyword">from</span> <span class="string">&quot;../../../lib/posts&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">handler</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="title class_">PostsDatas</span> = <span class="title function_">getSortedPostsData</span>();</span><br><span class="line">  res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(<span class="title class_">PostsDatas</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>pages/api/post/[postId].js</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getPostData &#125; <span class="keyword">from</span> <span class="string">&quot;../../../lib/posts&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询单个</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">handler</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; postId &#125; = req.<span class="property">query</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data = <span class="keyword">await</span> <span class="title function_">getPostData</span>(postId);</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(data);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: <span class="string">&quot;failed to load data&quot;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>pages/api/post/ids.js</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// id list</span></span><br><span class="line"><span class="keyword">import</span> &#123; getAllPostIds &#125; <span class="keyword">from</span> <span class="string">&quot;../../../lib/posts&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">handler</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> data = <span class="title function_">getAllPostIds</span>();</span><br><span class="line">  res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h3><p><a href="https://nextjs.org/docs/api-routes/dynamic-api-routes">动态 API 路由</a><br><a href="https://nextjs.org/docs/api-routes/request-helpers">请求助手</a><br><a href="https://nextjs.org/docs/api-routes/response-helpers">响应助手</a></p>
<h2 id="部署到-Vercel"><a href="#部署到-Vercel" class="headerlink" title="部署到 Vercel"></a>部署到 Vercel</h2><p><a href="https://nextjs.org/learn/basics/deploying-nextjs-app/deploy">官方教程</a></p>
<h3 id="Vercel"><a href="#Vercel" class="headerlink" title="Vercel"></a>Vercel</h3><p>Next.js 和 Vercel<br>Vercel由 Next.js 的创建者制作，并为 Next.js 提供一流的支持。当您将 Next.js 应用程序部署到Vercel时，默认情况下会发生以下情况：</p>
<p>使用静态生成和资产（JS、CSS、图像、字体等）的页面将自动从速度极快的Vercel 边缘网络提供服务。<br>使用Server-Side Rendering和API 路由的页面将自动成为孤立的Serverless Functions。这允许页面呈现和 API 请求无限扩展</p>
<h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h3><ul>
<li>源代码上传 github</li>
<li>注册 Vercel</li>
<li>[导入github项目](https :&#x2F;&#x2F;vercel.com&#x2F;import&#x2F;git)(导入时会提示安装Vercel)</li>
</ul>
<p>添加后vercel根据分支自动部署（相当于预配置好的git action）</p>
<h3 id="预览"><a href="#预览" class="headerlink" title="预览"></a>预览</h3><ul>
<li>创建预览分支</li>
<li>修改并上传预览分支</li>
<li>回到 github 仓库 会看到提示添加 Pull requests 根据提示添加 Pull requests</li>
<li>进到新创建的 Pull requests 中可以查看预览分支 部署好的页面<br><a href="https://bitbw.top/public/img/my_gallery/20220818112329.png">Pull requests</a></li>
<li>预览分支没问题就可以合并到主分支了</li>
</ul>
<h3 id="自定义域名"><a href="#自定义域名" class="headerlink" title="自定义域名"></a>自定义域名</h3><p><a href="https://vercel.com/docs/concepts/projects/custom-domains#dns-records">自定义域名</a></p>
<ul>
<li>进入项目setting</li>
<li>选择域菜单项</li>
<li>添加域名随便写个域名会提示正确的域名填写方式</li>
<li>添加域名 （同时添加域名解析  CNAME cname.vercel-dns.com）</li>
<li>添加预览域名 （同时添加域名解析 CNAME cname.vercel-dns.com）</li>
</ul>
<h2 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h2><h3 id="环境变量加载顺序"><a href="#环境变量加载顺序" class="headerlink" title="环境变量加载顺序"></a>环境变量加载顺序</h3><p>环境变量按顺序在以下位置查找，一旦找到变量就停止。</p>
<ul>
<li>process.env</li>
<li>.env.$(NODE_ENV).local</li>
<li>.env.local（未检查何时 NODE_ENV 是 test。）</li>
<li>.env.$(NODE_ENV)</li>
<li>.env<br>例如，如果NODE_ENVis并且您在 and development中都定义了一个变量，则将使用in 中的值 <code>.env.development.local</code> <code>.env</code> .env.development.local</li>
</ul>
<p>注意：NODE_ENV允许的值为 production,development 和 test。</p>
]]></content>
  </entry>
  <entry>
    <title>Nginx学习和常见问题汇总</title>
    <url>/2021/11/19/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/Nginx%E5%AD%A6%E4%B9%A0%E5%92%8C%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h2 id="Nginx-学习"><a href="#Nginx-学习" class="headerlink" title="Nginx 学习"></a>Nginx 学习</h2><h3 id="nginx-常用的命令："><a href="#nginx-常用的命令：" class="headerlink" title="nginx 常用的命令："></a><strong>nginx</strong> <strong>常用的命令：</strong></h3><p>（1）启动命令</p>
<p>在&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin 目录下执行 .&#x2F;nginx</p>
<p>（2）关闭命令</p>
<p>在&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin 目录下执行 .&#x2F;nginx -s stop</p>
<p>（3）重新加载命令</p>
<p>在&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin 目录下执行 .&#x2F;nginx -s reload</p>
<h3 id="nginx-conf"><a href="#nginx-conf" class="headerlink" title="nginx.conf"></a>nginx.conf</h3><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#============== Nginx 默认配置文件nginx.conf中文详解==============</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义Nginx运行的用户和用户组</span></span><br><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#nginx进程数，建议设置为等于CPU总核心数。</span></span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#全局错误日志定义类型，[ debug | info | notice | warn | error | crit ]</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  info;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#进程pid文件</span></span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置影响nginx服务器或与用户的网络连接。有每个进程的最大连接数，选取哪种事件驱动模型处理连接请求，是否允许同时接受多个网路连接，开启多个网络连接序列化等。（菜鸟教程解释）</span></span><br><span class="line"><span class="comment">#工作模式及连接数上限</span></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#设定http服务器，利用它的反向代理功能提供负载均衡支持</span></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#文件扩展名与文件类型映射表</span></span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#默认文件类型</span></span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#access_log  logs/access.log  main;</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="comment">#tcp_nopush     on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#keepalive_timeout  0;</span></span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line"></span><br><span class="line">　　<span class="comment">#设定负载均衡的服务器列表【没有用过】    upstream mysvr &#123;    　　#weigth参数表示权值，权值越高被分配到的几率越大    　　server 192.168.8.1x:3128 weight=5;#本机上的Squid开启3128端口    　　server 192.168.8.2x:80  weight=1;    　　server 192.168.8.3x:80  weight=6;    &#125;</span></span><br><span class="line">　<span class="comment">#【没有用过】</span></span><br><span class="line">    <span class="section">upstream</span> mysvr2 &#123;    <span class="comment">#weigth参数表示权值，权值越高被分配到的几率越大</span></span><br><span class="line">    　　<span class="attribute">server</span> <span class="number">192</span>.<span class="number">168</span>.<span class="number">8</span>.x:<span class="number">80</span>  weight=<span class="number">1</span>;    　　<span class="attribute">server</span> <span class="number">192</span>.<span class="number">168</span>.<span class="number">8</span>.x:<span class="number">80</span>  weight=<span class="number">6</span>;    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#配置虚拟主机的相关参数，一个http中可以有多个server。</span></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">80</span>; <span class="comment">#监听端口</span></span><br><span class="line">        <span class="attribute">server_name</span>  <span class="number">127.0.0.1</span>; <span class="comment">#监听地址</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#access_log  logs/host.access.log  main;</span></span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="attribute">root</span>   html; <span class="comment">#根路径</span></span><br><span class="line">            <span class="attribute">index</span>  index.html index.htm; <span class="comment">#设置默认页面</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#自己添加</span></span><br><span class="line">        <span class="section">location</span> /ooaa/ &#123;</span><br><span class="line">            <span class="comment">#请求转向mysvr 定义的服务器列表</span></span><br><span class="line">            <span class="attribute">proxy_pass</span> http://127.0.0.1:8384/;  <span class="comment">#注意：使用代理地址时末尾记得加上斜杠&quot;/&quot;。</span></span><br><span class="line">            <span class="comment">#deny 127.0.0.1;  #拒绝的ip【目前没有用过】</span></span><br><span class="line">            <span class="comment">#allow 172.18.5.54; #允许的ip【目前没有用过】</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#error_page  404              /404.html;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># redirect server error pages to the static page /50x.html</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">        <span class="section">location</span> = /50x.html &#123;</span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#location ~ \.php$ &#123;</span></span><br><span class="line">        <span class="comment">#    proxy_pass   http://127.0.0.1;</span></span><br><span class="line">        <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#location ~ \.php$ &#123;</span></span><br><span class="line">        <span class="comment">#    root           html;</span></span><br><span class="line">        <span class="comment">#    fastcgi_pass   127.0.0.1:9000;</span></span><br><span class="line">        <span class="comment">#    fastcgi_index  index.php;</span></span><br><span class="line">        <span class="comment">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span></span><br><span class="line">        <span class="comment">#    include        fastcgi_params;</span></span><br><span class="line">        <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># deny access to .htaccess files, if Apache&#x27;s document root</span></span><br><span class="line">        <span class="comment"># concurs with nginx&#x27;s one</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#location ~ /\.ht &#123;</span></span><br><span class="line">        <span class="comment">#    deny  all;</span></span><br><span class="line">        <span class="comment">#&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># another virtual host using mix of IP-, name-, and port-based configuration</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#server &#123;</span></span><br><span class="line">    <span class="comment">#    listen       8000;</span></span><br><span class="line">    <span class="comment">#    listen       somename:8080;</span></span><br><span class="line">    <span class="comment">#    server_name  somename  alias  another.alias;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    location / &#123;</span></span><br><span class="line">    <span class="comment">#        root   html;</span></span><br><span class="line">    <span class="comment">#        index  index.html index.htm;</span></span><br><span class="line">    <span class="comment">#    &#125;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># HTTPS server</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#server &#123;</span></span><br><span class="line">    <span class="comment">#    listen       443 ssl;</span></span><br><span class="line">    <span class="comment">#    server_name  localhost;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    ssl_certificate      cert.pem;</span></span><br><span class="line">    <span class="comment">#    ssl_certificate_key  cert.key;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    ssl_session_cache    shared:SSL:1m;</span></span><br><span class="line">    <span class="comment">#    ssl_session_timeout  5m;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    ssl_ciphers  HIGH:!aNULL:!MD5;</span></span><br><span class="line">    <span class="comment">#    ssl_prefer_server_ciphers  on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    location / &#123;</span></span><br><span class="line">    <span class="comment">#        root   html;</span></span><br><span class="line">    <span class="comment">#        index  index.html index.htm;</span></span><br><span class="line">    <span class="comment">#    &#125;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>工具使用</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>nodejs使用nodemailer发送邮件</title>
    <url>/2022/07/14/Nodejs/NodeJS%E4%BD%BF%E7%94%A8nodemailer%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6/</url>
    <content><![CDATA[<p><a href="https://nodemailer.com/">nodemailer 官网</a><br><a href="https://github.com/nodemailer/nodemailer/tree/master/examples">nodemailer 使用案例</a></p>
<h2 id="使用案例"><a href="#使用案例" class="headerlink" title="使用案例"></a>使用案例</h2><p><a href="https://github.com/nodemailer/nodemailer/blob/master/examples/sendmail.js">官方案例</a><br>email.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Description: 使用邮箱给对方发送邮件</span></span><br><span class="line"><span class="comment"> * @Autor: Bowen</span></span><br><span class="line"><span class="comment"> * @Date: 2022-03-08 11:14:05</span></span><br><span class="line"><span class="comment"> * @LastEditors: Bowen</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2022-06-30 09:28:02</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> nodemailer <span class="keyword">from</span> <span class="string">&quot;nodemailer&quot;</span>;</span><br><span class="line"><span class="comment">// 成功开启POP3/SMTP服务，在第三方客户端登录时，登录密码输入以下授权密码</span></span><br><span class="line"><span class="keyword">const</span> auth = <span class="string">&quot;XXXXXXXXXXX&quot;</span>;</span><br><span class="line"> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">sendEmail</span>(<span class="params">options = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// 结构参数</span></span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    to = <span class="string">&quot;note@example.com&quot;</span>, <span class="comment">// list of receivers</span></span><br><span class="line">    subject = <span class="string">&quot;subject&quot;</span>, <span class="comment">// Subject line</span></span><br><span class="line">    text = <span class="string">&quot;text&quot;</span>, <span class="comment">// plain text body</span></span><br><span class="line">    html = <span class="string">&quot;&lt;h1&gt; sendMail success &lt;/h1&gt;&quot;</span>, <span class="comment">// html body</span></span><br><span class="line">    attachments = [], <span class="comment">// 附件</span></span><br><span class="line">  &#125; = options;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// create reusable transporter object using the default SMTP transport</span></span><br><span class="line">  <span class="keyword">let</span> transporter = nodemailer.<span class="title function_">createTransport</span>(&#123;</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&quot;smtp.163.com&quot;</span>, <span class="comment">// 163 提供的 host</span></span><br><span class="line">    <span class="attr">port</span>: <span class="number">465</span>,            <span class="comment">// 163 提供的 port</span></span><br><span class="line">    <span class="attr">secure</span>: <span class="literal">true</span>, <span class="comment">// true for 465, false for other ports</span></span><br><span class="line">    <span class="attr">auth</span>: &#123;</span><br><span class="line">      <span class="attr">user</span>: <span class="string">&quot;xxxx@163.com&quot;</span>, <span class="comment">// generated ethereal user  //发送方邮箱</span></span><br><span class="line">      <span class="attr">pass</span>: auth, <span class="comment">// generated ethereal password //发送方邮箱的授权码,一般去邮箱设置里面找，应该可以找到</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// send mail with defined transport object</span></span><br><span class="line">  <span class="keyword">let</span> info = <span class="keyword">await</span> transporter.<span class="title function_">sendMail</span>(&#123;</span><br><span class="line">    <span class="attr">from</span>: <span class="string">&quot;xxxx@163.com&quot;</span>, <span class="comment">// sender address //发送方邮箱</span></span><br><span class="line">    to,</span><br><span class="line">    subject,</span><br><span class="line">    text,</span><br><span class="line">    html,</span><br><span class="line">    attachments,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// console.log(&quot;Message sent: %s&quot;, info.messageId);</span></span><br><span class="line">  <span class="comment">// Message sent: &lt;b658f8ca-6296-ccf4-8306-87d57a0b4321@example.com&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Preview only available when sending through an Ethereal account</span></span><br><span class="line">  <span class="comment">// console.log(&quot;Preview URL: %s&quot;, nodemailer.getTestMessageUrl(info));</span></span><br><span class="line">  <span class="comment">// Preview URL: https://ethereal.email/message/WaQKMgKddxQDoou...</span></span><br><span class="line">  <span class="keyword">return</span> info;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">sendEmail</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Nodejs</category>
      </categories>
      <tags>
        <tag>Nodejs</tag>
        <tag>nodemailer</tag>
      </tags>
  </entry>
  <entry>
    <title>NodeJS基础</title>
    <url>/2021/05/03/Nodejs/NodeJS%E5%9F%BA%E7%A1%80/</url>
    <content><![CDATA[<h2 id="node-搜索包的过程"><a href="#node-搜索包的过程" class="headerlink" title="node 搜索包的过程"></a>node 搜索包的过程</h2><p>在 node 中使用 require 函数直接通过名称导入的包的搜索过程</p>
<ul>
<li>首先在当前目录下寻找 node_modules 中有没有当前导入的包</li>
<li>如果没有就在往上级找 node_modules,找到就使用</li>
<li>如果找到根目录还没有找到需要导入的包，就会报错</li>
</ul>
<h2 id="Buffer-缓存区"><a href="#Buffer-缓存区" class="headerlink" title="Buffer 缓存区"></a>Buffer 缓存区</h2><p>buffer 就是一个数组，数组中每个元素是占 1 字节（8bit）的二进制数据</p>
<blockquote>
<p>&lt;Buffer 68 65 6c 6c 6f 20 e4 b8 96 e7 95 8c&gt; 之所以显示是 16 进制的，是因为控制台要简短的显示，二进制太长了</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">Buffer</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;buffer&quot;</span>);</span><br><span class="line"><span class="comment">//创建了一个占用10个字节的缓冲区(从内存中开辟一块10个字节的空间)  并全部重置为00</span></span><br><span class="line"><span class="keyword">let</span> buf = <span class="title class_">Buffer</span>.<span class="title function_">alloc</span>(<span class="number">10</span>); <span class="comment">// &lt;Buffer 00 00 00 00 00 00 00 00 00 00&gt;</span></span><br><span class="line"><span class="comment">// buf.length指占用的字节数</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf.<span class="property">length</span>); <span class="comment">// 10</span></span><br><span class="line"><span class="keyword">let</span> str = <span class="string">&quot;hello 世界&quot;</span>; <span class="comment">// 一个汉字占用3字节</span></span><br><span class="line">buf = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(str); <span class="comment">// &lt;Buffer 68 65 6c 6c 6f 20 e4 b8 96 e7 95 8c&gt;</span></span><br><span class="line"><span class="comment">// hello 占用6字节，世界占用6字节</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf.<span class="property">length</span>); <span class="comment">// 12</span></span><br><span class="line"><span class="comment">// buf.toString 方法将buffer对象以utf-8编码格式转化为字符串</span></span><br><span class="line">buf.<span class="title function_">toString</span>(); <span class="comment">// hello 世界</span></span><br></pre></td></tr></table></figure>

<p>buffer 一般用于文件的读写时使用，将文件读到内存中（buffer），再将文件从内存（buffer）中写入到硬盘</p>
<h2 id="fs-文件系统"><a href="#fs-文件系统" class="headerlink" title="fs 文件系统"></a>fs 文件系统</h2><h3 id="同步"><a href="#同步" class="headerlink" title="同步"></a>同步</h3><h3 id="异步"><a href="#异步" class="headerlink" title="异步"></a>异步</h3><h3 id="流式"><a href="#流式" class="headerlink" title="流式"></a>流式</h3><p>流式相当于将一个管子，链接需要写入的文件，不断向需要写入的文件中流数据，直到管子关闭，或者数据流完，</p>
<p>流式读写常用于大文件的读写操作·</p>
<h3 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h3><h4 id="rename"><a href="#rename" class="headerlink" title="rename"></a>rename</h4><p>rename 方法 类似 linux 系统中的<code>mv</code> 移动文件命令，可以对文件进行重命名和移动操作</p>
<p>fs.rename(oldPath, newPath, callback)</p>
<p>fs.renameSync(oldPath, newPath)</p>
]]></content>
      <categories>
        <category>Nodejs</category>
      </categories>
      <tags>
        <tag>Nodejs</tag>
      </tags>
  </entry>
  <entry>
    <title>NodeJS常见问题汇总</title>
    <url>/2022/08/25/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB/NodeJS%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h2 id="报错-libcrypto-so-1-1-cannot-open-shared-object-file-No-such-file-or-directory"><a href="#报错-libcrypto-so-1-1-cannot-open-shared-object-file-No-such-file-or-directory" class="headerlink" title="报错 libcrypto.so.1.1: cannot open shared object file: No such file or directory"></a>报错 libcrypto.so.1.1: cannot open shared object file: No such file or directory</h2><p> 完整报错信息</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line">node:internal/modules/cjs/loader:1210</span><br><span class="line">  return process.dlopen(module, path.toNamespacedPath(filename));</span><br><span class="line">                 ^</span><br><span class="line"></span><br><span class="line"><span class="keyword">Error: </span>libcrypto.so.1.1: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure>

<p>报错提示没有 <code>libcrypto.so.1.1</code> ，<code>libcrypto.so.1.1</code> 是 <code>openssl 1.1.x</code> 的库</p>
<p>验证一下版本</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">openssl version</span><br></pre></td></tr></table></figure>

<p><a href="https://bitbw.top/public/img/my_gallery/c267a3e017f456c23e61e0d7d7278a2.png">openssl version</a></p>
<p>果然<code>openssl</code>版本不对需要升级一下<code>openssl</code>版本 ,<a href="https://blog.csdn.net/londa/article/details/125861556">升级的方法</a>(有点麻烦建议使用 docker 解决)</p>
]]></content>
  </entry>
  <entry>
    <title>Promise对象和async函数</title>
    <url>/2018/05/28/js/Promise%E5%AF%B9%E8%B1%A1%E5%92%8Casync%E5%87%BD%E6%95%B0/</url>
    <content><![CDATA[<h2 id="异步代码"><a href="#异步代码" class="headerlink" title="异步代码"></a>异步代码</h2><h3 id="现在常见的的异步代码"><a href="#现在常见的的异步代码" class="headerlink" title="现在常见的的异步代码"></a>现在常见的的异步代码</h3><ul>
<li>定时器</li>
<li>ajax 请求</li>
</ul>
<h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><p><strong>1.在 JavaScript 中，记住一件事儿：所有的异步回调函数执行一定在普通代码执行之后</strong></p>
<p><strong>2.如果想要获取异步代码的执行结果：通过回调函数来接收</strong></p>
<h3 id="基于回调函数的异步流程控制"><a href="#基于回调函数的异步流程控制" class="headerlink" title="基于回调函数的异步流程控制"></a>基于回调函数的异步流程控制</h3><p>封装一个原生 get 请求</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">url, cd</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">  xhr.<span class="title function_">open</span>(<span class="string">&quot;get&quot;</span>, url);</span><br><span class="line">  xhr.<span class="title function_">send</span>();</span><br><span class="line">  xhr.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">cd</span>(<span class="variable language_">this</span>.<span class="property">response</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="原生-ajax-请求注意事项"><a href="#原生-ajax-请求注意事项" class="headerlink" title="原生 ajax 请求注意事项"></a>原生 ajax 请求注意事项</h4><p>事件最好放在发送请求前 不然像捕获发送失败这种函数会获不到</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">xhr.<span class="title function_">addEventListener</span>(<span class="string">&quot;load&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="variable language_">this</span>.<span class="property">response</span>);</span><br><span class="line">&#125;);</span><br><span class="line">xhr.<span class="title function_">addEventListener</span>(<span class="string">&quot;error&quot;</span>, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">  <span class="title function_">reject</span>(err);</span><br><span class="line">&#125;);</span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&quot;get&quot;</span>, url);</span><br><span class="line">xhr.<span class="title function_">send</span>();</span><br></pre></td></tr></table></figure>

<h4 id="异步并行"><a href="#异步并行" class="headerlink" title="异步并行"></a>异步并行</h4><ul>
<li>一起执行 不分先后顺序</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">get</span>(<span class="string">&quot;http://jsonplaceholder.typicode.com/posts&quot;</span>, <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">get</span>(<span class="string">&quot;http://jsonplaceholder.typicode.com/comments&quot;</span>, <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">get</span>(<span class="string">&quot;http://jsonplaceholder.typicode.com/users&quot;</span>, <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="异步串行"><a href="#异步串行" class="headerlink" title="异步串行"></a>异步串行</h4><ul>
<li>依次执行 上一层执行完毕在执行下面代码</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">get</span>(<span class="string">&quot;http://jsonplaceholder.typicode.com/posts&quot;</span>, <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="title function_">get</span>(<span class="string">&quot;http://jsonplaceholder.typicode.com/comments&quot;</span>, <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="title function_">get</span>(<span class="string">&quot;http://jsonplaceholder.typicode.com/users&quot;</span>, <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="回调地狱"><a href="#回调地狱" class="headerlink" title="回调地狱"></a>回调地狱</h3><p>异步串行如果嵌套过深会造成经典的<code>回调地狱</code> 这时需要用到 es6 新增的 Promise 对象来解决</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/timg.jpg" alt="img"></p>
<h3 id="axios-的串行"><a href="#axios-的串行" class="headerlink" title="axios 的串行"></a>axios 的串行</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">axios</span>(&#123;</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&quot;http://jsonplaceholder.typicode.com/posts&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;2 posts 的响应结果&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">axios</span>(&#123;</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;http://jsonplaceholder.typicode.com/users&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;3 users 的响应结果&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">axios</span>(&#123;</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;http://jsonplaceholder.typicode.com/comments&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;4 comments 的响应结果&quot;</span>);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="补充：setTimeout、setInterval-被遗忘的第三个参数"><a href="#补充：setTimeout、setInterval-被遗忘的第三个参数" class="headerlink" title="补充：setTimeout、setInterval 被遗忘的第三个参数"></a>补充：setTimeout、setInterval 被遗忘的第三个参数</h3><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout">MDN</a>介绍</p>
<p>定时器启动时候，第三个以后的参数是作为第一个<code>func()</code>的参数传进去。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> sum = <span class="keyword">function</span> (<span class="params">x, y, z</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(x + y + z); <span class="comment">// 打印6</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">setTimeout</span>(sum, <span class="number">1000</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Promise-对象"><a href="#Promise-对象" class="headerlink" title="Promise 对象"></a>Promise 对象</h2><blockquote>
</blockquote>
<h3 id="Promise-的含义"><a href="#Promise-的含义" class="headerlink" title="Promise 的含义"></a>Promise 的含义</h3><p>Promise 是异步编程的一种解决方案，比传统的解决方案——回调函数和事件——更合理和更强大。它由社区最早提出和实现，ES6 将其写进了语言标准，统一了用法，原生提供了<code>Promise</code>对象。</p>
<p>所谓<code>Promise</code>，简单说就是一个容器，里面保存着某个未来才会结束的事件（通常是一个异步操作）的结果。从语法上说，Promise 是一个对象，从它可以获取异步操作的消息。Promise 提供统一的 API，各种异步操作都可以用同样的方法进行处理。</p>
<p><code>Promise</code>对象有以下两个特点。</p>
<p>（1）对象的状态不受外界影响。<code>Promise</code>对象代表一个异步操作，有三种状态：<code>pending</code>（进行中）、<code>fulfilled</code>（已成功）和<code>rejected</code>（已失败）。只有异步操作的结果，可以决定当前是哪一种状态，任何其他操作都无法改变这个状态。这也是<code>Promise</code>这个名字的由来，它的英语意思就是“承诺”，表示其他手段无法改变。</p>
<p>（2）一旦状态改变，就不会再变，任何时候都可以得到这个结果。<code>Promise</code>对象的状态改变，只有两种可能：从<code>pending</code>变为<code>fulfilled</code>和从<code>pending</code>变为<code>rejected</code>。只要这两种情况发生，状态就凝固了，不会再变了，会一直保持这个结果，这时就称为 resolved（已定型）。如果改变已经发生了，你再对<code>Promise</code>对象添加回调函数，也会立即得到这个结果。这与事件（Event）完全不同，事件的特点是，如果你错过了它，再去监听，是得不到结果的。</p>
<p>注意，为了行文方便，本章后面的<code>resolved</code>统一只指<code>fulfilled</code>状态，不包含<code>rejected</code>状态。</p>
<p>有了<code>Promise</code>对象，就可以将异步操作以同步操作的流程表达出来，避免了层层嵌套的回调函数。此外，<code>Promise</code>对象提供统一的接口，使得控制异步操作更加容易。</p>
<p><code>Promise</code>也有一些缺点。首先，无法取消<code>Promise</code>，一旦新建它就会立即执行，无法中途取消。其次，如果不设置回调函数，<code>Promise</code>内部抛出的错误，不会反应到外部。第三，当处于<code>pending</code>状态时，无法得知目前进展到哪一个阶段（刚刚开始还是即将完成）。</p>
<p>如果某些事件不断地反复发生，一般来说，使用 <a href="https://nodejs.org/api/stream.html">Stream</a> 模式（node.js）是比部署<code>Promise</code>更好的选择。</p>
<h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">  <span class="comment">// ... some code</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="comment">/* 异步操作成功 */</span>)&#123;</span><br><span class="line">    <span class="title function_">resolve</span>(value);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>Promise</code>构造函数接受一个函数作为参数，该函数的两个参数分别是<code>resolve</code>和<code>reject</code>。它们是两个函数，由 JavaScript 引擎提供，不用自己部署。</p>
<p><code>resolve</code>函数的作用是，将<code>Promise</code>对象的状态从“未完成”变为“成功”（即从 pending 变为 resolved），在异步操作成功时调用，并将异步操作的结果，作为参数传递出去；<code>reject</code>函数的作用是，将<code>Promise</code>对象的状态从“未完成”变为“失败”（即从 pending 变为 rejected），在异步操作失败时调用，并将异步操作报出的错误，作为参数传递出去。</p>
<p><code>Promise</code>实例生成以后，可以用<code>then</code>方法分别指定<code>resolved</code>状态和<code>rejected</code>状态的回调函数。</p>
<p><code>then</code>方法可以接受两个回调函数作为参数。第一个回调函数是<code>Promise</code>对象的状态变为<code>resolved</code>时调用，第二个回调函数是<code>Promise</code>对象的状态变为<code>rejected</code>时调用。其中，第二个函数是可选的，不一定要提供。这两个函数都接受<code>Promise</code>对象传出的值作为参数。</p>
<p>下面是一个<code>Promise</code>对象的简单例子。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">timeout</span>(<span class="params">ms</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(resolve, ms, <span class="string">&quot;done&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">timeout</span>(<span class="number">100</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(value);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>上面代码中，<code>timeout</code>方法返回一个<code>Promise</code>实例，表示一段时间以后才会发生的结果。过了指定的时间（<code>ms</code>参数）以后，<code>Promise</code>实例的状态变为<code>resolved</code>，就会触发<code>then</code>方法绑定的回调函数。</p>
<h3 id="Promise-then-方法"><a href="#Promise-then-方法" class="headerlink" title="Promise-then 方法"></a>Promise-then 方法</h3><ul>
<li>then 方法执行完以后会返回一个新的 Promise 对象</li>
<li>如果是普通数据，那么它会把该数据包装为那个返回的 Promise 的 resolve 结果</li>
<li>如果你返回的数据就是一个 Promise 对象，那它就不做任何处理了</li>
</ul>
<h3 id="Promise-all"><a href="#Promise-all" class="headerlink" title="Promise.all"></a>Promise.all</h3><p>* Promise.all()方法用于将多个 Promise 实例，包装成一个新的 Promise 实例。</p>
<p>* 所有参数的状态都变成 fulfilled，res 的状态才会变成 fulfilled</p>
<h3 id="Promise-race"><a href="#Promise-race" class="headerlink" title="Promise.race"></a>Promise.race</h3><p>* Promise.race()方法同样是将多个 Promise 实例，包装成一个新的 Promise 实例。</p>
<p>* 参数之中有一个实例率先改变状态，res 的状态就跟着改变。那个率先改变的 Promise 实例的返回值，就传递给 p 的回调函数</p>
<h3 id="Promise-allSettled"><a href="#Promise-allSettled" class="headerlink" title="Promise.allSettled"></a>Promise.allSettled</h3><p>* Promise.allSettled()方法接受一组 Promise 实例作为参数，包装成一个新的 Promise 实例。</p>
<p>* 只有等到所有这些参数实例都返回结果，不管是 fulfilled 还是 rejected，包装实例才会结束。</p>
<h3 id="Promise-any"><a href="#Promise-any" class="headerlink" title="Promise.any"></a>Promise.any</h3><p>​ * Promise.any()方法。该方法接受一组 Promise 实例作为参数，包装成一个新的 Promise 实例返回。</p>
<p>​ * 只要参数实例有一个变成 fulfilled 状态，包装实例就会变成 fulfilled 状态；</p>
<h2 id="async-函数"><a href="#async-函数" class="headerlink" title="async 函数"></a>async 函数</h2><p><strong>Async 函数简化了 Promise 的调用，本质还是 Promise，有点类似 promise 的 then 方法</strong></p>
<p><strong>任何函数都可以被标记为 async 函数</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"> <span class="comment">// 具名函数：async function main() &#123;</span></span><br><span class="line">    <span class="comment">// 匿名函数：async function () &#123;&#125;</span></span><br><span class="line">    <span class="comment">// 箭头函数：async () =&gt; &#123;&#125;</span></span><br><span class="line">    <span class="comment">// 对象函数成员简写：</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// const user = &#123;</span></span><br><span class="line">    <span class="comment">//   sayHello: async function () &#123;&#125;</span></span><br><span class="line">    <span class="comment">//   sayHello: async () =&gt; &#123;&#125;</span></span><br><span class="line">注意对象里函数的简写  <span class="keyword">async</span>写在方法名的前面 其他的放在函数前即可</span><br><span class="line"> <span class="comment">//   async sayHello () &#123;&#125;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="async-函数-返回值"><a href="#async-函数-返回值" class="headerlink" title="async 函数-返回值"></a>async 函数-返回值</h3><ul>
<li>async 函数始终返回 Promise</li>
<li>async 函数的返回值<ul>
<li>如果是普通数据，则直接把它包装到 promise 对象中，数据就是 resolve 的结果</li>
<li>如果你返回的直接就是一个 promise 对象，则不作任何处理</li>
<li>如果你什么都没有反回，则返回一个空的 promise 对象</li>
</ul>
</li>
</ul>
<h3 id="await"><a href="#await" class="headerlink" title="await"></a>await</h3><p>await 代表等待的意思，就是等待后面的 promise 执行完返回后 在执行后续代码 ，相当于将后面的代码改成同步执行</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">ayrequest</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">request</span>(<span class="string">&quot;http://jsonplaceholder.typicode.com/users&quot;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>); <span class="comment">//此代码会等待上面代码返回后再执行</span></span><br><span class="line">  <span class="title function_">request</span>(<span class="string">&quot;http://jsonplaceholder.typicode.com/users&quot;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>); <span class="comment">// 此代码不会等待上面代码返回 ， 直接执行</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="async-函数-异常处理"><a href="#async-函数-异常处理" class="headerlink" title="async 函数-异常处理"></a>async 函数-异常处理</h3><p>跟推荐使用 try catch 语法来获取异常</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">ayrequest</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">request</span>(<span class="string">&quot;http://jsonplaceholder.typicode.com/users&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(<span class="string">&quot;http://jsonplaceholder.typicode.com/posts&quot;</span>);</span><br><span class="line">  <span class="comment">// 异常处理</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">request</span>(<span class="string">&quot;sdf://dsfsdfsdf.sdf.com/dsf&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;发送失败&quot;</span>, error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在-Vue-中使用-async-函数"><a href="#在-Vue-中使用-async-函数" class="headerlink" title="在 Vue 中使用 async 函数"></a>在 Vue 中使用 async 函数</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> created () &#123;</span><br><span class="line">    <span class="title function_">axios</span>(&#123;</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;http://jsonplaceholder.typicode.com/posts&#x27;</span></span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">    &#125;)</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h2 id="利用-Promise-aysnc-实现对原生-ajax-的封装"><a href="#利用-Promise-aysnc-实现对原生-ajax-的封装" class="headerlink" title="利用 Promise + aysnc 实现对原生 ajax 的封装"></a>利用 Promise + aysnc 实现对原生 ajax 的封装</h2><blockquote>
<p>这里利用 module 的 顶端可以直接使用 await 的特性</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">url</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 返回一个封装的 Promise</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span></span><br><span class="line"><span class="language-javascript">      xhr.<span class="title function_">addEventListener</span>(<span class="string">&quot;load&quot;</span>, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> reseult = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res.<span class="property">target</span>.<span class="property">response</span> || <span class="string">&quot;&#123;&#125;&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 成功resolve返回结果 状态变为 fulfilled （已成功）</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">resolve</span>(reseult);</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">      xhr.<span class="title function_">addEventListener</span>(<span class="string">&quot;error&quot;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 失败reject返回错误 状态变为 rejected （已失败）</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">reject</span>(err);</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">      xhr.<span class="title function_">open</span>(<span class="string">&quot;get&quot;</span>, url);</span></span><br><span class="line"><span class="language-javascript">      xhr.<span class="title function_">send</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 使用 await 等待 Promise的 返回值</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> res = <span class="keyword">await</span> <span class="title function_">get</span>(<span class="string">&quot;http://localhost:8848/getSysDB&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="使用-Promise-的注意事项"><a href="#使用-Promise-的注意事项" class="headerlink" title="使用 Promise 的注意事项"></a>使用 Promise 的注意事项</h2><h3 id="将多个-Promise-包装成一个-Promise-的方法-，都是并行执行"><a href="#将多个-Promise-包装成一个-Promise-的方法-，都是并行执行" class="headerlink" title="将多个 Promise 包装成一个 Promise 的方法 ，都是并行执行"></a>将多个 Promise 包装成一个 Promise 的方法 ，都是并行执行</h3><ul>
<li>Promise.all</li>
<li>Promise.race</li>
<li>Promise.allSettled</li>
<li>Promise.any</li>
</ul>
<p>这几个方法都用于将 Promise 实例作为参数，包装成一个新的 Promise 实例返回</p>
<p>这几个方法在执行的 Promise 时候，都是并行执行</p>
<p><strong>注意：如果有先执行完某个 Promise 在执行某个 Promise 的时候不可以这几种方法，需要改串行执行（一个执行完再执行另一个）</strong></p>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>js</tag>
        <tag>es6</tag>
      </tags>
  </entry>
  <entry>
    <title>React初始化项目</title>
    <url>/2021/11/21/React/React%E5%88%9D%E5%A7%8B%E5%8C%96%E9%A1%B9%E7%9B%AE/</url>
    <content><![CDATA[<h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npx create-react-app antd-demo</span><br></pre></td></tr></table></figure>

<h2 id="安装-antd"><a href="#安装-antd" class="headerlink" title="安装 antd"></a>安装 antd</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn add antd</span><br></pre></td></tr></table></figure>

<h3 id="高级配置"><a href="#高级配置" class="headerlink" title="高级配置"></a>高级配置</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn add -D babel-plugin-import react-app-rewired customize-cra less less-loader@5.0.0</span><br></pre></td></tr></table></figure>

<h4 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h4><p><a href="mailto:&#108;&#101;&#115;&#x73;&#x2d;&#x6c;&#x6f;&#x61;&#100;&#101;&#x72;&#x40;&#x35;&#x2e;&#x30;&#x2e;&#48;">&#108;&#101;&#115;&#x73;&#x2d;&#x6c;&#x6f;&#x61;&#100;&#101;&#x72;&#x40;&#x35;&#x2e;&#x30;&#x2e;&#48;</a> 下载 5.0.0 防止报错 TypeError: this.getOptions is not a function</p>
<h4 id="修改-peckage-json"><a href="#修改-peckage-json" class="headerlink" title="修改 peckage.json"></a>修改 peckage.json</h4><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;react-app-rewired start&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;react-app-rewired build&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;react-app-rewired test&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;eject&quot;</span><span class="punctuation">:</span> <span class="string">&quot;react-scripts eject&quot;</span></span><br><span class="line"> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<h4 id="新建-config-overrides-js-文件"><a href="#新建-config-overrides-js-文件" class="headerlink" title="新建 config-overrides.js 文件"></a>新建 config-overrides.js 文件</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; override, fixBabelImports, addLessLoader &#125; = <span class="built_in">require</span>(<span class="string">&quot;customize-cra&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">override</span>(</span><br><span class="line">  <span class="title function_">fixBabelImports</span>(<span class="string">&quot;import&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">libraryName</span>: <span class="string">&quot;antd&quot;</span>,</span><br><span class="line">    <span class="attr">libraryDirectory</span>: <span class="string">&quot;es&quot;</span>,</span><br><span class="line">    <span class="attr">style</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="title function_">addLessLoader</span>(&#123;</span><br><span class="line">    <span class="attr">javascriptEnabled</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 主题</span></span><br><span class="line">    <span class="attr">modifyVars</span>: &#123; <span class="string">&quot;@primary-color&quot;</span>: <span class="string">&quot;#3acea0&quot;</span> &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="router"><a href="#router" class="headerlink" title="router"></a>router</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn add react-router-dom</span><br></pre></td></tr></table></figure>

<h2 id="redux"><a href="#redux" class="headerlink" title="redux"></a>redux</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn add redux react-redux redux-thunk</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn add -D redux-devtools-extension</span><br></pre></td></tr></table></figure>

<h2 id="redux-router-代码"><a href="#redux-router-代码" class="headerlink" title="redux + router 代码"></a>redux + router 代码</h2><p>App.jsx</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span> <span class="keyword">as</span> <span class="title class_">Router</span>, <span class="title class_">Route</span>, <span class="title class_">Routes</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Main</span> <span class="keyword">from</span> <span class="string">&quot;./pages/Main&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Login</span> <span class="keyword">from</span> <span class="string">&quot;./pages/Login&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">NotFound</span> <span class="keyword">from</span> <span class="string">&quot;./pages/NotFound&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;./redux/store&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Provider</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">App</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Layout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Main</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Login</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;*&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">NotFound</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>React</category>
      </categories>
      <tags>
        <tag>antd</tag>
        <tag>redux</tag>
      </tags>
  </entry>
  <entry>
    <title>React学习理解</title>
    <url>/2020/12/24/React/React%E5%AD%A6%E4%B9%A0%E7%90%86%E8%A7%A3/</url>
    <content><![CDATA[<h2 id="表单"><a href="#表单" class="headerlink" title="表单"></a>表单</h2><h3 id="受控组件"><a href="#受控组件" class="headerlink" title="受控组件"></a>受控组件</h3><p>官方定义</p>
<blockquote>
<p>在 HTML 中，表单元素（如<code>&lt;input&gt;</code>、 <code>&lt;textarea&gt;</code> 和 <code>&lt;select&gt;</code>）通常自己维护 state，并根据用户输入进行更新。而在 React 中，可变&gt; 状态（mutable state）通常保存在组件的 state 属性中，并且只能通过使用 setState()来更新。</p>
<p>我们可以把两者结合起来，使 React 的 state 成为“唯一数据源”。渲染表单的 React 组件还控制着用户输入过程中表单发生的操作。被 React 以这种方式控制取值的表单输入元素就叫做“受控组件”。</p>
</blockquote>
<p>总结： 受控组件就相当与 Vue 中的 v-model</p>
<p>注意点：在受控组件上指定 value 的 prop 会阻止用户更改输入 ，value 设置为 undefined 或 null 了 用户可以自行输入</p>
<p>正确的方式是：</p>
<ul>
<li>有 value 的绑定，就得有对应的 onChange 或者 onInupt 通过 setState 修改 value</li>
<li>如果让用户自行输入数据值，而无需对变化做处理 ，可以使用<strong>非受控组件</strong></li>
</ul>
<h3 id="react-router-dom"><a href="#react-router-dom" class="headerlink" title="react-router-dom"></a>react-router-dom</h3><p>Route 放入 children 和 component 中的区别</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// children 中 home 通过 props 获取不到路由数据</span></span><br><span class="line">&lt;<span class="title class_">Route</span> path=<span class="string">&quot;/home&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Home</span> /&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">Route</span>&gt;</span><br><span class="line"><span class="comment">// component 中 home 通过 props 可以获取到路由数据</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/home&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Home&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>React</category>
      </categories>
      <tags>
        <tag>react</tag>
      </tags>
  </entry>
  <entry>
    <title>RegExp对象和string.replac方法</title>
    <url>/2018/12/04/js/RegExp%E5%AF%B9%E8%B1%A1%E5%92%8Cstring-replac%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<h2 id="RegExp-对象"><a href="#RegExp-对象" class="headerlink" title="RegExp 对象"></a>RegExp 对象</h2><p>RegExp 对象表示正则表达式，它是对字符串执行模式匹配的强大工具。</p>
<h3 id="创建-RegExp-对象的语法"><a href="#创建-RegExp-对象的语法" class="headerlink" title="创建 RegExp 对象的语法"></a>创建 RegExp 对象的语法</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">RegExp</span>(pattern, attributes);</span><br></pre></td></tr></table></figure>

<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><p>参数 <em>pattern</em> 是一个字符串，指定了正则表达式的模式或其他正则表达式。</p>
<p>参数 <em>attributes</em> 是一个可选的字符串，包含属性 “g”、”i” 和 “m”，分别用于指定全局匹配、区分大小写的匹配和多行匹配。ECMAScript 标准化之前，不支持 m 属性。如果 <em>pattern</em> 是正则表达式，而不是字符串，则必须省略该参数。</p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;ig&quot;</span>); <span class="comment">//全局匹配不区分大小写的hello字符串</span></span><br></pre></td></tr></table></figure>

<h3 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h3><p>一个新的 RegExp 对象，具有指定的模式和标志。如果参数 <em>pattern</em> 是正则表达式而不是字符串，那么 RegExp() 构造函数将用与指定的 RegExp 相同的模式和标志创建一个新的 RegExp 对象。</p>
<p>如果不用 new 运算符，而将 RegExp() 作为函数调用，那么它的行为与用 new 运算符调用时一样，只是当 <em>pattern</em> 是正则表达式时，它只返回 _pattern_，而不再创建一个新的 RegExp 对象。</p>
<h3 id="抛出"><a href="#抛出" class="headerlink" title="抛出"></a>抛出</h3><p>SyntaxError - 如果 <em>pattern</em> 不是合法的正则表达式，或 <em>attributes</em> 含有 “g”、”i” 和 “m” 之外的字符，抛出该异常。</p>
<p>TypeError - 如果 <em>pattern</em> 是 RegExp 对象，但没有省略 <em>attributes</em> 参数，抛出该异常。</p>
<h3 id="支持正则表达式的-String-对象的方法"><a href="#支持正则表达式的-String-对象的方法" class="headerlink" title="支持正则表达式的 String 对象的方法"></a>支持正则表达式的 String 对象的方法</h3><table>
<thead>
<tr>
<th align="center"><a href="https://www.w3school.com.cn/jsref/jsref_search.asp">search</a></th>
<th align="center">检索与正则表达式相匹配的值。</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><a href="https://www.w3school.com.cn/jsref/jsref_match.asp">match</a></td>
<td align="center">找到一个或多个正则表达式的匹配。</td>
</tr>
<tr>
<td align="center"><a href="https://www.w3school.com.cn/jsref/jsref_replace.asp">replace</a></td>
<td align="center">替换与正则表达式匹配的子串。</td>
</tr>
<tr>
<td align="center"><a href="https://www.w3school.com.cn/jsref/jsref_split.asp">split</a></td>
<td align="center">把字符串分割为字符串数组。</td>
</tr>
</tbody></table>
<h2 id="String-replace-方法"><a href="#String-replace-方法" class="headerlink" title="String.replace() 方法"></a>String.replace() 方法</h2><h3 id="定义和用法"><a href="#定义和用法" class="headerlink" title="定义和用法"></a>定义和用法</h3><p>replace() 方法用于在字符串中用一些字符替换另一些字符，或替换一个与正则表达式匹配的子串。</p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">stringObject.<span class="title function_">replace</span>(regexp / substr, replacement);</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">regexp&#x2F;substr</td>
<td align="left">必需。规定子字符串或要替换的模式的 RegExp 对象。请注意，如果该值是一个字符串，则将它作为要检索的直接量文本模式，而不是首先被转换为 RegExp 对象。</td>
</tr>
<tr>
<td align="left">replacement</td>
<td align="left">必需。一个字符串值。规定了替换文本或生成替换文本的函数。</td>
</tr>
</tbody></table>
<h3 id="返回值-1"><a href="#返回值-1" class="headerlink" title="返回值"></a>返回值</h3><p>一个新的字符串，是用 <em>replacement</em> 替换了 regexp 的第一次匹配或所有匹配之后得到的。</p>
<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>字符串 stringObject 的 replace() 方法执行的是查找并替换的操作。它将在 stringObject 中查找与 regexp 相匹配的子字符串，然后用 <em>replacement</em> 来替换这些子串。如果 regexp 具有全局标志 g，那么 replace() 方法将替换所有匹配的子串。否则，它只替换第一个匹配子串。</p>
<p><em>replacement</em> 可以是字符串，也可以是函数。如果它是字符串，那么每个匹配都将由字符串替换。但是 replacement 中的 $ 字符具有特定的含义。如下表所示，它说明从模式匹配得到的字符串将用于替换。</p>
<p><strong>注意：</strong>ECMAScript v3 规定，replace() 方法的参数 replacement 可以是函数而不是字符串。在这种情况下，每个匹配都调用该函数，它返回的字符串将作为替换文本使用。该函数的第一个参数是匹配模式的字符串。接下来的参数是与模式中的子表达式匹配的字符串，可以有 0 个或多个这样的参数。接下来的参数是一个整数，声明了匹配在 stringObject 中出现的位置。最后一个参数是 stringObject 本身。</p>
<table>
<thead>
<tr>
<th align="left">字符</th>
<th align="left">替换文本</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>$1</code>、 <code>$2</code>、…、$99</td>
<td align="left">与 regexp 中的第 1 到第 99 个子表达式相匹配的文本。</td>
</tr>
<tr>
<td align="left">$&amp;</td>
<td align="left">与 regexp 相匹配的子串。</td>
</tr>
<tr>
<td align="left">$&#96;</td>
<td align="left">位于匹配子串左侧的文本。</td>
</tr>
<tr>
<td align="left">$‘</td>
<td align="left">位于匹配子串右侧的文本。</td>
</tr>
<tr>
<td align="left">$$</td>
<td align="left">直接量符号。</td>
</tr>
</tbody></table>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><h4 id="例子-1"><a href="#例子-1" class="headerlink" title="例子 1"></a>例子 1</h4><p>在本例中，我们将使用 “W3School” 替换字符串中的 “Microsoft”：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">  <span class="keyword">var</span> str=<span class="string">&quot;Visit Microsoft!&quot;</span> <span class="variable language_">document</span>.<span class="title function_">write</span>(str.<span class="title function_">replace</span>(<span class="regexp">/Microsoft/</span>,</span><br><span class="line">  <span class="string">&quot;W3School&quot;</span>))</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Visit</span> W3School!</span><br></pre></td></tr></table></figure>

<h4 id="例子-2"><a href="#例子-2" class="headerlink" title="例子 2"></a>例子 2</h4><p>在本例中，我们将执行一次全局替换，每当 “Microsoft” 被找到，它就被替换为 “W3School”：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">  <span class="keyword">var</span> str=<span class="string">&quot;Welcome to Microsoft! &quot;</span> str=str + <span class="string">&quot;We are proud to announce that</span></span><br><span class="line"><span class="string">  Microsoft has &quot;</span> str=str + <span class="string">&quot;one of the largest Web Developers sites in the</span></span><br><span class="line"><span class="string">  world.&quot;</span> <span class="variable language_">document</span>.<span class="title function_">write</span>(str.<span class="title function_">replace</span>(<span class="regexp">/Microsoft/g</span>, <span class="string">&quot;W3School&quot;</span>))</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Welcome</span> to W3School! <span class="title class_">We</span> are proud to announce that W3School</span><br><span class="line">has one <span class="keyword">of</span> the largest <span class="title class_">Web</span> <span class="title class_">Developers</span> sites <span class="keyword">in</span> the world.</span><br></pre></td></tr></table></figure>

<h4 id="例子-3"><a href="#例子-3" class="headerlink" title="例子 3"></a>例子 3</h4><p>您可以使用本例提供的代码来确保匹配字符串大写字符的正确：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">text = <span class="string">&quot;javascript Tutorial&quot;</span>;</span><br><span class="line">text.<span class="title function_">replace</span>(<span class="regexp">/javascript/i</span>, <span class="string">&quot;JavaScript&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="例子-4"><a href="#例子-4" class="headerlink" title="例子 4"></a>例子 4</h4><p>在本例中，我们将把 “Doe, John” 转换为 “John Doe” 的形式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">name = <span class="string">&quot;Doe, John&quot;</span>;</span><br><span class="line">name.<span class="title function_">replace</span>(<span class="regexp">/(\w+)\s*, \s*(\w+)/</span>, <span class="string">&quot;$2 $1&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="例子-5"><a href="#例子-5" class="headerlink" title="例子 5"></a>例子 5</h4><p>在本例中，我们将把所有的花引号替换为直引号：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">name = <span class="string">&#x27;&quot;a&quot;, &quot;b&quot;&#x27;</span>;</span><br><span class="line">name.<span class="title function_">replace</span>(<span class="regexp">/&quot;([^&quot;]*)&quot;/g</span>, <span class="string">&quot;&#x27;$1&#x27;&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="例子-6"><a href="#例子-6" class="headerlink" title="例子 6"></a>例子 6</h4><p>在本例中，我们将把字符串中所有单词的首字母都转换为大写：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">name = <span class="string">&quot;aaa bbb ccc&quot;</span>;</span><br><span class="line">uw = name.<span class="title function_">replace</span>(<span class="regexp">/\b\w+\b/g</span>, <span class="keyword">function</span> (<span class="params">word</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> word.<span class="title function_">substring</span>(<span class="number">0</span>, <span class="number">1</span>).<span class="title function_">toUpperCase</span>() + word.<span class="title function_">substring</span>(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>TypeScript常见问题汇总</title>
    <url>/2022/03/11/TypeScript/TypeScript%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h2 id="理解-type-Record-lt-K-extends-keyof-any-T-gt-P-in-K-T"><a href="#理解-type-Record-lt-K-extends-keyof-any-T-gt-P-in-K-T" class="headerlink" title="理解 type Record&lt;K extends keyof any, T&gt; = { [P in K]: T; }"></a>理解 <code>type Record&lt;K extends keyof any, T&gt; = &#123; [P in K]: T; &#125;</code></h2><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// type KEY = keyof any //即 string | number | symbol</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Record</span>&lt;K <span class="keyword">extends</span> keyof <span class="built_in">any</span>, T&gt; = &#123;</span><br><span class="line">    <span class="comment">// [P in K]的意思是对象的key可以取 string，number，symbol.</span></span><br><span class="line">    [P <span class="keyword">in</span> K]: T;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 规定对象类型 key 为 string， value 为 boolean</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Classes</span> = <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">boolean</span>&gt;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>TypeScript</category>
      </categories>
      <tags>
        <tag>TypeScript</tag>
      </tags>
  </entry>
  <entry>
    <title>Typora使用技巧</title>
    <url>/2021/04/25/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/Typora%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/</url>
    <content><![CDATA[<p>typora，postman，vscode 等都是使用 electron 构建而成的桌面应用</p>
<p>这篇文章主要记录下 typora 日常使用中的技巧</p>
<h2 id="win-命令行添加-typora-直接打开-md-文档的方法"><a href="#win-命令行添加-typora-直接打开-md-文档的方法" class="headerlink" title="win 命令行添加 typora 直接打开 md 文档的方法"></a>win 命令行添加 typora 直接打开 md 文档的方法</h2><h3 id="添加-path-环境变量"><a href="#添加-path-环境变量" class="headerlink" title="添加 path 环境变量"></a>添加 path 环境变量</h3><figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">C:</span>\app\Typora\bin</span><br></pre></td></tr></table></figure>

<p>新版的 typora 没有 bin 目录 那就直接<code>C:\app\Typora</code></p>
<p>注意：添加环境变量后需要重启计算机</p>
<h2 id="通过修改注册表，在右键新建菜单中添加-typora"><a href="#通过修改注册表，在右键新建菜单中添加-typora" class="headerlink" title="通过修改注册表，在右键新建菜单中添加 typora"></a>通过修改注册表，在右键新建菜单中添加 typora</h2><ol>
<li>win+R 调出运行窗口，输入 regedit，弹出注册表窗口</li>
<li>在窗口的搜索栏中输入 Computer\HKEY_CLASSES_ROOT .md（有的可能是 计算机\HKEY_CLASSES_ROOT .md）,按回车，找到.md 项</li>
<li>点击.md,双击右栏的默认项，弹出编辑框后在“数值数据”框中输入“Typora.md”,点击确定</li>
<li>OpenWithProgids 查看是否有 \Typora.exe</li>
<li>点击.md，右键新建-&gt;项，取名“ShellNew”</li>
<li>点击 ShellNew，右键新建-&gt;字符串值，取名“NullFile”<br>至此，完成所有步骤，回到桌面刷新一下，右键新建菜单查看结果。</li>
</ol>
<p>总结：其实就是两步<br>（1）修改.md 的默认值<br>（2）添加 ShellNew，添加 NullFile</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20210427142049929.png" alt="image-20210427142049929"></p>
<blockquote>
<p>原文：<a href="https://blog.csdn.net/m0_46588308/article/details/105919561">https://blog.csdn.net/m0_46588308/article/details/105919561</a></p>
</blockquote>
]]></content>
      <categories>
        <category>工具使用</category>
      </categories>
      <tags>
        <tag>typora</tag>
        <tag>工具使用</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu 下几种软件安装的方法</title>
    <url>/2021/01/10/Linux/Ubuntu-%E4%B8%8B%E5%87%A0%E7%A7%8D%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E7%9A%84%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<h2 id="1、tar-gz-软件包的安装"><a href="#1、tar-gz-软件包的安装" class="headerlink" title="1、tar.gz 软件包的安装"></a><strong>1、tar.gz 软件包的安装</strong></h2><p><strong>1）解压 tar.gz 包</strong></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">tar</span> -zxvf nginx-<span class="number">1</span>.<span class="number">8</span>.<span class="number">1</span>.tar.gz -C /home/Desktop  # 将软件包名.tar.gz解压到指定的目录下</span><br></pre></td></tr></table></figure>

<p><strong>2）进入解压后的文件目录下</strong></p>
<p><strong>执行“.&#x2F;configure”命令为编译做好准备；</strong></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cd nginx</span><br><span class="line">sudo .<span class="regexp">/configure --prefix=/</span>opt<span class="regexp">/nginx  # 表示安装到/</span>opt目录下</span><br></pre></td></tr></table></figure>

<p><strong>3）执行“make”命令进行软件编译；</strong></p>
<p><strong>4）执行“make install”完成安装；</strong></p>
<p><strong>5）执行“make clean”删除安装时产生的临时文件。</strong></p>
<h2 id="2、-apt-get-安装方法"><a href="#2、-apt-get-安装方法" class="headerlink" title="2、 apt-get 安装方法"></a>2、 apt-get 安装方法</h2><p>ubuntu 默认的软件管理系统是 apt。apt 有很多国内软件源，推荐使用淘宝。</p>
<p>apt-get 的基本软件安装命令是:</p>
<p><strong>sudo apt-get install 软件名</strong></p>
<h2 id="3、-deb-包的安装方式"><a href="#3、-deb-包的安装方式" class="headerlink" title="3、 deb 包的安装方式"></a><strong>3、 deb 包的安装方式</strong></h2><p>deb 是 debian 系 Linux 的包管理方式，ubuntu 是属于 debian 系的 Linux 发行版，所以默认支持这种软件安装方式。<br>当下载到一个 deb 格式的软件后,在终端输入这个命令就能安装：</p>
<p><strong>sudo dpkg -i **软件名**.deb</strong></p>
<h2 id="4、二进制编译或者脚本安装方式"><a href="#4、二进制编译或者脚本安装方式" class="headerlink" title="4、二进制编译或者脚本安装方式"></a><strong>4、二进制编译或者脚本安装方式</strong></h2><p>github 上一般都会提供二进制源码或者脚本安装方式。<br>这类软件,你会在软件安装目录下发现类似后缀名的文件，如： .sh .py .run 等等,有的甚至连后缀名都没有,直接只有一个 INSTALL 文件。或者是一个其他什么的可执行文件。<br>对于这种软件,可尝试以下几种方式安装：</p>
<p>*在软件目录下输入: .&#x2F;软件名** **<br>或者 : sh 软件名.sh<br>或者: python 软件名.py**</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu 解压文件后名称乱码问题</title>
    <url>/2021/01/10/Linux/Ubuntu-%E8%A7%A3%E5%8E%8B%E6%96%87%E4%BB%B6%E5%90%8E%E5%90%8D%E7%A7%B0%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<p>由于中文的 Windows 使用的是 GBK 编码，而 Linux 默认使用 UTF-8 编码的，如果在 Windows 打包带中文文件的 zip 包，则这个 zip 包在 Linux 下面使用默认的归档管理器打开这个 zip 包的时候，中文文件名会显示乱码。</p>
<h2 id="解决方法-1："><a href="#解决方法-1：" class="headerlink" title="解决方法 1："></a>解决方法 1：</h2><p>使用 GBK 格式解压</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">unzip -O GBK *.zip</span><br></pre></td></tr></table></figure>

<h2 id="解决方法-2"><a href="#解决方法-2" class="headerlink" title="解决方法 2:"></a>解决方法 2:</h2><p>安装 p7zip-rar</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get install p7zip-rar</span><br><span class="line"><span class="built_in">export</span> LANG=zh_CN.GBK  		<span class="comment"># 临时在控制台修改环境为zh_CN.GBK，然后解压缩即可</span></span><br><span class="line">7za  x  需要解压的文件.zip</span><br><span class="line"><span class="built_in">export</span> LANG=zh_CN.utf-8 	<span class="comment"># 用完别忘了改回来</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>VScode常见问题汇总</title>
    <url>/2021/11/18/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/VScode%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h2 id="Remote-SSH-插件"><a href="#Remote-SSH-插件" class="headerlink" title="Remote-SSH 插件"></a>Remote-SSH 插件</h2><p><a href="https://blog.csdn.net/WindSunLike/article/details/103292922">文章地址</a></p>
<h3 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><p>如果报管道错误，可能是以下问题</p>
<p>你的Linux服务器的ssh配置有问题，通过修改配置测试是否解决问题。<br>删除在服务器上创建的“ .vscode-server”目录。这是在主目录中创建的隐藏目录（您可以使用“ ls -la”显示我相信的所有文件）。可能是一些不正确的数据被缓存在那里，因此删除目录将使您的情况更加整洁。删除后，可以尝试通过vscode上的remote-ssh重新连接。<br>如果还是不行，可以尝试重新使用ftp将本地公钥上传到Linux上，然后将其复制到authorized_keys文件中，设置权限，重启SSH服务器，重新连接</p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>在使用公钥第一次连接到Linux时候，可能会让你输入密码，连接完成后，会在你的用户.ssh目录中中生成一个文件known_hosts，这个目录中还有公钥和私钥id-rsa.pub和id-rsa，然后将公钥上传到服务器上，重新重复上面的复制到.ssh&#x2F;authorized_keys，并且重新设置权限，再重新尝试连接到Linux，就不需要再输入密码了</p>
]]></content>
      <categories>
        <category>工具使用</category>
      </categories>
      <tags>
        <tag>vscode</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue-cli4+HbuilderX打包android+ios应用</title>
    <url>/2021/03/25/Vue/Vue+HbuilderX%E6%89%93%E5%8C%85App%E5%BA%94%E7%94%A8/</url>
    <content><![CDATA[<h2 id="打包-vue-web-项目"><a href="#打包-vue-web-项目" class="headerlink" title="打包 vue web 项目"></a>打包 vue web 项目</h2><h3 id="1-修改-build-的配置"><a href="#1-修改-build-的配置" class="headerlink" title="1.修改 build 的配置"></a>1.修改 build 的配置</h3><p>在 vue-cli(4.x 版本)下，修改 vue.config.js, 如果没有就创建一个</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 选项...</span></span><br><span class="line">  <span class="attr">publicPath</span>: <span class="string">&quot;./&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="2-修改路由模式为-hash-模式"><a href="#2-修改路由模式为-hash-模式" class="headerlink" title="2.修改路由模式为 hash 模式"></a>2.修改路由模式为 hash 模式</h3><p>如果使用了路由并且路由模式为 history 模式的话，需要改为 hash 模式</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> <span class="title class_">VueRouter</span>(&#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;hash&quot;</span>,</span><br><span class="line">  <span class="attr">base</span>: process.<span class="property">env</span>.<span class="property">BASE_URL</span>,</span><br><span class="line">  routes,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="3-打包"><a href="#3-打包" class="headerlink" title="3.打包"></a>3.打包</h3><p>运行 npm run build</p>
<p>打包后会生成 dist 目录， dist 目录之后会用到</p>
<h2 id="使用-hbuildx-打包成-App"><a href="#使用-hbuildx-打包成-App" class="headerlink" title="使用 hbuildx 打包成 App"></a>使用 hbuildx 打包成 App</h2><h3 id="1-先在-dcloud-注册个开发者账号："><a href="#1-先在-dcloud-注册个开发者账号：" class="headerlink" title="1.先在 dcloud 注册个开发者账号："></a>1.先在 dcloud 注册个开发者账号：</h3><p><a href="https://dev.dcloud.net.cn/">https://dev.dcloud.net.cn/</a></p>
<h3 id="2-下载-hubilderx-App-开发版本"><a href="#2-下载-hubilderx-App-开发版本" class="headerlink" title="2.下载 hubilderx App 开发版本"></a>2.下载 hubilderx App 开发版本</h3><p>（<a href="https://www.dcloud.io/hbuilderx.html%EF%BC%89%EF%BC%8C%E6%89%93%E5%BC%80hbuilderx%EF%BC%8C%E7%82%B9%E5%87%BB%E5%B7%A6%E4%B8%8B%E8%A7%92%E7%99%BB%E5%BD%95%E8%B4%A6%E5%8F%B7%E3%80%82">https://www.dcloud.io/hbuilderx.html），打开hbuilderx，点击左下角登录账号。</a></p>
<h3 id="3-新建-h5-App-项目："><a href="#3-新建-h5-App-项目：" class="headerlink" title="3.新建 h5+ App 项目："></a>3.新建 h5+ App 项目：</h3><p>文件-&gt;新建-&gt;项目</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/20211022101926.png" alt="image-20211022101917225"></p>
<h3 id="4-将-dist-目录和新建的项目合并"><a href="#4-将-dist-目录和新建的项目合并" class="headerlink" title="4.将 dist 目录和新建的项目合并"></a>4.将 dist 目录和新建的项目合并</h3><p>删除 myApp 项目里面的 css、img、js 文件夹；将打包后的 vue 静态资源文件夹 dist 里面的文件拷贝进 app 项目里：</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/20211022102250.png" alt="image-20211022102250128"></p>
<h3 id="5-修改-app-的配置文件-mainfest-json"><a href="#5-修改-app-的配置文件-mainfest-json" class="headerlink" title="5.修改 app 的配置文件 mainfest.json"></a>5.修改 app 的配置文件 mainfest.json</h3><p><img data-src="https://bitbw.top/public/img/my_gallery/20211022102642.png" alt="image-20211022102642627"></p>
<h4 id="可选配置"><a href="#可选配置" class="headerlink" title="可选配置"></a>可选配置</h4><p>图标配置<br>安装到手机上后显示的 app 图标。可以选择一个分辨率较大的图片，然后点击自动生成所有图标并配置。</p>
<p>启动图配置<br>取消勾选：启动界面显示等待雪花</p>
<p>SDK 配置<br>根据 app 项目需求，选择相应的第三方 SDK（一般需要去相应的 SDK 官网申请 key）</p>
<p>模块权限配置<br>app 需要用到的权限，会询问用户打开这些权限。勾选相应的权限模块即可。</p>
<h3 id="6-云打包-Android-app"><a href="#6-云打包-Android-app" class="headerlink" title="6.云打包 Android app"></a>6.云打包 Android app</h3><p>选中需要打包的项目名，点击工具栏的“发行”，选择”原生 App-云打包“.</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/20211022103310.png" alt="image-20211022103310806"></p>
<p>在弹出的框中，选择”使用 DCloud 公用证书“（也可以使用自有证书，需要查看官网说明），取消勾选 ”广告联盟“ 和 ”换量联盟“，点击最底部的”打包“按钮：</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/20211022103342.png" alt="image-20211022103342804"></p>
<p>打包完成后打开文件位置 就可以看到生成的 apk 安卓安装文件了</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/20211022105826.png" alt="image-20211022105826098"></p>
<h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><p>因为是使用云打包需要排队，具体时间无法确定</p>
<h3 id="7-调试"><a href="#7-调试" class="headerlink" title="7.调试"></a>7.调试</h3><p>调试需要手机打开开发者模式通过 usb 连接电脑</p>
<p>运行-》运行到手机或模拟器 -》调试控制台</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/20211022104006.png" alt="image-20211022104005852"></p>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>HbuilderX</tag>
        <tag>android</tag>
        <tag>ios</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3学习理解</title>
    <url>/2020/12/24/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%90%86%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="vue3-新特性"><a href="#vue3-新特性" class="headerlink" title="vue3 新特性"></a>vue3 新特性</h1><blockquote>
<p>整理的比较好的文档：<a href="https://www.jianshu.com/p/1fd73091e2e4">https://www.jianshu.com/p/1fd73091e2e4</a></p>
</blockquote>
<p>直接看代码可以直接看 <a href="#demo" title=" Vue3 + TypeScript ">实践 demo</a></p>
<h2 id="组合式-API"><a href="#组合式-API" class="headerlink" title="组合式 API"></a>组合式 API</h2><p>vue3 中加入了组合式 ，这个功能的作用是将单个 vue 组件的，逻辑部分也能自由拆分组合，更深层次的实现解耦和高复用性</p>
<p>vue2 如果单个 vue 文件逻辑部分过大 ，我们往往 需要单独用一个 js 文件或 ts 文件存放 逻辑（函数）并且为了使用 vue 组件上的响应式属性不得不将 vue 实例传进这个函数中，总有一种怪怪的感觉；</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// vue2  单独存放逻辑的文件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">handle</span>(<span class="params">vue,xx</span>)&#123;</span><br><span class="line">    vue.<span class="property">yy</span> = xx ;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="响应式的改变"><a href="#响应式的改变" class="headerlink" title="响应式的改变"></a>响应式的改变</h2><blockquote>
<p>响应式转换是“深层”的——它影响所有嵌套 property。在基于 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy">ES2015 Proxy</a> 的实现中，返回的 proxy 是<strong>不</strong>等于原始对象的。建议只使用响应式 proxy，避免依赖原始对象。</p>
</blockquote>
<ul>
<li>ref 可以用于创建所有数据类型的响应式数据 需要.value 访问 （对象类型数据配合 reactive 使用）</li>
<li>reactive 只能用于创建对象数据类型的相应式数据 不需要.value 就直接可以访问 深度响应</li>
<li>toRefs 用于给 prop 添加响应数据，需要.value 访问</li>
</ul>
<h3 id="基础-api"><a href="#基础-api" class="headerlink" title="基础 api"></a>基础 api</h3><h4 id="reactive"><a href="#reactive" class="headerlink" title="reactive"></a>reactive</h4><p>返回对象的响应式副本</p>
<p>使用:</p>
<blockquote>
<p>可以直接给对象添加任何属性都是响应式的 ，但不能直接赋值对象</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> person = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;zhangshan&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 有效</span></span><br><span class="line">person.<span class="property">sex</span> = <span class="string">&quot;男&quot;</span>;</span><br><span class="line"><span class="comment">// 无效</span></span><br><span class="line">person = &#123; ...person, ...&#123; <span class="attr">sex</span>: <span class="string">&quot;男&quot;</span> &#125; &#125;;</span><br></pre></td></tr></table></figure>

<h4 id="isReactive"><a href="#isReactive" class="headerlink" title="isReactive"></a>isReactive</h4><p>检查对象是否是 reactive 创建的响应式 proxy。</p>
<h4 id="readonly"><a href="#readonly" class="headerlink" title="readonly"></a>readonly</h4><p>除了只读以外跟 reactive 一样，但只读也代表了响应式没有意义了</p>
<h4 id="isReadonly"><a href="#isReadonly" class="headerlink" title="isReadonly"></a>isReadonly</h4><p>检查对象是否是由 readonly 创建的只读 prox</p>
<h4 id="shallowReactive-和-shallowReadonly"><a href="#shallowReactive-和-shallowReadonly" class="headerlink" title="shallowReactive 和 shallowReadonly"></a>shallowReactive 和 shallowReadonly</h4><p>与上面的差别就是指对第一层属性响应，再深度的则不响应</p>
<h4 id="isProxy"><a href="#isProxy" class="headerlink" title="isProxy"></a>isProxy</h4><p>检查对象是否是由 reactive 或 readonly 创建的 proxy。</p>
<h3 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h3><h4 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h4><blockquote>
<p>接受一个内部值并返回一个响应式且可变的 ref 对象。ref 对象具有指向内部值的单个 property <code>.value</code>。</p>
<p>也就是相当于解决了 reactive 只能作用对象类型，和只能添加属性不能直接修改对象的不足</p>
<p>对象类型数据配合 reactive 使用</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(count.<span class="property">value</span>); <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line">count.<span class="property">value</span>++;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(count.<span class="property">value</span>); <span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 对象类型</span></span><br><span class="line"><span class="keyword">let</span> person = <span class="title function_">ref</span>(</span><br><span class="line">  <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;zhangshan&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line">person.<span class="property">value</span> = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;lisi&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">28</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="unref"><a href="#unref" class="headerlink" title="unref"></a>unref</h4><p>返回使用 ref 响应数据的 value （不是原始数据）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> flag = <span class="title function_">ref</span>(</span><br><span class="line">  <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">number</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;flag&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line">flag.<span class="property">value</span>.<span class="property">number</span>++;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">  <span class="title function_">unref</span>(flag),</span><br><span class="line">  <span class="string">&quot;unref(flag) === flag.value&quot;</span>,</span><br><span class="line">  <span class="title function_">unref</span>(flag) === flag.<span class="property">value</span></span><br><span class="line">); <span class="comment">// 1 true</span></span><br></pre></td></tr></table></figure>

<h3 id="setup（组合式的核心）"><a href="#setup（组合式的核心）" class="headerlink" title="setup（组合式的核心）"></a>setup（组合式的核心）</h3><h4 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h4><blockquote>
<p>个人理解 :setup 相当于一个盒子 （组合式的核心） ，将<code>methods</code>、<code>watch</code>、<code>computed</code>、<code>data</code>的数据都在这里进行组合</p>
<p>而<code>methods</code>、<code>watch</code>、<code>computed</code>、<code>data</code> 的数据，可以分别用不同的 js 文件生成，再导入到 vue 当文件组件中，或 setup 所在文件中</p>
</blockquote>
<blockquote>
<p>在 Vue3 中，定义 <code>methods</code>、<code>watch</code>、<code>computed</code>、<code>data</code>数据 等都放在了 <code>setup()</code> 函数中 ，(实现了逻辑的拆分)</p>
<p><a href="https://v3.cn.vuejs.org/guide/composition-api-introduction.html#setup-%E7%BB%84%E4%BB%B6%E9%80%89%E9%A1%B9">官网地址</a></p>
</blockquote>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p>setup 方法接收两个参数 ：</p>
<ul>
<li>prop</li>
<li>context 上下文对象也就是 this （当前 vue 实例）</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, onMounted, watch, toRefs, computed &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">components</span>: &#123; <span class="title class_">RepositoriesFilters</span>, <span class="title class_">RepositoriesSortBy</span>, <span class="title class_">RepositoriesList</span> &#125;,</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">user</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="comment">// 使用 `toRefs` 创建对 props 中的 `user` property 的响应式引用</span></span><br><span class="line">    <span class="keyword">const</span> &#123; user &#125; = <span class="title function_">toRefs</span>(props);</span><br><span class="line">    <span class="keyword">const</span> repositories = <span class="title function_">ref</span>([]);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(props); <span class="comment">// &#123; user: &#x27;&#x27; &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;; <span class="comment">// 这里返回的任何内容都可以用于组件的其余部分</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 组件的“其余部分”</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>更多用法详见：<a href="###setup.ts">setup.ts</a></p>
<h3 id="setup-语法糖-lt-scritp-setup-gt"><a href="#setup-语法糖-lt-scritp-setup-gt" class="headerlink" title="setup 语法糖 &lt;scritp setup&gt;"></a>setup 语法糖<code> &lt;scritp setup&gt;</code></h3><p>可以使用<code>&lt;script setup&gt;</code> 标签 代替 setup（）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">inc</span> = (<span class="params"></span>) =&gt; count.<span class="property">value</span>++;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      count,</span><br><span class="line">      inc,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>以上代码可以写成下面的代码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;button @click=&quot;inc&quot;&gt;&#123;&#123; count &#125;&#125;&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &quot;vue&quot;;</span><br><span class="line"></span><br><span class="line">export const count = ref(0);</span><br><span class="line">export const inc = () =&gt; count.value++;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="使用限制："><a href="#使用限制：" class="headerlink" title="使用限制："></a>使用限制：</h4><blockquote>
<p>由于模块执行语义的不同，内部代码<code>&lt;script setup&gt;</code>依赖于 SFC 的上下文。当移至外部<code>.js</code>或<code>.ts</code>文件中时，可能会给开发人员和工具带来混乱。因此，**<code>&lt;script setup&gt;</code>**不能与该<code>src</code>属性一起使用。</p>
</blockquote>
<p><strong>个人感觉比较麻烦 还不如正常的使用 setup</strong></p>
<h2 id="Global-API-全局-API"><a href="#Global-API-全局-API" class="headerlink" title="Global API 全局 API"></a>Global API 全局 API</h2><h3 id="createApp-创建整个应用的实例"><a href="#createApp-创建整个应用的实例" class="headerlink" title="createApp 创建整个应用的实例"></a><code>createApp</code> 创建整个应用的实例</h3><blockquote>
<p>3.x 添加<code>createApp</code> 方法用来创建应用的根 防止数据间的相互污染 <a href="https://v3.cn.vuejs.org/guide/migration/global-api.html#%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E5%85%A8%E5%B1%80-api-createapp">官方文档地址</a></p>
</blockquote>
<p>应用实例暴露当前全局 API 的子集，经验法则是，任何全局改变 Vue 行为的 API 现在都会移动到应用实例上，以下是当前全局 API 及其相应实例 API 的表：</p>
<table>
<thead>
<tr>
<th>2.x 全局 API</th>
<th>3.x 实例 API (<code>app</code>)</th>
</tr>
</thead>
<tbody><tr>
<td>Vue.config</td>
<td>app.config</td>
</tr>
<tr>
<td>Vue.config.productionTip</td>
<td><em>removed</em> (<a href="https://v3.cn.vuejs.org/guide/migration/global-api.html#config-productiontip-removed">见下方</a>)</td>
</tr>
<tr>
<td>Vue.config.ignoredElements</td>
<td>app.config.isCustomElement (<a href="https://v3.cn.vuejs.org/guide/migration/global-api.html#config-ignoredelements-is-now-config-iscustomelement">见下方</a>)</td>
</tr>
<tr>
<td>Vue.component</td>
<td>app.component</td>
</tr>
<tr>
<td>Vue.directive</td>
<td>app.directive</td>
</tr>
<tr>
<td>Vue.mixin</td>
<td>app.mixin</td>
</tr>
<tr>
<td>Vue.use</td>
<td>app.use (<a href="https://v3.cn.vuejs.org/guide/migration/global-api.html#a-note-for-plugin-authors">见下方</a>)</td>
</tr>
<tr>
<td>Vue.prototype</td>
<td>app.config.globalProperties (<a href="https://v3.cn.vuejs.org/guide/migration/global-api.html#vue-prototype-replaced-by-config-globalproperties">见下方</a>)</td>
</tr>
</tbody></table>
<p>所有其他不全局改变行为的全局 API 现在被命名为 exports，文档见<a href="https://v3.cn.vuejs.org/guide/migration/global-api-treeshaking.html">全局 API Treeshaking</a>。</p>
<h3 id="全局-API-Treeshaking-将一部分-xxx-和-指令-按需导入使用"><a href="#全局-API-Treeshaking-将一部分-xxx-和-指令-按需导入使用" class="headerlink" title="全局 API Treeshaking 将一部分$xxx 和 指令 按需导入使用"></a>全局 API Treeshaking 将一部分$xxx 和 指令 按需导入使用</h3><blockquote>
<p>Vue.nextTick() 将废弃 使用 导入方式如下</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; nextTick &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 一些和DOM有关的东西</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>使用 render 语法中 可以使用如下 api 按需导入</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; h, <span class="title class_">Transition</span>, withDirectives, vShow &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">h</span>(<span class="title class_">Transition</span>, [<span class="title function_">withDirectives</span>(<span class="title function_">h</span>(<span class="string">&quot;div&quot;</span>, <span class="string">&quot;hello&quot;</span>), [[vShow, <span class="variable language_">this</span>.<span class="property">ok</span>]])]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="teleport-指定标签父节点"><a href="#teleport-指定标签父节点" class="headerlink" title="teleport 指定标签父节点"></a>teleport 指定标签父节点</h2><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><blockquote>
<p>teleport 可以将组件生成的 dom 节点 ，转移到其他 dom 下作为其子节点</p>
<p>让我们修改 <code>modal-button</code> 以使用 <code>&lt;teleport&gt;</code>，并告诉 Vue “<strong>Teleport</strong> 这个 HTML <strong>到</strong>该‘<strong>body</strong>’标签”。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">app.component(&#x27;modal-button&#x27;, &#123; template: `</span><br><span class="line">&lt;button @click=&quot;modalOpen = true&quot;&gt;</span><br><span class="line">        Open full screen modal! (With teleport!)</span><br><span class="line">    &lt;/button&gt;</span><br><span class="line"></span><br><span class="line">&lt;teleport to=&quot;body&quot;&gt;								// teleport 的 to属性就是作为哪个dom的字节的</span><br><span class="line">      &lt;div v-if=&quot;modalOpen&quot; class=&quot;modal&quot;&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          I&#x27;m a teleported modal! </span><br><span class="line">          (My parent is &quot;body&quot;)</span><br><span class="line">          &lt;button @click=&quot;modalOpen = false&quot;&gt;</span><br><span class="line">            Close</span><br><span class="line">          &lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/teleport&gt;</span><br><span class="line">`, data() &#123; return &#123; modalOpen: false &#125; &#125; &#125;)</span><br></pre></td></tr></table></figure>

<h4 id="Props："><a href="#Props：" class="headerlink" title="Props："></a>Props：</h4><ul>
<li><code>to</code> - <code>string</code>。需要 prop，必须是有效的查询选择器（独一无二的类名或 id 或属性）或 <code>HTMLElement</code> (如果在浏览器环境中使用)。指定将在其中移动 <code>&lt;teleport&gt;</code> 内容的目标元素</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 正确 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">teleport</span> <span class="attr">to</span>=<span class="string">&quot;#some-id&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">teleport</span> <span class="attr">to</span>=<span class="string">&quot;.some-class&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">teleport</span> <span class="attr">to</span>=<span class="string">&quot;[data-teleport]&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 错误 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">teleport</span> <span class="attr">to</span>=<span class="string">&quot;h1&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">teleport</span> <span class="attr">to</span>=<span class="string">&quot;some-string&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>disabled</code> - <code>boolean</code>。此可选属性可用于禁用 <code>&lt;teleport&gt;</code> 的功能，这意味着其插槽内容将不会移动到任何位置，而是在您在周围父组件中指定了 <code>&lt;teleport&gt;</code> 的位置渲染。</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">teleport</span> <span class="attr">to</span>=<span class="string">&quot;#popup&quot;</span> <span class="attr">:disabled</span>=<span class="string">&quot;displayVideoInline&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">video</span> <span class="attr">src</span>=<span class="string">&quot;./my-movie.mp4&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">teleport</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>请注意，这将移动实际的 DOM 节点，而不是被销毁和重新创建，并且它还将保持任何组件实例的活动状态。所有有状态的 HTML 元素 (即播放的视频) 都将保持其状态。</p>
<h2 id="片段（支持多根节点）"><a href="#片段（支持多根节点）" class="headerlink" title="片段（支持多根节点）"></a>片段（支持多根节点）</h2><p>Vue 3 现在正式支持了多根节点的组件，也就是片段！</p>
<p>在 3.x 中，组件可以包含多个根节点！但是，这要求开发者显式定义 attribute 应该分布在哪里。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Layout.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">header</span>&gt;</span>...<span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">main</span> <span class="attr">v-bind</span>=<span class="string">&quot;$attrs&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">footer</span>&gt;</span>...<span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>因为 2.x 只有一个根节点 $attrs 就会绑定到根节点上，现在3.x会有多个根节点，所以需要定义$attrs 需要绑定到到哪个节点上</p>
</blockquote>
<h2 id="v-model-的改变"><a href="#v-model-的改变" class="headerlink" title="v-model 的改变"></a><code>v-model</code> 的改变</h2><p>2.x 使用 input + value 实现 v-model , 3.x 里使用使用 <code>modelValue</code>（ 自己定义字段名与 update:后面的字段一致即可 ，默认值是<code>modelValue</code>） 作为 prop 和 <code>update:modelValue</code> 作为事件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.<span class="title function_">component</span>(<span class="string">&quot;my-component&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="title class_">String</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">emits</span>: [<span class="string">&quot;update:title&quot;</span>],</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`  &lt;input </span></span><br><span class="line"><span class="string">      type=&quot;text&quot;</span></span><br><span class="line"><span class="string">      :value=&quot;title&quot;</span></span><br><span class="line"><span class="string">      @input=&quot;$emit(&#x27;update:title&#x27;, $event.target.value)&quot;&gt;</span></span><br><span class="line"><span class="string">  `</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">my-component</span> <span class="attr">v-model:title</span>=<span class="string">&quot;bookTitle&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">my-component</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意点：v-model 后面需要加对应的 update 后的的字段名 习惯于 2.x 语法后 前几次会忘记加</p>
</blockquote>
<p>并且可以使用多个 v-model 只需要在 v-model 后面加上对应的 prop 字段名即可</p>
<h3 id="v-model-修饰符"><a href="#v-model-修饰符" class="headerlink" title="v-model 修饰符"></a><code>v-model</code> 修饰符</h3><p>在 2.x 中 v-model 的修饰符有.trim<code>、</code>.number<code>和</code>.lazy，</p>
<p>在 3.x 中我们可以自定义修饰符，比如 <code>v-model:title.capitalize=&quot;bar&quot;</code></p>
<p>在子组件中 prop 中 <code>titleModifiers</code>中可以接收到 <code>capitalize：ture </code> 再做对应处理后</p>
<p>prop 中修饰符的属性名为 ： <code>arg + &quot;Modifiers&quot;</code>：（绑定 value 字段名 + “Modifiers”）</p>
<p>父组件</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">HelloWorld</span> <span class="attr">v-model:title.capitalize</span>=<span class="string">&quot;inputValue&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>子组件</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;title&quot;</span> @<span class="attr">input</span>=<span class="string">&quot;handleCapitalize&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//prop</span></span><br><span class="line"> <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">titleModifiers</span>: &#123; <span class="comment">//使用title + Modifiers 获取修饰符对象 &#123; capitalize:ture &#125;</span></span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Object</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="function">() =&gt;</span> (&#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"><span class="comment">// mothods</span></span><br><span class="line"><span class="title function_">handleCapitalize</span>(<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> value = event.<span class="property">target</span>.<span class="property">value</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">titleModifiers</span>.<span class="property">capitalize</span>) &#123; <span class="comment">// capitalize:ture</span></span><br><span class="line">    value = value.<span class="title function_">toLocaleUpperCase</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">this</span>.$emit(<span class="string">&quot;update:title&quot;</span>, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果<code>v-modle </code>使用默认值 <code>modelValue</code> 时，prop 修饰符对象使用 <code>modelModifiers</code> 作为属性名</p>
</blockquote>
<h2 id="单文件组件-style-中使用-script-中变量-实验性"><a href="#单文件组件-style-中使用-script-中变量-实验性" class="headerlink" title="单文件组件 style 中使用 script 中变量(实验性)"></a>单文件组件 style 中使用 script 中变量(实验性)</h2><blockquote>
<p><code>3.x</code> 单文件组件中 style 中可是使用当前<code>vue</code>实例的 data 数据</p>
<p>最新提议 <a href="https://github.com/vuejs/rfcs/pull/231">https://github.com/vuejs/rfcs/pull/231</a></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;text&quot;&gt;hello&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      color: &#x27;red&#x27;,						  // data中的变量在style中都可以使用 使用v-bind （11月10日最新提议）</span><br><span class="line">      font: &#123;								  // 之前的提议是 var(--变量名)</span><br><span class="line">        size: &#x27;2em&#x27;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.text &#123;</span><br><span class="line">  color: v-bind(color);</span><br><span class="line">  /* 使用对象.属性 包在&#x27;&#x27;引号中 */</span><br><span class="line">  font-size: v-bind(&quot;font.size&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="单文件组件样式作用域的变化"><a href="#单文件组件样式作用域的变化" class="headerlink" title="单文件组件样式作用域的变化"></a>单文件组件样式作用域的变化</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">/* deep (css选择器)  */</span><br><span class="line">::v-deep(.foo) &#123;&#125;</span><br><span class="line">/*可以在（）里写,  在sass less scss 等预编译器中可以写在 &#123;&#125; 中*/</span><br><span class="line">::v-deep() &#123;</span><br><span class="line">    .foo&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/* 简写 */</span><br><span class="line">:deep(.foo) &#123;&#125;</span><br><span class="line"></span><br><span class="line">/* 作用于插槽  给 slot 加对应 class=&quot;foo&quot; 就可以作用到插槽上*/</span><br><span class="line">::v-slotted(.foo) &#123;&#125;</span><br><span class="line">/* 简写 */</span><br><span class="line">:slotted(.foo) &#123;&#125;</span><br><span class="line"></span><br><span class="line">/* 在 scoped 中作用全局的样式 功能就 跟不加scoped一样 感觉有点脱裤子放屁的感觉 */</span><br><span class="line">::v-global(.foo) &#123;&#125;</span><br><span class="line">/* 简写 */</span><br><span class="line">:global(.foo) &#123;&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="tip-名词含义"><a href="#tip-名词含义" class="headerlink" title="tip 名词含义"></a>tip 名词含义</h2><ul>
<li><code>SFC</code> - 单文件组件</li>
</ul>
<h1 id="demo-Vue3-TypeScript"><a href="#demo-Vue3-TypeScript" class="headerlink" title="demo ( Vue3 + TypeScript )"></a>demo ( Vue3 + TypeScript )</h1><blockquote>
<p>直接使用 vue-cil 初始化 vue3 项目</p>
</blockquote>
<h3 id="Home-vue"><a href="#Home-vue" class="headerlink" title="Home.vue"></a>Home.vue</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;home&quot;&gt;</span><br><span class="line">    &lt;img alt=&quot;Vue logo&quot; src=&quot;../assets/logo.png&quot; /&gt;</span><br><span class="line">    &lt;HelloWorld v-model:title.capitalize=&quot;inputValue&quot;&gt;</span><br><span class="line">      &lt;p class=&quot;default-solt&quot;&gt;这里是默认插槽&lt;/p&gt;</span><br><span class="line">    &lt;/HelloWorld&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, defineComponent &#125; from &quot;vue&quot;; // 使用defineComponent创建vue实例</span><br><span class="line">import HelloWorld from &quot;@/components/HelloWorld.vue&quot;; // @ is an alias to /src</span><br><span class="line"></span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: &quot;Home&quot;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    HelloWorld,</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    console.log(&quot;created&quot;);</span><br><span class="line">  &#125;,</span><br><span class="line">  beforeCreate() &#123;</span><br><span class="line">    console.log(&quot;beforeCreate&quot;);</span><br><span class="line">  &#125;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    console.log(&quot;setup 在 created 之前&quot;);</span><br><span class="line">    const inputValue = ref(&quot;&quot;);</span><br><span class="line">    return &#123;</span><br><span class="line">      inputValue,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">// 等价于下面</span><br><span class="line">:deep(.skill) &#123;</span><br><span class="line">  color: skyblue;</span><br><span class="line">&#125;</span><br><span class="line">:deep() &#123;</span><br><span class="line">  .skill &#123;</span><br><span class="line">    color: skyblue;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 等价于不加 scoped</span><br><span class="line">:global(.modal) &#123;</span><br><span class="line">  &amp; &gt; div &#123;</span><br><span class="line">    color: skyblue !important;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="HelloWorld-vue"><a href="#HelloWorld-vue" class="headerlink" title="HelloWorld.vue"></a>HelloWorld.vue</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;hello&quot;&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;!-- 展示数据 --&gt;</span><br><span class="line">      &lt;div&gt;鼠标x轴:&#123;&#123; x &#125;&#125;&lt;/div&gt;</span><br><span class="line">      &lt;div&gt;鼠标y轴:&#123;&#123; y &#125;&#125;&lt;/div&gt;</span><br><span class="line">      &lt;span&gt;&#123;&#123; count &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;span&gt;双倍：&#123;&#123; doubelCount &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;button @click=&quot;count++&quot;&gt;Increment count&lt;/button&gt;</span><br><span class="line">      &lt;p&gt;</span><br><span class="line">        &lt;input type=&quot;text&quot; :value=&quot;title&quot; @input=&quot;handleCapitalize&quot; /&gt;</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">      &lt;p class=&quot;person&quot;&gt;</span><br><span class="line">        &lt;span&gt;姓名：&#123;&#123; person.name &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;span&gt;年龄：&#123;&#123; person.age &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">      &lt;p class=&quot;skill&quot;&gt;技能：敲代码&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 打开dialog按钮 --&gt;</span><br><span class="line">      &lt;button @click=&quot;modalOpen = true&quot;&gt;</span><br><span class="line">        Open full screen modal! (With teleport!)</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;!-- dialog --&gt;</span><br><span class="line">      &lt;teleport to=&quot;body&quot;&gt;</span><br><span class="line">        &lt;div v-show=&quot;modalOpen&quot; class=&quot;modal&quot;&gt;</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            I&#x27;m a teleported modal! (My parent is &quot;body&quot;)</span><br><span class="line">            &lt;button @click=&quot;modalOpen = false&quot;&gt;Close&lt;/button&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/teleport&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- 默认插槽 --&gt;</span><br><span class="line">    &lt;slot class=&quot;default-solt&quot;&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; setup &#125; from &quot;@/components/setup&quot;; // 直接导入 setup</span><br><span class="line">import &#123; defineComponent &#125; from &quot;vue&quot;;</span><br><span class="line"></span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: &quot;HelloWorld&quot;,</span><br><span class="line">  emits: [&quot;update:title&quot;], // 显式的定义使用了哪些emits</span><br><span class="line">  props: &#123;</span><br><span class="line">    title: String, // v-model绑定值</span><br><span class="line">    titleModifiers: &#123;</span><br><span class="line">      // v-model绑定值对应的修饰符对象</span><br><span class="line">      type: Object,</span><br><span class="line">      default: () =&gt; (&#123;&#125;),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  setup,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped lang=&quot;scss&quot;&gt;</span><br><span class="line">// 使用script中的变量 color</span><br><span class="line">.person &#123;</span><br><span class="line">  color: v-bind(color);</span><br><span class="line">&#125;</span><br><span class="line">// 默认插槽加样式：无效</span><br><span class="line">.default-solt &#123;</span><br><span class="line">  color: slateblue !important;</span><br><span class="line">&#125;</span><br><span class="line">// 默认插槽加样式：有效</span><br><span class="line">:slotted(.default-solt) &#123;</span><br><span class="line">  color: slateblue !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// dialog的样式</span><br><span class="line">.modal &#123;</span><br><span class="line">  position: absolute;</span><br><span class="line">  top: 0;</span><br><span class="line">  right: 0;</span><br><span class="line">  bottom: 0;</span><br><span class="line">  left: 0;</span><br><span class="line">  background-color: rgba(0, 0, 0, 0.5);</span><br><span class="line">  display: flex;</span><br><span class="line">  flex-direction: column;</span><br><span class="line">  align-items: center;</span><br><span class="line">  justify-content: center;</span><br><span class="line">&#125;</span><br><span class="line">.modal div &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  flex-direction: column;</span><br><span class="line">  align-items: center;</span><br><span class="line">  justify-content: center;</span><br><span class="line">  background-color: white;</span><br><span class="line">  width: 300px;</span><br><span class="line">  height: 300px;</span><br><span class="line">  padding: 5px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="setup-ts"><a href="#setup-ts" class="headerlink" title="setup.ts"></a>setup.ts</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  ref, <span class="comment">// 用于简单数据类型  需要.value 访问</span></span><br><span class="line">  reactive, <span class="comment">// 用于复杂数据类型 不需要.value 就直接可以方法</span></span><br><span class="line">  toRefs, <span class="comment">// 用于给prop添加响应数据，需要.value 访问</span></span><br><span class="line">  watch,</span><br><span class="line">  computed,</span><br><span class="line">  onMounted,</span><br><span class="line">  onUnmounted,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">setup</span> = (<span class="params">props: <span class="built_in">any</span>, context: <span class="built_in">any</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Bowen: setup -&gt; props, context&quot;</span>, props, context);</span><br><span class="line">  <span class="comment">//============================================================================</span></span><br><span class="line">  <span class="comment">// prop</span></span><br><span class="line">  <span class="keyword">const</span> &#123; titleModifiers &#125; = <span class="title function_">toRefs</span>(props);</span><br><span class="line">  <span class="comment">//============================================================================</span></span><br><span class="line">  <span class="comment">// data</span></span><br><span class="line">  <span class="keyword">const</span> x = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> y = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> modalOpen = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> color = <span class="title function_">ref</span>(<span class="string">&quot;red&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> person = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;Bowen&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//============================================================================</span></span><br><span class="line">  <span class="comment">// computed</span></span><br><span class="line">  <span class="keyword">const</span> doubelCount = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> count.<span class="property">value</span> * <span class="number">2</span>);</span><br><span class="line">  <span class="comment">//============================================================================</span></span><br><span class="line">  <span class="comment">// watch</span></span><br><span class="line">  <span class="title function_">watch</span>(count, <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Bowen: setup -&gt; val&quot;</span>, val);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//============================================================================</span></span><br><span class="line">  <span class="comment">// methods</span></span><br><span class="line">  <span class="comment">// 判断 v-model 是否有 capitalize 标识符  转换大写</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleCapitalize</span> = (<span class="params">event: InputEvent</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> value = (event.<span class="property">target</span> <span class="keyword">as</span> <span class="title class_">HTMLInputElement</span>).<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">if</span> (titleModifiers.<span class="property">value</span>.<span class="property">capitalize</span>) &#123;</span><br><span class="line">      value = value.<span class="title function_">toLocaleUpperCase</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    context.<span class="title function_">emit</span>(<span class="string">&quot;update:title&quot;</span>, value);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// 获取鼠标定位</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">getMousePosition</span> = (<span class="params">e: MouseEvent</span>) =&gt; &#123;</span><br><span class="line">    x.<span class="property">value</span> = e.<span class="property">pageX</span>;</span><br><span class="line">    y.<span class="property">value</span> = e.<span class="property">pageY</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//============================================================================</span></span><br><span class="line">  <span class="comment">// 生命周期</span></span><br><span class="line">  <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;mousemove&quot;</span>, getMousePosition);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">removeEventListener</span>(<span class="string">&quot;mousemove&quot;</span>, getMousePosition);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    x,</span><br><span class="line">    y,</span><br><span class="line">    modalOpen,</span><br><span class="line">    count,</span><br><span class="line">    color,</span><br><span class="line">    person,</span><br><span class="line">    doubelCount,</span><br><span class="line">    handleCapitalize,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> setup;</span><br></pre></td></tr></table></figure>

<h1 id="vue3-组件库"><a href="#vue3-组件库" class="headerlink" title="vue3 组件库"></a>vue3 组件库</h1><h2 id="element-puls"><a href="#element-puls" class="headerlink" title="element-puls"></a>element-puls</h2><p>elementUI 官方 bata 版 <a href="https://github.com/element-plus/element-plus">https://github.com/element-plus/element-plus</a></p>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>VueCli常见问题汇总</title>
    <url>/2021/11/12/Vue/VueCli%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h3 id="去除-PWA-插件"><a href="#去除-PWA-插件" class="headerlink" title="去除 PWA 插件"></a>去除 PWA 插件</h3><p>去除 package.json 中的 PWA 依赖 从新 npm install</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"> <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   ...</span><br><span class="line">-    <span class="attr">&quot;@vue/cli-plugin-pwa&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.4.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">     ...</span><br><span class="line"> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="ESlint"><a href="#ESlint" class="headerlink" title="ESlint"></a>ESlint</h2><h3 id="ESlint-开启保存校验"><a href="#ESlint-开启保存校验" class="headerlink" title="ESlint 开启保存校验"></a>ESlint 开启保存校验</h3><p>vue.config.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">lintOnSave</span>: <span class="literal">true</span>,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="关闭部分校验规则"><a href="#关闭部分校验规则" class="headerlink" title="关闭部分校验规则"></a>关闭部分校验规则</h3><p>.eslintrc.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">root</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">env</span>: &#123;</span><br><span class="line">    <span class="attr">node</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">extends</span>: [<span class="string">&quot;plugin:vue/essential&quot;</span>, <span class="string">&quot;eslint:recommended&quot;</span>, <span class="string">&quot;@vue/prettier&quot;</span>],</span><br><span class="line">  <span class="attr">parserOptions</span>: &#123;</span><br><span class="line">    <span class="attr">parser</span>: <span class="string">&quot;babel-eslint&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 关闭规则</span></span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">    <span class="string">&quot;no-console&quot;</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;production&quot;</span> ? <span class="string">&quot;warn&quot;</span> : <span class="string">&quot;off&quot;</span>,</span><br><span class="line">    <span class="string">&quot;no-debugger&quot;</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;production&quot;</span> ? <span class="string">&quot;warn&quot;</span> : <span class="string">&quot;off&quot;</span>,</span><br><span class="line">    <span class="string">&quot;no-unused-vars&quot;</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;production&quot;</span> ? <span class="string">&quot;warn&quot;</span> : <span class="string">&quot;off&quot;</span>,</span><br><span class="line">    <span class="comment">// vue相关加 vue/</span></span><br><span class="line">    <span class="string">&quot;vue/no-unused-components&quot;</span>:</span><br><span class="line">      process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;production&quot;</span> ? <span class="string">&quot;warn&quot;</span> : <span class="string">&quot;off&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="添加-vue-cli-添加-babel"><a href="#添加-vue-cli-添加-babel" class="headerlink" title="添加 vue-cli 添加 babel"></a>添加 vue-cli 添加 babel</h2><p><a href="https://blog.csdn.net/qq_37493515/article/details/118628968">参考文档</a></p>
<p>babel.config.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [</span><br><span class="line">    <span class="string">&#x27;@vue/cli-plugin-babel/preset&#x27;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;core-js&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.6.5&quot;</span><span class="punctuation">,</span>    <span class="comment">//core-js 是 babel-polyfill 的底层依赖，</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;@vue/cli-plugin-babel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;~4.5.0&quot;</span><span class="punctuation">,</span>  <span class="comment">// 包含  Babel 7 + babel-loader+ @vue/babel-preset-app</span></span><br><span class="line">   <span class="attr">&quot;@vue/cli-plugin-eslint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;~4.4.0&quot;</span><span class="punctuation">,</span> <span class="comment">// 跟其他 @vue/cli-plugin 和 @vue/cli-service 相近的版本</span></span><br><span class="line">   <span class="attr">&quot;@vue/cli-service&quot;</span><span class="punctuation">:</span> <span class="string">&quot;~4.4.0&quot;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<h3 id="容易出现的问题"><a href="#容易出现的问题" class="headerlink" title="容易出现的问题"></a>容易出现的问题</h3><p>@vue&#x2F;cli-plugin-babel 不要直接安装 最好使用与当前项目 @vue&#x2F;cli-plugin 和 @vue&#x2F;cli-service 相近的版本</p>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>vue-cli</tag>
      </tags>
  </entry>
  <entry>
    <title>VueRouter常见问题汇总</title>
    <url>/2021/11/12/Vue/VueRouter%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h2 id="路由可选参数"><a href="#路由可选参数" class="headerlink" title="路由可选参数"></a>路由可选参数</h2><p>routerConfig</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"> &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/home/mission/:type/:courseid/:missionid&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;Mission&quot;</span>,</span><br><span class="line">    <span class="attr">props</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span></span><br><span class="line">        <span class="keyword">import</span>(</span><br><span class="line">        <span class="comment">/* webpackChunkName:&#x27;Mission&#x27; */</span></span><br><span class="line">        <span class="string">&quot;@/views/course/mission.vue&quot;</span></span><br><span class="line">        ),</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p> 传参时如果少传一个参数 那路由地址将无法正常显示</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">     <span class="attr">name</span>: <span class="string">&quot;Mission&quot;</span>,</span><br><span class="line">     <span class="attr">params</span>: &#123; <span class="attr">type</span>: <span class="string">&quot;add&quot;</span>, <span class="attr">courseid</span>: item.<span class="property">uuid</span> &#125;,</span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>修改 routerConfig</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"> &#123;</span><br><span class="line">    <span class="comment">//  :parmas?  =&gt; ? 就是代表参数可选</span></span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/home/mission/:type?/:courseid?/:missionid?&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;Mission&quot;</span>,</span><br><span class="line">    <span class="attr">props</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span></span><br><span class="line">        <span class="keyword">import</span>(</span><br><span class="line">        <span class="comment">/* webpackChunkName:&#x27;Mission&#x27; */</span></span><br><span class="line">        <span class="string">&quot;@/views/course/mission.vue&quot;</span></span><br><span class="line">        ),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>vue-cli</tag>
      </tags>
  </entry>
  <entry>
    <title>Vuex入门</title>
    <url>/2018/11/29/Vue/Vuex/</url>
    <content><![CDATA[<h2 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1. 介绍"></a>1. 介绍</h2><h3 id="1-1-组件化开发"><a href="#1-1-组件化开发" class="headerlink" title="1.1. 组件化开发"></a>1.1. 组件化开发</h3><p>在现代 Web 开发复杂多变的需求驱动之下，组件化开发已然成为了事实上的标准。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/components.png" alt="components"></p>
<p>组件化开发为我们带来了：</p>
<ul>
<li>更快的开发效率</li>
<li>更好的可维护性</li>
</ul>
<h3 id="1-2-组件内的状态管理流程"><a href="#1-2-组件内的状态管理流程" class="headerlink" title="1.2. 组件内的状态管理流程"></a>1.2. 组件内的状态管理流程</h3><p>每个组件都有自己的状态、视图和行为等组成部分。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="comment">// state</span></span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// view</span></span><br><span class="line">  <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;div&gt;&#123;&#123; count &#125;&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="string">        `</span>,</span><br><span class="line">  <span class="comment">// actions</span></span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">count</span>++;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>state，驱动应用的数据源；</li>
<li>view，以声明方式将 state 映射到视图；</li>
<li>actions，响应在 view 上的用户输入导致的状态变化</li>
</ul>
<p>以下是一个表示“单向数据流”理念的简单示意：</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/flow.png" alt="flow"></p>
<h3 id="1-3-组件通信"><a href="#1-3-组件通信" class="headerlink" title="1.3. 组件通信"></a>1.3. 组件通信</h3><p>然而大多数场景下的组件都并不是独立存在的，而是相互协作共同构成了一个复杂的业务功能。在 Vue<br>中为不同的组件关系提供了不同的通信规则。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/1575007644430.png" alt="1575007644430"></p>
<ul>
<li>父子关系</li>
<li>非父子</li>
<li>。。。</li>
</ul>
<h3 id="1-3-1-父传子：Props-Down"><a href="#1-3-1-父传子：Props-Down" class="headerlink" title="1.3.1. 父传子：Props Down"></a>1.3.1. 父传子：Props Down</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">blog-post</span> <span class="attr">title</span>=<span class="string">&quot;My journey with Vue&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">blog-post</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&quot;blog-post&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&quot;title&quot;</span>],</span><br><span class="line">  <span class="attr">template</span>: <span class="string">&quot;&lt;h3&gt;&#123;&#123; title &#125;&#125;&lt;/h3&gt;&quot;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="1-3-2-子传父：Events-Up"><a href="#1-3-2-子传父：Events-Up" class="headerlink" title="1.3.2. 子传父：Events Up"></a>1.3.2. 子传父：Events Up</h3><p>在子组件中使用 $emit 发布一个自定义事件：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;$emit(&#x27;enlarge-text&#x27;)&quot;</span>&gt;</span>Enlarge text<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在使用这个组件的时候，使用 v-on 监听这个自定义事件</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">blog-post</span> <span class="attr">...</span> <span class="attr">v-on:enlarge-text</span>=<span class="string">&quot;postFontSize += 0.1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">blog-post</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-3-通过-ref-获取子组件"><a href="#1-3-3-通过-ref-获取子组件" class="headerlink" title="1.3.3. 通过 ref 获取子组件"></a>1.3.3. 通过 ref 获取子组件</h3><p>在使用组件的时候，添加 ref 属性：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">blog-post</span> <span class="attr">title</span>=<span class="string">&quot;My journey with Vue&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;post&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">blog-post</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后使用 $refs 访问：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">post</span>;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-4-非父子：Event-Bus"><a href="#1-3-4-非父子：Event-Bus" class="headerlink" title="1.3.4. 非父子：Event Bus"></a>1.3.4. 非父子：Event Bus</h3><p>我们可以使用一个非常简单的 Event Bus 来解决这个问题：</p>
<p><code>event-bus.js :</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vue</span>();</span><br></pre></td></tr></table></figure>

<p>然后在需要通信的两端：</p>
<p>使用 <code>$on</code>订阅：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 没有参数</span></span><br><span class="line">bus.$on(<span class="string">&quot;自定义事件名称&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行操作</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 有参数</span></span><br><span class="line">bus.$on(<span class="string">&quot;自定义事件名称&quot;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行操作</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>使用<code>$emit</code>发布：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 没有自定义传参</span></span><br><span class="line">bus.$emit(<span class="string">&quot;自定义事件名称&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有自定义传参</span></span><br><span class="line">bus.$emit(<span class="string">&quot;自定义事件名称&quot;</span>, 数据);</span><br></pre></td></tr></table></figure>

<h3 id="1-4-多个组件状态共享"><a href="#1-4-多个组件状态共享" class="headerlink" title="1.4. 多个组件状态共享"></a>1.4. 多个组件状态共享</h3><p>但是，当我们的应用遇到多个组件共享状态时：</p>
<ul>
<li>多个视图依赖于同一状态</li>
<li>来自不同视图的行为需要变更同一状态</li>
</ul>
<blockquote>
<p>最典型的场景就是购物车</p>
</blockquote>
<p>对于问题一，传参的方法对于多层嵌套的组件将会非常繁琐，并且对于兄弟组件间的状态传递无能为<br>力。</p>
<p>对于问题二，我们经常会采用父子组件直接引用或者通过事件来变更和同步状态的多份拷贝。以上的这<br>些模式非常脆弱，通常会导致无法维护的代码。</p>
<p>因此，我们为什么不把组件的共享状态抽取出来，以一个全局单例模式管理呢？在这种模式下，我们的<br>组件树构成了一个巨大的“视图”，不管在树的哪个位置，任何组件都能获取状态或者触发行为！</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/1575009217911.png" alt="1575009217911"></p>
<p>通过定义和隔离状态管理中的各种概念并通过强制规则维持视图和状态间的独立性，我们的代码将会变<br>得更结构化且易维护。</p>
<h3 id="1-5-什么是-Vuex"><a href="#1-5-什么是-Vuex" class="headerlink" title="1.5. 什么是 Vuex"></a>1.5. 什么是 Vuex</h3><blockquote>
<p>官方文档：<code>Vuex</code>是一个专为 <code>Vue.js</code>应用程序开发的状态管理模式。它采用集中式存储管理应用<br>的所有组件的状态，并以相应的规则保证状态以一种可预测的方式发生变化。Vuex 也集成到 Vue<br>的官方调试工具 devtools extension，提供了诸如零配置的 time-travel 调试、状态快照导入导出<br>等高级调试功能。</p>
</blockquote>
<ul>
<li><code>Vue</code> 是专门为<code>Vue.js</code> 设计的状态管理库</li>
<li>它采用集中式的方式存储需要共享的数据</li>
<li>从使用角度，它就是一个 JavaScript 库</li>
<li>它的作用是进行状态管理，解决复杂组件通信，数据贡献</li>
</ul>
<h3 id="1-6-什么情况下使用-Vuex"><a href="#1-6-什么情况下使用-Vuex" class="headerlink" title="1.6. 什么情况下使用 Vuex"></a>1.6. 什么情况下使用 Vuex</h3><blockquote>
<p>官方文档：<br><code>Vuex</code> 可以帮助我们管理共享状态，并附带了更多的概念和框架。这需要对短期和长期效益进行权<br>衡。<br>如果您不打算开发大型单页应用，使用<code>Vuex</code> 可能是繁琐冗余的。确实是如此——如果您的应用<br>够简单，您最好不要使用<code>Vuex</code>。一个简单的 store 模式就足够您所需了。但是，如果您需要构建<br>一个中大型单页应用，您很可能会考虑如何更好地在组件外部管理状态，<code>Vuex</code> 将会成为自然而然<br>的选择。引用 <code>Redux</code>的作者 <code>Dan Abramov</code>的话说就是：Flux 架构就像眼镜：您自会知道什么时<br>候需要它。</p>
</blockquote>
<p>当你的应用中具有以下需求场景的时候：</p>
<ul>
<li><strong>多个视图依赖于同一状态</strong>。</li>
<li><strong>来自不同视图的行为需要变更同一状态</strong>。</li>
</ul>
<p>建议符合这种场景的业务使用 <code>Vuex</code>来进行数据管理，例如非常典型的场景：<strong>购物车</strong>。</p>
<p><strong>注意：<code>Vuex</code> 不要滥用，不符合以上需求的业务不要使用，反而会让你的应用变得更麻烦</strong></p>
<h2 id="2-准备"><a href="#2-准备" class="headerlink" title="2. 准备"></a>2. 准备</h2><p>实现一个类似于购物车的组件案例</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/1575009753493.png" alt="1575009753493"></p>
<p>1、使用 VueCLI 创建一个练习项目：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vue create vuex-demo cd vuex-demo npm run serve</span><br></pre></td></tr></table></figure>

<p>2、准备两个组件</p>
<p>Foo.vue 和 Bar.vue</p>
<p>3、最后在 App.vue 中加载使用 Foo 和 Bar</p>
<p>最终达到上图效果</p>
<h2 id="3-安装-Vuex"><a href="#3-安装-Vuex" class="headerlink" title="3. 安装 Vuex"></a>3. 安装 Vuex</h2><pre><code>官方文档：https://vuex.vuejs.org/zh/installation.html
</code></pre>
<p>最方便的方式就是使用 npm：</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 或者 yarn add vuex</span></span><br><span class="line"> npm <span class="keyword">install</span> vuex</span><br></pre></td></tr></table></figure>

<h2 id="4-配置-Vuex"><a href="#4-配置-Vuex" class="headerlink" title="4. 配置 Vuex"></a>4. 配置 Vuex</h2><p>1、在项目中新建<code>store/index.js</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span>;</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建一个 Vuex 容器实例，用来在组件的外部管理共享的数据状态</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 类似于组件中的 data</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>

<p>2、在 <code>main.js</code>将<code>store</code>注册到 <code>Vue</code>根实例</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&quot;./App.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;./store/&quot;</span>;</span><br><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">productionTip</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">render</span>: <span class="function">(<span class="params">h</span>) =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>),</span><br><span class="line">  store,</span><br><span class="line">&#125;).$mount(<span class="string">&quot;#app&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="5-State"><a href="#5-State" class="headerlink" title="5. State"></a>5. State</h2><blockquote>
<p>目标：<br>知道什么是 State<br>掌握如何定义 State<br>掌握如何在组件中访问 State 数据</p>
</blockquote>
<p>容器中的 state 就好比组件的 data，用来存储共享数据：</p>
<ul>
<li>容器中的数据是共享的，任何组件都可以访问</li>
<li>容器中的数据也是响应式的，数据改变也会驱动视图更新</li>
</ul>
<p>在组件中访问容器中的数据，可以通过以下几种方式。</p>
<p>在组件模板中直接通过 $store 访问容器数据：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; $store.state.count &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在组件 JavaScript 中访问容器数据需要加 this ：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">    onClick () &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">count</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果在组件中多次使用到容器数据，可以将其封装到一个计算属性中：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">computed</span>: &#123;</span><br><span class="line">    count () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">count</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后就像使用访问自己的数据一样来访问容器中的数据</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; count &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="6-在调试工具中调试-Vuex-容器数据"><a href="#6-在调试工具中调试-Vuex-容器数据" class="headerlink" title="6. 在调试工具中调试 Vuex 容器数据"></a>6. 在调试工具中调试 Vuex 容器数据</h2><p>也可以通过调试工具查看 Vuex 容器中的数据：</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/1575011046982.png" alt="1575011046982"></p>
<h2 id="7-Mutation"><a href="#7-Mutation" class="headerlink" title="7. Mutation"></a>7. Mutation</h2><p>目标：</p>
<ul>
<li>了解 Mutation 的作用是什么</li>
<li>掌握如何定义 Mutation</li>
<li>掌握如何调用 Mutation</li>
</ul>
<p><strong>更改 Vuex 的 store 中的状态的唯一方法是提交 mutation</strong>。Vuex 中的 mutation 非常类似于事件：每<br>个 mutation 都有一个字符串的 事件类型 (type) 和 一个 回调函数 (handler)。这个回调函数就是我们<br>实际进行状态更改的地方，并且它会接受 state 作为第一个参数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">1</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="title function_">increment</span>(<span class="params">state</span>) &#123;</span><br><span class="line">      <span class="comment">// 变更状态</span></span><br><span class="line">      state.<span class="property">count</span>++;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>然后在组件中调用 mutation：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;com&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Bar 组件<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; $store.state.count &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 如果是在 JS 中，则 this.$store.commit(&#x27;increment&#x27;) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;$store.commit(&#x27;increment&#x27;)&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>mutation 函数也可以自定义传参：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="attr">mutations</span>: &#123;</span><br><span class="line">    increment (state, n) &#123;</span><br><span class="line">        state.<span class="property">count</span> += n</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">store.<span class="title function_">commit</span>(<span class="string">&quot;increment&quot;</span>, <span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<p><strong>注意：mutation 只能传递 1 个自定义参数</strong></p>
<p>如果需要传递多个参数，就放到一个对象中：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="attr">mutations</span>: &#123;</span><br><span class="line">    increment (state, payload) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(payload) <span class="comment">// &#123; n: 10, m: 20 &#125;</span></span><br><span class="line">        state.<span class="property">count</span> += payload.<span class="property">n</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">store.<span class="title function_">commit</span>(<span class="string">&quot;increment&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">n</span>: <span class="number">10</span>,</span><br><span class="line">  <span class="attr">m</span>: <span class="number">20</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>提交 mutation 的另一种方式是直接使用包含 <code>type</code>属性的对象：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">store.<span class="title function_">commit</span>(&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;increment&quot;</span>,</span><br><span class="line">  <span class="attr">amount</span>: <span class="number">10</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>当使用对象风格的提交方式，整个对象都作为载荷传给 mutation 函数，因此处理函数保持不变：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">mutations</span>: &#123;</span><br><span class="line">    increment (state, payload) &#123;</span><br><span class="line">        state.<span class="property">count</span> += payload.<span class="property">amount</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总结：</p>
<ul>
<li>修改容器的 state 务必使用 mutation 函数，因为只有 mutation 函数中修改 state 数据才会和调试工具正常工作。</li>
<li>mutation 函数的第 1 个参数是 state 对象</li>
<li>mutation 函数也可以自定义传参</li>
<li><strong>注意：不要在 mutation 中执行异步操作修改 state 、调试工具会出现问题。</strong></li>
</ul>
<h2 id="9-Action"><a href="#9-Action" class="headerlink" title="9.Action"></a>9.Action</h2><p>目标：</p>
<ul>
<li>了解 Action 的作用是什么</li>
<li>掌握如何定义 Action</li>
<li>掌握如何调用 Action</li>
</ul>
<p>Action 类似于 mutation，不同在于：</p>
<ul>
<li>Action 提交的是 mutation，而不是直接变更状态。</li>
<li>Action 可以包含任意异步操作。</li>
</ul>
<h3 id="9-1-定义-Action"><a href="#9-1-定义-Action" class="headerlink" title="9.1. 定义 Action"></a>9.1. 定义 Action</h3><p>让我们来注册一个简单的 action：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="title function_">increment</span>(<span class="params">state</span>) &#123;</span><br><span class="line">      state.<span class="property">count</span>++;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="title function_">increment</span>(<span class="params">context</span>) &#123;</span><br><span class="line">      <span class="comment">// 执行异步操作</span></span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 提交 mutation 更新 state</span></span><br><span class="line">        context.<span class="title function_">commit</span>(<span class="string">&quot;increment&quot;</span>);</span><br><span class="line">      &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Action 函数接受一个与 store 实例具有相同方法和属性的 context 对象，因此你可以调用<br><code>context.commit</code> 提交一个 mutation。<br>Action 通过<code>store.dispatch</code>方法触发：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">store.<span class="title function_">dispatch</span>(<span class="string">&quot;increment&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>例如我在组件中：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;$store.dispatch(&#x27;increment&#x27;)&quot;</span>&gt;</span>分发 Action<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Actions 和 Mutation 一样，也支持自定义传参：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 只有一个参数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;$store.dispatch(&#x27;increment&#x27;, 10)&quot;</span>&gt;</span>分发 Action<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 多个参数放到一个对象中 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;$store.dispatch(&#x27;increment&#x27;, &#123; n: 10, m: 20 &#125;)&quot;</span>&gt;</span></span><br><span class="line">  分发 Action</span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>总结：</p>
<ul>
<li>action 中异步操作结束以后，提交 mutation 来修改 state</li>
<li><strong>注意：也不要在 action 中直接修改 state，永远通过 mutation 来修改 state</strong></li>
<li>action 函数的第 1 个参数是容器对象</li>
<li>action 也可以像 mutation 函数一样自定义传参</li>
</ul>
<h2 id="10-Vuex-状态管理流程"><a href="#10-Vuex-状态管理流程" class="headerlink" title="10. Vuex 状态管理流程"></a>10. Vuex 状态管理流程</h2><h3 id="10-1-同步操作"><a href="#10-1-同步操作" class="headerlink" title="10.1. 同步操作"></a>10.1. 同步操作</h3><p><img data-src="https://bitbw.top/public/img/my_gallery/vuex%E5%90%8C%E6%AD%A5.png" alt="vuex同步"></p>
<ul>
<li>组件通过 Commit 调用 Mutations 中的方法</li>
<li>Mutations 执行内部逻辑修改 State 数据 ，同时在调试工具 Devtools 上显示对应变化内容</li>
<li>State 变化影响组件视图更新</li>
</ul>
<h3 id="10-2-异步操作"><a href="#10-2-异步操作" class="headerlink" title="10.2 异步操作"></a>10.2 异步操作</h3><p><img data-src="https://bitbw.top/public/img/my_gallery/vuex.png"></p>
<ul>
<li>组件通过 Dispatch 调用 Actions 中的方法</li>
<li>Actions 中的方法通过 Commit 调用 Mutations 中的方法</li>
<li>Mutations 执行内部逻辑修改 State 数据 ，同时在调试工具 Devtools 上显示对应变化内容</li>
<li>State 变化影响组件视图更新</li>
</ul>
<p><strong>注意点：</strong></p>
<ul>
<li><strong>不要在 action 中直接修改 state，调试工具工作有问题</strong></li>
<li><strong>也不要在 mutation 中执行异步操作修改 state，调试工具工作有问题</strong></li>
<li><strong>只有 mutation 中修改 state 才能反应到调试工具中</strong></li>
</ul>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue列表渲染中对象和数组变更检测注意事项</title>
    <url>/2018/12/04/Vue/Vue%E5%88%97%E8%A1%A8%E6%B8%B2%E6%9F%93%E4%B8%AD%E5%AF%B9%E8%B1%A1%E5%92%8C%E6%95%B0%E7%BB%84%E5%8F%98%E6%9B%B4%E6%A3%80%E6%B5%8B%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/</url>
    <content><![CDATA[<h2 id="对象变更检测注意事项"><a href="#对象变更检测注意事项" class="headerlink" title="对象变更检测注意事项"></a>对象变更检测注意事项</h2><p><a href="https://cn.vuejs.org/v2/guide/list.html#%E5%AF%B9%E8%B1%A1%E5%8F%98%E6%9B%B4%E6%A3%80%E6%B5%8B%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">对象变更检测注意事项</a></p>
<p>还是由于 JavaScript 的限制，<strong>Vue 不能检测对象属性的添加或删除</strong>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// `vm.a` 现在是响应式的</span></span><br><span class="line"></span><br><span class="line">vm.<span class="property">b</span> = <span class="number">2</span>;</span><br><span class="line"><span class="comment">// `vm.b` 不是响应式的</span></span><br></pre></td></tr></table></figure>

<p>对于已经创建的实例，Vue 不允许动态添加根级别的响应式属性。但是，可以使用 <code>Vue.set(object, propertyName, value)</code> 方法向嵌套对象添加响应式属性。例如，对于：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">userProfile</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;Anika&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>你可以添加一个新的 <code>age</code> 属性到嵌套的 <code>userProfile</code> 对象：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">set</span>(vm.<span class="property">userProfile</span>, <span class="string">&quot;age&quot;</span>, <span class="number">27</span>);</span><br></pre></td></tr></table></figure>

<p>你还可以使用 <code>vm.$set</code> 实例方法，它只是全局 <code>Vue.set</code> 的别名：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">vm.$set(vm.<span class="property">userProfile</span>, <span class="string">&quot;age&quot;</span>, <span class="number">27</span>);</span><br></pre></td></tr></table></figure>

<p>如果你想给一个 data 中的对象新加属性又不想使用到以上方法</p>
<p>建议使用一个变量接收添加完新属性的对象，然后在从新赋值给原 data 中的数据</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> userProfile = vm.<span class="property">userProfile</span>;</span><br><span class="line">userProfile.<span class="property">age</span> = <span class="number">27</span>;</span><br><span class="line">vm.<span class="property">userProfile</span> = userProfile;</span><br></pre></td></tr></table></figure>

<p>有时你可能需要为已有对象赋值多个新属性，比如使用 <code>Object.assign()</code> 或 <code>jQuery.extend()</code>。在这种情况下，你应该用两个对象的属性创建一个新的对象。所以，如果你想添加新的响应式属性，不要像这样：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(vm.<span class="property">userProfile</span>, &#123;</span><br><span class="line">  <span class="comment">//不要仅仅直接添加属性的方式</span></span><br><span class="line">  <span class="attr">age</span>: <span class="number">27</span>,</span><br><span class="line">  <span class="attr">favoriteColor</span>: <span class="string">&quot;Vue Green&quot;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>你应该这样做：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">vm.<span class="property">userProfile</span> = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, vm.<span class="property">userProfile</span>, &#123;</span><br><span class="line">  <span class="comment">//建议新建一个对象合并和后在重新赋值</span></span><br><span class="line">  <span class="attr">age</span>: <span class="number">27</span>,</span><br><span class="line">  <span class="attr">favoriteColor</span>: <span class="string">&quot;Vue Green&quot;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="Object-assign-方法"><a href="#Object-assign-方法" class="headerlink" title="Object.assign() 方法"></a>Object.assign() 方法</h2><p><code>Object.assign</code>方法用于对象的合并，将源对象（source）的所有可枚举属性，复制到目标对象（target）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> target = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> source1 = &#123; <span class="attr">b</span>: <span class="number">2</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> source2 = &#123; <span class="attr">c</span>: <span class="number">3</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(target, source1, source2);</span><br><span class="line">target; <span class="comment">// &#123;a:1, b:2, c:3&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="数组更新检测"><a href="#数组更新检测" class="headerlink" title="数组更新检测"></a>数组更新检测</h2><p><a href="https://cn.vuejs.org/v2/guide/list.html#%E6%95%B0%E7%BB%84%E6%9B%B4%E6%96%B0%E6%A3%80%E6%B5%8B">数组更新检测</a></p>
<h3 id="变异方法-mutation-method"><a href="#变异方法-mutation-method" class="headerlink" title="变异方法 (mutation method)"></a>变异方法 (mutation method)</h3><p>Vue 将被侦听的数组的变异方法进行了包裹，所以它们也将会触发视图更新。这些被包裹过的方法包括：</p>
<ul>
<li><code>push()</code></li>
<li><code>pop()</code></li>
<li><code>shift()</code></li>
<li><code>unshift()</code></li>
<li><code>splice()</code></li>
<li><code>sort()</code></li>
<li><code>reverse()</code></li>
</ul>
<p>你可以打开控制台，然后对前面例子的 <code>items</code> 数组尝试调用变异方法。比如 <code>example1.items.push(&#123; message: &#39;Baz&#39; &#125;)</code>。</p>
<h3 id="替换数组"><a href="#替换数组" class="headerlink" title="替换数组"></a>替换数组</h3><p>变异方法，顾名思义，会改变调用了这些方法的原始数组。相比之下，也有非变异 (non-mutating method) 方法，例如 <code>filter()</code>、<code>concat()</code> 和 <code>slice()</code> 。它们不会改变原始数组，而<strong>总是返回一个新数组</strong>。当使用非变异方法时，可以用新数组替换旧数组：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">example1.<span class="property">items</span> = example1.<span class="property">items</span>.<span class="title function_">filter</span>(<span class="keyword">function</span> (<span class="params">item</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> item.<span class="property">message</span>.<span class="title function_">match</span>(<span class="regexp">/Foo/</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>你可能认为这将导致 Vue 丢弃现有 DOM 并重新渲染整个列表。幸运的是，事实并非如此。Vue 为了使得 DOM 元素得到最大范围的重用而实现了一些智能的启发式方法，所以用一个含有相同元素的数组去替换原来的数组是非常高效的操作。</p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>由于 JavaScript 的限制，Vue <strong>不能</strong>检测以下数组的变动：</p>
<ol>
<li>当你利用索引直接设置一个数组项时，例如：<code>vm.items[indexOfItem] = newValue</code></li>
<li>当你修改数组的长度时，例如：<code>vm.items.length = newLength</code></li>
</ol>
<p>举个例子：</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">var</span> vm = new <span class="built_in">Vue</span>(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    items: <span class="selector-attr">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">vm<span class="selector-class">.items</span><span class="selector-attr">[1]</span> = <span class="string">&#x27;x&#x27;</span> <span class="comment">// 不是响应性的</span></span><br><span class="line">vm<span class="selector-class">.items</span><span class="selector-class">.length</span> = <span class="number">2</span> <span class="comment">// 不是响应性的</span></span><br></pre></td></tr></table></figure>

<p>为了解决第一类问题，以下两种方式都可以实现和 <code>vm.items[indexOfItem] = newValue</code> 相同的效果，同时也将在响应式系统内触发状态更新：</p>
<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Vue.set</span></span><br><span class="line">Vue.<span class="keyword">set</span>(vm.items, indexOfItem, <span class="keyword">new</span><span class="type">Value</span>)</span><br><span class="line"><span class="comment">// Array.prototype.splice</span></span><br><span class="line">vm.items.splice(indexOfItem, <span class="number">1</span>, <span class="keyword">new</span><span class="type">Value</span>)</span><br></pre></td></tr></table></figure>

<p>你也可以使用 <a href="https://cn.vuejs.org/v2/api/#vm-set"><code>vm.$set</code></a> 实例方法，该方法是全局方法 <code>Vue.set</code> 的一个别名：</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">vm.<span class="constructor">$set(<span class="params">vm</span>.<span class="params">items</span>, <span class="params">indexOfItem</span>, <span class="params">newValue</span>)</span></span><br></pre></td></tr></table></figure>

<p>为了解决第二类问题，你可以使用 <code>splice</code>：</p>
<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line">vm.items.splice(<span class="keyword">new</span><span class="type">Length</span>)</span><br></pre></td></tr></table></figure>

<h4 id="建议如果需要替换数组中某一项统一使用-splice-方法"><a href="#建议如果需要替换数组中某一项统一使用-splice-方法" class="headerlink" title="建议如果需要替换数组中某一项统一使用 splice 方法"></a><strong>建议如果需要替换数组中某一项统一使用 splice 方法</strong></h4>]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue原理</title>
    <url>/2019/12/14/Vue/Vue%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<h2 id="Vue更新数据流程流程"><a href="#Vue更新数据流程流程" class="headerlink" title="Vue更新数据流程流程"></a>Vue更新数据流程流程</h2><ol>
<li><p>Compiler 解析模板成虚拟dom ( render 函数 createElement 就是直接生成虚拟dom )</p>
</li>
<li><p>Observer 发现数据改变 通知 Watcher</p>
</li>
<li><p>Watcher 通知 Compiler 重新解析模板成虚拟dom</p>
</li>
<li><p>diff 虚拟 dom 对改变的部分进行渲染</p>
</li>
</ol>
<blockquote>
<p>Tip: 当使用 vue-loader 或 vueify 的时候，*.vue 文件内部的模板会在构建时预编译成 JavaScript ( 编译成 render + createElement )</p>
</blockquote>
<h2 id="监视数据更新"><a href="#监视数据更新" class="headerlink" title="监视数据更新"></a>监视数据更新</h2><h3 id="数据劫持"><a href="#数据劫持" class="headerlink" title="数据劫持"></a>数据劫持</h3><p>new Vue(new VueComponent) 时，遍历 data 通过 Object.defineProperty()，添加set和get(目的:数据发生改变从新解析模板(或者rander方法)生成新的虚dom，对比虚拟 dom 更新页面)</p>
<h3 id="数据代理"><a href="#数据代理" class="headerlink" title="数据代理"></a>数据代理</h3><p>将劫持后的数据赋值给 vm._data 上，再利用 Object.defineProperty()，将 vm._data，代理到 vm 上，(相当于 vm.xx &#x3D;&#x3D;&#x3D; vm._data.xx)</p>
<h2 id="对象和数组的监视"><a href="#对象和数组的监视" class="headerlink" title="对象和数组的监视"></a>对象和数组的监视</h2><h2 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h2><p>data中对象数据在new Vue(new VueComponent) 时，递归遍历属性，给属性或者属性内部属性都添加set，get，新添加的属性需要使用vue.set添加监视，或者重新赋值对象。</p>
<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><p>data中数组，在new Vue(new VueComponent) 时一样递归添加set和get，但是set，是对数组进行方法包装只有调用push，shift，unshift，pop，reverse，sort，才能触发模板编译，但数组内部的对象，同data中的对象一样的修改方式，改变数组也可以使用 vue.set，或者从新赋值数组</p>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue常用自定义指令</title>
    <url>/2021/03/25/Vue/Vue%E5%B8%B8%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4/</url>
    <content><![CDATA[<p>Vue 常用自定义指令</p>
<h2 id="布局容器布局下的左右托拽指令-v-resize"><a href="#布局容器布局下的左右托拽指令-v-resize" class="headerlink" title="布局容器布局下的左右托拽指令 v-resize"></a>布局容器布局下的左右托拽指令 v-resize</h2><p>vue+elementUI 项目 实现 Container 布局容器布局下的左右托拽指令</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> resize = &#123;</span><br><span class="line">  <span class="comment">//被绑定元素插入父节点时调用 (仅保证父节点存在，但不一定已被插入文档中)。</span></span><br><span class="line">  <span class="title function_">inserted</span>(<span class="params">el, binding, vnode, oldVnode</span>) &#123;</span><br><span class="line">    <span class="comment">//创建一个定位的节点定位到要托拽的节点上</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">resize</span>: <span class="title class_">HTMLElement</span> = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">    resize.<span class="property">innerText</span> = <span class="string">&quot;✌&quot;</span>;</span><br><span class="line">    <span class="keyword">const</span> style = &#123;</span><br><span class="line">      <span class="attr">position</span>: <span class="string">&quot;absolute&quot;</span>,</span><br><span class="line">      <span class="attr">top</span>: <span class="string">&quot;0%&quot;</span>,</span><br><span class="line">      <span class="attr">right</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">      <span class="attr">display</span>: <span class="string">&quot;flex&quot;</span>,</span><br><span class="line">      <span class="attr">flexDirection</span>: <span class="string">&quot;column&quot;</span>,</span><br><span class="line">      <span class="attr">alignItems</span>: <span class="string">&quot;center&quot;</span>,</span><br><span class="line">      <span class="attr">justifyContent</span>: <span class="string">&quot;center&quot;</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="string">&quot;10px&quot;</span>,</span><br><span class="line">      <span class="attr">height</span>: <span class="string">&quot;100%&quot;</span>,</span><br><span class="line">      <span class="attr">overflow</span>: <span class="string">&quot;hidden&quot;</span>,</span><br><span class="line">      <span class="attr">cursor</span>: <span class="string">&quot;e-resize&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> style) &#123;</span><br><span class="line">      <span class="keyword">if</span> (resize.<span class="property">style</span>.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">        resize.<span class="property">style</span>[key] = style[key];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    el.<span class="title function_">appendChild</span>(resize);</span><br><span class="line">    <span class="comment">//获取binding参数</span></span><br><span class="line">    <span class="keyword">const</span> &#123; container = <span class="literal">false</span>, percent = <span class="number">0.5</span> &#125; = binding.<span class="property">value</span>;</span><br><span class="line">    <span class="comment">//容器</span></span><br><span class="line">    <span class="keyword">let</span> containerNode = container</span><br><span class="line">      ? <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(container)</span><br><span class="line">      : el.<span class="property">parentElement</span>;</span><br><span class="line">    <span class="comment">//容器宽度</span></span><br><span class="line">    <span class="keyword">let</span> clientWidth = containerNode.<span class="property">clientWidth</span>;</span><br><span class="line">    <span class="comment">//要托拽节点的位置参数</span></span><br><span class="line">    <span class="keyword">let</span> targetPosition = el.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line">    <span class="comment">//最大可托拽宽度</span></span><br><span class="line">    <span class="keyword">let</span> maxWidth = clientWidth * percent;</span><br><span class="line">    <span class="comment">//托拽事件</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleMove</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">let</span> targetWidth = e.<span class="property">clientX</span> - targetPosition.<span class="property">right</span> + targetPosition.<span class="property">width</span>;</span><br><span class="line">      targetWidth &gt; maxWidth ? (targetWidth = maxWidth) : <span class="literal">null</span>;</span><br><span class="line">      el.<span class="property">style</span>.<span class="property">flex</span> = <span class="string">`0 0 <span class="subst">$&#123;targetWidth&#125;</span>px`</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//鼠标按下触发托拽</span></span><br><span class="line">    resize.<span class="title function_">addEventListener</span>(<span class="string">&quot;mousedown&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      containerNode.<span class="title function_">addEventListener</span>(<span class="string">&quot;mousemove&quot;</span>, handleMove);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//鼠标抬起清除事件</span></span><br><span class="line">    containerNode.<span class="title function_">addEventListener</span>(<span class="string">&quot;mouseup&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      containerNode.<span class="title function_">removeEventListener</span>(<span class="string">&quot;mousemove&quot;</span>, handleMove);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&quot;resize&quot;</span>, resize);</span><br></pre></td></tr></table></figure>

<h2 id="拖拽指令-v-drag"><a href="#拖拽指令-v-drag" class="headerlink" title="拖拽指令 v-drag"></a>拖拽指令 v-drag</h2><h3 id="效果："><a href="#效果：" class="headerlink" title="效果："></a>效果：</h3><p><img data-src="https://bitbw.top/public/img/my_gallery/%E6%8B%96%E6%8B%BD%E6%8C%87%E4%BB%A4%20v-drag%20.gif" alt="拖拽指令 v-drag "></p>
<p>拖拽指令 v-drag 绑定元素需要定位</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">inserted</span>(<span class="params">el, &#123; value &#125;</span>) &#123;</span><br><span class="line">    el.<span class="property">style</span>.<span class="property">cursor</span> = <span class="string">&quot;move&quot;</span>;</span><br><span class="line">    el.<span class="property">onmousedown</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> disx = e.<span class="property">pageX</span> - el.<span class="property">offsetLeft</span>;</span><br><span class="line">      <span class="keyword">let</span> disy = e.<span class="property">pageY</span> - el.<span class="property">offsetTop</span>;</span><br><span class="line">      <span class="comment">// el 的 x y 轴</span></span><br><span class="line">      <span class="keyword">let</span> x, y;</span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">onmousemove</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        x = e.<span class="property">pageX</span> - disx;</span><br><span class="line">        y = e.<span class="property">pageY</span> - disy;</span><br><span class="line">        el.<span class="property">style</span>.<span class="property">left</span> = x + <span class="string">&quot;px&quot;</span>;</span><br><span class="line">        el.<span class="property">style</span>.<span class="property">top</span> = y + <span class="string">&quot;px&quot;</span>;</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">onmouseup</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 如果绑定值是函数 移动后调用一下函数并传入 x, y</span></span><br><span class="line">        <span class="keyword">if</span> (value &amp;&amp; <span class="keyword">typeof</span> value === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">          <span class="title function_">value</span>(&#123; x, y &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 抬起后取消移动和抬起事件</span></span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">onmousemove</span> = <span class="variable language_">document</span>.<span class="property">onmouseup</span> = <span class="literal">null</span>;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue常见问题汇总</title>
    <url>/2020/09/16/Vue/Vue%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h2 id="Vue2"><a href="#Vue2" class="headerlink" title="Vue2"></a>Vue2</h2><blockquote>
<p>这篇文章是我在工作中使用 vue 遇到的问题做的简单汇总，希望能对看到这篇文章的你有所帮助</p>
</blockquote>
<h3 id="对象数组-响应式所引发的问题"><a href="#对象数组-响应式所引发的问题" class="headerlink" title="对象数组 响应式所引发的问题"></a>对象数组 响应式所引发的问题</h3><h4 id="对于对象"><a href="#对于对象" class="headerlink" title="对于对象"></a>对于对象</h4><p><a href="https://cn.vuejs.org/v2/guide/reactivity.html#%E5%AF%B9%E4%BA%8E%E5%AF%B9%E8%B1%A1">官方文档</a></p>
<p> Vue 无法检测 property 的添加或移除。由于 Vue 会在初始化实例时对 property 执行 getter&#x2F;setter （defineProperty）转化，所以 property 必须在 data 对象上存在才能让 Vue 将它转换为响应式的</p>
<h5 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">vm.$set(obj,<span class="string">&quot;key&quot;</span>,value)</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line">vm.<span class="property">obj</span> = &#123;...vm.<span class="property">obj</span>,<span class="attr">key</span>:value&#125;</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line">vm.<span class="property">obj</span> = <span class="title class_">Object</span>.<span class="title function_">assgin</span>(&#123;&#125;,vm.<span class="property">obj</span>,&#123;<span class="attr">key</span>:value&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="对于数组"><a href="#对于数组" class="headerlink" title="对于数组"></a>对于数组</h4><p>Vue 将被侦听的数组的变更方法进行了包裹，所以它们也将会触发视图更新。这些被包裹过的方法包括：</p>
<p>push()<br>pop()<br>shift()<br>unshift()<br>splice()<br>sort()<br>reverse()</p>
<p>Vue 不能检测以下数组的变动：</p>
<p>当你利用索引直接设置一个数组项时，例如：vm.items[indexOfItem] &#x3D; newValue<br>当你修改数组的长度时，例如：vm.items.length &#x3D; newLength</p>
<h5 id="解决-1"><a href="#解决-1" class="headerlink" title="解决"></a>解决</h5><p>修改数组某一项</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">vm.$set(vm.<span class="property">items</span>, indexOfItem, newValue)</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line">vm.<span class="property">items</span>.<span class="title function_">splice</span>(indexOfItem, <span class="number">1</span>, newValue)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>修改数组长度</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">vm.<span class="property">items</span>.<span class="title function_">splice</span>(newLength)</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line">vm.<span class="property">items</span> = vm.<span class="property">items</span>.<span class="title function_">slice</span>(<span class="number">0</span>,newLength)</span><br></pre></td></tr></table></figure>

<h4 id="vue-中给数组中的对象-添加新属性属性"><a href="#vue-中给数组中的对象-添加新属性属性" class="headerlink" title="vue 中给数组中的对象,添加新属性属性"></a>vue 中给数组中的对象,添加新属性属性</h4><p>不能使用直接遍历设置的方法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">items</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">  item.<span class="property">key</span> = value;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="解决-2"><a href="#解决-2" class="headerlink" title="解决"></a>解决</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">items</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">this</span>.$set(<span class="variable language_">this</span>.<span class="property">items</span>, index, &#123; ...item, ...&#123; <span class="attr">key</span>:value &#125; &#125;);</span><br><span class="line">  <span class="comment">//或者</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">items</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>, &#123; ...item, ...&#123; <span class="attr">key</span>:value &#125; &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">items</span> = <span class="variable language_">this</span>.<span class="property">items</span>.<span class="title function_">map</span>( <span class="function"><span class="params">item</span> =&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; ...item, ...&#123; <span class="attr">key</span>:value &#125; &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>tip 修改数组中的属性 直接修改即可 数组中的对象同外层对象的响应方式</p>
</blockquote>
<h3 id="v-if-使用时注意-vue-会将一样的元素复用-需要加-key-解决"><a href="#v-if-使用时注意-vue-会将一样的元素复用-需要加-key-解决" class="headerlink" title="v-if 使用时注意 vue 会将一样的元素复用 需要加 key 解决"></a>v-if 使用时注意 vue 会将一样的元素复用 需要加 key 解决</h3><blockquote>
<p>在下面的案例中 即使渲染出返回按钮 因为下面的每个 else 元素都一样 但是返回依然不现实 因为复用了下面的元素样式 display: none; 需要在不需要复用的元素上加 key 解决</p>
</blockquote>
<p><a href="%5Bhttps://cn.vuejs.org/v2/guide/conditional.html#%E7%94%A8-key-%E7%AE%A1%E7%90%86%E5%8F%AF%E5%A4%8D%E7%94%A8%E7%9A%84%E5%85%83%E7%B4%A0%5D(https://cn.vuejs.org/v2/guide/conditional.html#%E7%94%A8-key-%E7%AE%A1%E7%90%86%E5%8F%AF%E5%A4%8D%E7%94%A8%E7%9A%84%E5%85%83%E7%B4%A0)">vue 原文链接</a></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;top-button&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;isView&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">plain</span> @<span class="attr">click</span>=<span class="string">&quot;isView = false&quot;</span> <span class="attr">icon</span>=<span class="string">&quot;iconfont iconfont-hcm-back&quot;</span>&gt;</span>返回<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;top-button&quot;</span> <span class="attr">v-else-if</span>=<span class="string">&quot;isEdit === false&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">plain</span> @<span class="attr">click</span>=<span class="string">&quot;onNewPayment&quot;</span> <span class="attr">icon</span>=<span class="string">&quot;iconfont iconfont-hcm-add&quot;</span> <span class="attr">v-btn:edit</span>=<span class="string">&quot;$route.query&quot;</span></span></span><br><span class="line"><span class="tag">   &gt;</span>新建&lt;/el-button</span><br><span class="line">  &gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">   <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">icon</span>=<span class="string">&quot;iconfont iconfont-xinchou-fabu&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">plain</span></span></span><br><span class="line"><span class="tag">   @<span class="attr">click</span>=<span class="string">&quot;onPublish(true)&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">v-btn:edit</span>=<span class="string">&quot;$route.query&quot;</span></span></span><br><span class="line"><span class="tag">   &gt;</span>发布&lt;/el-button</span><br><span class="line">  &gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">   <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">icon</span>=<span class="string">&quot;iconfont iconfont-xinchou-quxiaofabu&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">plain</span></span></span><br><span class="line"><span class="tag">   @<span class="attr">click</span>=<span class="string">&quot;onPublish(false)&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">v-btn:edit</span>=<span class="string">&quot;$route.query&quot;</span></span></span><br><span class="line"><span class="tag">   &gt;</span>取消发布&lt;/el-button</span><br><span class="line">  &gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">plain</span> @<span class="attr">click</span>=<span class="string">&quot;onClickCancelPublish&quot;</span> <span class="attr">v-btn:edit</span>=<span class="string">&quot;$route.query&quot;</span>&gt;</span>设置启动时间<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">   <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">plain</span></span></span><br><span class="line"><span class="tag">   @<span class="attr">click</span>=<span class="string">&quot;$refs.changeLogDialog.open(currentNode.data.id, false)&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">v-btn:view</span>=<span class="string">&quot;$route.query&quot;</span></span></span><br><span class="line"><span class="tag">   &gt;</span>查看变更记录&lt;/el-button</span><br><span class="line">  &gt;</span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;top-button&quot;</span> <span class="attr">v-else-if</span>=<span class="string">&quot;isEdit&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">plain</span> @<span class="attr">click</span>=<span class="string">&quot;onEditSave&quot;</span> <span class="attr">icon</span>=<span class="string">&quot;iconfont iconfont-hcm-save&quot;</span>&gt;</span>保存<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">plain</span> @<span class="attr">click</span>=<span class="string">&quot;onEditCancel&quot;</span> <span class="attr">icon</span>=<span class="string">&quot;iconfont iconfont-hcm-delete&quot;</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-header</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="vue-样式：scoped-使用"><a href="#vue-样式：scoped-使用" class="headerlink" title="vue 样式：scoped 使用"></a>vue 样式：scoped 使用</h3><h4 id="深度作用选择器"><a href="#深度作用选择器" class="headerlink" title="深度作用选择器"></a>深度作用选择器</h4><p>如果你希望 <code>scoped</code> 样式中的一个选择器能够作用得“更深”，例如影响子组件，你可以使用 <code>&gt;&gt;&gt;</code> 操作符：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.a</span> &gt;&gt;&gt; <span class="selector-class">.b</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* ... */</span></span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上述代码将会编译成：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.a</span><span class="selector-attr">[data-v-f3f3eg9]</span> <span class="selector-class">.b</span> &#123;</span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h4><blockquote>
<p>注意点：如果子组件dom不在父组件内部 例如：dialog组件, 通过深度作用选择器也不会生效<br>这时需要通过 全局样式即去除 scoped  + 子组件calss  + 选择器 来实现</p>
</blockquote>
<p>有些像 Sass 之类的预处理器无法正确解析 <code>&gt;&gt;&gt;</code>。这种情况下你可以使用 <code>/deep/</code> 或 <code>::v-deep</code> 操作符取而代之——两者都是 <code>&gt;&gt;&gt;</code> 的别名，同样可以正常工作。</p>
<p>参考： <a href="%5Bhttps://vue-loader.vuejs.org/zh/guide/scoped-css.html#%E6%B7%B1%E5%BA%A6%E4%BD%9C%E7%94%A8%E9%80%89%E6%8B%A9%E5%99%A8%5D(https://vue-loader.vuejs.org/zh/guide/scoped-css.html#%E6%B7%B1%E5%BA%A6%E4%BD%9C%E7%94%A8%E9%80%89%E6%8B%A9%E5%99%A8)">vue-loader 官方文档-深度作用选择器</a></p>
<h3 id="Vue-中的-v-bind-使用问题"><a href="#Vue-中的-v-bind-使用问题" class="headerlink" title="Vue 中的 v-bind 使用问题"></a>Vue 中的 v-bind 使用问题</h3><blockquote>
<p>在 vue 中使用 v-bind 绑定对象时 需要注意 ：v-bind 绑定值不会覆盖之前的属性</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">  <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">class</span>=<span class="string">&quot;test&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:disabled</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-bind</span>=<span class="string">&quot;&#123; disabled: true, class: &#x27;test3&#x27; &#125;&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 上面的代码disabled显示的还是false 但是class可以进行合并 显示：class=&quot;test test3&quot; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">  <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">class</span>=<span class="string">&quot;test&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:class</span>=<span class="string">&quot;&#x27;test2&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:disabled</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-bind</span>=<span class="string">&quot;&#123; disabled: true, class: &#x27;test3&#x27; &#125;&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--注意： class 只能合并一次  最后显示 class=&quot;test test2&quot;--&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="模板-v-bind-绑定值的变量名为-class-报-‘v-bind’-directives-require-an-attribute-value-eslint"><a href="#模板-v-bind-绑定值的变量名为-class-报-‘v-bind’-directives-require-an-attribute-value-eslint" class="headerlink" title="模板 v-bind 绑定值的变量名为 class 报 ‘v-bind’ directives require an attribute value.eslint"></a>模板 v-bind 绑定值的变量名为 class 报 ‘v-bind’ directives require an attribute value.eslint</h4><blockquote>
<p>在模板中绑定的名称不要用 class 作为命名 否则 eslint 会报’v-bind’ directives require an attribute value.eslint</p>
</blockquote>
<blockquote>
<p>$attrs 可以获取任何绑定在组件上的属性 但（ <code>porp</code>中的属性和 <code>class</code> 和 <code>style</code> 除外）</p>
</blockquote>
<h3 id="vue-property-decorator-注意事项（ts-项目中）"><a href="#vue-property-decorator-注意事项（ts-项目中）" class="headerlink" title="vue-property-decorator 注意事项（ts 项目中）"></a>vue-property-decorator 注意事项（ts 项目中）</h3><p>介绍链接[<a href="https://segmentfault.com/a/1190000019906321]">https://segmentfault.com/a/1190000019906321]</a></p>
<h4 id="1-新建组件必须加-Component-否则组件会怎样都不现实"><a href="#1-新建组件必须加-Component-否则组件会怎样都不现实" class="headerlink" title="1.新建组件必须加@Component 否则组件会怎样都不现实"></a>1.新建组件必须加@Component 否则组件会怎样都不现实</h4><h3 id="router-传参-注意事项"><a href="#router-传参-注意事项" class="headerlink" title="router 传参 注意事项"></a>router 传参 注意事项</h3><blockquote>
<p>路由传参 query 和 params 显示到地址栏形式的 注意 不要超长 ，否则浏览器会报 413 错误 ， 传参需要按需传送</p>
</blockquote>
<h3 id="prop-中默认值返回空对象"><a href="#prop-中默认值返回空对象" class="headerlink" title="prop 中默认值返回空对象"></a>prop 中默认值返回空对象</h3><p>prop 中 default 默认值 返回对象或数组需要使用工厂函数 ，一般我们都会用箭头函数简写</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">props</span>: &#123;</span><br><span class="line">  <span class="attr">defaultText</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Array</span>,</span><br><span class="line">    <span class="attr">default</span>: <span class="function">()=&gt;</span> []    <span class="comment">// 工厂函数返回空数组</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 错误写法</span></span><br><span class="line">  <span class="attr">defaultAttrs</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Object</span>,</span><br><span class="line">    <span class="attr">default</span>: <span class="function">()=&gt;</span> &#123;&#125;    <span class="comment">// 但是返回空对象就不能直接=&gt;&#123;&#125; 这样就代表函数的块级作用域了 会报错</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 正确写法</span></span><br><span class="line">   <span class="attr">defaultAttrs</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Object</span>,</span><br><span class="line">    <span class="attr">default</span>: <span class="function">()=&gt;</span> (&#123;&#125;)    <span class="comment">// 在&#123;&#125;外面包一层()即可</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h3 id="使用-v-on-x3D-”-listeners”-的注意事项"><a href="#使用-v-on-x3D-”-listeners”-的注意事项" class="headerlink" title="使用 v-on&#x3D;”$listeners” 的注意事项"></a>使用 v-on&#x3D;”$listeners” 的注意事项</h3><h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><p> 内部使用了 v-on&#x3D;”$listeners” 的组件事件被重复调用</p>
<h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><p>这里有个 Father 组件</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Child</span> <span class="attr">v-on</span>=<span class="string">&quot;$listeners&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;$emit(&#x27;click&#x27;)&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>Child组件上用$listeners接收外部传入的所有事件 同时有独立 click 绑定</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Father</span> @<span class="attr">click</span>=<span class="string">&quot;onClick&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">Father</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Father 组件上 绑定  onClick  </p>
<h5 id="行为"><a href="#行为" class="headerlink" title="行为"></a>行为</h5><p>此时触发 Child组件的 click 事件</p>
<h5 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h5><p>onClick事件被触发 2 次</p>
<h4 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h4><p>$listeners 中 click 和  单独绑定的 click 都被掉用了<br>我们在 Father 的 created中看一下 $listeners</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$listeners</span>  <span class="comment">// &#123; click: ƒ, input: ƒ&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h5><p>Father.$listeners.click 直接被绑到了 Child 上  @click 也被绑定到到了 Child 上<br>Child click 被触发<br>1 调用 Father.$listeners.click  （也就是onClick）<br>2 调用 @click -&gt; 触发 $emit(‘click’) -&gt; 调用 onClick</p>
<h4 id="解决-3"><a href="#解决-3" class="headerlink" title="解决"></a>解决</h4><p>v-on&#x3D;”$listeners” 同时又想自己绑定一些事件的情况 防止重复调用 可以使用合并事件的方式</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Child</span> <span class="attr">v-on</span>=<span class="string">&quot;listeners&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Father&quot;</span>,</span><br><span class="line">  <span class="attr">components</span>: &#123;</span><br><span class="line">    <span class="title class_">Child</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">computed</span>: &#123;</span><br><span class="line">    <span class="title function_">listeners</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...<span class="variable language_">this</span>.<span class="property">$listeners</span>,</span><br><span class="line">        <span class="comment">// 用下面 click 覆盖  this.$listeners.click</span></span><br><span class="line">        <span class="attr">click</span>: <span class="function">() =&gt;</span> <span class="variable language_">this</span>.$emit(<span class="string">&quot;click&quot;</span>),</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="注意点-attrs-不会出现这种情况"><a href="#注意点-attrs-不会出现这种情况" class="headerlink" title="注意点 $attrs 不会出现这种情况"></a>注意点 $attrs 不会出现这种情况</h4><blockquote>
<p>$attrs 包含了父作用域中不作为 prop 被识别 (且获取) 的 attribute 绑定 (class 和 style 除外)</p>
</blockquote>
<p>意味着 prop中的属性 就不会出现在 $attrs 中 ，导致重复出现</p>
<h4 id="Vue3-去除了-listeners"><a href="#Vue3-去除了-listeners" class="headerlink" title="Vue3 去除了$listeners"></a>Vue3 去除了$listeners</h4><p>vue3 中去除了 $listeners 统一在 $attrs 中</p>
<p>并且 添加了 emits ，同 props 用法类似， 是用于定义需要触发的事件的</p>
<p>在 emits 和 props 定义的属性 都不会在 $attrs 中出现 ，这意味的不会出现多次调用的可能 ！ vue3是挺好！😏</p>
<h3 id="Vetur-在vue文件中-script-不高亮"><a href="#Vetur-在vue文件中-script-不高亮" class="headerlink" title="Vetur 在vue文件中 script 不高亮"></a>Vetur 在vue文件中 script 不高亮</h3><p><a href="https://bitbw.top/public/img/my_gallery/Snipaste_2022-10-20_11-06-39.png">不高亮</a></p>
<p>在 vue 文件中不高量</p>
<h4 id="原因-1"><a href="#原因-1" class="headerlink" title="原因"></a>原因</h4><p><code>&lt;/template&gt;</code>标签位置不对</p>
<p><a href="https://bitbw.top/public/img/my_gallery/Snipaste_2022-10-20_11-11-08.png">解决</a></p>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>WebSocket的简单了解和使用</title>
    <url>/2020/05/09/%E7%BD%91%E7%BB%9C%E5%BA%94%E7%94%A8/WebSocket%E7%9A%84%E7%AE%80%E5%8D%95%E4%BA%86%E8%A7%A3%E5%92%8C%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h2><p><img data-src="https://bitbw.top/public/img/my_gallery/bg2017051501.png" alt="img"></p>
<ul>
<li>WebSocket 是一种数据通信协议，类似于我们常见的 http</li>
<li>既然有 http，为啥还要 WebSocket</li>
<li>http 通信是单向的<ul>
<li>请求 + 响应</li>
<li>没有请求也就没有响应</li>
</ul>
</li>
</ul>
<p>初次接触 WebSocket 的人，都会问同样的问题：我们已经有了 HTTP 协议，为什么还需要另一个协议？它能带来什么好处？</p>
<span id="more"></span>

<p>答案很简单，因为 HTTP 协议有一个缺陷：通信只能由客户端发起。</p>
<p>举例来说，我们想了解今天的天气，只能是客户端向服务器发出请求，服务器返回查询结果。HTTP 协议做不到服务器主动向客户端推送信息。</p>
<p>这种单向请求的特点，注定了如果服务器有连续的状态变化，客户端要获知就非常麻烦。我们只能使用<a href="https://www.pubnub.com/blog/2014-12-01-http-long-polling/">“轮询”</a>：每隔一段时候，就发出一个询问，了解服务器有没有新的信息。最典型的场景就是聊天室。</p>
<p>轮询的效率低，非常浪费资源（因为必须不停连接，或者 HTTP 连接始终打开）。因此，工程师们一直在思考，有没有更好的方法。WebSocket 就是这样发明的。</p>
<p>WebSocket 协议在 2008 年诞生，2011 年成为国际标准。所有浏览器都已经支持了。</p>
<p>它的最大特点就是，<strong>服务器可以主动向客户端推送信息</strong>，<strong>客户端也可以主动向服务器发送信息</strong>，是真正的<strong>双向平等对话</strong>，属于<a href="https://en.wikipedia.org/wiki/Push_technology">服务器推送技术</a>的一种。</p>
<p>简单理解：</p>
<p>HTTP 打电话：</p>
<ul>
<li>我问一句</li>
<li>你回答一句</li>
<li>没有提问就没有回答，即便对方主动给你说话，我也是个聋子听不见</li>
</ul>
<p>WebSocket 打电话：</p>
<ul>
<li>双向对话</li>
</ul>
<p><img data-src="https://bitbw.top/public/img/my_gallery/bg2017051502.png" alt="img"></p>
<blockquote>
<p>HTTP 和 WebSocket 通信模型</p>
</blockquote>
<p>其他特点包括：</p>
<p>（1）建立在 TCP 协议之上，服务器端的实现比较容易。</p>
<p>（2）与 HTTP 协议有着良好的兼容性。默认端口也是 80 和 443，并且握手阶段（第 1 次建立连接）采用 HTTP 协议，因此握手时不容易屏蔽，能通过各种 HTTP 代理服务器。</p>
<p>（3）数据格式比较轻量，性能开销小，通信高效。</p>
<p>（4）可以发送文本，也可以发送二进制数据。</p>
<p>（5）没有同源跨域限制，客户端可以与任意服务器通信。</p>
<p>（6）协议标识符是<code>ws</code>（如果加密，则为<code>wss</code>），服务器网址就是 URL。</p>
<p>（7）浏览器专门为 WebSocket 通信提供了一个请求对象 <code>WebSocket</code></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">ws:<span class="regexp">//</span>example.com:<span class="number">80</span><span class="regexp">/some/</span>path</span><br></pre></td></tr></table></figure>

<p><img data-src="https://bitbw.top/public/img/my_gallery/bg2017051503.jpg" alt="img"></p>
<h2 id="使用原生-WebSocket（了解）"><a href="#使用原生-WebSocket（了解）" class="headerlink" title="使用原生 WebSocket（了解）"></a>使用原生 WebSocket（了解）</h2><blockquote>
<p>参考文档：</p>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket">MDN - WebSocket</a></li>
</ul>
</blockquote>
<p>浏览器为 HTTP 通信提供了 <code>XMLHttpRequest</code> 对象，同样的，也为 WebSocket 通信提供了一个通信操作接口：<code>WebSocket</code>。</p>
<p>通信模型：</p>
<ul>
<li>拨号（建立连接）</li>
<li>通话（双向通信）</li>
<li>结束通话（关闭连接）</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// WebSocet 通信模型</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 1. 拨打电话（建立连接）</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 注意：wss://echo.websocket.org 是一个在线的测试接口，仅用于 WebSocket 协议通信测试使用</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> ws = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&quot;wss://echo.websocket.org&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 当连接建立成功，触发 open 事件</span></span></span><br><span class="line"><span class="language-javascript">      ws.<span class="property">onopen</span> = <span class="keyword">function</span> (<span class="params">evt</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;建立连接成功 ...&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 连接建立成功以后，就可以使用这个连接对象通信了</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// send 方法发送数据</span></span></span><br><span class="line"><span class="language-javascript">        ws.<span class="title function_">send</span>(<span class="string">&quot;Hello WebSockets!&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 当接收到对方发送的消息的时候，触发 message 事件</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 我们可以通过回调函数的 evt.data 获取对方发送的数据内容</span></span></span><br><span class="line"><span class="language-javascript">      ws.<span class="property">onmessage</span> = <span class="keyword">function</span> (<span class="params">evt</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;接收到消息: &quot;</span> + evt.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 当不需要通信的时候，可以手动的关闭连接</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// ws.close();</span></span></span><br><span class="line"><span class="language-javascript">      &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 当连接断开的时候触发 close 事件</span></span></span><br><span class="line"><span class="language-javascript">      ws.<span class="property">onclose</span> = <span class="keyword">function</span> (<span class="params">evt</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;连接已关闭.&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>怎么查看 WebSocket 请求日志：</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/1569575005360.png" alt="1569575005360"></p>
<blockquote>
<p>朝上的绿色箭头是发出去的消息</p>
<p>朝下的红色箭头是收到的消息</p>
</blockquote>
<h2 id="Socket-IO（了解体验）"><a href="#Socket-IO（了解体验）" class="headerlink" title="Socket.IO（了解体验）"></a>Socket.IO（了解体验）</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><ul>
<li>原生的 WebSocket 使用比较麻烦，所以推荐使用一个封装好的解决方案：socket.io</li>
<li>socket.io 提供了服务端 + 客户端的实现<ul>
<li>客户端：浏览器</li>
<li>服务端：Java、Python、PHP、。。。。Node.js</li>
</ul>
</li>
<li>对于前端开发者来说，只需要关心她的客户端如何使用即可</li>
<li>注意：Socket.io 必须前后端配套使用<ul>
<li>实际工作中，socket.io 已经成为了各大后端开发的 WebSocket 通信主流解决方案</li>
</ul>
</li>
<li><a href="https://github.com/socketio/socket.io">GitHub 仓库</a></li>
<li><a href="https://socket.io/">官网</a></li>
</ul>
<p>Socket.io 和 WebSocket 就好比它就好比 axios 和 XMLHTTPRequest 的关系。</p>
<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><p>官方的 Hello World：<a href="https://socket.io/get-started/chat/">https://socket.io/get-started/chat/</a>。</p>
<p>服务端代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>)();</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>).<span class="title function_">createServer</span>(app);</span><br><span class="line"><span class="keyword">var</span> io = <span class="built_in">require</span>(<span class="string">&quot;socket.io&quot;</span>)(http);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">sendFile</span>(__dirname + <span class="string">&quot;/index.html&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">io.<span class="title function_">on</span>(<span class="string">&quot;connection&quot;</span>, <span class="keyword">function</span> (<span class="params">socket</span>) &#123;</span><br><span class="line">  socket.<span class="title function_">on</span>(<span class="string">&quot;disconnect&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;user disconnected&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  socket.<span class="title function_">on</span>(<span class="string">&quot;chat message&quot;</span>, <span class="keyword">function</span> (<span class="params">msg</span>) &#123;</span><br><span class="line">    io.<span class="title function_">emit</span>(<span class="string">&quot;chat message&quot;</span>, msg);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">http.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="string">&quot;0.0.0.0&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;listening on *:3000&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>客户端代码：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Socket.IO chat<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">      * &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">font</span>: <span class="number">13px</span> Helvetica, Arial;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      <span class="selector-tag">form</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: <span class="number">#000</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">padding</span>: <span class="number">3px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">position</span>: fixed;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">bottom</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      <span class="selector-tag">form</span> <span class="selector-tag">input</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">padding</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">90%</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-right</span>: <span class="number">0.5%</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      <span class="selector-tag">form</span> <span class="selector-tag">button</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">9%</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: <span class="built_in">rgb</span>(<span class="number">130</span>, <span class="number">224</span>, <span class="number">255</span>);</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">padding</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      <span class="selector-id">#messages</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">list-style-type</span>: none;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      <span class="selector-id">#messages</span> <span class="selector-tag">li</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      <span class="selector-id">#messages</span> <span class="selector-tag">li</span><span class="selector-pseudo">:nth-child</span>(odd) &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: <span class="number">#eee</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 消息列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;messages&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 发送消息的表单 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;m&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">button</span>&gt;</span>Send<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- SocketIO 提供了一个客户端实现：socket.io.js --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/socket.io/socket.io.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://code.jquery.com/jquery-1.11.1.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 建立连接，得到 socket 通信对象</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> socket = <span class="title function_">io</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      socket.<span class="title function_">on</span>(<span class="string">&quot;connect&quot;</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;建立连接成功了&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      $(<span class="string">&quot;form&quot;</span>).<span class="title function_">submit</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        e.<span class="title function_">preventDefault</span>(); <span class="comment">// prevents page reloading</span></span></span><br><span class="line"><span class="language-javascript">        socket.<span class="title function_">emit</span>(<span class="string">&quot;chat message&quot;</span>, $(<span class="string">&quot;#m&quot;</span>).<span class="title function_">val</span>());</span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;#m&quot;</span>).<span class="title function_">val</span>(<span class="string">&quot;&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      socket.<span class="title function_">on</span>(<span class="string">&quot;chat message&quot;</span>, <span class="keyword">function</span> (<span class="params">msg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;#messages&quot;</span>).<span class="title function_">append</span>($(<span class="string">&quot;&lt;li&gt;&quot;</span>).<span class="title function_">text</span>(msg));</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>我们只需要关注客户端怎么使用：</p>
<ul>
<li>怎么建立连接</li>
<li>怎么发送消息</li>
<li>怎么接收消息</li>
</ul>
<p>建立连接：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> socket = <span class="title function_">io</span>(<span class="string">&quot;连接地址&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>发送数据：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 发送指定类型的消息</span></span><br><span class="line"><span class="comment">// 数据可以是任何类型</span></span><br><span class="line">socket.<span class="title function_">emit</span>(<span class="string">&quot;消息类型&quot;</span>, 数据);</span><br></pre></td></tr></table></figure>

<p>接收消息：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 消息类型</span></span><br><span class="line"><span class="comment">// 回调函数参数获取消息数据</span></span><br><span class="line">socket.<span class="title function_">on</span>(<span class="string">&quot;消息类型&quot;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>消息类型由后端给出，他会告诉你收发消息的类型，就好比 HTTP 接口中的请求路径一样。</p>
</blockquote>
<p>利用广播实现多人沟通</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//服务器端</span></span><br><span class="line">io.<span class="title function_">on</span>(<span class="string">&quot;connection&quot;</span>, <span class="keyword">function</span> (<span class="params">socket</span>) &#123;</span><br><span class="line">  socket.<span class="property">broadcast</span>.<span class="title function_">emit</span>(<span class="string">&quot;有用户连接&quot;</span>);</span><br><span class="line">  <span class="comment">//这条信息会发送给除了当前socket的其他用户</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>网络应用</category>
      </categories>
      <tags>
        <tag>网络应用</tag>
      </tags>
  </entry>
  <entry>
    <title>Web前端高频面试题全解析记录</title>
    <url>/2021/10/09/%E9%9D%A2%E8%AF%95/Web%E5%89%8D%E7%AB%AF%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98%E5%85%A8%E8%A7%A3%E6%9E%90%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<h2 id="var-变量提升"><a href="#var-变量提升" class="headerlink" title="var 变量提升"></a>var 变量提升</h2><p>var 申明的变量会被提升到当前作用域的最顶端<br>所谓作用域是 <code>function</code> 这样的函数才算是, <code>if</code> <code>else</code> <code>for</code> 等带 <code>&#123;&#125;</code> 的是没有作用域的无论嵌套多少层都会提升</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(i); <span class="comment">//var i 被提升到这里 结果是 undefind ，如果没提升就会报 Uncaught ReferenceError: i is not defined</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="comment">// for 中  var i = 0; 会被提到最上面</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;World!&#x27;</span>;</span><br><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"> <span class="keyword">if</span> (<span class="keyword">typeof</span> name === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line"> <span class="keyword">var</span> name = <span class="string">&#x27;Jack&#x27;</span>; <span class="comment">// 这个会被提升到当前作用域的最顶端 var name</span></span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Goodbye &#x27;</span> + name); </span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Hello &#x27;</span> + name);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Array-3-和-Array-from-length-3"><a href="#Array-3-和-Array-from-length-3" class="headerlink" title="Array(3) 和 Array.from({length:3})"></a>Array(3) 和 Array.from({length:3})</h2><p><code>Array(3)</code> 是创建了一个 length: 3 没有经过初始化的数组，数组每一项其实是<code>empty</code>也就是未经初始化<br><code>Array.from(&#123;length:3&#125;)</code> 是创建了一个 length: 3 经过初始化的数组,数组每一项是 <code>undefind</code></p>
<p>使用时的区别 Array.prototype.map filter forEach 等， 只有数组中被初始化过元素才会被触发，也就是说未经初始化的元素压根不会被遍历到</p>
<h2 id="手写-async-await"><a href="#手写-async-await" class="headerlink" title="手写 async await"></a>手写 async await</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 包装 generator 函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">asyncToGenerator</span>(<span class="params">generatorFunc</span>) &#123;</span><br><span class="line">  <span class="comment">// 返回的是一个新的函数</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 先调用generator函数 生成迭代器</span></span><br><span class="line">    <span class="comment">// 对应 var gen = testG()</span></span><br><span class="line">    <span class="keyword">const</span> gen = generatorFunc.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">    <span class="comment">// 返回一个promise 因为外部是用.then的方式 或者await的方式去使用这个函数的返回值的</span></span><br><span class="line">    <span class="comment">// var test = asyncToGenerator(testG)</span></span><br><span class="line">    <span class="comment">// test().then(res =&gt; console.log(res))</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 内部定义一个step函数 用来一步一步的跨过yield的阻碍</span></span><br><span class="line">      <span class="comment">// key有next和throw两种取值，分别对应了gen的next和throw方法</span></span><br><span class="line">      <span class="comment">// arg参数则是用来把promise resolve出来的值交给下一个yield</span></span><br><span class="line">      <span class="keyword">function</span> <span class="title function_">step</span>(<span class="params">key, arg</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> generatorResult;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 这个方法需要包裹在try catch中</span></span><br><span class="line">        <span class="comment">// 如果报错了 就把promise给reject掉 外部通过.catch可以获取到错误</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          generatorResult = gen[key](arg);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">reject</span>(error);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// gen.next() 得到的结果是一个 &#123; value, done &#125; 的结构</span></span><br><span class="line">        <span class="keyword">const</span> &#123; value, done &#125; = generatorResult;</span><br><span class="line">        <span class="keyword">if</span> (done) &#123;</span><br><span class="line">          <span class="comment">// 如果已经完成了 就直接resolve这个promise</span></span><br><span class="line">          <span class="comment">// 这个done是在最后一次调用next后才会为true</span></span><br><span class="line">          <span class="comment">// 以本文的例子来说 此时的结果是 &#123; done: true, value: &#x27;success&#x27; &#125;</span></span><br><span class="line">          <span class="comment">// 这个value也就是generator函数最后的返回值</span></span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">resolve</span>(value);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// 除了最后结束的时候外，每次调用gen.next()</span></span><br><span class="line">          <span class="comment">// 其实是返回 &#123; value: Promise, done: false &#125; 的结构，</span></span><br><span class="line"></span><br><span class="line">          <span class="comment">// 这里要注意的是Promise.resolve可以接受一个promise为参数</span></span><br><span class="line">          <span class="comment">// 并且这个promise参数被resolve的时候，这个then才会被调用</span></span><br><span class="line">          <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(</span><br><span class="line">            <span class="comment">// 这个value对应的是yield后面的promise</span></span><br><span class="line">            value</span><br><span class="line">          ).<span class="title function_">then</span>(</span><br><span class="line">            <span class="comment">/*        </span></span><br><span class="line"><span class="comment">            // value这个promise被resove的时候，就会执行next</span></span><br><span class="line"><span class="comment">            // 并且只要done不是true的时候 就会递归的往下解开promise</span></span><br><span class="line"><span class="comment">            // 对应</span></span><br><span class="line"><span class="comment">            gen.next().value.then(value =&gt; &#123;</span></span><br><span class="line"><span class="comment">            gen.next(value).value.then(value2 =&gt; &#123;</span></span><br><span class="line"><span class="comment">            gen.next()</span></span><br><span class="line"><span class="comment">            // 此时done为true了 整个promise被resolve了</span></span><br><span class="line"><span class="comment">            // 最外部的test().then(res =&gt; console.log(res))的then就开始执行了</span></span><br><span class="line"><span class="comment">            &#125;) */</span></span><br><span class="line">            <span class="keyword">function</span> <span class="title function_">onResolve</span>(<span class="params">val</span>) &#123;</span><br><span class="line">              <span class="title function_">step</span>(<span class="string">&quot;next&quot;</span>, val);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 如果promise被reject了 就再次进入step函数</span></span><br><span class="line">            <span class="comment">// 不同的是，这次的try catch中调用的是gen.throw(err)</span></span><br><span class="line">            <span class="comment">// 那么自然就被catch到 然后把promise给reject掉啦</span></span><br><span class="line">            <span class="keyword">function</span> <span class="title function_">onReject</span>(<span class="params">err</span>) &#123;</span><br><span class="line">              <span class="title function_">step</span>(<span class="string">&quot;throw&quot;</span>, err);</span><br><span class="line">            &#125;</span><br><span class="line">          );</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">step</span>(<span class="string">&quot;next&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 模拟 async 的 generator 函数</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">generatorFunc</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Promise padding&quot;</span>);</span><br><span class="line">      <span class="title function_">resolve</span>(<span class="string">&quot;Promise res&quot;</span>);</span><br><span class="line">    &#125;, <span class="number">100</span>)</span><br><span class="line">  );</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Promise end&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;res&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">var</span> asyncFn = <span class="title function_">asyncToGenerator</span>(generatorFunc);</span><br><span class="line"><span class="title function_">asyncFn</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res));</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>面试</category>
      </categories>
      <tags>
        <tag>面试</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows Termial设置</title>
    <url>/2021/04/13/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/Windows-Termial%E8%AE%BE%E7%BD%AE/</url>
    <content><![CDATA[<h1 id="Windows-Termial"><a href="#Windows-Termial" class="headerlink" title="Windows Termial"></a>Windows Termial</h1><h2 id="安装-Windows-Termial"><a href="#安装-Windows-Termial" class="headerlink" title="安装 Windows Termial"></a>安装 Windows Termial</h2><p><a href="https://github.com/microsoft/terminal">https://github.com/microsoft/terminal</a></p>
<h2 id="在-PowerShell-中设置-Powerline"><a href="#在-PowerShell-中设置-Powerline" class="headerlink" title="在 PowerShell 中设置 Powerline"></a>在 PowerShell 中设置 Powerline</h2><p><a href="https://docs.microsoft.com/en-us/windows/terminal/tutorials/powerline-setup">https://docs.microsoft.com/en-us/windows/terminal/tutorials/powerline-setup</a></p>
<h3 id="安装-Cascadia-Mono-PL-字体"><a href="#安装-Cascadia-Mono-PL-字体" class="headerlink" title="安装 Cascadia Mono PL 字体"></a>安装 Cascadia Mono PL 字体</h3><p><a href="https://github.com/microsoft/cascadia-code/releases">https://github.com/microsoft/cascadia-code/releases</a></p>
<p>使用<code>notepad $PROFILE</code>打开编辑文本</p>
<p>设置启动后导入 posh-git， oh-my-posh ，</p>
<p>设置主题 powerline：Set-PoshPrompt paradox</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Import-Module posh-git</span><br><span class="line">Import-Module oh-my-posh</span><br><span class="line">Set-PoshPrompt paradox</span><br></pre></td></tr></table></figure>

<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>使用 Set-Theme 会报错：Set-Theme : 无法将“Set-Theme”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。请检查名称的拼写，如果包括路径，请确保路径正确，然后再试一次。</p>
<blockquote>
<p>原因：oh-my-posh v3 不支持 Set-Theme 命令 ，需要使用 Set-PoshPrompt -Theme xxx</p>
</blockquote>
<p>解决方案：<a href="https://www.icode9.com/content-4-866063.html">https://www.icode9.com/content-4-866063.html</a></p>
<p>官网介绍：<a href="https://ohmyposh.dev/docs/upgrading/">https://ohmyposh.dev/docs/upgrading/</a></p>
<p>官方是使用 <strong>Get-PoshThemes</strong> 查看支持主题；</p>
<h2 id="分屏操作"><a href="#分屏操作" class="headerlink" title="分屏操作"></a>分屏操作</h2><p><a href="https://docs.microsoft.com/zh-cn/windows/terminal/panes">https://docs.microsoft.com/zh-cn/windows/terminal/panes</a></p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="settting-json"><a href="#settting-json" class="headerlink" title="settting.json"></a>settting.json</h3><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">// This file was initially generated by Windows Terminal 1.6.10571.0</span></span><br><span class="line"><span class="comment">// It should still be usable in newer versions, but newer versions might have additional</span></span><br><span class="line"><span class="comment">// settings, help text, or changes that you will not see unless you clear this file</span></span><br><span class="line"><span class="comment">// and let us generate a new one for you.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// To view the default settings, hold &quot;alt&quot; while clicking on the &quot;Settings&quot; button.</span></span><br><span class="line"><span class="comment">// For documentation on these settings, see: https://aka.ms/terminal-documentation</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;$schema&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://aka.ms/terminal-profiles-schema&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;defaultProfile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;61c54bbd-c2c6-5271-96e7-009a87ff44bf&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// You can add more global application settings here.</span></span><br><span class="line">  <span class="comment">// To learn more about global settings, visit https://aka.ms/terminal-global-settings</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// If enabled, selections are automatically copied to your clipboard.</span></span><br><span class="line">  <span class="attr">&quot;copyOnSelect&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// If enabled, formatted data is also copied to your clipboard</span></span><br><span class="line">  <span class="attr">&quot;copyFormatting&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// A profile specifies a command to execute paired with information about how it should look and feel.</span></span><br><span class="line">  <span class="comment">// Each one of them will appear in the &#x27;New Tab&#x27; dropdown,</span></span><br><span class="line">  <span class="comment">//   and can be invoked from the commandline with `wt.exe -p xxx`</span></span><br><span class="line">  <span class="comment">// To learn more about profiles, visit https://aka.ms/terminal-profile-settings</span></span><br><span class="line">  <span class="attr">&quot;profiles&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;defaults&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="comment">// Put settings here that you want to apply to all profiles.</span></span><br><span class="line">      <span class="attr">&quot;startingDirectory&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fontFace&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MesloLGM Nerd Font&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fontSize&quot;</span><span class="punctuation">:</span> <span class="number">12</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="comment">// Make changes here to the powershell.exe profile.</span></span><br><span class="line">        <span class="attr">&quot;guid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;61c54bbd-c2c6-5271-96e7-009a87ff44bf&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Windows PowerShell&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;commandline&quot;</span><span class="punctuation">:</span> <span class="string">&quot;powershell.exe&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;hidden&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">// 浅色主题</span></span><br><span class="line">        <span class="comment">// &quot;acrylicOpacity&quot;: 0.7,</span></span><br><span class="line">        <span class="comment">// &quot;colorScheme&quot; : &quot;Frost&quot;,</span></span><br><span class="line">        <span class="comment">// &quot;cursorColor&quot; : &quot;#000000&quot;,</span></span><br><span class="line">        <span class="comment">// &quot;fontFace&quot; : &quot;Cascadia Code PL&quot;,</span></span><br><span class="line">        <span class="comment">// &quot;useAcrylic&quot;: true</span></span><br><span class="line">        <span class="comment">// 深色主题</span></span><br><span class="line">        <span class="attr">&quot;acrylicOpacity&quot;</span><span class="punctuation">:</span> <span class="number">0.7</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;colorScheme&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Vintage&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;cursorColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFFFFD&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;fontFace&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MesloLGM Nerd Font&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;useAcrylic&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;guid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;3ef3d962-7a99-4b13-93b6-b92a4d42a2e0&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;hidden&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bash&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;commandline&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C:\\Program Files\\Git\\bin\\bash.exe&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;colorScheme&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Raspberry&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;cursorColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFFFFF&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">// &quot;fontFace&quot; : &quot;Cascadia Code PL&quot;,</span></span><br><span class="line">        <span class="attr">&quot;padding&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5, 5, 5, 5&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;suppressApplicationTitle&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;tabTitle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bash&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="comment">// Make changes here to the cmd.exe profile.</span></span><br><span class="line">        <span class="attr">&quot;guid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;0caa0dad-35be-5f56-a8ff-afceeeaa6101&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;命令提示符&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;commandline&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cmd.exe&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;hidden&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;closeOnExit&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;colorScheme&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Retro&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;cursorColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFFFFF&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;cursorShape&quot;</span><span class="punctuation">:</span> <span class="string">&quot;filledBox&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;fontSize&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;padding&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5, 5, 5, 5&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;tabTitle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Command Prompt&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;fontFace&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PxPlus IBM VGA8&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;experimental.retroTerminalEffect&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;guid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;2c4de342-38b7-51cf-b940-2309a097f518&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;hidden&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Ubuntu&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">// &quot;source&quot;: &quot;Windows.Terminal.Wsl&quot;,</span></span><br><span class="line">        <span class="attr">&quot;colorScheme&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Raspberry&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;cursorColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFFFFF&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;fontFace&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MesloLGM Nerd Font&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;padding&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5, 5, 5, 5&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;suppressApplicationTitle&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;tabTitle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Ubuntu&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;guid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;574e775e-4f2a-5b96-ac1e-a2962a402336&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;hidden&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PowerShell&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Windows.Terminal.PowershellCore&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;acrylicOpacity&quot;</span><span class="punctuation">:</span> <span class="number">0.7</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;colorScheme&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Vintage&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;cursorColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFFFFD&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;fontFace&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MesloLGM Nerd Font&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;useAcrylic&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;guid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;b453ae62-4e3d-5e58-b989-0a998ec441b8&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;hidden&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Azure Cloud Shell&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Windows.Terminal.Azure&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Add custom color schemes to this array.</span></span><br><span class="line">  <span class="comment">// To learn more about color schemes, visit https://aka.ms/terminal-color-schemes</span></span><br><span class="line">  <span class="attr">&quot;schemes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="comment">// 毛玻璃</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Frost&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFFFFF&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;black&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#3C5712&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;blue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#17b2ff&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brightBlack&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#749B36&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brightBlue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#27B2F6&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brightCyan&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#13A8C0&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brightGreen&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#89AF50&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brightPurple&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#F2A20A&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brightRed&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#F49B36&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brightWhite&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#741274&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brightYellow&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#991070&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;cyan&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#3C96A6&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;foreground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#000000&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;green&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#6AAE08&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;purple&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#991070&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;red&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#8D0C0C&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;white&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#6E386E&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;yellow&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#991070&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 复古</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Retro&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#000000&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;black&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#00ff00&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;blue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#00ff00&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brightBlack&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#00ff00&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brightBlue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#00ff00&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brightCyan&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#00ff00&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brightGreen&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#00ff00&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brightPurple&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#00ff00&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brightRed&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#00ff00&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brightWhite&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#00ff00&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brightYellow&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#00ff00&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;cyan&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#00ff00&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;foreground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#00ff00&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;green&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#00ff00&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;purple&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#00ff00&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;red&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#00ff00&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;white&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#00ff00&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;yellow&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#00ff00&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// ubuntu</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Raspberry&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#3C0315&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;black&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#282A2E&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;blue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#0170C5&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brightBlack&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#676E7A&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brightBlue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#80c8ff&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brightCyan&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#8ABEB7&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brightGreen&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#B5D680&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brightPurple&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#AC79BB&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brightRed&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#BD6D85&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brightWhite&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFFFFD&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;brightYellow&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFFD76&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;cyan&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#3F8D83&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;foreground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFFFFD&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;green&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#76AB23&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;purple&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#7D498F&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;red&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#BD0940&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;white&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FFFFFD&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;yellow&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#E0DE48&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Add custom actions and keybindings to this array.</span></span><br><span class="line">  <span class="comment">// To unbind a key combination from your defaults.json, set the command to &quot;unbound&quot;.</span></span><br><span class="line">  <span class="comment">// To learn more about actions and keybindings, visit https://aka.ms/terminal-keybindings</span></span><br><span class="line">  <span class="attr">&quot;actions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="comment">// Copy and paste are bound to Ctrl+Shift+C and Ctrl+Shift+V in your defaults.json.</span></span><br><span class="line">    <span class="comment">// These two lines additionally bind them to Ctrl+C and Ctrl+V.</span></span><br><span class="line">    <span class="comment">// To learn more about selection, visit https://aka.ms/terminal-selection</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;copy&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;singleLine&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span> <span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="attr">&quot;keys&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ctrl+c&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;paste&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;keys&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ctrl+v&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Press Ctrl+Shift+F to open the search box</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;find&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;keys&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ctrl+f&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;duplicateTab&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;keys&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ctrl+shift+d&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// Press Alt+Shift+D to open a new pane.</span></span><br><span class="line">    <span class="comment">// - &quot;split&quot;: &quot;auto&quot; makes this pane open in the direction that provides the most surface area.</span></span><br><span class="line">    <span class="comment">// - &quot;splitMode&quot;: &quot;duplicate&quot; makes the new pane use the focused pane&#x27;s profile.</span></span><br><span class="line">    <span class="comment">// To learn more about panes, visit https://aka.ms/terminal-panes</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;splitPane&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;split&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vertical&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;splitMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;duplicate&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;keys&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shift+tab&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;splitPane&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;split&quot;</span><span class="punctuation">:</span> <span class="string">&quot;horizontal&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;splitMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;duplicate&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;keys&quot;</span><span class="punctuation">:</span> <span class="string">&quot;alt+shift+-&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;splitPane&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;split&quot;</span><span class="punctuation">:</span> <span class="string">&quot;auto&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;splitMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;duplicate&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;keys&quot;</span><span class="punctuation">:</span> <span class="string">&quot;alt+shift+d&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;closePane&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;keys&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shift+w&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="添加注册列表-右键菜单"><a href="#添加注册列表-右键菜单" class="headerlink" title="添加注册列表(右键菜单)"></a>添加注册列表(右键菜单)</h2><p><a href="https://blog.csdn.net/u011532601/article/details/106305373/">https://blog.csdn.net/u011532601/article/details/106305373/</a></p>
<h4 id="使用别人写好的-bat-程序"><a href="#使用别人写好的-bat-程序" class="headerlink" title="使用别人写好的 bat 程序"></a>使用别人写好的 bat 程序</h4><p>下载地址：<a href="https://github.com/BroJenuel/Explorer-Context-Menu-Integration-for-windows-terminal">https://github.com/BroJenuel/Explorer-Context-Menu-Integration-for-windows-terminal</a></p>
<h4 id="手动配置右键打开"><a href="#手动配置右键打开" class="headerlink" title="手动配置右键打开"></a>手动配置右键打开</h4><ul>
<li>Win+R 输入 regedit 进入注册表目录 HKEY_CLASSES_ROOT\Directory\Background\shell</li>
</ul>
<p>在这里新建一个项命名为 WT 并设置(默认)值为你想要的名称，比如 Windows Terminal Here</p>
<ul>
<li><p>再新建字符串值 Icon 即显示图标，并将值设设置 C:\ProgramFiles\WindowsApps\Microsoft.WindowsTerminal_<version>\WindowsTerminal.exe</p>
<blockquote>
<p>Win10 系统下 WindowsApps 文件夹拒绝访问如何获取权限：</p>
<p><a href="http://www.xitongcheng.com/jiaocheng/win10_article_45151.html">http://www.xitongcheng.com/jiaocheng/win10_article_45151.html</a></p>
</blockquote>
</li>
<li><p>注意：<version>值看你安装的具体版本，可通过 Everything 搜索查证，或者设置为 cmd 的图标 C:\Windows\System32\cmd.exe 免去更新的麻烦，再或者设置你自己的图标，这个不影响使用</p>
</li>
<li><p>如有需要的话可以将这个命令置顶，则添加新字符串值 Position，值为 Top</p>
</li>
<li><p>然后再新建一个项 command，默认值%USERPROFILE%\AppData\Local\Microsoft\WindowsApps\wt.exe</p>
</li>
<li><p>注意：如失效，可将%USERPROFILE%改为指定用户目录如 C:\Users&lt;username&gt;，并注销重启，<username>记得改成自己的用户名</p>
</li>
</ul>
<p>一般出现 explorer.exe 错误多是没有用管理员权限写入导致的</p>
<blockquote>
<p>注意：自动添加的右键菜单会出现复制窗口但工作目录变的情况</p>
</blockquote>
<h3 id="删除程序自带的右键菜单"><a href="#删除程序自带的右键菜单" class="headerlink" title="删除程序自带的右键菜单"></a>删除程序自带的右键菜单</h3><p>github 上有对应的 issues:<a href="https://github.com/microsoft/terminal/issues/8105">https://github.com/microsoft/terminal/issues/8105</a></p>
<p>😓 看来大家都不喜欢程序自动添加的右键菜单</p>
<p>完成后记得<a href="https://www.howtogeek.com/198815/use-this-secret-trick-to-close-and-restart-explorer.exe-in-windows/">重新启动资源管理器</a></p>
<h2 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h2><p><a href="https://github.com/microsoft/terminal/issues/9806">https://github.com/microsoft/terminal/issues/9806</a></p>
<p>powershell.exe 中的普通空格</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20210414173814189.png" alt="image-20210414173814189"></p>
<p>在 Windows terminal 中空格变成 </p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20210414172703793.png" alt="image-20210414172703793"></p>
<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>更换<a href="https://ohmyposh.dev/"><strong>Oh my Posh</strong></a>官方推荐字体：<a href="https://ohmyposh.dev/docs/fonts/">https://ohmyposh.dev/docs/fonts/</a></p>
<p>使用<a href="https://github.com/ryanoasis/nerd-fonts/releases/download/v2.1.0/Meslo.zip">Meslo LGM NF</a></p>
<p><img data-src="https://user-images.githubusercontent.com/55389796/114845441-56ec7580-9e0e-11eb-8c6c-d2512fdc7bf8.png" alt="image03"></p>
<h4 id="setting-json"><a href="#setting-json" class="headerlink" title="setting.json"></a>setting.json</h4><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;fontFace&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;MesloLGM Nerd Font&quot;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<h2 id="修改-vscode-终端字体"><a href="#修改-vscode-终端字体" class="headerlink" title="修改 vscode 终端字体"></a>修改 vscode 终端字体</h2><h4 id="setting-json-1"><a href="#setting-json-1" class="headerlink" title="setting.json"></a>setting.json</h4><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;terminal.integrated.fontFamily&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MesloLGSDZ Nerd Font&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：vscode 只能使用等宽字体 所以得单独设置</p>
</blockquote>
<h2 id="Git-bash-乱码问题"><a href="#Git-bash-乱码问题" class="headerlink" title="Git bash 乱码问题"></a>Git bash 乱码问题</h2><p>解决：<a href="https://www.cnblogs.com/ssrs-wanghao/articles/9216955.html">https://www.cnblogs.com/ssrs-wanghao/articles/9216955.html</a></p>
<p>我就用下面命令一下解决</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git config --global core.quotepath <span class="literal">false</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>工具使用</category>
      </categories>
      <tags>
        <tag>windows</tag>
      </tags>
  </entry>
  <entry>
    <title>XLSX.js的使用</title>
    <url>/2020/07/30/%E6%8F%92%E4%BB%B6/XLSX-js%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<p><a href="http://sheetjs.com/">SheetJS js-xlsx</a> 中文文档： <a href="https://github.com/rockboom/SheetJS-docs-zh-CN">https://github.com/rockboom/SheetJS-docs-zh-CN</a></p>
<h2 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 从头开始创建工作簿</span></span><br><span class="line"><span class="keyword">var</span> wb = <span class="variable constant_">XLSX</span>.<span class="property">utils</span>.<span class="title function_">book_new</span>();</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建工作表</span></span><br><span class="line"><span class="comment"> * aoa_to_sheet    二维数组</span></span><br><span class="line"><span class="comment"> * json_to_sheet   对象数组</span></span><br><span class="line"><span class="comment"> * table_to_sheet  tableDOM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> ws= <span class="variable constant_">XLSX</span>.<span class="property">utils</span>.<span class="title function_">json_to_sheet</span>(json);</span><br><span class="line"><span class="comment">// 把工作表添加到工作簿中</span></span><br><span class="line"><span class="variable constant_">XLSX</span>.<span class="property">utils</span>.<span class="title function_">book_append_sheet</span>(wb, ws, <span class="string">&quot;sheet&quot;</span>);</span><br><span class="line"><span class="comment">// 写入 （node）</span></span><br><span class="line"><span class="variable constant_">XLSX</span>.<span class="title function_">writeFile</span>(wb, path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;./test.xlsx&quot;</span>), &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;buffer&quot;</span>,</span><br><span class="line">  <span class="title class_">Props</span>: &#123; <span class="title class_">Author</span>: <span class="string">&quot;author&quot;</span> &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="merges-的使用"><a href="#merges-的使用" class="headerlink" title="merges 的使用"></a>merges 的使用</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">........</span><br><span class="line"><span class="comment">// 设置单元格合并</span></span><br><span class="line">data[<span class="string">&quot;!merges&quot;</span>] = [&#123;</span><br><span class="line">    <span class="attr">s</span>: &#123;<span class="comment">//s为开始</span></span><br><span class="line">        <span class="attr">c</span>: <span class="number">1</span>,<span class="comment">//开始列</span></span><br><span class="line">        <span class="attr">r</span>: <span class="number">0</span><span class="comment">//可以看成开始行,实际是取值范围</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">e</span>: &#123;<span class="comment">//e结束</span></span><br><span class="line">        <span class="attr">c</span>: <span class="number">4</span>,<span class="comment">//结束列</span></span><br><span class="line">        <span class="attr">r</span>: <span class="number">0</span><span class="comment">//结束行</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br><span class="line">........</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>插件</category>
      </categories>
      <tags>
        <tag>js</tag>
        <tag>XLSX</tag>
      </tags>
  </entry>
  <entry>
    <title>antd-mobile常见问题汇总</title>
    <url>/2021/11/12/React/antd-mobile%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h2 id="在-create-react-app-中使用"><a href="#在-create-react-app-中使用" class="headerlink" title="在 create-react-app 中使用"></a>在 create-react-app 中使用</h2><h3 id="antd-mobile-2-0"><a href="#antd-mobile-2-0" class="headerlink" title="antd-mobile 2.0"></a>antd-mobile 2.0</h3><p>在 create-react-app 中使用 antd-mobile 需要自定义主题时,需要根据官方模板中的依赖版本进行安装否则会报各种错误!!</p>
<p>github 地址：<a href="https://github.com/ant-design/antd-mobile-samples/tree/master/create-react-app">https://github.com/ant-design/antd-mobile-samples/tree/master/create-react-app</a></p>
<p>package.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"> <span class="comment">// 直接复制到项目中 yarn 更新依赖</span></span><br><span class="line"><span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;babel-plugin-import&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;less&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.7.3&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;less-loader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.0.5&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;react-app-rewired&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.2.9&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>less-loader 不要超过 5.0， react-app-rewired 不要超过 2.0.2-next.0，<a href="mailto:&#108;&#x65;&#115;&#115;&#x40;&#50;&#46;&#x37;&#x2e;&#x33;">&#108;&#x65;&#115;&#115;&#x40;&#50;&#46;&#x37;&#x2e;&#x33;</a></p>
]]></content>
      <categories>
        <category>React</category>
      </categories>
      <tags>
        <tag>antd</tag>
        <tag>antd-mobile</tag>
      </tags>
  </entry>
  <entry>
    <title>axios常见问题汇总</title>
    <url>/2020/04/12/%E7%BD%91%E7%BB%9C%E5%BA%94%E7%94%A8/axios%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h3 id="关于-axios-上传文件超时的问题记录"><a href="#关于-axios-上传文件超时的问题记录" class="headerlink" title="关于 axios 上传文件超时的问题记录"></a>关于 axios 上传文件超时的问题记录</h3><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>前端上传一个 7M 文件，上传一半连接中断，后端是 java， 报了一个 tomcat 的问题，让我一直以为是后端断开连接</p>
<p>但是postman却可以上传（postman没有设置连接超时）</p>
<p>本地调试发现无法进入后端断点 （进入超时状态）<br>但是后端本地可以进入（后端因为是本地地址没有进入超时状态）</p>
<p>我想了好久也没有想明白为什么（没有想到是前端超时断开连接 后端让我帮忙看问题 唉！！！ 我一直以为是后端兄弟的问题 让后端兄弟找了好久 结果却是前端的问题 唉！！！）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// axios</span></span><br><span class="line"><span class="keyword">const</span> service = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="comment">// 公共接口</span></span><br><span class="line">  <span class="attr">baseURL</span>: config[config[<span class="string">&quot;mode&quot;</span>]].<span class="property">basicURL</span>,</span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">5000</span>, <span class="comment">// 0 永不超时</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 设置了 5秒就超时</span></span><br></pre></td></tr></table></figure>

<p>如果仔细看看 axios 返回的错误信息就可以直接是超时问题 <code>timeout of  5000ms exceeded</code></p>
<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>增大超时时间</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> service = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="comment">// 公共接口</span></span><br><span class="line">  <span class="attr">baseURL</span>: config[config[<span class="string">&quot;mode&quot;</span>]].<span class="property">basicURL</span>,</span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">60000</span>, <span class="comment">// 0 永不超时</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>添加请求错误日志 打印详细错误信息</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 3.响应拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(response.<span class="property">data</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; response &#125; = error;</span><br><span class="line">    <span class="keyword">let</span> errMsg = response</span><br><span class="line">      ? <span class="comment">// 使用服务返回错误信息</span></span><br><span class="line">        <span class="title function_">fmtError</span>(response.<span class="property">data</span>.<span class="property">code</span>) || response.<span class="property">data</span>.<span class="property">message</span> || response.<span class="property">status</span></span><br><span class="line">      : <span class="comment">// 使用 axios 返回的错误信息</span></span><br><span class="line">        <span class="string">`<span class="subst">$&#123;error.message ? <span class="string">&quot;:&quot;</span> + error.message : <span class="string">&quot;&quot;</span>&#125;</span>`</span>;</span><br><span class="line">    <span class="title function_">logger</span>(<span class="string">&quot;response error&quot;</span>).<span class="title function_">error</span>(errMsg);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>每次出现问题后先看看前端报错信息 再进行分析</strong><br><strong>上传大文件时尽量不设置超时</strong></p>
]]></content>
      <categories>
        <category>网络应用</category>
      </categories>
      <tags>
        <tag>axios</tag>
      </tags>
  </entry>
  <entry>
    <title>electron-builder-install-app-deps-卡住不动的问题解决</title>
    <url>/2020/12/13/Electron/electron-builder-install-app-deps-%E5%8D%A1%E4%BD%8F%E4%B8%8D%E5%8A%A8%E7%9A%84%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/</url>
    <content><![CDATA[<p>背景：使用 electron-builder 和 @journeyapps&#x2F;sqlcipher 的项目 ，在新电脑上 clone 项目，npm 装包时遇到错误</p>
<p>一般 electron-builder 的项目下完包的最后，会调用 electron-builder install-app-deps 命令重新构建本地依赖</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20201213113529472-1607837076092-1607839721753.png" alt="image-20201213112431054"></p>
<p>换了电脑后就是在这里卡住，卡住几个小时都不动，也不报错，无奈尝试遍各种方法都不行，比如卸载 node 重新安装，卸载 python 和 visual studio,修改 npm 配置改为淘宝镜像地址，使用 yarn，cnpm 安装，都是不行，百度上也没有对应的案例，就差祈祷了，感觉每次 npm 下包都是看运气，哎，还是经验少啊。</p>
<p>最后因为是卡在@journeyapps&#x2F;sqlcipher 这个 sqlite 加密版插件上，于是 package.json 中提高了@journeyapps&#x2F;sqlcipher 的版本改成 5.0.0 最新版本，并改用 cnpm 正经淘宝镜像来安装， 发现可以正常编译 ，最后的 electron-builder install-app-deps 也过去了，但是运行项目的时候却 报错说缺编译@journeyapps&#x2F;sqlcipher 的 builder 模块，说明 electron-builder install-app-deps 没成功啊，继续找原因，灵光一闪看到：</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20201213112431054-1607837073833-1607839720074.png" alt="image-20201213113529472"></p>
<p>node-pre-gyp，可以将存在网络上的作者根据不同平台预编译好的二进制文件下载下来</p>
<p>关于 gyp 与 node-gyp 与 node-pre-gyp 可以看这篇文章<a href="https://zhuanlan.zhihu.com/p/330468774">https://zhuanlan.zhihu.com/p/330468774</a></p>
<p>原来 这个包的时候先去·<code> https://journeyapps-node-binary.s3.amazonaws.com/@journeyapps/sqlcipher/v4.1.0/node-v83-win32-x64.tar.gz</code> 找对应系统的对应 node 版本的二进制文件， 如果没有就会下载源码进行编译，之前在 linux 上下载这个包就出现过这个问题，</p>
<p>node-v83 表示当前 node 的 NODE_MODULE_VERSION <a href="https://nodejs.org/zh-cn/download/releases/">官网</a>可以查到,因为是新电脑所以下的是 node 的最新版本 14，还是太年轻啊，以为最新的就是最好的，不知道好多插件都没有最新 node 版本的二进制文件，通过 <a href="https://npm.taobao.org/mirrors?spm=a2c6h.14029880.0.0.735975d7WMqyIm">淘宝镜像</a> （一般淘宝镜像上有的就一定是有了）看到最新的包是<code>node-v72-win32-x64.tar.gz </code>,也就是 node 的 12 版本，果断卸载 14 安装 12 。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20201213115738432-1607837078098-1607839723068.png" alt="image-20201213115738432"></p>
<p>最后试了几次之后终于重新构建本地依赖成功</p>
]]></content>
      <categories>
        <category>Electron</category>
      </categories>
      <tags>
        <tag>js</tag>
        <tag>Electron</tag>
        <tag>Nodejs</tag>
        <tag>npm</tag>
      </tags>
  </entry>
  <entry>
    <title>electron-builder 项目中下载依赖相关问题，包含打包时下载依赖报错问题</title>
    <url>/2021/06/07/Electron/electron-builder-%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%B8%8B%E8%BD%BD%E4%BE%9D%E8%B5%96%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98%EF%BC%8C%E5%8C%85%E5%90%AB%E6%89%93%E5%8C%85%E6%97%B6%E4%B8%8B%E8%BD%BD%E4%BE%9D%E8%B5%96%E6%8A%A5%E9%94%99%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h2 id="修改-electron-下载源"><a href="#修改-electron-下载源" class="headerlink" title="修改 electron 下载源"></a>修改 electron 下载源</h2><p>找到用户目录下对应源的配置文件，如果没有就新建一个即可</p>
<h3 id="npm"><a href="#npm" class="headerlink" title="npm"></a>npm</h3><p>修改 <code>.npmrc</code></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">ELECTRON_MIRROR=http:<span class="regexp">//</span>npm.taobao.org<span class="regexp">/mirrors/</span>electron/</span><br></pre></td></tr></table></figure>

<h3 id="yarn"><a href="#yarn" class="headerlink" title="yarn"></a>yarn</h3><p>修改 <code>.yarnrc</code></p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">ELECTRON_MIRROR</span> <span class="string">&quot;http://npm.taobao.org/mirrors/electron/&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="打包时下载依赖报错"><a href="#打包时下载依赖报错" class="headerlink" title="打包时下载依赖报错"></a>打包时下载依赖报错</h2><p>下载不下来对应的包，比如我使用代理有时下载 github 上的对应包就会报错</p>
<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>手动下载对应地址的包</p>
<p>下载放到<code>C:\Users\Administrator\AppData\Local\electron\Cache</code>下</p>
<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>一般需要三个包 wincodesign，nsis，nsis-resources，</p>
<p>这个三个包分别创建<code>包名-版本号</code>的文件夹，然后将下载下了的压缩文件放<code>C:\Users\Administrator\AppData\Local\electron\Cache</code>下</p>
<p>也可以解压后放到<code>C:\Users\WX03\AppData\Local\electron-builder\Cache</code>下</p>
<p>这个是我的 electron-builer 的目录</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line">├── Cache</span><br><span class="line">│   ├── nsis</span><br><span class="line">│   │   ├── nsis<span class="string">-3</span>.0.3.2</span><br><span class="line">│   │   ├── nsis<span class="string">-3</span>.0.4.1</span><br><span class="line">│   │   └── nsis-resources<span class="string">-3</span>.4.1</span><br><span class="line">│   └── winCodeSign</span><br><span class="line">│       └── winCodeSign<span class="string">-2</span>.6.0</span><br><span class="line">├── nsis</span><br><span class="line">│   ├── nsis<span class="string">-3</span>.0.3.2</span><br><span class="line">│   ├── nsis<span class="string">-3</span>.0.4.1</span><br><span class="line">└── winCodeSign</span><br></pre></td></tr></table></figure>

<h2 id="所有难下的包的对应淘宝镜像源解决方案"><a href="#所有难下的包的对应淘宝镜像源解决方案" class="headerlink" title="所有难下的包的对应淘宝镜像源解决方案"></a>所有难下的包的对应淘宝镜像源解决方案</h2><p>官方地址：<a href="https://npm.taobao.org/mirrors">https://npm.taobao.org/mirrors</a></p>
]]></content>
      <categories>
        <category>Electron</category>
      </categories>
      <tags>
        <tag>Electron</tag>
        <tag>electron-builder</tag>
      </tags>
  </entry>
  <entry>
    <title>electron-builder双击文件打开关联应用(文件关联)</title>
    <url>/2022/07/27/Electron/electron-builder%E5%8F%8C%E5%87%BB%E6%96%87%E4%BB%B6%E6%89%93%E5%BC%80%E5%85%B3%E8%81%94%E5%BA%94%E7%94%A8-%E6%96%87%E4%BB%B6%E5%85%B3%E8%81%94/</url>
    <content><![CDATA[<p><a href="https://blog.csdn.net/jingjingchen1014/article/details/121223905">参考文章</a></p>
<h2 id="配置文件关联"><a href="#配置文件关联" class="headerlink" title="配置文件关联"></a>配置文件关联</h2><p><a href="https://www.electron.build/configuration/configuration#PlatformSpecificBuildOptions-fileAssociations">官方配置文档</a></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">fileAssociations</span>: [</span><br><span class="line">         &#123;</span><br><span class="line">           <span class="attr">ext</span>: <span class="string">&quot;ipc&quot;</span>, <span class="comment">// 关联文件扩展名 .ipc</span></span><br><span class="line">           <span class="attr">name</span>: <span class="string">&quot;IPS Config File&quot;</span>, <span class="comment">// 名称 默认为 ext</span></span><br><span class="line">           <span class="attr">description</span>: <span class="string">&quot;iConfig Machine Config File&quot;</span>, <span class="comment">// -仅限 Windows 文件描述</span></span><br><span class="line">           <span class="attr">icon</span>: ipcicon, <span class="comment">// 图标的路径 例如： build/iConfig/ipc/ipc 就会去读取 build/iConfig/ipc/ipc.ico (.icns对于 MacOS 和.ico Windows)</span></span><br><span class="line">           <span class="attr">role</span>: <span class="string">&quot;Editor&quot;</span>, <span class="comment">// String -仅限 macOS应用程序在类型方面的角色。该值可以是Editor、Viewer、Shell或None。对应于CFBundleTypeRole</span></span><br><span class="line">         &#125;,</span><br><span class="line">       ],</span><br></pre></td></tr></table></figure>

<h2 id="添加进程通信"><a href="#添加进程通信" class="headerlink" title="添加进程通信"></a>添加进程通信</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 主进程</span></span><br><span class="line">win.<span class="title function_">on</span>(<span class="string">&quot;ready-to-show&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// window 显示后</span></span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">&quot;[ window ] ready-to-show&quot;</span>);</span><br><span class="line">    <span class="title function_">watchLauchFromIPC</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 监视通过 ipc 文件启动</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">*</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">watchLauchFromIPC</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> argv = process.<span class="property">argv</span>;</span><br><span class="line">  <span class="comment">// 不是 MacOS</span></span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">platform</span> !== <span class="string">&quot;darwin&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// argv[argv.length - 1] 为 ipc 文件路径</span></span><br><span class="line">    <span class="keyword">const</span> filePath = argv[argv.<span class="property">length</span> - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/\.ipc$/</span>.<span class="title function_">test</span>(filePath)) &#123;</span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">&quot;[app] watchLauchFromIPC opne IPC File&quot;</span>, filePath);</span><br><span class="line">      bridge &amp;&amp; bridge.<span class="property">win</span>.<span class="property">webContents</span>.<span class="title function_">send</span>(<span class="string">&quot;launchFromIPC&quot;</span>, filePath);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 渲染进程</span></span><br><span class="line">ipcRenderer.<span class="title function_">on</span>(<span class="string">&quot;launchFromIPC&quot;</span>, <span class="function">(<span class="params">e, filePath</span>) =&gt;</span> &#123;</span><br><span class="line">  logger.<span class="title function_">info</span>(<span class="string">&quot;[ipcRenderer] launchFromIPC filePath = &quot;</span>, filePath);</span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> 这里拿到文件路径就开始处理吧 </span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="MacOS"><a href="#MacOS" class="headerlink" title="MacOS"></a><code>MacOS</code></h3><p><code>MacOS</code> 通过 <code>open-file</code> 获取到文件路径， 但 <code>open-file</code> 会在 <code>app</code> 的 <code>ready</code> 前触发,  所以直接模仿 win 的  <code>process.argv</code>， 将文件路径 push 到 <code>process.argv</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 主进程 </span></span><br><span class="line"><span class="comment">// macos ipc 文件启动</span></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&quot;will-finish-launching&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// custom schema handler on macos</span></span><br><span class="line">  app.<span class="title function_">on</span>(<span class="string">&quot;open-file&quot;</span>, <span class="function">(<span class="params">event, url</span>) =&gt;</span> &#123;</span><br><span class="line">    event.<span class="title function_">preventDefault</span>();</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">&quot;[app] open-file url&quot;</span>, url);</span><br><span class="line">    process.<span class="property">argv</span>.<span class="title function_">push</span>(url);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>修改 <code>watchLauchFromIPC</code> 兼容 <code>MacOS</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 监视通过 ipc 文件启动</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">*</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">watchLauchFromIPC</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> argv = process.<span class="property">argv</span>;</span><br><span class="line">  <span class="comment">// argv[argv.length - 1] 为 ipc 文件路径</span></span><br><span class="line">  <span class="keyword">const</span> filePath = argv[argv.<span class="property">length</span> - <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/\.ipc$/</span>.<span class="title function_">test</span>(filePath)) &#123;</span><br><span class="line">    logger.<span class="title function_">info</span>(<span class="string">&quot;[app] watchLauchFromIPC opne IPC File&quot;</span>, filePath);</span><br><span class="line">    bridge &amp;&amp; bridge.<span class="property">win</span>.<span class="property">webContents</span>.<span class="title function_">send</span>(<span class="string">&quot;launchFromIPC&quot;</span>, filePath);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Electron</category>
      </categories>
      <tags>
        <tag>Electron</tag>
        <tag>electron-builder</tag>
      </tags>
  </entry>
  <entry>
    <title>electron-builder常见问题汇总</title>
    <url>/2022/07/29/Electron/electron-builder%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h2 id="electron-updater-下载无进度问题"><a href="#electron-updater-下载无进度问题" class="headerlink" title="electron-updater 下载无进度问题"></a>electron-updater 下载无进度问题</h2><p>突然某一次更新 download-progress 事件不触发了<br>下载进度显示了，直到下载结束 触发<code>update-downloaded</code>事件<br>开始以为是 electron-builder 和 electron-updater 版本问题，因为最近更新过<code>node_modules</code><br>尝试将 electron-builder 和 electron-updater 更到最新， 还是不行 😖</p>
<p>开始将问题点转到 请求上，因为之前给 nginx 加了 gzip，考虑是不是 gzip 压缩后无法读取进度了</p>
<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>nginx.conf</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">gzip</span> <span class="string">on;</span> <span class="comment"># 开启 gzip 压缩输出 </span></span><br><span class="line"><span class="string">gzip_min_length</span> <span class="string">1k;</span> <span class="comment"># 1k 以上开启 gzip</span></span><br><span class="line"><span class="string">gzip_types</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="comment"># application/octet-stream 这里注释防止大文件（.exe）下载时读取不到进度</span></span><br></pre></td></tr></table></figure>

<p>去除 nginx.conf 中<code>application/octet-stream</code> 二进制流类型的压缩，发现<code>update-downloaded</code>事件正常了</p>
<p>gzip压缩后其实通过浏览器下载这个 exe 文件时也不显示进度, 估计是压缩后是直接下载 .gz 文件（下载好以后直接写入文件）， 而未压缩使用流式下载（边下边写入文件）<br><img data-src="https://bitbw.top/public/img/my_gallery/1659084148258.jpg" alt="image"></p>
]]></content>
      <categories>
        <category>Electron</category>
      </categories>
      <tags>
        <tag>Electron</tag>
        <tag>electron-builder</tag>
      </tags>
  </entry>
  <entry>
    <title>electron-builder添加自定义安装卸载界面</title>
    <url>/2021/04/12/Electron/electron-builder%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%89%E8%A3%85%E5%8D%B8%E8%BD%BD%E7%95%8C%E9%9D%A2/</url>
    <content><![CDATA[<p>electron-builder 官方文档 ：<a href="https://www.electron.build/configuration/nsis#NsisOptions-script">https://www.electron.build/configuration/nsis#NsisOptions-script</a></p>
<p>添加自定义安装卸载界面需要在 builderOptions 中添加 include 脚本</p>
<h2 id="添加-include-脚本"><a href="#添加-include-脚本" class="headerlink" title="添加 include 脚本"></a>添加 include 脚本</h2><blockquote>
<p>nsis 脚本 在 node_modules\app-builder-lib\templates\nsis 中被引入，所以这里写的脚本都会进到最终 nsis 的脚本中</p>
<p>nsis 脚本官方文档 ：<a href="https://nsis.sourceforge.io/Docs">https://nsis.sourceforge.io/Docs</a></p>
</blockquote>
<h3 id="1-在-build-nsis-添加-uninstaller-nsh"><a href="#1-在-build-nsis-添加-uninstaller-nsh" class="headerlink" title="1.在 build\nsis 添加 uninstaller.nsh"></a>1.在 build\nsis 添加 uninstaller.nsh</h3><p>我在做用户卸载界面所以叫 uninstaller ， 这个可以随意叫</p>
<figure class="highlight nsis"><table><tr><td class="code"><pre><span class="line"><span class="keyword">!include</span> nsDialogs.nsh</span><br><span class="line"></span><br><span class="line"><span class="keyword">XPStyle</span> <span class="literal">on</span></span><br><span class="line"><span class="comment"># 此卸载脚本在原有基础上添加指定义卸载页面 用于显示提示用户删除用户数据</span></span><br><span class="line"><span class="keyword">Var</span> <span class="params">/GLOBAL </span><span class="variable">Dialog_1</span></span><br><span class="line"><span class="comment">; Var /GLOBAL HLine</span></span><br><span class="line"><span class="keyword">Var</span> <span class="params">/GLOBAL </span><span class="variable">VLine</span></span><br><span class="line"><span class="comment">; Var /GLOBAL Text_1</span></span><br><span class="line"><span class="keyword">Var</span> <span class="params">/GLOBAL </span><span class="variable">Label_1</span></span><br><span class="line"><span class="keyword">Var</span> <span class="params">/GLOBAL </span><span class="variable">Label_2</span></span><br><span class="line"><span class="keyword">Var</span> <span class="params">/GLOBAL </span><span class="variable">CheckBox_1</span></span><br><span class="line"><span class="keyword">Var</span> <span class="params">/GLOBAL </span><span class="variable">Checkbox_State</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建自定义卸载页面</span></span><br><span class="line"><span class="keyword">UninstPage</span> <span class="literal">custom</span> un.nsDialogsPage un.nsDialogsPageLeave</span><br><span class="line"><span class="keyword">Function</span> <span class="title function_">un</span>.nsDialogsPage</span><br><span class="line">	<span class="title function_">nsDialogs::Create</span> <span class="number">1018</span></span><br><span class="line">	<span class="keyword">Pop</span> <span class="variable">$Dialog_1</span></span><br><span class="line">	<span class="variable">$&#123;If&#125;</span> <span class="variable">$Dialog_1</span> == error</span><br><span class="line">		<span class="keyword">Abort</span></span><br><span class="line">	<span class="variable">$&#123;EndIf&#125;</span></span><br><span class="line">	<span class="variable">$&#123;NSD_CreateVLine&#125;</span> <span class="number">0</span> <span class="number">30</span>u <span class="number">100</span>% <span class="number">12</span>u <span class="string">&quot;&quot;</span></span><br><span class="line">	<span class="keyword">Pop</span> <span class="variable">$VLine</span></span><br><span class="line">	<span class="variable">$&#123;NSD_CreateLabel&#125;</span> <span class="number">0</span> <span class="number">10</span>u <span class="number">100</span>% <span class="number">12</span>u <span class="string">&quot;卸载提示：是否本地删除用户数据？&quot;</span></span><br><span class="line">	<span class="keyword">Pop</span> <span class="variable">$Label_1</span></span><br><span class="line">	<span class="variable">$&#123;NSD_CreateLabel&#125;</span> <span class="number">10</span>u <span class="number">30</span>u <span class="number">100</span>% <span class="number">12</span>u <span class="string">&quot;保留用户数据可在重新安装后找回以往配置方案&quot;</span></span><br><span class="line">	<span class="keyword">Pop</span> <span class="variable">$Label_2</span></span><br><span class="line">	<span class="variable">$&#123;NSD_CreateCheckbox&#125;</span> <span class="number">0</span> <span class="number">50</span>u <span class="number">100</span>% <span class="number">10</span>u <span class="string">&quot;&amp;确认删除本地用户数据&quot;</span></span><br><span class="line">	<span class="keyword">Pop</span> <span class="variable">$CheckBox_1</span></span><br><span class="line">	<span class="title function_">nsDialogs::Show</span></span><br><span class="line"><span class="keyword">FunctionEnd</span></span><br><span class="line"><span class="keyword">Function</span> <span class="title function_">un</span>.nsDialogsPageLeave</span><br><span class="line"><span class="variable">$&#123;NSD_GetState&#125;</span> <span class="variable">$CheckBox_1</span> <span class="variable">$Checkbox_State</span></span><br><span class="line">	 <span class="comment">; MessageBox MB_OK &quot;You checked:$\n$\n   CheckBox_1 $CheckBox_1 $\n$\n  Checkbox_State $Checkbox_State   $\n$\n  BST_CHECKED $&#123;BST_CHECKED&#125; $\n$\n BST_UNCHECKED $&#123;BST_UNCHECKED&#125;&quot;  #MessageBox用于调试</span></span><br><span class="line"><span class="keyword">FunctionEnd</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Section</span></span><br><span class="line"><span class="keyword">SectionEnd</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">!macro</span> customUnInstall</span><br><span class="line"><span class="comment">; 卸载过程执行</span></span><br><span class="line">    <span class="variable">$&#123;ifNot&#125;</span> <span class="variable">$&#123;isUpdated&#125;</span></span><br><span class="line">      <span class="comment"># 提示窗</span></span><br><span class="line">        <span class="variable">$&#123;If&#125;</span> <span class="variable">$Checkbox_State</span> == <span class="variable">$&#123;BST_CHECKED&#125;</span></span><br><span class="line">          <span class="comment"># 如果勾选删除固定文件夹（测试版）</span></span><br><span class="line">          <span class="keyword">MessageBox</span> <span class="params">MB_OK</span>CANCEL <span class="string">&quot;是否确认删除用户数据?&quot;</span> <span class="params">IDOK</span> label_ok  <span class="params">IDCANCEL</span>  label_cancel</span><br><span class="line">          label_ok:</span><br><span class="line">              <span class="comment"># 删除固定文件夹</span></span><br><span class="line">              <span class="keyword">RMDir</span> /r <span class="variable">$PROFILE</span>\iConfig_TEST</span><br><span class="line">              <span class="keyword">Goto</span> end</span><br><span class="line">          label_cancel:</span><br><span class="line">              <span class="keyword">Goto</span> end</span><br><span class="line">          end:</span><br><span class="line">        <span class="variable">$&#123;EndIf&#125;</span></span><br><span class="line">    <span class="variable">$&#123;endIf&#125;</span></span><br><span class="line"><span class="keyword">!macro</span>end</span><br></pre></td></tr></table></figure>

<blockquote>
<p>关于自定义页面的官方文档：<a href="https://nsis.sourceforge.io/Docs/Modern%20UI%202/Readme.html">https://nsis.sourceforge.io/Docs/Modern%20UI%202/Readme.html</a></p>
</blockquote>
<p>参考这段</p>
<figure class="highlight nsis"><table><tr><td class="code"><pre><span class="line"><span class="literal">Custom</span> pages</span><br><span class="line">If you want add your <span class="literal">custom</span> pages to your installer, you can insert your own <span class="keyword">page</span> commands between the <span class="keyword">page</span> macros.</span><br><span class="line"></span><br><span class="line"><span class="keyword">!insertmacro</span> MUI_PAGE_WELCOME</span><br><span class="line"><span class="keyword">Page</span> <span class="literal">custom</span> FunctionName <span class="comment">;Custom page</span></span><br><span class="line"><span class="keyword">!insertmacro</span> MUI_PAGE_COMPONENTS</span><br><span class="line"></span><br><span class="line"><span class="comment">;Uninstaller</span></span><br><span class="line"><span class="keyword">!insertmacro</span> MUI_UNPAGE_CONFIRM</span><br><span class="line"><span class="keyword">UninstPage</span> <span class="literal">custom</span> un.FunctionName <span class="comment">;Custom page</span></span><br><span class="line"><span class="keyword">!insertmacro</span> MUI_UNPAGE_INSTFILES</span><br><span class="line">Use the MUI_HEADER_TEXT macro to set the text <span class="literal">on</span> the <span class="keyword">page</span> header in a <span class="keyword">page</span> <span class="keyword">function</span>:</span><br><span class="line"></span><br><span class="line"><span class="keyword">LangString</span> PAGE_TITLE <span class="variable">$&#123;LANG_ENGLISH&#125;</span> <span class="string">&quot;Title&quot;</span></span><br><span class="line"><span class="keyword">LangString</span> PAGE_SUBTITLE <span class="variable">$&#123;LANG_ENGLISH&#125;</span> <span class="string">&quot;Subtitle&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Function</span> <span class="title function_">CustomPageFunction</span></span><br><span class="line">  <span class="keyword">!insertmacro</span> MUI_HEADER_TEXT <span class="variable">$(PAGE_TITLE)</span> <span class="variable">$(PAGE_SUBTITLE)</span></span><br><span class="line">  nsDialogs::...</span><br><span class="line">  ...</span><br><span class="line"><span class="keyword">FunctionEnd</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用 nsDialogs 创建自定义界面， nsDialogs 的详细文档：<a href="https://nsis.sourceforge.io/Docs/nsDialogs/Readme.html">https://nsis.sourceforge.io/Docs/nsDialogs/Readme.html</a></p>
</blockquote>
<h3 id="2-修改-builderOptions-配置"><a href="#2-修改-builderOptions-配置" class="headerlink" title="2.修改 builderOptions 配置"></a>2.修改 builderOptions 配置</h3><p>我用的 vue-electron 所以在 vue.config.js 中配置</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">builderOptions</span>: &#123;</span><br><span class="line">	...</span><br><span class="line">       <span class="attr">nsis</span>: &#123;</span><br><span class="line">         ...</span><br><span class="line">         <span class="attr">warningsAsErrors</span>: <span class="literal">false</span> ,<span class="comment">// nsis警告变错误（防止警告变成报错无法打包）</span></span><br><span class="line">         <span class="attr">include</span>: <span class="string">&#x27;build/nsis/uninstaller.nsh&#x27;</span>, <span class="comment">// NSIS包含定制安装程序脚本的路径</span></span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>如果 include 像我一样添加的是卸载页面，会报错：warning 6020: Uninstaller script code found but WriteUninstaller never used - no uninstaller will be</p>
<p>虽然只是警告 但是 编译时默认使用&#x2F;WX (将警告视为错误 <code>warningsAsErrors</code>为<code>true</code>（默认） )，导致打包中断。</p>
<p>因为一直没有找到对应 WriteUninstaller 应该写在哪，而且改 node_modules 中的源码也不太好,干脆不让警告视为错误，</p>
<p>修改 warningsAsErrors &#x3D; false</p>
<h2 id="预定义宏"><a href="#预定义宏" class="headerlink" title="预定义宏"></a>预定义宏</h2><p>关于 include 脚本 还可以添加预定好的宏 ,下面是例子 可以自己在中添加需要执行的代码</p>
<figure class="highlight nsis"><table><tr><td class="code"><pre><span class="line"><span class="comment">; include 脚本 用于在安装和卸载的各个阶段做一些事情</span></span><br><span class="line"><span class="comment">; $&#123;BUILD_RESOURCES_DIR&#125; 默认为项目目录下的 build 目录</span></span><br><span class="line"><span class="comment">; ==============================================================================</span></span><br><span class="line"><span class="comment">; !macro preInit</span></span><br><span class="line"><span class="comment">; ; 安装时最早执行0</span></span><br><span class="line"><span class="comment">;   ; This macro is inserted at the beginning of the NSIS .OnInit callback</span></span><br><span class="line"><span class="comment">;   MessageBox MB_OK  &quot;$&#123;BUILD_RESOURCES_DIR&#125;/preInit&quot; IDOK</span></span><br><span class="line"><span class="comment">; !macroend</span></span><br><span class="line"><span class="comment">; ==============================================================================</span></span><br><span class="line"><span class="comment">; !macro customInit</span></span><br><span class="line"><span class="comment">; ; 安装时其次执行1</span></span><br><span class="line"><span class="comment">;   MessageBox MB_OK  &quot;$&#123;BUILD_RESOURCES_DIR&#125;/customInit&quot; IDOK</span></span><br><span class="line"><span class="comment">; !macroend</span></span><br><span class="line"><span class="comment">; ==============================================================================</span></span><br><span class="line"><span class="comment">; # 卸载</span></span><br><span class="line"><span class="comment">; !macro customHeader</span></span><br><span class="line"><span class="comment">; ; 安装时其次执行3</span></span><br><span class="line">      <span class="comment">; MessageBox MB_OK  &quot;$&#123;BUILD_RESOURCES_DIR&#125;/customHeader&quot; IDOK</span></span><br><span class="line"><span class="comment">; !macroend</span></span><br><span class="line"><span class="comment">; ==============================================================================</span></span><br><span class="line"><span class="comment">; !macro customInstall</span></span><br><span class="line"><span class="comment">; ; 安装时其次执行4</span></span><br><span class="line"><span class="comment">;   MessageBox MB_OK  &quot;$&#123;BUILD_RESOURCES_DIR&#125;/customInstall&quot; IDOK</span></span><br><span class="line"><span class="comment">; !macroend</span></span><br><span class="line"><span class="comment">; ==============================================================================</span></span><br><span class="line"><span class="comment">; !macro customUnInit</span></span><br><span class="line"><span class="comment">;; 卸载页面出现前执行</span></span><br><span class="line"><span class="comment">;     # 提示窗</span></span><br><span class="line">        <span class="comment">;  MessageBox MB_OKCANCEL &quot;是否删除用户数据?&quot; IDOK label_ok  IDCANCEL  label_cancel</span></span><br><span class="line">        <span class="comment">;  label_ok:</span></span><br><span class="line">        <span class="comment">;     # 删除固定文件夹</span></span><br><span class="line">        <span class="comment">;      RMDir /r $PROFILE\iConfig_TEST</span></span><br><span class="line">        <span class="comment">;      Goto end</span></span><br><span class="line">        <span class="comment">;  label_cancel:</span></span><br><span class="line">        <span class="comment">;      Goto end</span></span><br><span class="line">        <span class="comment">;  end:</span></span><br><span class="line"><span class="comment">; !macroend</span></span><br><span class="line"><span class="comment">; ==============================================================================</span></span><br><span class="line"><span class="comment">;  !macro customUnInstall</span></span><br><span class="line"><span class="comment">;  ; 卸载过程执行</span></span><br><span class="line"><span class="comment">;      $&#123;ifNot&#125; $&#123;isUpdated&#125;</span></span><br><span class="line"><span class="comment">;         # 提示窗</span></span><br><span class="line"><span class="comment">;          MessageBox MB_OKCANCEL &quot;是否删除用户数据?&quot; IDOK label_ok  IDCANCEL  label_cancel</span></span><br><span class="line"><span class="comment">;          label_ok:</span></span><br><span class="line"><span class="comment">;             # 删除固定文件夹</span></span><br><span class="line"><span class="comment">;              RMDir /r $PROFILE\iConfig_TEST</span></span><br><span class="line"><span class="comment">;              Goto end</span></span><br><span class="line"><span class="comment">;          label_cancel:</span></span><br><span class="line"><span class="comment">;              Goto end</span></span><br><span class="line"><span class="comment">;          end:</span></span><br><span class="line"><span class="comment">;      $&#123;endIf&#125;</span></span><br><span class="line"><span class="comment">;  !macroend</span></span><br><span class="line"><span class="comment">; ==============================================================================</span></span><br><span class="line"><span class="comment">; !macro customInstallMode</span></span><br><span class="line"><span class="comment">;    ; 安装和卸载时都执行用于设定安装用户</span></span><br><span class="line"><span class="comment">;   # set  $isForceMachineInstall (给机器的每个用户都安装) or $isForceCurrentInstall (给当前用户安装)</span></span><br><span class="line"><span class="comment">;   # to enforce one or the other modes.</span></span><br><span class="line"><span class="comment">;     ; StrCpy $isForceMachineInstall &quot;1&quot;</span></span><br><span class="line"><span class="comment">;     MessageBox MB_OK  &quot;$&#123;BUILD_RESOURCES_DIR&#125;/customInstallMode&quot; IDOK</span></span><br><span class="line"><span class="comment">; !macroend</span></span><br><span class="line"><span class="comment">; ==============================================================================</span></span><br><span class="line"><span class="comment">; !macro customRemoveFiles</span></span><br><span class="line"><span class="comment">; ; 当删除文件时执行（重新安装和卸载都执行）</span></span><br><span class="line"><span class="comment">;     ; Section  /o &quot;是否删除用户数据&quot;</span></span><br><span class="line"><span class="comment">;     ; MessageBox MB_OK  &quot;$&#123;BUILD_RESOURCES_DIR&#125;/NSISDemo&quot; IDOK</span></span><br><span class="line"><span class="comment">;     ; SectionEnd</span></span><br><span class="line"><span class="comment">;     MessageBox MB_OK  &quot;$&#123;BUILD_RESOURCES_DIR&#125;/customRemoveFiles&quot; IDOK</span></span><br><span class="line"><span class="comment">;   # set $isForceMachineInstall or $isForceCurrentInstall</span></span><br><span class="line"><span class="comment">;   # to enforce one or the other modes.</span></span><br><span class="line"><span class="comment">; !macroend</span></span><br><span class="line"><span class="comment">; ==============================================================================</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果要做卸载后表单选项 也可以用以上界面 添加对应的表单控件在 dialog 中，和发送地址即可</p>
]]></content>
      <categories>
        <category>Electron</category>
      </categories>
      <tags>
        <tag>Electron</tag>
        <tag>electron-builder</tag>
        <tag>nsis</tag>
      </tags>
  </entry>
  <entry>
    <title>electron+vue项目快捷创建的两种方式</title>
    <url>/2021/06/04/Electron/electron-vue%E9%A1%B9%E7%9B%AE%E5%BF%AB%E6%8D%B7%E5%88%9B%E5%BB%BA%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F/</url>
    <content><![CDATA[<h2 id="使用-vue-cli-plugin-electron-builder-生成项目-推荐"><a href="#使用-vue-cli-plugin-electron-builder-生成项目-推荐" class="headerlink" title="使用 vue-cli-plugin-electron-builder 生成项目(推荐)"></a>使用 vue-cli-plugin-electron-builder 生成项目(推荐)</h2><p>vue-cli-plugin-electron-builder 官方文档：<a href="https://nklayman.github.io/vue-cli-plugin-electron-builder/">https://nklayman.github.io/vue-cli-plugin-electron-builder/</a></p>
<p>需要 vue-cli 最新版</p>
<p>使用 vue-cli 创建项目</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vue create  项目名 <span class="comment">#创建vue项目</span></span><br></pre></td></tr></table></figure>

<p>添加使用 vue-cli-plugin-electron-builder 生成项目</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vue add electron-builder <span class="comment"># 自动生成带electron的项目</span></span><br></pre></td></tr></table></figure>

<h2 id="使用-electron-vue-模板创建（不推荐）"><a href="#使用-electron-vue-模板创建（不推荐）" class="headerlink" title="使用 electron-vue 模板创建（不推荐）"></a>使用 electron-vue 模板创建（不推荐）</h2><p>electron-vue 中文文档： <a href="https://simulatedgreg.gitbooks.io/electron-vue/content/cn/">https://simulatedgreg.gitbooks.io/electron-vue/content/cn/</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 安装 vue-cli 和 脚手架样板代码</span></span><br><span class="line">npm install -g vue-cli</span><br><span class="line">vue init simulatedgreg/electron-vue my-project</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装依赖并运行你的程序</span></span><br><span class="line"><span class="built_in">cd</span> my-project</span><br><span class="line">yarn <span class="comment"># 或者 npm install</span></span><br><span class="line">yarn run dev <span class="comment"># 或者 npm run dev</span></span><br></pre></td></tr></table></figure>

<h2 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h2><p>个人觉得使用 vue-cli-plugin-electron-builder 生成项目更好用 而且文档详细，快速上手</p>
]]></content>
      <categories>
        <category>Electron</category>
      </categories>
      <tags>
        <tag>Electron</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>electron项目快捷生成所有端对应图标</title>
    <url>/2021/06/09/Electron/electron%E9%A1%B9%E7%9B%AE%E5%BF%AB%E6%8D%B7%E7%94%9F%E6%88%90%E6%89%80%E6%9C%89%E7%AB%AF%E5%AF%B9%E5%BA%94%E5%9B%BE%E6%A0%87/</url>
    <content><![CDATA[<h2 id="使用-electron-icon-builder-可以一次性生成所有端对应的图标"><a href="#使用-electron-icon-builder-可以一次性生成所有端对应的图标" class="headerlink" title="使用 electron-icon-builder 可以一次性生成所有端对应的图标"></a>使用 electron-icon-builder 可以一次性生成所有端对应的图标</h2><p>github：<a href="https://github.com/safu9/electron-icon-builder">https://github.com/safu9/electron-icon-builder</a></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -g  electron-icon-builder</span><br></pre></td></tr></table></figure>

<h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">electron-icon-builder --input=./build/icon.png --output=./build/icon --flatten</span><br></pre></td></tr></table></figure>

<p>–input 为输入文件夹</p>
<p>–output 为输入文件夹</p>
<p>还可以在项目中安装使用</p>
]]></content>
      <categories>
        <category>Electron</category>
      </categories>
      <tags>
        <tag>Electron</tag>
      </tags>
  </entry>
  <entry>
    <title>element+sortablejs实现表格托拽</title>
    <url>/2020/07/31/Vue/element-sortablejs%E5%AE%9E%E7%8E%B0%E8%A1%A8%E6%A0%BC%E6%89%98%E6%8B%BD/</url>
    <content><![CDATA[<p>最终实现效果：</p>
<span id="more"></span>

<p><img data-src="https://bitbw.top/public/img/my_gallery/%E5%8D%95%E8%A1%A8%E6%A0%BC%E6%89%98%E6%8B%BD.gif" alt="单表格托拽"></p>
<p>js 部分实现</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Sortable</span> <span class="keyword">from</span> <span class="string">&#x27;sortablejs&#x27;</span>;<span class="comment">//引入sortablejs</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//1.请求数据后使用托拽方法</span></span><br><span class="line"><span class="variable language_">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setSort</span>();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//2. 托拽方法</span></span><br><span class="line"> <span class="comment">// 初始化拖拽</span></span><br><span class="line"> <span class="title function_">setSort</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">rightTable</span>);</span><br><span class="line">  <span class="keyword">const</span> el = <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">rightTable</span>.<span class="property">$el</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.el-table__body-wrapper &gt; table &gt; tbody&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">let</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">sortable</span> = <span class="title class_">Sortable</span>.<span class="title function_">create</span>(el, &#123;</span><br><span class="line">   <span class="attr">animation</span>: <span class="number">150</span>,  <span class="comment">// ms, number 单位：ms，定义排序动画的时间</span></span><br><span class="line">    <span class="comment">//  指定父元素下可被拖拽的子元素</span></span><br><span class="line">   <span class="attr">draggable</span>: <span class="string">&#x27;.el-table__row&#x27;</span>,</span><br><span class="line">   <span class="title function_">onEnd</span>(<span class="params">&#123; newIndex, oldIndex &#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;TabsTreeTable -&gt; onEnd -&gt; newIndex, oldIndex&#x27;</span>, newIndex, oldIndex);</span><br><span class="line">    <span class="keyword">let</span> rightTableData = <span class="title function_">cloneDeep</span>(_this.<span class="property">rightTableData</span>);</span><br><span class="line">    <span class="keyword">const</span> currRow = rightTableData.<span class="title function_">splice</span>(oldIndex, <span class="number">1</span>)[<span class="number">0</span>];</span><br><span class="line">    rightTableData.<span class="title function_">splice</span>(newIndex, <span class="number">0</span>, currRow);</span><br><span class="line">    _this.<span class="property">rightTableData</span> = rightTableData;</span><br><span class="line">    _this.<span class="property">rightOriginData</span> = <span class="title function_">cloneDeep</span>(rightTableData);</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">ghostClass</span>: <span class="string">&#x27;sortable-ghost&#x27;</span>, <span class="comment">// Class name for the drop placeholder,</span></span><br><span class="line">   <span class="attr">setData</span>: <span class="keyword">function</span>(<span class="params">dataTransfer</span>) &#123;</span><br><span class="line">    <span class="comment">// to avoid Firefox bug</span></span><br><span class="line">    <span class="comment">// Detail see : https://github.com/RubaXa/Sortable/issues/1012</span></span><br><span class="line">    dataTransfer.<span class="title function_">setData</span>(<span class="string">&#x27;Text&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">   &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>css 部分</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">//针对固定列的<span class="selector-tag">table</span>需要处理hover的样式</span><br><span class="line"><span class="selector-tag">tr</span><span class="selector-class">.hover-row</span> &#123;</span><br><span class="line">  &amp;,</span><br><span class="line">  &amp;<span class="selector-class">.el-table__row--striped</span> &#123;</span><br><span class="line">    &amp;,</span><br><span class="line">    &amp;<span class="selector-class">.current-row</span> &#123;</span><br><span class="line">      &gt; <span class="selector-tag">td</span> &#123;</span><br><span class="line">        <span class="attribute">background-color</span>: transparent;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">//托拽时的样式</span><br><span class="line"><span class="selector-class">.sortable-ghost</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0.8</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#42b983</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意事项：el-table 需要指定 row-key 否则会发生不生效的现象，托拽时的样式不生效时，需要将 el-table 的 hover 样式去掉</p>
</blockquote>
<h2 id="两个-table-的相互托拽"><a href="#两个-table-的相互托拽" class="headerlink" title="两个 table 的相互托拽"></a>两个 table 的相互托拽</h2><p>最终实现效果：</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/%E5%8F%8C%E8%A1%A8%E6%A0%BC%E8%A1%A8%E6%A0%BC%E6%89%98%E6%8B%BD.gif" alt="双表格表格托拽"></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 初始化拖拽</span></span><br><span class="line"> <span class="title function_">setSort</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">rightTable</span>);</span><br><span class="line">  <span class="keyword">const</span> el = <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">rightTable</span>.<span class="property">$el</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.el-table__body-wrapper &gt; table &gt; tbody&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">const</span> el2 = <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">leftTable</span>.<span class="property">$el</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.el-table__body-wrapper &gt; table &gt; tbody&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">let</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">sortable</span> = <span class="title class_">Sortable</span>.<span class="title function_">create</span>(el, &#123;</span><br><span class="line">   <span class="attr">group</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;shared&#x27;</span>,</span><br><span class="line">    <span class="attr">pull</span>: <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;right: data&#x27;</span>, data);</span><br><span class="line">    &#125;,</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">animation</span>: <span class="number">150</span>, <span class="comment">//动画效果</span></span><br><span class="line">   <span class="comment">//  指定父元素下可被拖拽的子元素</span></span><br><span class="line">   <span class="attr">draggable</span>: <span class="string">&#x27;.el-table__row&#x27;</span>,</span><br><span class="line">   <span class="title function_">onUpdate</span>(<span class="params">&#123; to, <span class="keyword">from</span>, newIndex, oldIndex &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> currRow = _this.<span class="property">rightTableData</span>.<span class="title function_">splice</span>(oldIndex, <span class="number">1</span>)[<span class="number">0</span>];</span><br><span class="line">    _this.<span class="property">rightTableData</span>.<span class="title function_">splice</span>(newIndex, <span class="number">0</span>, currRow);</span><br><span class="line">    <span class="comment">// console.log(&#x27;onUpdate: onEnd -&gt; to, from,&#x27;, to, from);</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;onUpdate-&gt; onEnd -&gt; newIndex, oldIndex&#x27;</span>, newIndex, oldIndex);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;列表单元在列表容器中的排序发生变化后的回调函数&#x27;</span>);</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="title function_">onRemove</span>(<span class="params">&#123; to, <span class="keyword">from</span>, newIndex, oldIndex &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> currRow = _this.<span class="property">rightTableData</span>.<span class="title function_">splice</span>(oldIndex, <span class="number">1</span>)[<span class="number">0</span>];</span><br><span class="line">    _this.<span class="property">leftTableData</span>.<span class="title function_">splice</span>(newIndex, <span class="number">0</span>, currRow);</span><br><span class="line">    <span class="comment">// console.log(&#x27;onRemoveleft: onEnd -&gt; to, from,&#x27;, to, from);</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;onRemove -&gt; onEnd -&gt; newIndex, oldIndex&#x27;</span>, newIndex, oldIndex);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;列表元素移到另一个列表容器的回调函数&#x27;</span>);</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">ghostClass</span>: <span class="string">&#x27;sortable-ghost&#x27;</span>, <span class="comment">// Class name for the drop placeholder,</span></span><br><span class="line">   <span class="attr">setData</span>: <span class="keyword">function</span>(<span class="params">dataTransfer</span>) &#123;</span><br><span class="line">    <span class="comment">// to avoid Firefox bug</span></span><br><span class="line">    <span class="comment">// Detail see : https://github.com/RubaXa/Sortable/issues/1012</span></span><br><span class="line">    dataTransfer.<span class="title function_">setData</span>(<span class="string">&#x27;Text&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">   &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">sortable</span> = <span class="title class_">Sortable</span>.<span class="title function_">create</span>(el2, &#123;</span><br><span class="line">   <span class="attr">group</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;shared&#x27;</span>,</span><br><span class="line">    <span class="attr">pull</span>: <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;left: data&#x27;</span>, data);</span><br><span class="line">    &#125;,</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">animation</span>: <span class="number">150</span>, <span class="comment">//动画效果</span></span><br><span class="line">   <span class="comment">//  指定父元素下可被拖拽的子元素</span></span><br><span class="line">   <span class="attr">draggable</span>: <span class="string">&#x27;.el-table__row&#x27;</span>,</span><br><span class="line">   <span class="title function_">onRemove</span>(<span class="params">&#123; to, <span class="keyword">from</span>, newIndex, oldIndex &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> currRow = _this.<span class="property">leftTableData</span>.<span class="title function_">splice</span>(oldIndex, <span class="number">1</span>)[<span class="number">0</span>];</span><br><span class="line">    _this.<span class="property">rightTableData</span>.<span class="title function_">splice</span>(newIndex, <span class="number">0</span>, currRow);</span><br><span class="line">    <span class="comment">// console.log(&#x27;onRemoveleft: onEnd -&gt; to, from,&#x27;, to, from);</span></span><br><span class="line">    <span class="comment">// console.log(&#x27;onRemove -&gt; onEnd -&gt; newIndex, oldIndex&#x27;, newIndex, oldIndex);</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;列表元素移到另一个列表容器的回调函数&#x27;</span>);</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="title function_">onChoose</span>(<span class="params">&#123; to, <span class="keyword">from</span>, newIndex, oldIndex &#125;</span>) &#123;</span><br><span class="line">    <span class="comment">// console.log(&#x27;onChoose: onEnd -&gt; to, from,&#x27;, to, from);</span></span><br><span class="line">    <span class="comment">// console.log(&#x27;onChoose-&gt; onEnd -&gt; newIndex, oldIndex&#x27;, newIndex, oldIndex);</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;function 列表单元被选中的回调函数&#x27;</span>);</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="title function_">onStart</span>(<span class="params">&#123; to, <span class="keyword">from</span>, newIndex, oldIndex &#125;</span>) &#123;</span><br><span class="line">    <span class="comment">// console.log(&#x27;onStart: onEnd -&gt; to, from,&#x27;, to, from);</span></span><br><span class="line">    <span class="comment">// console.log(&#x27;onStart -&gt; onEnd -&gt; newIndex, oldIndex&#x27;, newIndex, oldIndex);</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;function 列表单元拖动开始的回调函数&#x27;</span>);</span><br><span class="line">   &#125;,</span><br><span class="line"></span><br><span class="line">   <span class="title function_">onAdd</span>(<span class="params">&#123; to, <span class="keyword">from</span>, newIndex, oldIndex &#125;</span>) &#123;</span><br><span class="line">    <span class="comment">// console.log(&#x27;onAdd: onEnd -&gt; to, from,&#x27;, to, from);</span></span><br><span class="line">    <span class="comment">// console.log(&#x27;onAddve -&gt; onEnd -&gt; newIndex, oldIndex&#x27;, newIndex, oldIndex);</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;列表单元添加到本列表容器的回调函数&#x27;</span>);</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="title function_">onUpdate</span>(<span class="params">&#123; to, <span class="keyword">from</span>, newIndex, oldIndex &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> currRow = _this.<span class="property">leftTableData</span>.<span class="title function_">splice</span>(oldIndex, <span class="number">1</span>)[<span class="number">0</span>];</span><br><span class="line">    _this.<span class="property">leftTableData</span>.<span class="title function_">splice</span>(newIndex, <span class="number">0</span>, currRow);</span><br><span class="line">    <span class="comment">// console.log(&#x27;onUpdate: onEnd -&gt; to, from,&#x27;, to, from);</span></span><br><span class="line">    <span class="comment">// console.log(&#x27;onUpdate-&gt; onEnd -&gt; newIndex, oldIndex&#x27;, newIndex, oldIndex);</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;列表单元在列表容器中的排序发生变化后的回调函数&#x27;</span>);</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="title function_">onFilter</span>(<span class="params">&#123; to, <span class="keyword">from</span>, newIndex, oldIndex &#125;</span>) &#123;</span><br><span class="line">    <span class="comment">// console.log(&#x27;onFilter: onEnd -&gt; to, from,&#x27;, to, from);</span></span><br><span class="line">    <span class="comment">// console.log(&#x27;onFilter-&gt; onEnd -&gt; newIndex, oldIndex&#x27;, newIndex, oldIndex);</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27; 试图选中一个被filter过滤的列表单元的回调函数&#x27;</span>);</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="title function_">onMove</span>(<span class="params">&#123; to, <span class="keyword">from</span>, newIndex, oldIndex &#125;</span>) &#123;</span><br><span class="line">    <span class="comment">// console.log(&#x27;onMove: onEnd -&gt; to, from,&#x27;, to, from);</span></span><br><span class="line">    <span class="comment">// console.log(&#x27;onMovee -&gt; onEnd -&gt; newIndex, oldIndex&#x27;, newIndex, oldIndex);</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27; 当移动列表单元在一个列表容器中或者多个列表容器中的回调函数&#x27;</span>);</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="title function_">onClone</span>(<span class="params">&#123; to, <span class="keyword">from</span>, newIndex, oldIndex &#125;</span>) &#123;</span><br><span class="line">    <span class="comment">// console.log(&#x27;onClone: onEnd -&gt; to, from,&#x27;, to, from);</span></span><br><span class="line">    <span class="comment">// console.log(&#x27;onClone -&gt; onEnd -&gt; newIndex, oldIndex&#x27;, newIndex, oldIndex);</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27; 当创建一个列表单元副本的时候的回调函数&#x27;</span>);</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">ghostClass</span>: <span class="string">&#x27;sortable-ghost&#x27;</span>, <span class="comment">// Class name for the drop placeholder,</span></span><br><span class="line">   <span class="attr">setData</span>: <span class="keyword">function</span>(<span class="params">dataTransfer</span>) &#123;</span><br><span class="line">    <span class="comment">// to avoid Firefox bug</span></span><br><span class="line">    <span class="comment">// Detail see : https://github.com/RubaXa/Sortable/issues/1012</span></span><br><span class="line">    dataTransfer.<span class="title function_">setData</span>(<span class="string">&#x27;Text&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">   &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>elementUI</tag>
        <tag>sortablejs</tag>
      </tags>
  </entry>
  <entry>
    <title>elementUI常见问题汇总</title>
    <url>/2020/09/16/Vue/elementUI%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<blockquote>
<p>这篇文章是我在工作中使用 elementUi 遇到的问题做的简单汇总，希望能对看到这篇文章的你有所帮助</p>
</blockquote>
<h2 id="el-table"><a href="#el-table" class="headerlink" title="el-table"></a>el-table</h2><h3 id="如何修改-el-table-展开树的三角图标"><a href="#如何修改-el-table-展开树的三角图标" class="headerlink" title="如何修改 el-table 展开树的三角图标"></a>如何修改 el-table 展开树的三角图标</h3><p>只需要给定 before 的 content 即可</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"> // 隐藏展开箭头</span><br><span class="line">  <span class="selector-class">.el-table__expand-icon</span> &#123;</span><br><span class="line">    // 修改展开箭头的样式</span><br><span class="line">    <span class="selector-class">.el-icon-arrow-right</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">      <span class="attribute">content</span>: <span class="string">&quot;\e791&quot;</span>;</span><br><span class="line">      <span class="attribute">font-size</span>: <span class="number">18px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参考网址：<a href="https://blog.csdn.net/m0_37378152/article/details/102628860">https://blog.csdn.net/m0_37378152/article/details/102628860</a></p>
<h3 id="elementUI-的-table-的每一项的-min-width-不要使用百分比"><a href="#elementUI-的-table-的每一项的-min-width-不要使用百分比" class="headerlink" title="elementUI 的 table 的每一项的 min-width 不要使用百分比"></a>elementUI 的 table 的每一项的 min-width 不要使用百分比</h3><blockquote>
<p>elementUI 的 table 的每一项的 min-width 不要使用百分比 ,不然会出现这种情况</p>
</blockquote>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20200227163411930.png" alt="image-20200227163411930"></p>
<blockquote>
<p>固定的序号和 checkbox 会掉下来</p>
</blockquote>
<h3 id="修改-el-table-表头高度的坑"><a href="#修改-el-table-表头高度的坑" class="headerlink" title="修改 el-table 表头高度的坑"></a>修改 el-table 表头高度的坑</h3><blockquote>
<p>el-table 固定列的 table，在 dom 上是有两个 thead 的所以要修改表头高度就一定要两个都修改 ，不然会导致固定列表头高度与正常表头高度不一致现象 ，在薪酬项目的代码示例</p>
</blockquote>
<figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="comment">//处理表头高度</span></span><br><span class="line"><span class="selector-class">.el-table__header-wrapper</span> <span class="selector-tag">th</span> <span class="selector-class">.cell</span> <span class="selector-class">.edit-table-header</span> &gt; <span class="selector-tag">p</span> &gt; <span class="selector-tag">span</span>,</span><br><span class="line"><span class="selector-class">.el-table__fixed-header-wrapper</span> <span class="selector-tag">th</span> <span class="selector-class">.cell</span> <span class="selector-class">.edit-table-header</span> &gt; <span class="selector-tag">p</span> &gt; <span class="selector-tag">span</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="在-dialog-中使用-table-的问题"><a href="#在-dialog-中使用-table-的问题" class="headerlink" title="在 dialog 中使用 table 的问题"></a>在 dialog 中使用 table 的问题</h3><blockquote>
<p>在 dialog 中使用 table 发现无论怎样设置表头都会出现表头高度不正常现象 和数据不正常现象</p>
<p>这时可以使用 dialog 的 destroy-on-close 属性 （关闭时销毁 Dialog 中的元素）</p>
</blockquote>
<h3 id="el-table-自定义动态表头：更新数据之后表头不更新"><a href="#el-table-自定义动态表头：更新数据之后表头不更新" class="headerlink" title="el-table 自定义动态表头：更新数据之后表头不更新"></a>el-table 自定义动态表头：更新数据之后表头不更新</h3><p>在开发中 表头但是多级表头并且是动态遍历的 ，遍历的数据发生改变表头数据却没有更新</p>
<h4 id="问题出现原因"><a href="#问题出现原因" class="headerlink" title="问题出现原因"></a>问题出现原因</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">v-for</span>=<span class="string">&quot;item in columnData&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--一级表头文字--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot</span>=<span class="string">&quot;header&quot;</span> <span class="attr">slot-scope</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;table-head&quot;</span>&gt;</span>&#123;&#123;item.name &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--.........战略性省略业务代码.........--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>排查了很久，后发现：在自定义表头的时候，由于是用的 v-for 循环生成的，因此会给每个循环体一个固定的 key，导致数据频繁更新时，因为这个 key 没有变，所以 el-table 觉得表头数据是没有变化的，因此就只更新了整体表格数据、key 值有变化的列的表头。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--表头的v-for中的key 使用 id + index 组合的形式使key变成动态的--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in tableData&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id + index&quot;</span>&gt;</span></span><br><span class="line">  .....</span><br><span class="line"><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="el-form"><a href="#el-form" class="headerlink" title="el-form"></a>el-form</h2><h3 id="elementUI-的-form-表单数据-resetFields-重置方法注意事项"><a href="#elementUI-的-form-表单数据-resetFields-重置方法注意事项" class="headerlink" title="elementUI 的 form 表单数据 resetFields 重置方法注意事项"></a>elementUI 的 form 表单数据 resetFields 重置方法注意事项</h3><p>this.$refs.form<a href="">“resetFields”</a>;</p>
<p>form 无法重置表单项的原因有以下四点：</p>
<ol>
<li>el-form-item 的 prop 属性缺失或属性值 不等于 字段名称</li>
<li>表单项本身就有默认值</li>
<li>表单数据绑定时未使用$nextTick 函数（resetFields 重置到挂载前的数据）</li>
<li>未显示的表单项无法重置</li>
</ol>
<h3 id="form-的坑-element-ui-form-表单只有一个输入框获取焦点的时候回车会触发表单的-submit-事件，导致页面刷新"><a href="#form-的坑-element-ui-form-表单只有一个输入框获取焦点的时候回车会触发表单的-submit-事件，导致页面刷新" class="headerlink" title="form 的坑 element ui form 表单只有一个输入框获取焦点的时候回车会触发表单的 submit 事件，导致页面刷新"></a>form 的坑 element ui form 表单只有一个输入框获取焦点的时候回车会触发表单的 submit 事件，导致页面刷新</h3><p><strong>解决方法：</strong></p>
<blockquote>
<p>当一个 form 元素中只有一个输入框时，在该输入框中按下回车应提交该表单。如果希望阻止这一默认行为，可以在 标签上添加 @submit.native.prevent。</p>
</blockquote>
<h2 id="tree"><a href="#tree" class="headerlink" title="tree"></a>tree</h2><h3 id="elementUI-的-tree-的-loadData-从新加载节点方法使用"><a href="#elementUI-的-tree-的-loadData-从新加载节点方法使用" class="headerlink" title="elementUI 的 tree 的 loadData()从新加载节点方法使用"></a>elementUI 的 tree 的 loadData()从新加载节点方法使用</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 更新节点数据</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">currentNode</span>.<span class="property">loaded</span> = <span class="literal">false</span>; <span class="comment">//需要配合node.loaded = false 使用</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">currentNode</span>.<span class="title function_">loadData</span>();</span><br></pre></td></tr></table></figure>

<h3 id="elementUI-tree-未展开的子节点数据改变却不更新的-bug"><a href="#elementUI-tree-未展开的子节点数据改变却不更新的-bug" class="headerlink" title="elementUI tree 未展开的子节点数据改变却不更新的 bug"></a>elementUI tree 未展开的子节点数据改变却不更新的 bug</h3><p>不采用懒加载方式直接改变 tree 的 data 数据发现为展开的子节点数据改变，展开后展示的数据却未变，</p>
<p>查看文档发现有个属性<code>render-after-expand</code>是否在第一次展开某个树节点后才渲染其子节点,</p>
<p>设置为<code>false</code>就可以解决了</p>
<h3 id="element-的-tree-的懒加载使用方法"><a href="#element-的-tree-的懒加载使用方法" class="headerlink" title="element 的 tree 的懒加载使用方法"></a>element 的 tree 的懒加载使用方法</h3><h4 id="load-属性"><a href="#load-属性" class="headerlink" title="load 属性"></a>load 属性</h4><p>懒加载子树数据的方法，需要配合 lazy 属性为 true 时生效，点开当前节点时就会触发； 类型：function(node, resolve)</p>
<p><strong>node：</strong></p>
<ul>
<li>id: 26</li>
<li>text: null</li>
<li>checked: false</li>
<li>indeterminate: false</li>
<li>data: Object 当前绑定的 data</li>
<li>expanded: true</li>
<li>parent: Node 父节点</li>
<li>visible: true</li>
<li>isCurrent: false</li>
<li>store: TreeStore</li>
<li>level: 4 当前在第几级</li>
<li>loaded: true</li>
<li>childNodes: Array(5) 子节点</li>
<li>loading: false</li>
<li>isLeaf: false</li>
<li>label: “中非莱基” 绑定显示的文字</li>
<li>key: undefined</li>
<li>disabled: “”</li>
<li>nextSibling: Node</li>
<li>previousSibling: Node</li>
</ul>
<p>**resolve:**接收子节点的 data 自动绑定到树上</p>
<h4 id="props-属性"><a href="#props-属性" class="headerlink" title="props 属性"></a>props 属性</h4><p>定义 data 中的绑定项的 key</p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">说明</th>
<th align="left">类型</th>
<th align="left">可选值</th>
<th align="left">默认值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">label</td>
<td align="left">指定节点标签为节点对象的某个属性值</td>
<td align="left">string, function(data, node)</td>
<td align="left">—</td>
<td align="left">—</td>
</tr>
<tr>
<td align="left">children</td>
<td align="left">指定子树为节点对象的某个属性值</td>
<td align="left">string</td>
<td align="left">—</td>
<td align="left">—</td>
</tr>
<tr>
<td align="left">disabled</td>
<td align="left">指定节点选择框是否禁用为节点对象的某个属性值</td>
<td align="left">boolean, function(data, node)</td>
<td align="left">—</td>
<td align="left">—</td>
</tr>
<tr>
<td align="left">isLeaf</td>
<td align="left">指定节点是否为叶子节点，仅在指定了 lazy 属性的情况下生效</td>
<td align="left">boolean, function(data, node)</td>
<td align="left">—</td>
<td align="left">—</td>
</tr>
</tbody></table>
<h2 id="el-input"><a href="#el-input" class="headerlink" title="el-input"></a>el-input</h2><h3 id="el-input-同过正则限制只能输入正数可以带小数点-但不生效问题"><a href="#el-input-同过正则限制只能输入正数可以带小数点-但不生效问题" class="headerlink" title="el-input 同过正则限制只能输入正数可以带小数点 但不生效问题"></a>el-input 同过正则限制只能输入正数可以带小数点 但不生效问题</h3><p>代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;el-input</span><br><span class="line">    type=<span class="string">&quot;text&quot;</span></span><br><span class="line">    v-model.<span class="property">number</span>=<span class="string">&quot;editingFormData.salary&quot;</span></span><br><span class="line">    oninput=<span class="string">&quot;value=value.replace(/^\D*(\d*(?:\.\d&#123;0,2&#125;)?).*$/g, &#x27;$1&#x27;)&quot;</span></span><br><span class="line">&gt;&lt;/el-input&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>正则一直不好 无法输入小数点 ， 是因为加了 number 修饰符无法输入小数点， 找了我一个多小时啊</p>
</blockquote>
<p><img data-src="https://bitbw.top/public/img/my_gallery/%E6%AD%A3%E5%88%99%E4%B8%8D%E7%94%9F%E6%95%88%E5%8E%9F%E5%9B%A0.jpg" alt="正则不生效原因"></p>
<h3 id="工作中出现的—表头带-input-搜索框-搜索后点击表格会刷新数据-bug"><a href="#工作中出现的—表头带-input-搜索框-搜索后点击表格会刷新数据-bug" class="headerlink" title="工作中出现的—表头带 input 搜索框 搜索后点击表格会刷新数据 bug"></a>工作中出现的—表头带 input 搜索框 搜索后点击表格会刷新数据 bug</h3><blockquote>
<p>表格带表头 input 搜索的结构 搜索需要回车， 发现每次搜索回车后 点击表格或其他地方， 表格会刷新一下，经同事指点打开 Network 发现 ，点击其他地方会发次请求，打开 table 组件的源码发现 被别的同事添加了@blur 失去焦点事件，并且与回车事件调用同一个函数，因为回车不会使 input 框失去焦点，点击表格其他地方时 input 失去焦点导致再次触发搜索，所有好像自己刷新了一下的样子。 下面是表格内 input 的代码</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-input</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-if</span>=<span class="string">&quot;[undefined, &#x27;&#x27;, &#x27;input&#x27;, &#x27;button&#x27;, &#x27;string&#x27;].includes(field.fieldType)&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-bind</span>=<span class="string">&quot;field.headerSearchAttrs&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-model.trim</span>=<span class="string">&quot;field.inputValue&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">clearable</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:placeholder</span>=<span class="string">&quot;field.label&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">keyup.enter.native</span>=<span class="string">&quot;handleBlur(field.prop, field.inputValue)&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">blur</span>=<span class="string">&quot;handleBlur(field.prop, field.inputValue)&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">clear</span>=<span class="string">&quot;clearQueryInput&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- @keyup.enter 和@blur调用同一函数产生的bug --&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="el-image"><a href="#el-image" class="headerlink" title="el-image"></a>el-image</h2><h3 id="elementUI-的-image-的-src-加载-vue-系统或本地图片的方法（重要）"><a href="#elementUI-的-image-的-src-加载-vue-系统或本地图片的方法（重要）" class="headerlink" title="elementUI 的 image 的 src 加载 vue 系统或本地图片的方法（重要）"></a>elementUI 的 image 的 src 加载 vue 系统或本地图片的方法（重要）</h3><blockquote>
<p>正常情况以下情形是不生效的， 会提示找不到图片 所以需要用到，原生的 require 方法</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div class=&quot;message-item&quot; v-for=&quot;(item, index) in uploadMessage&quot; :key=&quot;index&quot;&gt;</span><br><span class="line">    &lt;span class=&quot;item-txt&quot;&gt;&#123;&#123;item.txt&#125;&#125;&lt;/span&gt;</span><br><span class="line">    &lt;el-image :src=&quot;item.img&quot; :preview-src-list=&quot;srcList&quot;&gt;&lt;/el-image&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//js部分</span></span><br><span class="line">uploadMessage = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">txt</span>: <span class="string">&quot;1.进入税务系统&quot;</span>,</span><br><span class="line">    <span class="attr">img</span>: <span class="string">&quot;@/hrwa/assets/taxset-information-management/taxset1.png&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">txt</span>: <span class="string">&quot;1.进入税务系统&quot;</span>,</span><br><span class="line">    <span class="attr">img</span>: <span class="string">&quot;@/hrwa/assets/taxset-information-management/taxset2.png&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">txt</span>: <span class="string">&quot;1.进入税务系统&quot;</span>,</span><br><span class="line">    <span class="attr">img</span>: <span class="string">&quot;@/hrwa/assets/taxset-information-management/taxset3.png&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">txt</span>: <span class="string">&quot;1.进入税务系统&quot;</span>,</span><br><span class="line">    <span class="attr">img</span>: <span class="string">&quot;@/hrwa/assets/taxset-information-management/taxset4.png&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">]; <span class="comment">//提示</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>图片会显示加载失败 ， 修改后 的代码结构 如下</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">uploadMessage = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">txt</span>: <span class="string">&quot;1.进入税务系统&quot;</span>,</span><br><span class="line">    <span class="attr">img</span>: <span class="built_in">require</span>(<span class="string">&quot;@/hrwa/assets/taxset-information-management/taxset1.png&quot;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">txt</span>: <span class="string">&quot;1.进入税务系统&quot;</span>,</span><br><span class="line">    <span class="attr">img</span>: <span class="built_in">require</span>(<span class="string">&quot;@/hrwa/assets/taxset-information-management/taxset2.png&quot;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">txt</span>: <span class="string">&quot;1.进入税务系统&quot;</span>,</span><br><span class="line">    <span class="attr">img</span>: <span class="built_in">require</span>(<span class="string">&quot;@/hrwa/assets/taxset-information-management/taxset3.png&quot;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">txt</span>: <span class="string">&quot;1.进入税务系统&quot;</span>,</span><br><span class="line">    <span class="attr">img</span>: <span class="built_in">require</span>(<span class="string">&quot;@/hrwa/assets/taxset-information-management/taxset4.png&quot;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"><span class="comment">//大图地址也需要加require</span></span><br><span class="line">srcList = [</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&quot;@/hrwa/assets/taxset-information-management/taxset1.png&quot;</span>),</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&quot;@/hrwa/assets/taxset-information-management/taxset2.png&quot;</span>),</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&quot;@/hrwa/assets/taxset-information-management/taxset3.png&quot;</span>),</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&quot;@/hrwa/assets/taxset-information-management/taxset4.png&quot;</span>),</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h2 id="样式问题"><a href="#样式问题" class="headerlink" title="样式问题"></a>样式问题</h2><ul>
<li>table 通过 th display: table-cell !important; 控制在谷歌浏览器下边框不对齐问题</li>
<li>导航菜单选中项样式问题通过类名.is-active 设置</li>
<li>顶部 logo 部分的顶部栏的高度，和子项宽度 都是通过 flex 属性设置，flex ：0 0 220px</li>
<li>elementui 的样式变量在 E:\project\hr-web-container\node_modules\element-ui\packages\theme-chalk\src\common\var.scss 内</li>
</ul>
<h2 id="date-picker"><a href="#date-picker" class="headerlink" title="date-picker"></a>date-picker</h2><h3 id="问题-datepicker-星期日期选择组件。绑定值格式化为时间戳时会出现乱码"><a href="#问题-datepicker-星期日期选择组件。绑定值格式化为时间戳时会出现乱码" class="headerlink" title="问题 datepicker 星期日期选择组件。绑定值格式化为时间戳时会出现乱码"></a>问题 datepicker 星期日期选择组件。绑定值格式化为时间戳时会出现乱码</h3><p><a href="https://github.com/ElemeFE/element/issues/21159">github issues</a></p>
<p>将datepicker组件的type属性设置为week，value-format属性设置为timestamp，此时无法回显选择的日期，通过打印v-model值可以得知此时的v-model正确值是乱码 <code>ti0e0tam0p</code></p>
<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>目前 github 上没有解决 elementUI 2 已经没有维护了 ， value-format尽量别设置为timestamp 就可以避免这个问题</p>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
        <tag>elementUI</tag>
      </tags>
  </entry>
  <entry>
    <title>es6 模块规范</title>
    <url>/2019/11/30/js/es6%E6%A8%A1%E5%9D%97%E8%A7%84%E8%8C%83/</url>
    <content><![CDATA[<h3 id="导出-export"><a href="#导出-export" class="headerlink" title="导出 export"></a>导出 export</h3><p>如果模块只有一个成员，建议 <code>export default</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> 数字|字符串|数组|对象|函数。。。任何数据</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：</p>
<p>1.export default 只能有一次，重复会报错</p>
<p>2.使用时不要在后面做声明 var 、 let 、const 、直接写需要导出的对象或其他， 也可以先声明变量或常量， 再直接导出</p>
</blockquote>
<p>如果一个模块有多个成员</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  成员<span class="number">1</span>: 值,</span><br><span class="line">  成员<span class="number">2</span>: 值<span class="number">2</span>,</span><br><span class="line">  成员<span class="number">3.</span>..</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果成员之间没有依赖关系，不是用于某个数据的完整整体，不推荐，你可能只使用其中某个成员，而必须加载整体数据对象</p>
<p>除非这个对象是一个完整的整体，例如 Vue 组件的实例选项对象，这样是可以的</p>
</blockquote>
<span id="more"></span>

<p>ECMAScript 6 提供了一种更优化的方案，当多个成员没有具体的依赖关系的时候，我们推荐使用 <code>export</code> 语法进行导出，因为它支持<strong>按需加载</strong>，就是说你用什么就只加载什么，其它多余的都不要，这样有利于程序的执行效率。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> b = <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<p>也可以集中按需导出多个成员</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> b = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">const</span> c = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 语法就是这样，后面的成员也不是对象的简写方式， &#123;&#125; 中的成员必须当前模块能够访问的成员名称</span></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">  <span class="comment">// 不是 a: a 的简写，必须 a</span></span><br><span class="line">  <span class="comment">// a 必须是当前模块中的某个成员</span></span><br><span class="line">  a,</span><br><span class="line">  b,</span><br><span class="line">  c,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以上写法等价于</span></span><br><span class="line"><span class="comment">// export const a = 1</span></span><br><span class="line"><span class="comment">// export const b = 2</span></span><br><span class="line"><span class="comment">// export const c = 3</span></span><br></pre></td></tr></table></figure>

<p>有时候模块中有很多成员的时候，我们会 <code>export default</code> 和 <code>export</code> 一起使用。</p>
<p>我们把最常用的使用 <code>export default</code> 导出，把不太常用的使用 <code>export</code> 导出（用于按需加载）。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> b = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> (<span class="params">x, y</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="导入-import"><a href="#导入-import" class="headerlink" title="导入 import"></a>导入 import</h3><p>加载 <code>export default</code> 成员</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> xxx <span class="keyword">from</span> <span class="string">&quot;模块路径&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>按需加载 <code>export</code> 成员</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; 成员<span class="number">1</span> <span class="keyword">as</span> 别名, 成员<span class="number">2.</span>.. &#125; <span class="keyword">from</span> <span class="string">&#x27;模块路径&#x27;</span></span><br></pre></td></tr></table></figure>

<p>混着加载 <code>export default</code> 和 <code>export</code> 成员</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> xxx, &#123; 成员<span class="number">1</span>, 成员<span class="number">2.</span>.. &#125; <span class="keyword">from</span> <span class="string">&#x27;模块路径&#x27;</span></span><br></pre></td></tr></table></figure>

<p>一次性加载所有成员</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> xxx <span class="keyword">from</span> <span class="string">&quot;模块路径&quot;</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>包括 <code>export default</code> 和 <code>export</code> 所有成员</p>
<p><code>export default</code> 就是一个名字叫 <code>default</code> 的成员，知道即可，不推荐这样来使用 <code>xxx.default</code></p>
</blockquote>
<p>下面是一个导出的例子：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="number">123</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// export default 只能有1次，多次就报错，语法不允许</span></span><br><span class="line"><span class="comment">// export default &#x27;hello&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果你想导出多个成员，可以放到1个对象中</span></span><br><span class="line"><span class="comment">// export default &#123;</span></span><br><span class="line"><span class="comment">//   a: 1,</span></span><br><span class="line"><span class="comment">//   b: 2</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 大多数情况下我们其实只需要使用到对象中某几个成员，而不是所有</span></span><br><span class="line"><span class="comment">// ECMAScript 6 为了优化这一点，增加了：按需加载和导出功能</span></span><br><span class="line"><span class="comment">// 使用谁，加载谁，更有利于性能优化，打包优化</span></span><br><span class="line"><span class="comment">// 按需导出可以导出任意个成员</span></span><br><span class="line"><span class="comment">// 注意：export 成员必须有名字</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> b = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> c = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也不能这么写</span></span><br><span class="line"><span class="comment">// const d = 789</span></span><br><span class="line"><span class="comment">// export d</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// export const d = 789</span></span><br><span class="line"><span class="comment">// export function hello () &#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;hello&#x27;)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 建议写法：</span></span><br><span class="line"><span class="comment">// 我们一般会把最主要的那个成员作为 export  default 导出</span></span><br><span class="line"><span class="comment">// 如果有其它的成员，作为 export 成员按需导出</span></span><br><span class="line"><span class="comment">// 没有主要的那就不用设置了，</span></span><br></pre></td></tr></table></figure>

<h3 id="模块数据结构"><a href="#模块数据结构" class="headerlink" title="模块数据结构"></a>模块数据结构</h3><p>使用 import * as xx form “xxx” 可以获取 模块的结构</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">default</span>: &#123;	  <span class="comment">// export default 导出的数据</span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;default&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module1</span>: &#123;	<span class="comment">// 单独 export 导出的数据</span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;module1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module2</span>: &#123;	<span class="comment">// 多个 export 都再这一层</span></span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;module2&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="简便写法"><a href="#简便写法" class="headerlink" title="简便写法"></a>简便写法</h3><h4 id="导入多个-导出多个"><a href="#导入多个-导出多个" class="headerlink" title="导入多个 导出多个"></a>导入多个 导出多个</h4><p><a name="project1">案例 1.1</a></p>
<p>module1.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> module1 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;module1&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> module3 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;module3&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> module1;</span><br><span class="line"><span class="keyword">export</span> &#123; module1 &#125;; <span class="comment">// 多个导出模块也可以这样写 export &#123; module1 &#125;;</span></span><br><span class="line"><span class="keyword">export</span> &#123; module3 &#125;;</span><br></pre></td></tr></table></figure>

<p>module2.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> module2 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;module2&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> module2;</span><br><span class="line"><span class="keyword">export</span> &#123; module2 &#125;;</span><br></pre></td></tr></table></figure>

<p>index.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./module1&quot;</span>; <span class="comment">//会将 module1 内部使用 export 导出的模块都导出</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./module2&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>main.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> modules <span class="keyword">from</span> <span class="string">&#x27;./index.js&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;modules&quot;</span>, modules)</span><br><span class="line"><span class="comment">// 下面是 modules 数据结构  因为都是使用 export 导出 所以没有 default</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;module1&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;module1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;module3&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;module3&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;module2&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;module2&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="导入默认模块-并导出为默认模块"><a href="#导入默认模块-并导出为默认模块" class="headerlink" title="导入默认模块 并导出为默认模块"></a>导入默认模块 并导出为默认模块</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> &#123; <span class="keyword">default</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./dialog.vue&quot;</span>; <span class="comment">// 将默认模块 导出为默认模块</span></span><br></pre></td></tr></table></figure>

<h3 id="常用写法"><a href="#常用写法" class="headerlink" title="常用写法"></a>常用写法</h3><h4 id="组件的导出"><a href="#组件的导出" class="headerlink" title="组件的导出"></a>组件的导出</h4><p>index.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">VBtn</span> <span class="keyword">from</span> <span class="string">&quot;./VBtn&quot;</span>; <span class="comment">// 将index.js作为导出的中转将VBtn.vue导出</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; <span class="title class_">VBtn</span> &#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">VBtn</span>;</span><br></pre></td></tr></table></figure>

<h3 id="注意事项："><a href="#注意事项：" class="headerlink" title="注意事项："></a>注意事项：</h3><h4 id="多次导出一个模块-只执行一次"><a href="#多次导出一个模块-只执行一次" class="headerlink" title="多次导出一个模块 只执行一次"></a>多次导出一个模块 只执行一次</h4><p>module1.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> module1 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;module1&quot;</span>,</span><br><span class="line">  <span class="attr">id</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>() + <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">100</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> module1;</span><br><span class="line"><span class="keyword">export</span> &#123; module1 &#125;;</span><br></pre></td></tr></table></figure>

<p>多个模块导入一起导入</p>
<blockquote>
<p>tip:本例中虽然是两个 js 但打包后会合并到一个页面中执行，如果路由发生跳转则相当于重新编译所以导入模块也将重置</p>
</blockquote>
<p>index.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> modules <span class="keyword">from</span> <span class="string">&#x27;./module1.js&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;module1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;id&quot;</span>: <span class="number">1615195779568.6755</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>main.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> modules <span class="keyword">from</span> <span class="string">&#x27;./module1.js&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;module1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;id&quot;</span>: <span class="number">1615195779568.6755</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面的 id 都是 1615195779568.6755</p>
<h4 id="export-导出重名模块-只会存在一个"><a href="#export-导出重名模块-只会存在一个" class="headerlink" title="export 导出重名模块 只会存在一个"></a>export 导出重名模块 只会存在一个</h4><p>将 <a href="#project1">案例 1.1</a> 修改一下</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> module1 = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;module1&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> module2 = &#123;</span><br><span class="line">  <span class="comment">//module2.js 导出 和 module1.js 的导出 都有 module2</span></span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;module3&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> module1;</span><br><span class="line"><span class="keyword">export</span> &#123; module1 &#125;;</span><br><span class="line"><span class="keyword">export</span> &#123; module2 &#125;;</span><br></pre></td></tr></table></figure>

<p>main.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> modules <span class="keyword">from</span> <span class="string">&#x27;./index.js&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;modules&quot;</span>, modules)  <span class="comment">// 有两个重名模块 只会留在上面那个导出的模块</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;module1&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;module1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;module2&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;module3&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果修改一下 index.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./module2&quot;</span>;  <span class="comment">// 最终导出的 module2 将是 module2.js 中的</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&quot;./module1&quot;</span>;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;module1&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;module1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;module2&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;module2&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="直接-import-某个-js-相当于直接执行这个-js-文件"><a href="#直接-import-某个-js-相当于直接执行这个-js-文件" class="headerlink" title="直接 import 某个 js 相当于直接执行这个 js 文件"></a>直接 import 某个 js 相当于直接执行这个 js 文件</h4><blockquote>
<p>如果不需要模块导出, 直接执行这个 js 可以 improt xx.js</p>
</blockquote>
<p>module.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;模块执行了&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">add</span> = (<span class="params">...args</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> sum = args.<span class="title function_">reduce</span>(<span class="function">(<span class="params">sum, item</span>) =&gt;</span> (sum += item), <span class="number">0</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;sum&quot;</span>, sum);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">add</span>(<span class="number">123123</span>, <span class="number">2351235</span>);</span><br></pre></td></tr></table></figure>

<p>index.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;./module3.mjs&quot;</span>;</span><br><span class="line"><span class="comment">// 模块执行了</span></span><br><span class="line"><span class="comment">// sum 2474358</span></span><br></pre></td></tr></table></figure>

<h3 id="ES6-模块与-CommonJS-模块的差异"><a href="#ES6-模块与-CommonJS-模块的差异" class="headerlink" title="ES6 模块与 CommonJS 模块的差异"></a>ES6 模块与 CommonJS 模块的差异</h3><p>讨论 Node.js 加载 ES6 模块之前，必须了解 ES6 模块与 CommonJS 模块完全不同。</p>
<p>它们有三个重大差异。</p>
<ul>
<li>CommonJS 模块输出的是一个值的拷贝，ES6 模块输出的是值的引用。</li>
<li>CommonJS 模块是运行时加载，ES6 模块是编译时输出接口。</li>
<li>CommonJS 模块的<code>require()</code>是同步加载模块，ES6 模块的<code>import</code>命令是异步加载，有一个独立的模块依赖的解析阶段。</li>
</ul>
<p>第二个差异是因为 CommonJS 加载的是一个对象（即<code>module.exports</code>属性），该对象只有在脚本运行完才会生成。而 ES6 模块不是对象，它的对外接口只是一种静态定义，在代码静态解析阶段就会生成。</p>
<p>详细分析见阮一峰 es6 入门：<a href="https://es6.ruanyifeng.com/#docs/module-loader">https://es6.ruanyifeng.com/#docs/module-loader</a></p>
<h4 id="CommonJS-模块加载-ES6-模块"><a href="#CommonJS-模块加载-ES6-模块" class="headerlink" title="CommonJS 模块加载 ES6 模块"></a>CommonJS 模块加载 ES6 模块</h4><p>CommonJS 的<code>require()</code>命令不能加载 ES6 模块，会报错，只能使用<code>import()</code>这个方法加载。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">&quot;./my-app.mjs&quot;</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h4 id="ES6-模块加载-CommonJS-模块"><a href="#ES6-模块加载-CommonJS-模块" class="headerlink" title="ES6 模块加载 CommonJS 模块"></a>ES6 模块加载 CommonJS 模块</h4><p>ES6 模块的<code>import</code>命令可以加载 CommonJS 模块，但是只能整体加载，不能只加载单一的输出项</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 正确</span></span><br><span class="line"><span class="keyword">import</span> packageMain <span class="keyword">from</span> <span class="string">&quot;commonjs-package&quot;</span>;</span><br><span class="line"><span class="comment">// 报错</span></span><br><span class="line"><span class="keyword">import</span> &#123; method &#125; <span class="keyword">from</span> <span class="string">&quot;commonjs-package&quot;</span>;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>js</tag>
        <tag>es6</tag>
      </tags>
  </entry>
  <entry>
    <title>express入门</title>
    <url>/2022/03/07/Nodejs/express%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<h2 id="Express-应用程序生成器"><a href="#Express-应用程序生成器" class="headerlink" title="Express 应用程序生成器"></a>Express 应用程序生成器</h2><p><a href="http://expressjs.com/zh-cn/starter/generator.html">官方地址</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npx express-generator --git  -view=ejs  myapp</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> myapp</span><br><span class="line"></span><br><span class="line">npm install</span><br><span class="line"></span><br><span class="line">npm start</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="项目完善"><a href="#项目完善" class="headerlink" title="项目完善"></a>项目完善</h2><h3 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h3><p>app.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//设置CORS</span></span><br><span class="line">app.<span class="title function_">all</span>(<span class="string">&#x27;*&#x27;</span>,<span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  res.<span class="title function_">header</span>(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>,<span class="string">&#x27;*&#x27;</span>); <span class="comment">//当允许携带cookies此处的白名单不能写’*’</span></span><br><span class="line">  res.<span class="title function_">header</span>(<span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span>,<span class="string">&#x27;Accept-Ranges, Content-Encoding,  Content-Range, content-type,Content-Length, Authorization,Origin,Accept,X-Requested-With&#x27;</span>); <span class="comment">//允许的请求头</span></span><br><span class="line">  res.<span class="title function_">header</span>(<span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span>, <span class="string">&#x27;POST, GET, OPTIONS, PUT&#x27;</span>); <span class="comment">//允许的请求方法</span></span><br><span class="line">  res.<span class="title function_">header</span>(<span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span>,<span class="literal">true</span>);  <span class="comment">//允许携带cookies</span></span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="解析-formdata"><a href="#解析-formdata" class="headerlink" title="解析 formdata"></a>解析 formdata</h3><p><a href="https://www.npmjs.com/package/multiparty">使用 multiparty</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install multiparty</span><br></pre></td></tr></table></figure>

<p>router</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> multiparty = <span class="built_in">require</span>(<span class="string">&quot;multiparty&quot;</span>);</span><br><span class="line">outer.<span class="title function_">post</span>(<span class="string">&quot;/xxx&quot;</span>, <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">  <span class="comment">// 获取form</span></span><br><span class="line">  <span class="keyword">var</span> form = <span class="keyword">new</span> multiparty.<span class="title class_">Form</span>();</span><br><span class="line">  form.<span class="title function_">parse</span>(req, <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">err, fields, files</span>) &#123;</span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">      例子：  客户端发送如下 formData</span></span><br><span class="line"><span class="comment">      </span></span><br><span class="line"><span class="comment">      formData :&#123;</span></span><br><span class="line"><span class="comment">        image : new File([1,2,3],&quot;xx.png&quot;),</span></span><br><span class="line"><span class="comment">        userID:&quot;S12SADXXA&quot;</span></span><br><span class="line"><span class="comment">      &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      files 接收 formData 中的文件 </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      files.image[0] = &#123;</span></span><br><span class="line"><span class="comment">        fieldName: &quot;image&quot;,</span></span><br><span class="line"><span class="comment">        originalFilename: &quot;xx.png&quot;,</span></span><br><span class="line"><span class="comment">        path: &quot;XXX/XXX/XXX/xx.png&quot;,</span></span><br><span class="line"><span class="comment">        headers: &#123;</span></span><br><span class="line"><span class="comment">          &quot;content-disposition&quot;: &quot;form-data; name=\&quot;image\&quot;; filename=\&quot;xx.png\&quot;&quot;,</span></span><br><span class="line"><span class="comment">          &quot;content-type&quot;: &quot;application/json&quot;,</span></span><br><span class="line"><span class="comment">        &#125;,</span></span><br><span class="line"><span class="comment">        size: 26,</span></span><br><span class="line"><span class="comment">      &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      fields 接收非文件字段</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      fields.userID[0] = &quot;S12SADXXA&quot;</span></span><br><span class="line"><span class="comment">      */</span> </span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(fields, files)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Nodejs</category>
      </categories>
      <tags>
        <tag>express</tag>
      </tags>
  </entry>
  <entry>
    <title>gitlab的使用</title>
    <url>/2022/01/19/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/gitlab%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="docker安装"><a href="#docker安装" class="headerlink" title="docker安装"></a>docker安装</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo docker run --detach \</span><br><span class="line">  --hostname gitlab.example.com \</span><br><span class="line">  --publish 8443:443 --publish 8081:80 --publish 10022:22 \</span><br><span class="line">  --name gitlab \</span><br><span class="line">  --restart always \</span><br><span class="line">  --volume <span class="variable">$GITLAB_HOME</span>/config:/etc/gitlab \</span><br><span class="line">  --volume <span class="variable">$GITLAB_HOME</span>/logs:/var/log/gitlab \</span><br><span class="line">  --volume <span class="variable">$GITLAB_HOME</span>/data:/var/opt/gitlab \</span><br><span class="line">  --shm-size 256m \</span><br><span class="line">  gitlab/gitlab-ce:latest</span><br></pre></td></tr></table></figure>

<p>注意：端口号映射， 防止端口占用 –publish 8443:443 –publish 8081:80 –publish 10022:22 \</p>
]]></content>
      <categories>
        <category>工具使用</category>
      </categories>
      <tags>
        <tag>gitlab</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo常见问题汇总</title>
    <url>/2019/11/28/Hexo/hexo%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<p><a href="https://hexo.io/docs/">hexo官方文档</a></p>
<h2 id="hexo-上传-github-后图片不显示问题"><a href="#hexo-上传-github-后图片不显示问题" class="headerlink" title="hexo 上传 github 后图片不显示问题"></a>hexo 上传 github 后图片不显示问题</h2><ul>
<li><p>在文件夹下找到_config.yml 文件 将<code>post_asset_folder:</code>修改为 true</p>
</li>
<li><p>将上面的参数修改后 直接<code>hexo new 文件名</code> 会自动创建出一个跟文件同名的文件夹 ，将图片等资料都放到文件夹中</p>
</li>
<li><p>下载依赖~&#96;npm install hexo-asset-image <a href="https://github.com/CodeFalling/hexo-asset-image%60">https://github.com/CodeFalling/hexo-asset-image`</a></p>
<blockquote>
<p>注意下载 依赖一定要后面的网址 这接<code>hexo-asset-image</code> 会下载最新版 还会导致图片不显示</p>
<p>注意（）内部直接加文件名&#x2F;图片名即可, 例如：<code>![1574935033235](hexo采坑日记/1574935033235.png)</code></p>
<p>加相对路径例如<code>![1574935033235](./hexo采坑日记/1574935033235.png)</code> 也会导致图片不显示</p>
<p>注意：路径需要 encodeURI 才行 像这样<code>hexo%E9%87%87%E5%9D%91%E6%97%A5%E8%AE%B0/image-20200725174552781.png</code></p>
</blockquote>
</li>
<li><p>使用 typroa 修改图片路径 下面这种方法 typroa 会自动保存到命名文件夹下，并自动 encode</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20201215135603281.png" alt="image-20201215135603281"></p>
</li>
</ul>
<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p><strong>编辑好 md 文档先在<code>hexo server</code> 运行一下在提交 github</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Markdown</span> 使用时（） &#123; &#125; 都需要转义 否者会报错</span><br></pre></td></tr></table></figure>

<p><strong>每次提交 github 自动构建前，要重启一下 hexo server 然后看看没有报错 ，再进行提交</strong></p>
<h2 id="next-主题注意事项"><a href="#next-主题注意事项" class="headerlink" title="next 主题注意事项"></a>next 主题注意事项</h2><p>canvas_ribbon 和 tree 需要配合在 CDN 中添加 git 默认不上传 lib 下的文件</p>
<h2 id="关于报错"><a href="#关于报错" class="headerlink" title="关于报错"></a>关于报错</h2><p><img data-src="https://bitbw.top/public/img/my_gallery/image-20200725160508488.png" alt="image-20200725160508488"></p>
<p>没有任何提示 哪个文件，挨个改动回退试试，原来是因为<code>_config.yml</code>这里直接写中文是不行的，中文需要引号包裹</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">social:</span></span><br><span class="line">  <span class="comment"># 微博: http://weibo.com/your-user-name  这里不能使用中文  确使用方式如下  地址后是图标</span></span><br><span class="line">  <span class="string">&quot;微博&quot;</span><span class="string">:</span> <span class="string">http://weibo.com/your-user-name</span> <span class="string">||</span> <span class="string">fab</span> <span class="string">fa-weibo</span></span><br><span class="line">  <span class="string">&quot;知乎&quot;</span><span class="string">:</span> <span class="string">http://www.zhihu.com/people/your-user-name</span> <span class="string">||</span> <span class="string">fab</span> <span class="string">fa-zhihu</span></span><br></pre></td></tr></table></figure>

<h2 id="Next-主题文章老是自动滚到底部评论区的问题"><a href="#Next-主题文章老是自动滚到底部评论区的问题" class="headerlink" title="Next 主题文章老是自动滚到底部评论区的问题"></a>Next 主题文章老是自动滚到底部评论区的问题</h2><p>原因 :<br>设置了 utterances</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">utterances:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>解决：<br>取消 utterances</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">utterances:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h2 id="hexo-4-2-1-升级至-6-2-0-Next-7-8-0-升级至-8-12-1"><a href="#hexo-4-2-1-升级至-6-2-0-Next-7-8-0-升级至-8-12-1" class="headerlink" title="hexo 4.2.1 升级至 6.2.0  Next 7.8.0 升级至 8.12.1"></a>hexo 4.2.1 升级至 6.2.0  Next 7.8.0 升级至 8.12.1</h2><h3 id="hexo-升级"><a href="#hexo-升级" class="headerlink" title="hexo 升级"></a>hexo 升级</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm i -g npm-check <span class="comment"># 检查之前安装的插件，都有哪些是可以升级的 </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cd hexo 目录</span></span><br><span class="line">npm-check         <span class="comment"># 检查那些依赖能够升级 并把 package.json 版本号升级到最新</span></span><br><span class="line">npm update        <span class="comment"># 安装升级</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Next-升级"><a href="#Next-升级" class="headerlink" title="Next 升级"></a>Next 升级</h3><p><a href="https://theme-next.js.org/docs/getting-started/upgrade.html">升级官方文档</a></p>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># cd hexo 目录</span></span><br><span class="line">npm i hexo-theme-next</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="修改配置文件位置"><a href="#修改配置文件位置" class="headerlink" title="修改配置文件位置"></a>修改配置文件位置</h4><p>将<code>themes/next/_config.yml</code> 复制到 <code>hexo目录/_config.next.yml</code></p>
<h4 id="备份原主题"><a href="#备份原主题" class="headerlink" title="备份原主题"></a>备份原主题</h4><p>将 <code>themes/next</code> 改为  <code>themes/next-old</code></p>
<h4 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h4><p>运行<code>hexo clean</code>并<code>hexo s</code>检查站点是否正常工作</p>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>javaScript-变量-数据类型-数据类型的转换</title>
    <url>/2016/06/05/js/javaScript-%E5%8F%98%E9%87%8F-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%9A%84%E8%BD%AC%E6%8D%A2/</url>
    <content><![CDATA[<h2 id="变量-（主要）"><a href="#变量-（主要）" class="headerlink" title="变量 （主要）"></a>变量 （主要）</h2><h3 id="为什么要使用变量"><a href="#为什么要使用变量" class="headerlink" title="为什么要使用变量"></a>为什么要使用变量</h3><ul>
<li>因为编程中会存在很多数据操作，多次进行数据操作很麻烦，而且会出错</li>
</ul>
<h3 id="什么是变量"><a href="#什么是变量" class="headerlink" title="什么是变量"></a>什么是变量</h3><ul>
<li>本质上就是保存数据的容器，用来方便进行数据操作</li>
</ul>
<h3 id="变量怎么操作"><a href="#变量怎么操作" class="headerlink" title="变量怎么操作"></a>变量怎么操作</h3><ul>
<li>变量的声明操作<ul>
<li>格式： var 变量名; - 注意：声明变量必须设置 var！！！<span id="more"></span></li>
</ul>
</li>
</ul>
<h3 id="变量的赋值操作"><a href="#变量的赋值操作" class="headerlink" title="变量的赋值操作"></a>变量的赋值操作</h3><ul>
<li><p>格式：var 变量名; 变量名 &#x3D; 数据；</p>
</li>
<li><p>同时进行声明和赋值操作</p>
</li>
<li><p>格式： var 变量名 &#x3D; 数据;</p>
</li>
<li><p>合并多个变量的声明或赋值</p>
<ul>
<li>格式： var 变量名 1 &#x3D; 数据 1, 变量名 2， 变量名 3 &#x3D; 数据; &#x2F;&#x2F; ….</li>
</ul>
</li>
<li><p>操作变量实际上就是操作内部保存的数据。</p>
</li>
</ul>
<h2 id="基本数据类型-5-个"><a href="#基本数据类型-5-个" class="headerlink" title="基本数据类型 5 个"></a>基本数据类型 5 个</h2><h3 id="数值类型-number"><a href="#数值类型-number" class="headerlink" title="数值类型 number"></a>数值类型 number</h3><ul>
<li>组成<ul>
<li>基本数值：生活中的整数和小数</li>
<li>特殊数值：NaN - 非数值</li>
</ul>
</li>
<li>极限值（了解，不需要记忆）<ul>
<li>无穷和无限的概念只在生活中存在，是一种理想化的情况</li>
<li>计算机中的编程语言不可能表示出无限的数值位数，是具有最大和最小值的</li>
<li>Number.MAX_VALUE 超出了这个最大表示范围后出现 Infinity</li>
<li>Number.MIN_VALUE 正数的最小精度</li>
</ul>
</li>
</ul>
<h3 id="字符串类型-string"><a href="#字符串类型-string" class="headerlink" title="字符串类型 string"></a>字符串类型 string</h3><ul>
<li>特殊的标识方式<ul>
<li>成对的英文半角的单引号或双引号</li>
<li>推荐使用单引号进行标识</li>
</ul>
</li>
<li>转义符的使用<ul>
<li>转义符的符号： 反斜线 \</li>
<li>作用：<ul>
<li>将特殊字符转换为普通字符</li>
<li>将普通字符转换为特殊字符</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="布尔类型-boolean"><a href="#布尔类型-boolean" class="headerlink" title="布尔类型 boolean"></a>布尔类型 boolean</h3><p>组成： true 和 false</p>
<ul>
<li>用来表示某个结果的真 true 或假 false</li>
</ul>
<h3 id="undefined-未定义"><a href="#undefined-未定义" class="headerlink" title="undefined 未定义"></a>undefined 未定义</h3><ul>
<li>defined 定义</li>
<li>出现在某些操作的默认值中<ul>
<li>当变量声明还未赋值时，默认值为 undefined</li>
<li>后面学习的其他语法中也存在默认值为 undefined 的情况<ul>
<li>会在后面的内容中依次讲解，最后一天进行小结</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="null-空"><a href="#null-空" class="headerlink" title="null 空"></a>null 空</h3><p>当我们希望主动的将变量中保存的数据清空时，设置为 null 即可</p>
<h2 id="类型检测操作"><a href="#类型检测操作" class="headerlink" title="类型检测操作"></a>类型检测操作</h2><h3 id="typeof"><a href="#typeof" class="headerlink" title="typeof"></a>typeof</h3><ul>
<li><p>使用方式：</p>
<ul>
<li>typeof 数据</li>
<li>typeof(数据)</li>
</ul>
</li>
<li><p>两种方式检测结果没有区别，个人推荐第一种</p>
</li>
<li><p>结果：</p>
<ul>
<li>字符串形式的类型名称，例如’string’ ‘number’。。</li>
<li>问题：对 null 的检测结果不准确，是’object’，后续会介绍其他方式</li>
</ul>
</li>
</ul>
<h2 id="变量的交换操作"><a href="#变量的交换操作" class="headerlink" title="变量的交换操作"></a>变量的交换操作</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 需求：交换str1和str2中保存的数据</span></span><br><span class="line"><span class="keyword">var</span> str1 = <span class="string">&quot;我是第一个变量的内容&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> str2 = <span class="string">&quot;我是第二个变量的内容&quot;</span>;</span><br><span class="line"><span class="comment">// 实现方式，设置一个用来中转数据的变量即可</span></span><br><span class="line"><span class="keyword">var</span> temp = str1;</span><br><span class="line">str1 = str2;</span><br><span class="line">str2 = temp;</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(str1);</span><br><span class="line"><span class="title function_">alert</span>(str2);</span><br></pre></td></tr></table></figure>

<h2 id="常用的输出方式"><a href="#常用的输出方式" class="headerlink" title="常用的输出方式"></a>常用的输出方式</h2><ul>
<li>alert() 普通的弹出提示框</li>
<li>console.log() 在控制台中输出内容，非常常用<ul>
<li>console.log(数据 1, 数据 2, 数据 3………);</li>
</ul>
</li>
<li>confirm() 确认提示框<ul>
<li>根据用户选择的确定和取消返回布尔值 true 或 false</li>
</ul>
</li>
<li>prompt() 输入提示框<ul>
<li>点击确定后，会将输入框中的内容返回，点击取消为空 null</li>
</ul>
</li>
<li>document.write() 在文档中输出内容（输出位置为 body 标签内）<ul>
<li>设置的 html 标签结构，会被生成为真正的标签</li>
</ul>
</li>
</ul>
<h2 id="数据类型转换"><a href="#数据类型转换" class="headerlink" title="数据类型转换"></a>数据类型转换</h2><h3 id="数值类型"><a href="#数值类型" class="headerlink" title="数值类型"></a>数值类型</h3><ul>
<li>转换失败结果均为 NaN</li>
<li>强制转换：<ul>
<li>Number(数据);</li>
<li>parseInt()<ul>
<li>将数据转换为整数</li>
</ul>
</li>
<li>parseFloat()<ul>
<li>将数据转换为小数</li>
</ul>
</li>
</ul>
</li>
<li>隐式转换：<ul>
<li>+- 俗称正负号</li>
<li>+-*&#x2F;%</li>
</ul>
</li>
</ul>
<blockquote>
<p>注意：转换失败结果均为 NaN</p>
</blockquote>
<h3 id="字符串类型"><a href="#字符串类型" class="headerlink" title="字符串类型"></a>字符串类型</h3><ul>
<li><p>指的是将其他类型转换为字符串类型</p>
</li>
<li><p>强制转换：</p>
<ul>
<li>数据.toString()</li>
</ul>
</li>
</ul>
<blockquote>
<p>注意：null 和 undefined 无法使用 数据.toString() 的方式</p>
</blockquote>
<ul>
<li><p>String(数据)</p>
</li>
<li><p>隐式转换(字符串拼接)：</p>
<ul>
<li>字符串和任意类型进行+操作，最终结果都是字符串<ul>
<li>通常类型转换时使用’’进行操作</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>注意：任何数据类型与字符串相加 都会变成字符串拼接</p>
<p>包括复杂数据类型 array、 object</p>
</blockquote>
<h3 id="布尔类型"><a href="#布尔类型" class="headerlink" title="布尔类型"></a>布尔类型</h3><ul>
<li>转换方式： Boolean(数据)</li>
</ul>
<blockquote>
<p>只需掌握转换结果为 false 的 6 个值即可：</p>
<p>0</p>
<p>NaN</p>
<p>‘’ <code>//空字符串</code></p>
<p>null</p>
<p>undefined</p>
<p>false</p>
</blockquote>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>javaScript-操作符-分支结构-循环结构</title>
    <url>/2016/07/05/js/javaScript-%E6%93%8D%E4%BD%9C%E7%AC%A6-%E5%88%86%E6%94%AF%E7%BB%93%E6%9E%84-%E5%BE%AA%E7%8E%AF%E7%BB%93%E6%9E%84/</url>
    <content><![CDATA[<h2 id="1-操作符"><a href="#1-操作符" class="headerlink" title="1 操作符"></a>1 操作符</h2><h3 id="算术操作符"><a href="#算术操作符" class="headerlink" title="算术操作符"></a>算术操作符</h3><h4 id="自增操作符、自减操作符"><a href="#自增操作符、自减操作符" class="headerlink" title="自增操作符、自减操作符"></a>自增操作符、自减操作符</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ++ --</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>需要注意的是后++和后–，在和其他算术运算符一起操作时 是先原值操作在下次操作在再自身加减</p>
<p>口诀：</p>
<ul>
<li>++放在变量<strong>前面</strong>，什么时候计算++？先算++，在算整个运算；</li>
<li>++放在变量后面，什么时候计算++？先算整个运算，再算++；</li>
</ul>
</blockquote>
<span id="more"></span>

<h4 id="x2F"><a href="#x2F" class="headerlink" title="+ - * &#x2F; %"></a>+ - * &#x2F; %</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1.常规操作：Number类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// var a = 10;</span></span><br><span class="line"><span class="comment">// var b = 3;</span></span><br><span class="line"><span class="comment">// + - / * %</span></span><br><span class="line"><span class="comment">// var c = a + b;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 10对3取余数；</span></span><br><span class="line"><span class="comment">// var c = 10 % 3;</span></span><br><span class="line"><span class="comment">// console.log(c);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.非常规：字符串、Boolean、null、undefined；</span></span><br><span class="line"><span class="comment">// 字符串 遇见 +，把左右的数据类型 转化为字符串</span></span><br><span class="line"><span class="comment">// 字符串 + 字符串 ：字符串拼接；</span></span><br><span class="line"><span class="comment">// var a = 10 + &quot;10&quot;;</span></span><br><span class="line"><span class="comment">// var a = true + &quot;10&quot;;</span></span><br><span class="line"><span class="comment">// console.log(a, typeof a);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 运算：从左到右运算；</span></span><br><span class="line"><span class="comment">// var a = 10 + 10 + &quot;10&quot;;</span></span><br><span class="line"><span class="comment">// console.log(a);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 只要字符串不是遇见+，遇见-*/% ，字符串会 隐式 转化 Number类型；</span></span><br><span class="line"><span class="comment">// var a = 10 - &quot;10&quot;;</span></span><br><span class="line"><span class="comment">// console.log(a, typeof a);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// var a = 10 - &quot;我&quot;;</span></span><br><span class="line"><span class="comment">// console.log(a, typeof a);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.其他(排出string类型外)：true null undefined</span></span><br><span class="line"><span class="comment">// 隐式转化：转为数字类型；</span></span><br><span class="line"><span class="comment">// 输出 10</span></span><br><span class="line"><span class="comment">// var a = false + 10;</span></span><br><span class="line"><span class="comment">// console.log(a);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出 10</span></span><br><span class="line"><span class="comment">// var a = null + 10;</span></span><br><span class="line"><span class="comment">// console.log(a);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出 NaN</span></span><br><span class="line"><span class="comment">// var a = undefined + 10;</span></span><br><span class="line"><span class="comment">// console.log(a);</span></span><br></pre></td></tr></table></figure>

<h3 id="比较操作符"><a href="#比较操作符" class="headerlink" title="比较操作符"></a>比较操作符</h3><p>比较操作符的就是比较两个数据，操作符号有:</p>
<p><code>&gt; &lt; &gt;= &lt;=</code> 运算结果是 布尔 类型</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">!= 和!== 是比较两个数据是否不相等的    !== 同时比较值和类型</span><br><span class="line">== 和 === 是用来比较两个数据是否相等的   === 不仅比较两个数据的值，还比较数据的类型</span><br></pre></td></tr></table></figure>

<h3 id="逻辑操作符"><a href="#逻辑操作符" class="headerlink" title="逻辑操作符"></a>逻辑操作符</h3><h4 id="逻辑与-amp-amp"><a href="#逻辑与-amp-amp" class="headerlink" title="逻辑与&amp;&amp;"></a>逻辑与&amp;&amp;</h4><ul>
<li>两个条件都为 true 结果为 true 否者为 false</li>
<li>逻辑短路：当第一个值为 false 将不再判断第二个值 直接返回第一个值</li>
</ul>
<h4 id="逻辑或"><a href="#逻辑或" class="headerlink" title="逻辑或 ||"></a>逻辑或 ||</h4><ul>
<li>只要有一个条件为 true 结果为 true，两个都是 false 才是 false</li>
<li>逻辑短路：当第一个值为 true 将不再判断第二个值 直接返回第一个值</li>
</ul>
<h4 id="逻辑非"><a href="#逻辑非" class="headerlink" title="逻辑非"></a>逻辑非</h4><ul>
<li>把 true 变 false 把 false 变 true</li>
</ul>
<blockquote>
<p>注意：逻辑非的优先级 仅次于（） 和 [ ] 与 前两个逻辑操作符一起用的时候需要注意</p>
</blockquote>
<h3 id="赋值操作符"><a href="#赋值操作符" class="headerlink" title="赋值操作符"></a>赋值操作符</h3><h4 id="x3D-x3D-x3D-x3D-x2F-x3D-x3D"><a href="#x3D-x3D-x3D-x3D-x2F-x3D-x3D" class="headerlink" title="&#x3D; +&#x3D; -&#x3D; *&#x3D; &#x2F;&#x3D; %&#x3D;"></a>&#x3D; +&#x3D; -&#x3D; *&#x3D; &#x2F;&#x3D; %&#x3D;</h4><ul>
<li>+&#x3D; 的作用是简写加法 a +&#x3D; 2; &#x2F;&#x2F; 相当于是 a &#x3D; a + 2; 就是一个简写的语法</li>
<li>-&#x3D; *&#x3D; &#x2F;&#x3D; %&#x3D; 除了运算规则不同，作用是一样的，都是简写</li>
</ul>
<h3 id="操作的优先级"><a href="#操作的优先级" class="headerlink" title="操作的优先级"></a>操作的优先级</h3><ol>
<li>第一优先级： [] . ()</li>
<li>第二优先级： ++ – !</li>
<li>第三优先级： * &#x2F; %</li>
<li>第四优先级： + -</li>
<li>第五优先级： &gt; &gt;&#x3D; &lt; &lt;&#x3D;</li>
<li>第六优先级： &#x3D;&#x3D; !&#x3D; &#x3D;&#x3D;&#x3D; !&#x3D;&#x3D;</li>
<li>第七优先级： &amp;&amp;</li>
<li>第八优先级： ||</li>
<li>第九优先级： &#x3D; +&#x3D; -&#x3D; *&#x3D; &#x2F;&#x3D; %&#x3D;</li>
</ol>
<p>上面是具体的优先级，但是平时我们不会把很多的操作符放在一起运算，所以我们大致记住</p>
<ol>
<li>括号先算</li>
<li>其次算算术</li>
<li>再次算比较</li>
<li>然后算逻辑</li>
<li>最后算赋值</li>
</ol>
<h2 id="2-流程控制-三个名词"><a href="#2-流程控制-三个名词" class="headerlink" title="2 流程控制-三个名词"></a>2 流程控制-三个名词</h2><ul>
<li>表达式：有返回结果；<strong>在浏览器后台可以直接敲表达式，回车返回的就是该表达式的结果；</strong></li>
<li>语句：有思考在里面的表达式；思考主要是告诉浏览器要做什么事情；</li>
</ul>
<ul>
<li><p>结构：</p>
<ul>
<li>顺序结构：从上到下执行的代码就是顺序结构 程序默认就是由上到下顺序执行的</li>
</ul>
<ul>
<li>分支：<strong>不同的情况，走不同的分支 ；</strong></li>
<li>循环结构：要求一个流程要有<strong>重复的思想</strong>在里面；</li>
</ul>
</li>
</ul>
<h2 id="3-分支结构（重要）"><a href="#3-分支结构（重要）" class="headerlink" title="3 分支结构（重要）"></a>3 分支结构（重要）</h2><p>这就使用到了分支结构，分支结构分为三个大类</p>
<ul>
<li>if 结构</li>
<li>switch-case 结构</li>
<li>三元表达式</li>
</ul>
<h3 id="if-结构-（常用）"><a href="#if-结构-（常用）" class="headerlink" title="if 结构 （常用）"></a>if 结构 （常用）</h3><p>单个 if 结构：解决的一个分支的判断问题</p>
<p>if-else： if-else 结构，解决两个分支的判断问题</p>
<p>if-else-if：if-else-if 结构，解决多分支的判断问题</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(条件表达式<span class="number">1</span>)&#123;</span><br><span class="line">   当条件表达式<span class="number">1</span>的结果是 <span class="literal">true</span> 时执行的代码</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(条件表达式<span class="number">2</span>)&#123;</span><br><span class="line">  当条件表达式<span class="number">2</span>的结果是 <span class="literal">true</span> 时执行的代码</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(条件表达式<span class="number">3</span>)&#123;</span><br><span class="line">  当条件表达式<span class="number">3</span>的结果是 <span class="literal">true</span> 时执行的代码</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 中间可以继续写多个判断</span></span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">  多个条件表达式的结果都是 <span class="literal">false</span> 的时候执行的代码</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//例如: 判断一下一个人的性别是不是男的,如果是男的，让他去男厕所，如果是女的，让他去女厕所 ， 否则不让他上厕所</span></span><br><span class="line"><span class="keyword">var</span> gender = <span class="title function_">prompt</span>(<span class="string">&#x27;请输入性别&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(gender === <span class="string">&#x27;男&#x27;</span>)&#123;</span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;请去男厕所&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(gender === <span class="string">&#x27;女&#x27;</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;请去女厕所&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;你个不男不女的家伙，我们这里没有你能上的厕所，去别处吧&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：在 if-else-if 连着多个判断时 最终只会进到一个分支中</p>
</blockquote>
<h3 id="switch-case-结构"><a href="#switch-case-结构" class="headerlink" title="switch-case 结构"></a>switch-case 结构</h3><p>switch-case 结构主要用于多个固定值之间的判断</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//例如： 判断一下一个人的性别是不是男的,如果是男的，让他去男厕所，如果是女的，让他去女厕所 ，如果是人妖，去人妖专用厕所，如果都不是，打晕送走</span></span><br><span class="line"><span class="keyword">var</span> gender = <span class="title function_">prompt</span>(<span class="string">&quot;请输入性别&quot;</span>);</span><br><span class="line"><span class="keyword">switch</span> (gender) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&quot;男&quot;</span>:</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;请去男厕所&quot;</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&quot;女&quot;</span>:</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;请去女厕所&quot;</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&quot;人妖&quot;</span>:</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;请去人妖专用厕所&quot;</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="attr">default</span>:</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;净给我添乱，打晕送走&quot;</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>值得注意的是：这个结构里面的 break 并不是必须的，如果两个 case 之间没有 break ，执行完了一个 break 之后，会继续执行下面的 case 的代码</p>
</blockquote>
<h3 id="三元表达式"><a href="#三元表达式" class="headerlink" title="三元表达式"></a>三元表达式</h3><p>三元表达式的使用是简写 if-else 结构 属于表达式</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">表达式<span class="number">1</span> ? 表达式<span class="number">2</span> : 表达式<span class="number">3</span>;</span><br><span class="line"><span class="comment">// 这个表达式会先执行表达式1，判断其结果是true还是false，如果是true，则执行表达式2，</span></span><br><span class="line"><span class="comment">//然后将表达式2的执行结果作为整个三元表达式的结果，如果表达式1的结果是false，则执行表达式3，</span></span><br><span class="line"><span class="comment">//并表达式3的结果作为整个三元表达式的结果</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//例如： 求二个数字中谁更大</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">var</span> max = a &gt; b ? a : b;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(max);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>总结</p>
<p>1.在我们需要判断的时候，就可以使用分支结构</p>
<p>2.if 判断用法很多，switch-case 却只能判断固定值</p>
<p>3.三元表达式就是 if-else 的简写，将来可以把代码写得更简洁</p>
</blockquote>
<h2 id="4-循环结构（重要）"><a href="#4-循环结构（重要）" class="headerlink" title="4 循环结构（重要）"></a>4 循环结构（重要）</h2><h3 id="for-循环-常用"><a href="#for-循环-常用" class="headerlink" title="for 循环(常用)"></a>for 循环(常用)</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (初始化表达式; 条件表达式; 自增表达式) &#123;</span><br><span class="line">  循环体;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//初始化表达式只是开始用到 后期反复执行。。。条件--&gt;循环体--&gt;自增--&gt;条件。。。。。</span></span><br></pre></td></tr></table></figure>

<p>执行过程：</p>
<ol>
<li>执行初始化表达式</li>
<li>执行条件表达式</li>
<li>如果条件表达式的结果为 false,结束循环，继续执行循环后面的代码</li>
<li>如果条件表达式的结果为 true，执行循环体</li>
<li>执行自增表达式</li>
<li>重复 2~5 的步骤，直到条件表达式的结果为 false，结束循环</li>
</ol>
<h3 id="while-循环"><a href="#while-循环" class="headerlink" title="while 循环"></a>while 循环</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> (条件表达式) &#123;</span><br><span class="line">  循环体;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 循环体就是重复执行的代码</span></span><br><span class="line"><span class="comment">//可以做无限循环（true）就可以实现</span></span><br><span class="line"><span class="comment">//需要结束时加break</span></span><br></pre></td></tr></table></figure>

<p>执行过程：</p>
<ol>
<li>先执行条件表达式，得到一个布尔类型的结果</li>
<li>如果表达式的结果为 false,循环结束，执行循环后面的代码</li>
<li>如果表达式的结果为 true，执行循环体</li>
<li>执行条件表达式，得到一个布尔类型的结果</li>
<li>重复 2~4 的过程，直到表达式结果为 false，结束循环</li>
</ol>
<h3 id="do-while-循环-补充"><a href="#do-while-循环-补充" class="headerlink" title="do-while 循环(补充)"></a>do-while 循环(补充)</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">  循环体;</span><br><span class="line">&#125; <span class="keyword">while</span> (条件表达式);</span><br></pre></td></tr></table></figure>

<p>执行过程</p>
<ol>
<li>先执行循环体</li>
<li>执行条件表达式</li>
<li>如果条件表达式结果为 false，结束循环</li>
<li>如果条件表达式结果为 true，执行循环体</li>
<li>重复 2~4 的步骤，直到条件表达式结果为 false，结束循环</li>
</ol>
<h3 id="break-和-continue"><a href="#break-和-continue" class="headerlink" title="break 和 continue"></a>break 和 continue</h3><ol>
<li>break 用于结束整个循环</li>
<li>continue 用于结束整个循环中的一次</li>
<li>break 和 continue 后面的代码都不会执行</li>
</ol>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>javaScript-数组</title>
    <url>/2016/06/25/js/javaScript-%E6%95%B0%E7%BB%84/</url>
    <content><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><ul>
<li>数组是一个有<strong>顺序</strong>、<strong>有长度</strong>的数据集合；</li>
<li>数组：类型 Object；</li>
<li>特点：<ul>
<li>把数据放在一起；</li>
<li>有先后位置上的顺序；</li>
<li>有数据的长度；</li>
</ul>
</li>
</ul>
<blockquote>
<p>注意：数组的 typeof 结果是 object</p>
</blockquote>
<h2 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 5个人的成绩为： 91，88，72，45，63</span></span><br><span class="line"><span class="comment">// 先声明一个数组，字面量的形式</span></span><br><span class="line"><span class="keyword">var</span> arr = [];</span><br><span class="line"><span class="keyword">var</span> a = <span class="string">&quot;null&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出 []  这是一个没有数据在里面的数组，称为空数组</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr, <span class="keyword">typeof</span> arr);</span><br></pre></td></tr></table></figure>

<h2 id="存值"><a href="#存值" class="headerlink" title="存值"></a>存值</h2><ul>
<li>数组中的数据使用<strong>索引</strong>管理。</li>
<li>索引：<strong>序号、顺序、排位、位置、下标</strong></li>
<li><strong>索引从 0 开始</strong></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//把成绩存储到数组中</span></span><br><span class="line">arr[<span class="number">0</span>] = <span class="number">91</span>;</span><br><span class="line">arr[<span class="number">1</span>] = <span class="number">88</span>;</span><br><span class="line">arr[<span class="number">2</span>] = <span class="number">72</span>;</span><br><span class="line">arr[<span class="number">3</span>] = <span class="number">45</span>;</span><br><span class="line">arr[<span class="number">4</span>] = <span class="number">63</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr); <span class="comment">// 输出 [91,88,72,45,63] 就是一个数据集合</span></span><br></pre></td></tr></table></figure>

<ul>
<li>把 <code>数组[索引]</code>格式当成一个变量使用就行，</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 初始化赋值完成后，也可以再次改变值，把前面的值覆盖掉；</span></span><br><span class="line">arr[<span class="number">0</span>] = <span class="number">100</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>如果一开始就知道数组了，可以直接使用一个简单的语法存储数据</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">91</span>, <span class="number">88</span>, <span class="number">72</span>, <span class="number">45</span>, <span class="number">63</span>];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr); <span class="comment">// 输出的结果是一样的</span></span><br></pre></td></tr></table></figure>

<ul>
<li>上面每个位置上存的都是数字类型，可以为其他类型；</li>
</ul>
<h2 id="取值"><a href="#取值" class="headerlink" title="取值"></a>取值</h2><ul>
<li>把数据取出来，得知道你要取哪个位置上的数据把。</li>
<li>数据取值同样使用<strong>索引</strong>取。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 拿到索引为0，顺序上第一个位置上的数据；</span></span><br><span class="line"><span class="comment">// 把 数组[索引] 格式当成一个变量使用就行；</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组求和：班里的成绩总和</span></span><br><span class="line"><span class="keyword">var</span> sum = arr[<span class="number">0</span>] + arr[<span class="number">1</span>] + arr[<span class="number">2</span>] + arr[<span class="number">3</span>] + arr[<span class="number">4</span>];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sum); <span class="comment">// 输出370</span></span><br></pre></td></tr></table></figure>

<h2 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h2><ul>
<li>求成绩总和：一个一个地把数组里面的数组取出来了，从索引 0 到最后一个索引，</li>
<li>索引从 0 开始到结束的过程，<strong>有重复的思想，需要用到循环；</strong></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 最初的写法</span></span><br><span class="line"><span class="keyword">var</span> sum = arr[<span class="number">0</span>] + arr[<span class="number">1</span>] + arr[<span class="number">2</span>] + arr[<span class="number">3</span>] + arr[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 循环 这个从0~最后一个索引，有重复的思想在里面，使用循环。</span></span><br><span class="line"><span class="keyword">var</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; i++) &#123;</span><br><span class="line">  sum += arr[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sum); <span class="comment">// 输出 370，和我们一个一个相加是一样的</span></span><br></pre></td></tr></table></figure>

<ul>
<li>使用<strong>循环来遍历</strong>数组，当数组中的数据比较多的时候，会比较方便。<strong>一般是使用 for 循环；</strong></li>
</ul>
<h2 id="数组长度"><a href="#数组长度" class="headerlink" title="数组长度"></a>数组长度</h2><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><ul>
<li>存取数据：涉及到就是数组的<strong>顺序</strong>问题，通过索引去存取；</li>
<li>数组长度：数组中一共存放了多少个数据；</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr.<span class="property">length</span>); <span class="comment">// 数组.length 就是数组的长度</span></span><br></pre></td></tr></table></figure>

<ul>
<li>如果数组的长度是 5，最后一个元素的<strong>索引</strong>就是 4；</li>
<li><strong>我们发现最大索引总是比长度少 1 ，所以遍历还可以这么写</strong></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt;= arr.<span class="property">length</span> - <span class="number">1</span>; i++) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(arr[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简化一下</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(arr[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="案例：求数组中所有数字的总和的平均值"><a href="#案例：求数组中所有数字的总和的平均值" class="headerlink" title="案例：求数组中所有数字的总和的平均值"></a>案例：求数组中所有数字的总和的平均值</h3><ul>
<li>分析：<ul>
<li>总和：循环遍历，加在一个变量上得到；</li>
<li>均值：总和 &#x2F; 个数；（arr.length）</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 还可以更简单</span></span><br><span class="line"><span class="keyword">var</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">  sum += arr[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sum);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 求平均分</span></span><br><span class="line"><span class="comment">// 平均分= 总分 / 数组的长度</span></span><br><span class="line"><span class="keyword">var</span> avg = sum / arr.<span class="property">length</span>;</span><br></pre></td></tr></table></figure>

<h3 id="案例：求数组中的最大值"><a href="#案例：求数组中的最大值" class="headerlink" title="案例：求数组中的最大值"></a>案例：求数组中的最大值</h3><ul>
<li>分析：生活中，一堆人最高的（人很多，多到你一下看不出来）；<ul>
<li>最大值：最起码得两个数比较下，得到最大值；</li>
<li>假设：其中随便一个是最大值 MAX，每个元素和 max 比较，<ul>
<li>若有比 MAX 大的，那该元素代替 MAX；</li>
<li>若都没有 MAX 大，恭喜，你一开始就猜对了；</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> max = arr[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">if</span> (max &lt; arr[i]) &#123;</span><br><span class="line">    max = arr[i];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>需求：求数组中的最大值的索引</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 分析：找打最大值的时候，记录下最大值的下标就行了。</span></span><br><span class="line"><span class="keyword">var</span> max_index = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> max = arr[max_index];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">if</span> (max &lt; arr[i]) &#123;</span><br><span class="line">    max = arr[i];</span><br><span class="line">    max_index = i;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="清空数组"><a href="#清空数组" class="headerlink" title="清空数组"></a>清空数组</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">arr.<span class="property">length</span> = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<h2 id="数组的构造函数"><a href="#数组的构造函数" class="headerlink" title="数组的构造函数"></a>数组的构造函数</h2><ul>
<li>数组在 JS 中还可以使用另一种方式创建，这个方式我们称为 ： 构造函数</li>
<li>构造函数：能构造一个你需要的东西（对象）；</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用 构造函数 创建数组</span></span><br><span class="line"><span class="keyword">var</span> arr = <span class="keyword">new</span> <span class="title class_">Array</span>();</span><br><span class="line"><span class="comment">// 存储数据</span></span><br><span class="line">arr[<span class="number">0</span>] = <span class="number">10</span>;</span><br><span class="line">arr[<span class="number">1</span>] = <span class="number">20</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">10</span>, <span class="number">20</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr);</span><br></pre></td></tr></table></figure>

<ul>
<li>注意：一个数据，不要使用这个方式存储数据；它会认为你想要设置数组的长度，而不是要把数据存储在数组中。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">10</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr); <span class="comment">// 输出 [empty × 10]</span></span><br></pre></td></tr></table></figure>

<h2 id="JS-实现数组去重（重复的元素只保留一个）"><a href="#JS-实现数组去重（重复的元素只保留一个）" class="headerlink" title="JS 实现数组去重（重复的元素只保留一个）"></a>JS 实现数组去重（重复的元素只保留一个）</h2><p><strong>优化遍历数组法（推荐）</strong></p>
<p>实现思路：双层循环，外循环表示从 0 到 arr.length，内循环表示从 i+1 到 arr.length</p>
<p>将没重复的右边值放入新数组。（检测到有重复值时终止当前循环同时进入外层循环的下一轮判断）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">unique4</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> hash = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j = i + <span class="number">1</span>; j &lt; arr.<span class="property">length</span>; j++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (arr[i] === arr[j]) &#123;</span><br><span class="line">        ++i;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    hash.<span class="title function_">push</span>(arr[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> hash;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>javaScript Object.is和==和===</title>
    <url>/2016/08/31/js/javaScript==%E5%92%8CObject.is%E5%92%8C===/</url>
    <content><![CDATA[<h2 id="相等运算符-x3D-x3D"><a href="#相等运算符-x3D-x3D" class="headerlink" title="相等运算符 ( &#x3D;&#x3D;)"></a>相等运算符 ( &#x3D;&#x3D;)</h2><p> &#x3D;&#x3D; 相等运算符在判断相等前对两边的变量（如果它们不是同一类型）进行强制转换</p>
<ol>
<li>如果操作数具有相同的类型，则按如下方式进行比较：<ul>
<li>对象：<code>true</code>仅当两个操作数都引用同一个对象时才返回。</li>
<li>字符串：<code>true</code>仅当两个操作数具有相同顺序的相同字符时才返回。</li>
<li>数字：<code>true</code>仅当两个操作数具有相同值时才返回。<code>+0</code>并被<code>-0</code>视为相同的值。如果任一操作数是<code>NaN</code>，则返回<code>false</code>；所以，<code>NaN</code>永远不等于<code>NaN</code>。</li>
<li>布尔值：<code>true</code>仅当操作数为 both<code>true</code>或 both时才返回<code>false</code>。</li>
<li>BigInt：<code>true</code>仅当两个操作数具有相同值时才返回。</li>
<li>符号：<code>true</code>仅当两个操作数引用相同的符号时才返回。</li>
</ul>
</li>
<li>如果其中一个操作数是<code>null</code>or <code>undefined</code>，则另一个也必须是<code>null</code>or<code>undefined</code>才能返回<code>true</code>。否则返回<code>false</code>。</li>
<li>如果其中一个操作数是对象而另一个是基元，则按该顺序使用对象的<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/toPrimitive"><code>@@toPrimitive()</code></a>（带有<code>&quot;default&quot;</code>提示）<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/valueOf"><code>valueOf()</code></a>、、和<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/toString"><code>toString()</code></a>方法将对象转换为基元。（这个原语转换和<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Addition">另外</a>使用的一样。）</li>
<li>在这一步，两个操作数都被转换为原语（String、Number、Boolean、Symbol 和 BigInt 之一）。其余的转换是逐案完成的。<ul>
<li>如果它们属于同一类型，请使用步骤 1 进行比较。</li>
<li>如果其中一个操作数是 Symbol 而另一个不是，则返回<code>false</code>。</li>
<li>如果其中一个操作数是布尔值，而另一个不是，则将布尔值转换为数字：<code>true</code>转换为 1，然后<code>false</code>转换为 0。然后再次松散地比较两个操作数。</li>
<li>数字转字符串：使用与构造函数相同的算法将字符串转换为数字<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/Number"><code>Number()</code></a>。将导致转换失败<code>NaN</code>，这将保证相等<code>false</code>。</li>
<li>Number to BigInt：比较它们的数值。如果数字是 ±Infinity 或<code>NaN</code>，则返回<code>false</code>。</li>
<li>String to BigInt：使用与构造函数相同的算法将字符串转换为 BigInt <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt/BigInt"><code>BigInt()</code></a>。如果转换失败，则返回<code>false</code>。</li>
</ul>
</li>
</ol>
<p>松散相等是<em>对称</em>的：对于and的任何值<code>A == B</code>总是具有相同的语义（应用转换的顺序除外）。<code>B == A``A``B</code></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>类型相同 对象和符号比地址 其他都比值 ,数字比较特殊 +0 和 -0 相等 ，NaN 和 NaN 永远不相等</li>
<li>类型不同 都尝试转化为数字类型在比较(如果一次无法转化到位就两次)，object 会依次调用 valueOf()  toString() 获取值， 但是有两种特殊情况<ul>
<li>String to BigInt 字符串转换为 BigInt , Number to BigInt 直接比较 ,数字是 ±Infinity 或<code>NaN</code>，则返回<code>false</code></li>
<li>其中一个操作数是 Symbol 而另一个不是，则返回<code>false</code></li>
</ul>
</li>
</ul>
<h2 id="严格相等运算符-x3D-x3D-x3D"><a href="#严格相等运算符-x3D-x3D-x3D" class="headerlink" title="严格相等运算符 (&#x3D;&#x3D;&#x3D;)"></a>严格相等运算符 (&#x3D;&#x3D;&#x3D;)</h2><p>严格相等运算符 ( <code>===</code>) 检查它的两个操作数是否相等，返回一个布尔结果。与<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Equality">相等</a>运算符不同，严格相等运算符始终认为不同类型的操作数是不同的。</p>
<ul>
<li>如果操作数的类型不同，则返回<code>false</code>。</li>
<li>如果两个操作数都是对象，<code>true</code>则仅当它们引用同一个对象时才返回。</li>
<li>如果两个操作数都是<code>null</code>或两个操作数都是<code>undefined</code>，则返回<code>true</code>。</li>
<li>如果任一操作数是<code>NaN</code>，则返回<code>false</code>。</li>
<li>否则，比较两个操作数的值：<ul>
<li>数字必须具有相同的数值。<code>+0</code>并且<code>-0</code> 被认为是相同的值。</li>
<li>字符串必须以相同的顺序具有相同的字符。</li>
<li>布尔值必须是两者<code>true</code>或两者<code>false</code>。</li>
</ul>
</li>
</ul>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Equality">此运算符与等式</a> ( ) 运算符 之间最显着的区别在于<code>==</code>，如果操作数属于不同类型，则 <code>==</code>运算符会在比较之前尝试将它们转换为相同类型。</p>
<h2 id="Object-is"><a href="#Object-is" class="headerlink" title="Object.is()"></a>Object.is()</h2><p><code>Object.is()</code> 方法判断两个值是否为<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Equality_comparisons_and_sameness">同一个值</a>，如果满足以下任意条件则两个值相等：</p>
<ul>
<li>都是 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/undefined"><code>undefined</code></a></li>
<li>都是 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/null"><code>null</code></a></li>
<li>都是 <code>true</code> 或都是 <code>false</code></li>
<li>都是相同长度、相同字符、按相同顺序排列的字符串</li>
<li>都是相同对象（意味着都是同一个对象的值引用）</li>
<li>都是数字且<ul>
<li>都是 <code>+0</code></li>
<li>都是 <code>-0</code></li>
<li>都是 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/NaN"><code>NaN</code></a></li>
<li>都是同一个值，非零且都不是 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/NaN"><code>NaN</code></a></li>
</ul>
</li>
</ul>
<p><code>Object.is()</code> 与 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators#%E7%9B%B8%E7%AD%89%E8%BF%90%E7%AE%97%E7%AC%A6"><code>==</code></a> 不同。<code>==</code> 运算符在判断相等前对两边的变量（如果它们不是同一类型）进行强制转换（这种行为将 <code>&quot;&quot; == false</code> 判断为 <code>true</code>），而 <code>Object.is</code> 不会强制转换两边的值。</p>
<p><code>Object.is()</code> 与 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators#%E5%85%A8%E7%AD%89%E8%BF%90%E7%AE%97%E7%AC%A6"><code>===</code></a> 也不相同。差别是它们对待有符号的零和 NaN 不同，例如，<code>===</code> 运算符（也包括 <code>==</code> 运算符）将数字 <code>-0</code> 和 <code>+0</code> 视为相等，而将 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Number/NaN"><code>Number.NaN</code></a> 与 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/NaN"><code>NaN</code></a> 视为不相等。</p>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p><code>Object.is()</code> 在 undefined 与 null 与 Object 和 基本数据类型的处理上与 <code>===</code> 操作符一致，不会强制类型转化</p>
<p>特殊点</p>
<ul>
<li>+0 和 -0 不等</li>
<li>NaN 和 NaN 相等</li>
</ul>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>jest单元测试入门</title>
    <url>/2022/03/11/%E5%89%8D%E7%AB%AF%E6%B5%8B%E8%AF%95/jest%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<p><a href="https://www.jestjs.cn/docs/getting-started">官方文档</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn add --dev jest</span><br></pre></td></tr></table></figure>

<h2 id="DEMO"><a href="#DEMO" class="headerlink" title="DEMO"></a>DEMO</h2><p>下面我们开始给一个假定的函数写测试，这个函数的功能是两数相加。首先创建 <code>sum.js</code> 文件：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = sum;</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>接下来，创建名为 <code>sum.test.js</code> 的文件。这个文件包含了实际测试内容：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> sum = <span class="built_in">require</span>(<span class="string">&#x27;./sum&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">test</span>(<span class="string">&#x27;adds 1 + 2 to equal 3&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">expect</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>)).<span class="title function_">toBe</span>(<span class="number">3</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>将如下代码添加到 <code>package.json</code> 中：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jest&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>最后，运行 <code>yarn test</code> 或者 <code>npm run test</code> ，Jest 将输出如下信息：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">PASS  ./sum.test.js</span><br><span class="line">✓ adds 1 + 2 to equal 3 (5ms)</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p><strong>你刚才使用 Jest 成功地写出了第一个测试！</strong></p>
<p>在此测试中，使用了 <code>expect</code> 和 <code>toBe</code> 来检测两个值是否完全相同。若要了解其它使用 Jest 可以测试的内容，请参阅<a href="https://www.jestjs.cn/docs/using-matchers">使用匹配器(Matcher)</a>。</p>
<h2 id="使用命令行"><a href="#使用命令行" class="headerlink" title="使用命令行"></a><a href="https://www.jestjs.cn/docs/getting-started#%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E8%A1%8C">使用命令行</a></h2><p>你可以直接从 CLI 运行 Jest 并使用一系列有用的配置参数（前提是已经配置了环境变量 <code>PATH</code> 使其全局可用，例如通过 <code>yarn global add jest</code> 或者 <code>npm install jest --global</code> 来安装 Jest）。</p>
<p>这里演示了如何对于能够匹配到 <code>my-test</code> 的文件运行 Jest，以 <code>config.json</code> 作为配置文件，并在运行后显示一个基于原生操作系统的通知：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">jest my-test --notify --config=config.json</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>如果想要了解更多在命令行中运行 <code>jest</code> 的内容，请参阅 <a href="https://www.jestjs.cn/docs/cli">Jest CLI 配置项</a>页面.</p>
<h2 id="更多配置项"><a href="#更多配置项" class="headerlink" title="更多配置项"></a><a href="https://www.jestjs.cn/docs/getting-started#%E6%9B%B4%E5%A4%9A%E9%85%8D%E7%BD%AE%E9%A1%B9">更多配置项</a></h2><h3 id="生成基础配置文件"><a href="#生成基础配置文件" class="headerlink" title="生成基础配置文件"></a><a href="https://www.jestjs.cn/docs/getting-started#%E7%94%9F%E6%88%90%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">生成基础配置文件</a></h3><p>Jest 将根据你的项目提出一系列问题，并且将创建一个基础配置文件。文件中的每一项都配有简短的说明：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">jest --init</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<h3 id="使用-Babel"><a href="#使用-Babel" class="headerlink" title="使用 Babel"></a>使用 <a href="https://www.jestjs.cn/docs/getting-started#%E4%BD%BF%E7%94%A8-babel">Babel</a></h3><p>要使用 <a href="https://babeljs.io/">Babel</a>，请通过 <code>yarn</code> 来安装所需的依赖项：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn add --dev babel-jest @babel/core @babel/preset-env</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p>在项目的根目录下创建 <code>babel.config.js</code> ，通过配置 Babel 使其能够兼容当前的 Node 版本。</p>
<p>babel.config.js</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [[<span class="string">&#x27;@babel/preset-env&#x27;</span>, &#123;<span class="attr">targets</span>: &#123;<span class="attr">node</span>: <span class="string">&#x27;current&#x27;</span>&#125;&#125;]],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Copy</p>
<p><em>Babel 理想的配置取决于项目本身。</em> 请查阅 <a href="https://babeljs.io/docs/en/">Babel 官方文档</a> 来获得更多详细信息。</p>
<details class="details_2tSt isBrowser_mvLw alert alert--info details_4nRH" data-collapsed="true" style="box-sizing: border-box; color: var(--ifm-alert-foreground-color); --ifm-alert-background-color:var(--ifm-color-info-contrast-background); --ifm-alert-background-color-highlight:rgba(84,199,236,0.15); --ifm-alert-foreground-color:var(--ifm-color-info-contrast-foreground); --ifm-alert-border-color:var(--ifm-color-info-dark); --ifm-code-background:var(--ifm-alert-background-color-highlight); --ifm-link-color:var(--ifm-alert-foreground-color); --ifm-link-hover-color:var(--ifm-alert-foreground-color); --ifm-link-decoration:underline; --ifm-tabs-color:var(--ifm-alert-foreground-color); --ifm-tabs-color-active:var(--ifm-alert-foreground-color); --ifm-tabs-color-active-border:var(--ifm-alert-border-color); background-color: var(--ifm-alert-background-color); border: 1px solid var(--ifm-alert-border-color); border-radius: var(--ifm-alert-border-radius); box-shadow: var(--ifm-alert-shadow); padding: var(--ifm-alert-padding-vertical) var(--ifm-alert-padding-horizontal); --docusaurus-details-summary-arrow-size:0.38rem; --docusaurus-details-transition:transform var(--ifm-transition-fast) ease; --docusaurus-details-decoration-color:var(--ifm-alert-border-color); margin: 0 0 var(--ifm-spacing-vertical); font-family: system-ui, -apple-system, &quot;Segoe UI&quot;, Roboto, Ubuntu, Cantarell, &quot;Noto Sans&quot;, sans-serif, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><summary markdown="span" style="box-sizing: border-box; cursor: pointer; list-style: none; padding-left: 1rem; position: relative;"><strong style="box-sizing: border-box; font-weight: var(--ifm-font-weight-bold);">将 Babel 配置为 Jest 可感知的</strong></summary></details>

<details class="details_2tSt isBrowser_mvLw alert alert--info details_4nRH" data-collapsed="true" style="box-sizing: border-box; color: var(--ifm-alert-foreground-color); --ifm-alert-background-color:var(--ifm-color-info-contrast-background); --ifm-alert-background-color-highlight:rgba(84,199,236,0.15); --ifm-alert-foreground-color:var(--ifm-color-info-contrast-foreground); --ifm-alert-border-color:var(--ifm-color-info-dark); --ifm-code-background:var(--ifm-alert-background-color-highlight); --ifm-link-color:var(--ifm-alert-foreground-color); --ifm-link-hover-color:var(--ifm-alert-foreground-color); --ifm-link-decoration:underline; --ifm-tabs-color:var(--ifm-alert-foreground-color); --ifm-tabs-color-active:var(--ifm-alert-foreground-color); --ifm-tabs-color-active-border:var(--ifm-alert-border-color); background-color: var(--ifm-alert-background-color); border: 1px solid var(--ifm-alert-border-color); border-radius: var(--ifm-alert-border-radius); box-shadow: var(--ifm-alert-shadow); padding: var(--ifm-alert-padding-vertical) var(--ifm-alert-padding-horizontal); --docusaurus-details-summary-arrow-size:0.38rem; --docusaurus-details-transition:transform var(--ifm-transition-fast) ease; --docusaurus-details-decoration-color:var(--ifm-alert-border-color); margin: 0 0 var(--ifm-spacing-vertical); font-family: system-ui, -apple-system, &quot;Segoe UI&quot;, Roboto, Ubuntu, Cantarell, &quot;Noto Sans&quot;, sans-serif, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><summary markdown="span" style="box-sizing: border-box; cursor: pointer; list-style: none; padding-left: 1rem; position: relative;"><strong style="box-sizing: border-box; font-weight: var(--ifm-font-weight-bold);">对 Babel 6 支持</strong></summary></details>

<h3 id="使用-webpack"><a href="#使用-webpack" class="headerlink" title="使用 webpack"></a>使用 <a href="https://www.jestjs.cn/docs/getting-started#%E4%BD%BF%E7%94%A8-webpack">webpack</a></h3><p>Jest 可以用于在使用 <a href="https://webpack.js.org/">webpack</a> 管理资源、样式和编译方式的项目中。webpack 和其它工具相比的确多了一些独特的挑战。请参阅 <a href="https://www.jestjs.cn/docs/webpack">webpack 指南</a> 快速上手。</p>
<h3 id="显示测试报告"><a href="#显示测试报告" class="headerlink" title="显示测试报告"></a>显示测试报告</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">jest --coverage</span><br></pre></td></tr></table></figure>

<h3 id="动态监听文件改变进行测试"><a href="#动态监听文件改变进行测试" class="headerlink" title="动态监听文件改变进行测试"></a>动态监听文件改变进行测试</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">jest --watchAll</span><br></pre></td></tr></table></figure>

<p>package.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jest --watchAll&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;coverage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jest --coverage&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<h2 id="匹配器"><a href="#匹配器" class="headerlink" title="匹配器"></a>匹配器</h2><p><a href="https://www.jestjs.cn/docs/expect">官方文档</a></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 用于.toBe比较原始值或检查对象实例的引用身份。它调用比较值，这比严格相等运算符Object.is更适合测试</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;to be&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="string">&quot;a&quot;</span>).<span class="title function_">toBe</span>(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//  用于.toEqual递归比较对象实例的所有属性（也称为“深度”相等）。它调用比较原始值，这比严格相等运算符Object.is更适合测试。</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;.toEqual()&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> a = &#123; <span class="attr">name</span>: <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="title function_">expect</span>(a).<span class="title function_">toEqual</span>(&#123; <span class="attr">name</span>: <span class="number">1</span> &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//   .toBeTruthy当您不关心值是什么并且希望确保值在布尔上下文中为真时使用。</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;.toBeTruthy()&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">22</span>;</span><br><span class="line">    <span class="title function_">expect</span>(a).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//   .toBeFalsy当您不关心值是什么并且希望确保值在布尔上下文中为假时使用</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;.toBeFalsy()&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="title function_">expect</span>(a).<span class="title function_">toBeFalsy</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//   用于.toBeUndefined检查变量是否未定义</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;.toBeUndefined()&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> a;</span><br><span class="line">    <span class="title function_">expect</span>(a).<span class="title function_">toBeUndefined</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//   用于.toBeDefined检查变量是否未定义</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;.toBeDefined()&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">123</span>;</span><br><span class="line">    <span class="title function_">expect</span>(a).<span class="title function_">toBeDefined</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//   toBeNull()是一样的，.toBe(null)但错误信息更好一点。所以.toBeNull()当你想检查某些东西是否为空时使用。</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;.toBeNull()&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// 期望（a）.为空（）;</span></span><br><span class="line">    <span class="title function_">expect</span>(a).<span class="title function_">toBeNull</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//   .toBeNaN检查值为 时使用NaN。</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;.toBeNaN()&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="title class_">NaN</span>;</span><br><span class="line">    <span class="title function_">expect</span>(a).<span class="title function_">toBeNaN</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//  大于</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;.toBeGreaterThan()&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">8</span>;</span><br><span class="line">    <span class="comment">// 期望（a）大于（6）</span></span><br><span class="line">    <span class="title function_">expect</span>(a).<span class="title function_">toBeGreaterThan</span>(<span class="number">6</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//   大于或等于</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;.toBeGreaterThanOrEqual()&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">8</span>;</span><br><span class="line">    <span class="comment">// 期望（a）大于或等于（8）</span></span><br><span class="line">    <span class="title function_">expect</span>(a).<span class="title function_">toBeGreaterThanOrEqual</span>(<span class="number">8</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//   小于</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;.toBeLessThan()&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">8</span>;</span><br><span class="line">    <span class="comment">// 期望（a）小于（10）</span></span><br><span class="line">    <span class="title function_">expect</span>(a).<span class="title function_">toBeLessThan</span>(<span class="number">10</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//   小于或等于</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;.toBeLessThanOrEqual()&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">8</span>;</span><br><span class="line">    <span class="comment">// 期望（a）.小于或等于（8）</span></span><br><span class="line">    <span class="title function_">expect</span>(a).<span class="title function_">toBeLessThanOrEqual</span>(<span class="number">8</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//   用于.toMatch检查字符串是否与正则表达式匹配</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;.toMatch()&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="string">&quot;jest-test, mock , api&quot;</span>;</span><br><span class="line">    <span class="title function_">expect</span>(a).<span class="title function_">toMatch</span>(<span class="string">&quot;api&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//   .toContain当您要检查项目是否在数组中时使用。为了测试数组中的项目，这使用===了严格的相等检查。.toContain还可以检查一个字符串是否是另一个字符串的子字符串</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;.toContain()&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> a = [<span class="string">&quot;react&quot;</span>, <span class="string">&quot;vue&quot;</span>, <span class="string">&quot;webpack&quot;</span>, <span class="string">&quot;node&quot;</span>, <span class="string">&quot;ts&quot;</span>];</span><br><span class="line">    <span class="title function_">expect</span>(a).<span class="title function_">toContain</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//   用于.toThrow测试函数在调用时是否抛出 错误</span></span><br><span class="line">  <span class="title function_">test</span>(<span class="string">&quot;.toThrow()&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="title function_">a</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="comment">//   throw Error(&quot;error&quot;);</span></span><br><span class="line">      <span class="keyword">throw</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">expect</span>(a).<span class="title function_">toThrow</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>前端测试</category>
      </categories>
      <tags>
        <tag>单元测试</tag>
        <tag>jest</tag>
      </tags>
  </entry>
  <entry>
    <title>js中的微观任务和宏观任务</title>
    <url>/2020/09/14/js/js%E4%B8%AD%E7%9A%84%E5%BE%AE%E8%A7%82%E4%BB%BB%E5%8A%A1%E5%92%8C%E5%AE%8F%E8%A7%82%E4%BB%BB%E5%8A%A1/</url>
    <content><![CDATA[<h1 id="js-中的微观任务和宏观任务"><a href="#js-中的微观任务和宏观任务" class="headerlink" title="js 中的微观任务和宏观任务"></a>js 中的微观任务和宏观任务</h1><blockquote>
<p>首先 js 是单线程的,代码执行都在执行栈中，io 接口事件和 dom 事件都放在任务队列中，等到执行栈执行完毕再去任务队列中看有没有可执行的任务，这称之为事件循环</p>
</blockquote>
<span id="more"></span>

<p>事件循环示意</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/bg2014100802.png" alt="bg2014100802"></p>
<h3 id="注意点-1"><a href="#注意点-1" class="headerlink" title="注意点 1"></a>注意点 1</h3><p>微观任务都是放在执行栈的最后来执行，还是在本轮事件循环中</p>
<p>宏观任务都是放在任务队列中执行，不在本轮事件循环之中</p>
<h3 id="注意点-2"><a href="#注意点-2" class="headerlink" title="注意点 2"></a>注意点 2</h3><p>asycn 的 await 下面的代码相当于都在 promise 的 then 里面都是本轮事件循环的最末执行，也就是说 await 下面的代码在等待 await 期间会被放到栈尾，而执行 asnyc 函数下的代码</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/%E5%BE%AE%E8%A7%82%E4%BB%BB%E5%8A%A1%E5%92%8C%E5%AE%8F%E8%A7%82%E4%BB%BB%E5%8A%A1.png" alt="微观任务和宏观任务"></p>
<p>总结：遇到 setimeout 就放一边 ，遇到 setImmediate 也放 一边，遇到 promise 或者 nextTick 就放到本轮最后，等到本轮执行结束去找可以执行的 settimeout 或<strong>setImmediate</strong></p>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>js常用冷知识</title>
    <url>/2021/04/24/js/js%E5%B8%B8%E7%94%A8%E5%86%B7%E7%9F%A5%E8%AF%86/</url>
    <content><![CDATA[<h2 id="函数对象-空字串-x3D-函数内容"><a href="#函数对象-空字串-x3D-函数内容" class="headerlink" title="函数对象+空字串 &#x3D; 函数内容"></a>函数对象+空字串 &#x3D; 函数内容</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">...arg</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> arg.<span class="title function_">reduce</span>(<span class="function">(<span class="params">per, cur</span>) =&gt;</span> per + cur, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(add + <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//function add(...arg)&#123;</span></span><br><span class="line"><span class="comment">//   return  arg.reduce((per,cur)=&gt;per + cur, 0)</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br></pre></td></tr></table></figure>

<p>node.js 中 查看 CommonJS 的模块</p>
<p>index.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">exports</span>.<span class="property">a</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">arguments</span>.<span class="property">callee</span> + <span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>使用 node 运行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">node index.js</span><br></pre></td></tr></table></figure>

<p>打印</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> (<span class="params"><span class="built_in">exports</span>, <span class="built_in">require</span>, <span class="variable language_">module</span>, __filename, __dirname</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">a</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">arguments</span>.<span class="property">callee</span> + <span class="string">&quot;&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>exports 为 module 中的属性</p>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>js文件处理 Blob File Buffer TypedArray ArrayBuffer之间的关系</title>
    <url>/2022/06/08/js/js%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86_Blob_File_Buffer_TypedArray_ArrayBuffer%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB/</url>
    <content><![CDATA[<h2 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h2><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob">Blob</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/File">File</a><br><a href="https://nodejs.org/dist/latest-v14.x/docs/api/buffer.html#buffer_buffers_and_typedarrays">Buffer</a><br><a href="https://nodejs.org/dist/latest-v14.x/docs/api/buffer.html#buffer_static_method_buffer_from_arraybuffer_byteoffset_length">Buffer.from</a><br><a href="https://nodejs.org/dist/latest-v14.x/docs/api/buffer.html#buffer_static_method_buffer_from_arraybuffer_byteoffset_length">Buffer.from</a><br><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray">TypedArray</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer">ArrayBuffer</a></p>
<h2 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h2><h3 id="继承关系"><a href="#继承关系" class="headerlink" title="继承关系"></a>继承关系</h3><p>Buffer 是 node 中的类型 Buffer 继承于 Uint8Array<br>Uint8Array 继承于 TypedArray （或者说是其中一种实现 TypedArray 不能直接new ）<br>TypedArray 有以下类型</p>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Int8Array">Int8Array</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array">Uint8Array</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint8ClampedArray">Uint8ClampedArray</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Int16Array">Int16Array</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint16Array">Uint16Array</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Int32Array">Int32Array</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint32Array">Uint32Array</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Float32Array">Float32Array</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Float64Array">Float64Array</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/DataView">DataView</a><br>ArrayBufferView 就是  TypedArray<br>File 继承于 Blob</li>
</ul>
<h3 id="转换关系"><a href="#转换关系" class="headerlink" title="转换关系"></a>转换关系</h3><p>ArrayBuffer 类型转换中的关键！ 可以转换为任何类型， 其他类型也可以转化为 ArrayBuffer</p>
<p>Buffer.from 接收 ArrayBuffer 转换为 Buffer<br>Buffer.buffer 可以获取到 ArrayBuffer</p>
<p>Uint8Array.buffer 可以获取到 ArrayBuffer<br>new Uint8Array 接收 ArrayBuffer 可以转化为 Uint8Array</p>
<p>new Blob 和 File 都可以接收 ArrayBuffer，ArrayBufferView，Blob 生成参数<br>Blob.arrayBuffer() 返回一个 promise 且包含 blob 所有内容的二进制格式的 ArrayBuffer</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Uint8Array | ArrayBufferView | TypedArray</span></span><br><span class="line"><span class="keyword">const</span> buffer = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">8</span>);</span><br><span class="line"><span class="keyword">const</span> uint8 = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(buffer)</span><br><span class="line">uint8.<span class="property">buffer</span> === buffer <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// node buffer</span></span><br><span class="line"><span class="keyword">const</span> buffer = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">8</span>);</span><br><span class="line"><span class="keyword">const</span> buf = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(buffer)</span><br><span class="line">buf.<span class="property">buffer</span> === buffer <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Blob</span></span><br><span class="line"><span class="keyword">const</span> buffer = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">8</span>);</span><br><span class="line"><span class="keyword">let</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>([buffer])</span><br><span class="line">blob.<span class="title function_">arrayBuffer</span>().<span class="title function_">then</span>((<span class="function"><span class="params">buf</span>=&gt;</span><span class="variable language_">console</span>.<span class="title function_">log</span>(buf))) <span class="comment">// buf !== buffer</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// File</span></span><br><span class="line"><span class="keyword">const</span> buffer = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">8</span>);</span><br><span class="line"><span class="keyword">let</span> file = <span class="keyword">new</span> <span class="title class_">File</span>([buffer],<span class="string">&quot;file.xxx&quot;</span>)</span><br><span class="line">file.<span class="title function_">arrayBuffer</span>().<span class="title function_">then</span>((<span class="function"><span class="params">buf</span>=&gt;</span><span class="variable language_">console</span>.<span class="title function_">log</span>(buf))) <span class="comment">// buf !== buffer</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>js</tag>
        <tag>Nodejs</tag>
      </tags>
  </entry>
  <entry>
    <title>linux 常用命令</title>
    <url>/2021/01/03/Linux/linux-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<h2 id="退出和进入-root-权限"><a href="#退出和进入-root-权限" class="headerlink" title="退出和进入 root 权限"></a>退出和进入 root 权限</h2><p>进入</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo -s</span><br></pre></td></tr></table></figure>

<p>退出</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ su [用户名]</span><br></pre></td></tr></table></figure>

<h2 id="Ubuntu-下几种软件安装的方法"><a href="#Ubuntu-下几种软件安装的方法" class="headerlink" title="Ubuntu 下几种软件安装的方法"></a>Ubuntu 下几种软件安装的方法</h2><h2 id="tar-命令的用法"><a href="#tar-命令的用法" class="headerlink" title="tar 命令的用法"></a>tar 命令的用法</h2><p>参考 <a href="https://blog.csdn.net/kkw1992/article/details/80000653">https://blog.csdn.net/kkw1992/article/details/80000653</a></p>
<p>linux 下最常用的打包程序就是 tar 了，使用 tar 程序打出来的包我们常称为 tar 包，tar 包文件的命令通常都是以.tar 结尾的。生成 tar 包后，就可以用其它的程序来进行压缩。</p>
<p><strong>1．命令格式：</strong></p>
<p><code>tar [必要参数][选择参数][文件] </code></p>
<p><strong>2．命令功能：</strong></p>
<p>用来压缩和解压文件。tar 本身不具有压缩功能。他是调用压缩功能实现的</p>
<p><strong>3．命令参数：</strong></p>
<p>必要参数有如下：</p>
<p>-A 新增压缩文件到已存在的压缩</p>
<p>-B 设置区块大小</p>
<p>-c 建立新的压缩文件</p>
<p>-d 记录文件的差别</p>
<p>-r 添加文件到已经压缩的文件</p>
<p>-u 添加改变了和现有的文件到已经存在的压缩文件</p>
<p>-x 从压缩的文件中提取文件</p>
<p>-t 显示压缩文件的内容</p>
<p>-z 支持 gzip 解压文件</p>
<p>-j 支持 bzip2 解压文件</p>
<p>-Z 支持 compress 解压文件</p>
<p>-v 显示操作过程</p>
<p>-l 文件系统边界设置</p>
<p>-k 保留原有文件不覆盖</p>
<p>-m 保留文件不被覆盖</p>
<p>-W 确认压缩文件的正确性</p>
<p>可选参数如下：</p>
<p>-b 设置区块数目</p>
<p>-C 切换到指定目录</p>
<p>-f 指定压缩文件</p>
<p>–help 显示帮助信息</p>
<p>–version 显示版本信息</p>
<p><strong>4．常见解压&#x2F;压缩命令</strong></p>
<p>tar<br>解包：tar xvf FileName.tar<br>打包：tar cvf FileName.tar DirName</p>
<p>（注：tar 是打包，不是压缩！）</p>
<p>.gz<br>解压 1：gunzip FileName.gz<br>解压 2：gzip -d FileName.gz<br>压缩：gzip FileName</p>
<p>.tar.gz 和 .tgz<br>解压：tar zxvf FileName.tar.gz<br>压缩：tar zcvf FileName.tar.gz DirName<br>.bz2<br>解压 1：bzip2 -d FileName.bz2<br>解压 2：bunzip2 FileName.bz2<br>压缩： bzip2 -z FileName</p>
<p>.tar.bz2<br>解压：tar jxvf FileName.tar.bz2<br>压缩：tar jcvf FileName.tar.bz2 DirName<br>.bz<br>解压 1：bzip2 -d FileName.bz<br>解压 2：bunzip2 FileName.bz<br>压缩：未知</p>
<p>.tar.bz<br>解压：tar jxvf FileName.tar.bz<br>压缩：未知<br>.Z<br>解压：uncompress FileName.Z<br>压缩：compress FileName</p>
<p>.tar.Z<br>解压：tar Zxvf FileName.tar.Z<br>压缩：tar Zcvf FileName.tar.Z DirName</p>
<p>.zip<br>解压：unzip FileName.zip<br>压缩：zip FileName.zip DirName<br>.rar<br>解压：rar x FileName.rar<br>压缩：rar a FileName.rar DirName</p>
<h2 id="Linux-常用命令大全（非常全！！！）"><a href="#Linux-常用命令大全（非常全！！！）" class="headerlink" title="Linux 常用命令大全（非常全！！！）"></a><strong>Linux 常用命令大全（非常全！！！）</strong></h2><h3 id="中查看正在使用的端口"><a href="#中查看正在使用的端口" class="headerlink" title="中查看正在使用的端口"></a>中查看正在使用的端口</h3><p>参考：<a href="https://www.linuxidc.com/Linux/2019-08/160085.htm">https://www.linuxidc.com/Linux/2019-08/160085.htm</a></p>
<h4 id="使用-netstat-检查端口"><a href="#使用-netstat-检查端口" class="headerlink" title="使用 netstat 检查端口"></a>使用 netstat 检查端口</h4><p>netstat 是一个命令行工具，可以提供有关网络连接的信息。</p>
<p>要列出正在侦听的所有 TCP 或 UDP 端口，包括使用端口和套接字状态的服务，请使用以下命令：</p>
<p>linuxidc@linuxidc:~&#x2F;<a href="http://www.linuxidc.com$/">www.linuxidc.com$</a> sudo netstat -tunlp</p>
<p>此命令中使用的选项具有以下含义：</p>
<ul>
<li>-t - 显示 TCP 端口。</li>
<li>-u - 显示 UDP 端口。</li>
<li>-n - 显示数字地址而不是主机名。</li>
<li>-l - 仅显示侦听端口。</li>
<li>-p - 显示进程的 PID 和名称。仅当您以 root 或 sudo 用户身份运行命令时，才会显示此信息。</li>
</ul>
<p>输出示例如下所示：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">inuxidc@linuxidc:~/www.linuxidc.com$ sudo netstat -tunlp</span><br><span class="line">[sudo] linuxidc 的密码：</span><br><span class="line">激活Internet连接 (仅服务器)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span><br><span class="line">tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      1405/mysqld</span><br><span class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1181/nginx: master</span><br><span class="line">tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      784/systemd-resolve</span><br><span class="line">tcp        0      0 127.0.0.1:631           0.0.0.0:*               LISTEN      1081/cupsd</span><br><span class="line">tcp6       0      0 :::80                   :::*                    LISTEN      1181/nginx: master</span><br><span class="line">tcp6       0      0 ::1:631                 :::*                    LISTEN      1081/cupsd</span><br><span class="line">udp        0      0 0.0.0.0:44785           0.0.0.0:*                           958/avahi-daemon: r</span><br><span class="line">udp        0      0 127.0.0.53:53           0.0.0.0:*                           784/systemd-resolve</span><br><span class="line">udp        0      0 0.0.0.0:68              0.0.0.0:*                           4581/dhclient</span><br><span class="line">udp        0      0 0.0.0.0:631             0.0.0.0:*</span><br></pre></td></tr></table></figure>

<p>我们例子中的比较重要的列是：</p>
<ul>
<li>Proto - 套接字使用的协议。</li>
<li>Local Address - 进程侦听的 IP 地址和端口号。</li>
<li>PID&#x2F;Program name - PID 和进程名称。</li>
</ul>
<h3 id="系统信息"><a href="#系统信息" class="headerlink" title="系统信息"></a><strong>系统信息</strong></h3><p>arch 显示机器的处理器架构<br>uname -m 显示机器的处理器架构<br>uname -r 显示正在使用的内核版本<br>dmidecode -q 显示硬件系统部件 - (SMBIOS &#x2F; DMI)<br>hdparm -i &#x2F;dev&#x2F;hda 罗列一个磁盘的架构特性<br>hdparm -tT &#x2F;dev&#x2F;sda 在磁盘上执行测试性读取操作<br>cat &#x2F;proc&#x2F;cpuinfo 显示 CPU info 的信息<br>cat &#x2F;proc&#x2F;interrupts 显示中断<br>cat &#x2F;proc&#x2F;meminfo 校验内存使用<br>cat &#x2F;proc&#x2F;swaps 显示哪些 swap 被使用<br>cat &#x2F;proc&#x2F;version 显示内核的版本<br>cat &#x2F;proc&#x2F;net&#x2F;dev 显示网络适配器及统计<br>cat &#x2F;proc&#x2F;mounts 显示已加载的文件系统<br>lspci -tv 罗列 PCI 设备<br>lsusb -tv 显示 USB 设备<br>date 显示系统日期<br>cal 2007 显示 2007 年的日历表<br>date 041217002007.00 设置日期和时间 - 月日时分年.秒<br>clock -w 将时间修改保存到 BIOS</p>
<h3 id="关机-系统的关机、重启以及登出"><a href="#关机-系统的关机、重启以及登出" class="headerlink" title="关机 (系统的关机、重启以及登出 )"></a><strong>关机 (系统的关机、重启以及登出 )</strong></h3><p>shutdown -h now 关闭系统<br>init 0 关闭系统<br>telinit 0 关闭系统<br>shutdown -h hours:minutes &amp; 按预定时间关闭系统<br>shutdown -c 取消按预定时间关闭系统<br>shutdown -r now 重启<br>reboot 重启<br>logout 注销</p>
<h3 id="文件和目录"><a href="#文件和目录" class="headerlink" title="文件和目录"></a><strong>文件和目录</strong></h3><p>cd &#x2F;home 进入 ‘&#x2F; home’ 目录’<br>cd .. 返回上一级目录<br>cd ..&#x2F;.. 返回上两级目录<br>cd 进入个人的主目录<br>cd ~user1 进入个人的主目录<br>cd - 返回上次所在的目录<br>pwd 显示工作路径<br>ls 查看目录中的文件<br>ls -F 查看目录中的文件<br>ls -l 显示文件和目录的详细资料<br>ls -a 显示隐藏文件<br>ls <em>[0-9]</em> 显示包含数字的文件名和目录名<br>tree 显示文件和目录由根目录开始的树形结构<br>lstree 显示文件和目录由根目录开始的树形结构<br>mkdir dir1 创建一个叫做 ‘dir1’ 的目录’<br>mkdir dir1 dir2 同时创建两个目录<br>mkdir -p &#x2F;tmp&#x2F;dir1&#x2F;dir2 创建一个目录树<br>rm -f file1 删除一个叫做 ‘file1’ 的文件’<br>rmdir dir1 删除一个叫做 ‘dir1’ 的目录’<br>rm -rf dir1 删除一个叫做 ‘dir1’ 的目录并同时删除其内容<br>rm -rf dir1 dir2 同时删除两个目录及它们的内容<br>mv dir1 new_dir 重命名&#x2F;移动 一个目录<br>cp file1 file2 复制一个文件<br>cp dir&#x2F;_ . 复制一个目录下的所有文件到当前工作目录<br>cp -a &#x2F;tmp&#x2F;dir1 . 复制一个目录到当前工作目录<br>cp -a dir1 dir2 复制一个目录<br>ln -s file1 lnk1 创建一个指向文件或目录的软链接<br>ln file1 lnk1 创建一个指向文件或目录的物理链接<br>touch -t 0712250000 file1 修改一个文件或目录的时间戳 - (YYMMDDhhmm)<br>file file1 outputs the mime type of the file as text<br>iconv -l 列出已知的编码<br>iconv -f fromEncoding -t toEncoding inputFile &gt; outputFile creates a new from the given input file by assuming it is encoded in fromEncoding and converting it to toEncoding.<br>find . -maxdepth 1 -name _.jpg -print -exec convert “{}” -resize 80x60 “thumbs&#x2F;{}” ; batch resize files in the current directory and send them to a thumbnails directory (requires convert from Imagemagick)</p>
<h3 id="文件搜索"><a href="#文件搜索" class="headerlink" title="文件搜索"></a><strong>文件搜索</strong></h3><p>find &#x2F; -name file1 从 ‘&#x2F;‘ 开始进入根文件系统搜索文件和目录<br>find &#x2F; -user user1 搜索属于用户 ‘user1’ 的文件和目录<br>find &#x2F;home&#x2F;user1 -name *.bin 在目录 ‘&#x2F; home&#x2F;user1’ 中搜索带有’.bin’ 结尾的文件<br>find &#x2F;usr&#x2F;bin -type f -atime +100 搜索在过去 100 天内未被使用过的执行文件<br>find &#x2F;usr&#x2F;bin -type f -mtime -10 搜索在 10 天内被创建或者修改过的文件<br>find &#x2F; -name *.rpm -exec chmod 755 ‘{}’ ; 搜索以 ‘.rpm’ 结尾的文件并定义其权限<br>find &#x2F; -xdev -name *.rpm 搜索以 ‘.rpm’ 结尾的文件，忽略光驱、捷盘等可移动设备<br>locate *.ps 寻找以 ‘.ps’ 结尾的文件 - 先运行 ‘updatedb’ 命令<br>whereis halt 显示一个二进制文件、源码或 man 的位置<br>which halt 显示一个二进制文件或可执行文件的完整路径</p>
<h3 id="挂载一个文件系统"><a href="#挂载一个文件系统" class="headerlink" title="挂载一个文件系统"></a><strong>挂载一个文件系统</strong></h3><p>mount &#x2F;dev&#x2F;hda2 &#x2F;mnt&#x2F;hda2 挂载一个叫做 hda2 的盘 - 确定目录 ‘&#x2F; mnt&#x2F;hda2’ 已经存在<br>umount &#x2F;dev&#x2F;hda2 卸载一个叫做 hda2 的盘 - 先从挂载点 ‘&#x2F; mnt&#x2F;hda2’ 退出<br>fuser -km &#x2F;mnt&#x2F;hda2 当设备繁忙时强制卸载<br>umount -n &#x2F;mnt&#x2F;hda2 运行卸载操作而不写入 &#x2F;etc&#x2F;mtab 文件- 当文件为只读或当磁盘写满时非常有用<br>mount &#x2F;dev&#x2F;fd0 &#x2F;mnt&#x2F;floppy 挂载一个软盘<br>mount &#x2F;dev&#x2F;cdrom &#x2F;mnt&#x2F;cdrom 挂载一个 cdrom 或 dvdrom<br>mount &#x2F;dev&#x2F;hdc &#x2F;mnt&#x2F;cdrecorder 挂载一个 cdrw 或 dvdrom<br>mount &#x2F;dev&#x2F;hdb &#x2F;mnt&#x2F;cdrecorder 挂载一个 cdrw 或 dvdrom<br>mount -o loop file.iso &#x2F;mnt&#x2F;cdrom 挂载一个文件或 ISO 镜像文件<br>mount -t vfat &#x2F;dev&#x2F;hda5 &#x2F;mnt&#x2F;hda5 挂载一个 Windows FAT32 文件系统<br>mount &#x2F;dev&#x2F;sda1 &#x2F;mnt&#x2F;usbdisk 挂载一个 usb 捷盘或闪存设备<br>mount -t smbfs -o username&#x3D;user,password&#x3D;pass &#x2F;&#x2F;WinClient&#x2F;share &#x2F;mnt&#x2F;share 挂载一个 windows 网络共享</p>
<h3 id="磁盘空间"><a href="#磁盘空间" class="headerlink" title="磁盘空间"></a><strong>磁盘空间</strong></h3><p>df -h 显示已经挂载的分区列表<br>ls -lSr |more 以尺寸大小排列文件和目录<br>du -sh dir1 估算目录 ‘dir1’ 已经使用的磁盘空间’<br>du -sk * | sort -rn 以容量大小为依据依次显示文件和目录的大小<br>rpm -q -a –qf ‘%10{SIZE}t%{NAME}n’ | sort -k1,1n 以大小为依据依次显示已安装的 rpm 包所使用的空间 (fedora, redhat 类系统)<br>dpkg-query -W -f&#x3D;’${Installed-Size;10}t${Package}n’ | sort -k1,1n 以大小为依据显示已安装的 deb 包所使用的空间 (ubuntu, debian 类系统)</p>
<h3 id="用户和群组"><a href="#用户和群组" class="headerlink" title="用户和群组"></a><strong>用户和群组</strong></h3><p>groupadd group_name 创建一个新用户组<br>groupdel group_name 删除一个用户组<br>groupmod -n new_group_name old_group_name 重命名一个用户组<br>useradd -c “Name Surname “ -g admin -d &#x2F;home&#x2F;user1 -s &#x2F;bin&#x2F;bash user1 创建一个属于 “admin” 用户组的用户<br>useradd user1 创建一个新用户<br>userdel -r user1 删除一个用户 ( ‘-r’ 排除主目录)<br>usermod -c “User FTP” -g system -d &#x2F;ftp&#x2F;user1 -s &#x2F;bin&#x2F;nologin user1 修改用户属性<br>passwd 修改口令<br>passwd user1 修改一个用户的口令 (只允许 root 执行)<br>chage -E 2005-12-31 user1 设置用户口令的失效期限<br>pwck 检查 ‘&#x2F;etc&#x2F;passwd’ 的文件格式和语法修正以及存在的用户<br>grpck 检查 ‘&#x2F;etc&#x2F;passwd’ 的文件格式和语法修正以及存在的群组<br>newgrp group_name 登陆进一个新的群组以改变新创建文件的预设群组</p>
<h3 id="文件的权限-使用-“-”-设置权限，使用-“-“-用于取消"><a href="#文件的权限-使用-“-”-设置权限，使用-“-“-用于取消" class="headerlink" title="文件的权限 - 使用 “+” 设置权限，使用 “-“ 用于取消"></a><strong>文件的权限 - 使用 “+” 设置权限，使用 “-“ 用于取消</strong></h3><p>ls -lh 显示权限<br>ls &#x2F;tmp | pr -T5 -W$COLUMNS 将终端划分成 5 栏显示<br>chmod ugo+rwx directory1 设置目录的所有人(u)、群组(g)以及其他人(o)以读（r ）、写(w)和执行(x)的权限<br>chmod go-rwx directory1 删除群组(g)与其他人(o)对目录的读写执行权限<br>chown user1 file1 改变一个文件的所有人属性<br>chown -R user1 directory1 改变一个目录的所有人属性并同时改变改目录下所有文件的属性<br>chgrp group1 file1 改变文件的群组<br>chown user1:group1 file1 改变一个文件的所有人和群组属性<br>find &#x2F; -perm -u+s 罗列一个系统中所有使用了 SUID 控制的文件<br>chmod u+s &#x2F;bin&#x2F;file1 设置一个二进制文件的 SUID 位 - 运行该文件的用户也被赋予和所有者同样的权限<br>chmod u-s &#x2F;bin&#x2F;file1 禁用一个二进制文件的 SUID 位<br>chmod g+s &#x2F;home&#x2F;public 设置一个目录的 SGID 位 - 类似 SUID ，不过这是针对目录的<br>chmod g-s &#x2F;home&#x2F;public 禁用一个目录的 SGID 位<br>chmod o+t &#x2F;home&#x2F;public 设置一个文件的 STIKY 位 - 只允许合法所有人删除文件<br>chmod o-t &#x2F;home&#x2F;public 禁用一个目录的 STIKY 位</p>
<h3 id="文件的特殊属性-使用-“-”-设置权限，使用-“-“-用于取消"><a href="#文件的特殊属性-使用-“-”-设置权限，使用-“-“-用于取消" class="headerlink" title="文件的特殊属性 - 使用 “+” 设置权限，使用 “-“ 用于取消"></a><strong>文件的特殊属性 - 使用 “+” 设置权限，使用 “-“ 用于取消</strong></h3><p>chattr +a file1 只允许以追加方式读写文件<br>chattr +c file1 允许这个文件能被内核自动压缩&#x2F;解压<br>chattr +d file1 在进行文件系统备份时，dump 程序将忽略这个文件<br>chattr +i file1 设置成不可变的文件，不能被删除、修改、重命名或者链接<br>chattr +s file1 允许一个文件被安全地删除<br>chattr +S file1 一旦应用程序对这个文件执行了写操作，使系统立刻把修改的结果写到磁盘<br>chattr +u file1 若文件被删除，系统会允许你在以后恢复这个被删除的文件<br>lsattr 显示特殊的属性</p>
<h3 id="打包和压缩文件"><a href="#打包和压缩文件" class="headerlink" title="打包和压缩文件"></a><strong>打包和压缩文件</strong></h3><p>bunzip2 file1.bz2 解压一个叫做 ‘file1.bz2’的文件<br>bzip2 file1 压缩一个叫做 ‘file1’ 的文件<br>gunzip file1.gz 解压一个叫做 ‘file1.gz’的文件<br>gzip file1 压缩一个叫做 ‘file1’的文件<br>gzip -9 file1 最大程度压缩<br>rar a file1.rar test_file 创建一个叫做 ‘file1.rar’ 的包<br>rar a file1.rar file1 file2 dir1 同时压缩 ‘file1’, ‘file2’ 以及目录 ‘dir1’<br>unrar x file1.rar 解压 rar 包<br>tar -cvf archive.tar file1 创建一个非压缩的 tarball<br>tar -cvf archive.tar file1 file2 dir1 创建一个包含了 ‘file1’, ‘file2’ 以及 ‘dir1’的档案文件<br>tar -tf archive.tar 显示一个包中的内容<br>tar -xvf archive.tar 释放一个包<br>tar -xvf archive.tar -C &#x2F;tmp 将压缩包释放到 &#x2F;tmp 目录下<br>tar -cvfj archive.tar.bz2 dir1 创建一个 bzip2 格式的压缩包<br>tar -jxvf archive.tar.bz2 解压一个 bzip2 格式的压缩包<br>tar -cvfz archive.tar.gz dir1 创建一个 gzip 格式的压缩包<br>tar -zxvf archive.tar.gz 解压一个 gzip 格式的压缩包<br>zip file1.zip file1 创建一个 zip 格式的压缩包<br>zip -r file1.zip file1 file2 dir1 将几个文件和目录同时压缩成一个 zip 格式的压缩包<br>unzip file1.zip 解压一个 zip 格式压缩包</p>
<h3 id="RPM-包-（Fedora-Redhat-及类似系统）"><a href="#RPM-包-（Fedora-Redhat-及类似系统）" class="headerlink" title="RPM 包 - （Fedora, Redhat 及类似系统）"></a><strong>RPM 包 - （Fedora, Redhat 及类似系统）</strong></h3><p>rpm -ivh package.rpm 安装一个 rpm 包<br>rpm -ivh –nodeeps package.rpm 安装一个 rpm 包而忽略依赖关系警告<br>rpm -U package.rpm 更新一个 rpm 包但不改变其配置文件<br>rpm -F package.rpm 更新一个确定已经安装的 rpm 包<br>rpm -e package_name.rpm 删除一个 rpm 包<br>rpm -qa 显示系统中所有已经安装的 rpm 包<br>rpm -qa | grep httpd 显示所有名称中包含 “httpd” 字样的 rpm 包<br>rpm -qi package_name 获取一个已安装包的特殊信息<br>rpm -qg “System Environment&#x2F;Daemons” 显示一个组件的 rpm 包<br>rpm -ql package_name 显示一个已经安装的 rpm 包提供的文件列表<br>rpm -qc package_name 显示一个已经安装的 rpm 包提供的配置文件列表<br>rpm -q package_name –whatrequires 显示与一个 rpm 包存在依赖关系的列表<br>rpm -q package_name –whatprovides 显示一个 rpm 包所占的体积<br>rpm -q package_name –scripts 显示在安装&#x2F;删除期间所执行的脚本 l<br>rpm -q package_name –changelog 显示一个 rpm 包的修改历史<br>rpm -qf &#x2F;etc&#x2F;httpd&#x2F;conf&#x2F;httpd.conf 确认所给的文件由哪个 rpm 包所提供<br>rpm -qp package.rpm -l 显示由一个尚未安装的 rpm 包提供的文件列表<br>rpm –import &#x2F;media&#x2F;cdrom&#x2F;RPM-GPG-KEY 导入公钥数字证书<br>rpm –checksig package.rpm 确认一个 rpm 包的完整性<br>rpm -qa gpg-pubkey 确认已安装的所有 rpm 包的完整性<br>rpm -V package_name 检查文件尺寸、 许可、类型、所有者、群组、MD5 检查以及最后修改时间<br>rpm -Va 检查系统中所有已安装的 rpm 包- 小心使用<br>rpm -Vp package.rpm 确认一个 rpm 包还未安装<br>rpm2cpio package.rpm | cpio –extract –make-directories <em>bin</em> 从一个 rpm 包运行可执行文件<br>rpm -ivh &#x2F;usr&#x2F;src&#x2F;redhat&#x2F;RPMS&#x2F;<code>arch</code>&#x2F;package.rpm 从一个 rpm 源码安装一个构建好的包<br>rpmbuild –rebuild package_name.src.rpm 从一个 rpm 源码构建一个 rpm 包</p>
<h3 id="YUM-软件包升级器-（Fedora-RedHat-及类似系统）"><a href="#YUM-软件包升级器-（Fedora-RedHat-及类似系统）" class="headerlink" title="YUM 软件包升级器 - （Fedora, RedHat 及类似系统）"></a><strong>YUM 软件包升级器 - （Fedora, RedHat 及类似系统）</strong></h3><p>yum install package_name 下载并安装一个 rpm 包<br>yum localinstall package_name.rpm 将安装一个 rpm 包，使用你自己的软件仓库为你解决所有依赖关系<br>yum update package_name.rpm 更新当前系统中所有安装的 rpm 包<br>yum update package_name 更新一个 rpm 包<br>yum remove package_name 删除一个 rpm 包<br>yum list 列出当前系统中安装的所有包<br>yum search package_name 在 rpm 仓库中搜寻软件包<br>yum clean packages 清理 rpm 缓存删除下载的包<br>yum clean headers 删除所有头文件<br>yum clean all 删除所有缓存的包和头文件</p>
<h3 id="DEB-包-Debian-Ubuntu-以及类似系统"><a href="#DEB-包-Debian-Ubuntu-以及类似系统" class="headerlink" title="DEB 包 (Debian, Ubuntu 以及类似系统)"></a><strong>DEB 包 (Debian, Ubuntu 以及类似系统)</strong></h3><p>dpkg -i package.deb 安装&#x2F;更新一个 deb 包<br>dpkg -r package_name 从系统删除一个 deb 包<br>dpkg -l 显示系统中所有已经安装的 deb 包<br>dpkg -l | grep httpd 显示所有名称中包含 “httpd” 字样的 deb 包<br>dpkg -s package_name 获得已经安装在系统中一个特殊包的信息<br>dpkg -L package_name 显示系统中已经安装的一个 deb 包所提供的文件列表<br>dpkg –contents package.deb 显示尚未安装的一个包所提供的文件列表<br>dpkg -S &#x2F;bin&#x2F;ping 确认所给的文件由哪个 deb 包提供</p>
<h3 id="APT-软件工具-Debian-Ubuntu-以及类似系统"><a href="#APT-软件工具-Debian-Ubuntu-以及类似系统" class="headerlink" title="APT 软件工具 (Debian, Ubuntu 以及类似系统)"></a><strong>APT 软件工具 (Debian, Ubuntu 以及类似系统)</strong></h3><p>apt-get install package_name 安装&#x2F;更新一个 deb 包<br>apt-cdrom install package_name 从光盘安装&#x2F;更新一个 deb 包<br>apt-get update 升级列表中的软件包<br>apt-get upgrade 升级所有已安装的软件<br>apt-get remove package_name 从系统删除一个 deb 包<br>apt-get check 确认依赖的软件仓库正确<br>apt-get clean 从下载的软件包中清理缓存<br>apt-cache search searched-package 返回包含所要搜索字符串的软件包名称</p>
<h3 id="查看文件内容"><a href="#查看文件内容" class="headerlink" title="查看文件内容"></a><strong>查看文件内容</strong></h3><p>cat file1 从第一个字节开始正向查看文件的内容<br>tac file1 从最后一行开始反向查看一个文件的内容<br>more file1 查看一个长文件的内容<br>less file1 类似于 ‘more’ 命令，但是它允许在文件中和正向操作一样的反向操作<br>head -2 file1 查看一个文件的前两行<br>tail -2 file1 查看一个文件的最后两行<br>tail -f &#x2F;var&#x2F;log&#x2F;messages 实时查看被添加到一个文件中的内容</p>
<h3 id="文本处理"><a href="#文本处理" class="headerlink" title="文本处理"></a><strong>文本处理</strong></h3><p>cat file1 file2 … | command &lt;&gt; file1_in.txt_or_file1_out.txt general syntax for text manipulation using PIPE, STDIN and STDOUT<br>cat file1 | command( sed, grep, awk, grep, etc…) &gt; result.txt 合并一个文件的详细说明文本，并将简介写入一个新文件中<br>cat file1 | command( sed, grep, awk, grep, etc…) &gt;&gt; result.txt 合并一个文件的详细说明文本，并将简介写入一个已有的文件中<br>grep Aug &#x2F;var&#x2F;log&#x2F;messages 在文件 ‘&#x2F;var&#x2F;log&#x2F;messages’中查找关键词”Aug”<br>grep ^Aug &#x2F;var&#x2F;log&#x2F;messages 在文件 ‘&#x2F;var&#x2F;log&#x2F;messages’中查找以”Aug”开始的词汇<br>grep [0-9] &#x2F;var&#x2F;log&#x2F;messages 选择 ‘&#x2F;var&#x2F;log&#x2F;messages’ 文件中所有包含数字的行<br>grep Aug -R &#x2F;var&#x2F;log&#x2F;_ 在目录 ‘&#x2F;var&#x2F;log’ 及随后的目录中搜索字符串”Aug”<br>sed ‘s&#x2F;stringa1&#x2F;stringa2&#x2F;g’ example.txt 将 example.txt 文件中的 “string1” 替换成 “string2”<br>sed ‘&#x2F;^$&#x2F;d’ example.txt 从 example.txt 文件中删除所有空白行<br>sed ‘&#x2F; _#&#x2F;d; &#x2F;^$&#x2F;d’ example.txt 从example.txt文件中删除所有注释和空白行<br>echo ‘esempio’ | tr ‘[:lower:]’ ‘[:upper:]’ 合并上下单元格内容<br>sed -e ‘1d’ result.txt 从文件example.txt 中排除第一行<br>sed -n ‘&#x2F;stringa1&#x2F;p’ 查看只包含词汇 “string1”的行<br>sed -e ‘s&#x2F; *$&#x2F;&#x2F;‘ example.txt 删除每一行最后的空白字符<br>sed -e ‘s&#x2F;stringa1&#x2F;&#x2F;g’ example.txt 从文档中只删除词汇 “string1” 并保留剩余全部<br>sed -n ‘1,5p;5q’ example.txt 查看从第一行到第 5 行内容<br>sed -n ‘5p;5q’ example.txt 查看第 5 行<br>sed -e ‘s&#x2F;00*&#x2F;0&#x2F;g’ example.txt 用单个零替换多个零<br>cat -n file1 标示文件的行数<br>cat example.txt | awk ‘NR%2&#x3D;&#x3D;1’ 删除 example.txt 文件中的所有偶数行<br>echo a b c | awk ‘{print $1}’ 查看一行第一栏<br>echo a b c | awk ‘{print $1,$3}’ 查看一行的第一和第三栏<br>paste file1 file2 合并两个文件或两栏的内容<br>paste -d ‘+’ file1 file2 合并两个文件或两栏的内容，中间用”+”区分<br>sort file1 file2 排序两个文件的内容<br>sort file1 file2 | uniq 取出两个文件的并集(重复的行只保留一份)<br>sort file1 file2 | uniq -u 删除交集，留下其他的行<br>sort file1 file2 | uniq -d 取出两个文件的交集(只留下同时存在于两个文件中的文件)<br>comm -1 file1 file2 比较两个文件的内容只删除 ‘file1’ 所包含的内容<br>comm -2 file1 file2 比较两个文件的内容只删除 ‘file2’ 所包含的内容<br>comm -3 file1 file2 比较两个文件的内容只删除两个文件共有的部分</p>
<h3 id="字符设置和文件格式转换"><a href="#字符设置和文件格式转换" class="headerlink" title="字符设置和文件格式转换"></a><strong>字符设置和文件格式转换</strong></h3><p>dos2unix filedos.txt fileunix.txt 将一个文本文件的格式从 MSDOS 转换成 UNIX<br>unix2dos fileunix.txt filedos.txt 将一个文本文件的格式从 UNIX 转换成 MSDOS<br>recode ..HTML &lt; page.txt &gt; page.html 将一个文本文件转换成 html<br>recode -l | more 显示所有允许的转换格式</p>
<h3 id="文件系统分析"><a href="#文件系统分析" class="headerlink" title="文件系统分析"></a><strong>文件系统分析</strong></h3><p>badblocks -v &#x2F;dev&#x2F;hda1 检查磁盘 hda1 上的坏磁块<br>fsck &#x2F;dev&#x2F;hda1 修复&#x2F;检查 hda1 磁盘上 linux 文件系统的完整性<br>fsck.ext2 &#x2F;dev&#x2F;hda1 修复&#x2F;检查 hda1 磁盘上 ext2 文件系统的完整性<br>e2fsck &#x2F;dev&#x2F;hda1 修复&#x2F;检查 hda1 磁盘上 ext2 文件系统的完整性<br>e2fsck -j &#x2F;dev&#x2F;hda1 修复&#x2F;检查 hda1 磁盘上 ext3 文件系统的完整性<br>fsck.ext3 &#x2F;dev&#x2F;hda1 修复&#x2F;检查 hda1 磁盘上 ext3 文件系统的完整性<br>fsck.vfat &#x2F;dev&#x2F;hda1 修复&#x2F;检查 hda1 磁盘上 fat 文件系统的完整性<br>fsck.msdos &#x2F;dev&#x2F;hda1 修复&#x2F;检查 hda1 磁盘上 dos 文件系统的完整性<br>dosfsck &#x2F;dev&#x2F;hda1 修复&#x2F;检查 hda1 磁盘上 dos 文件系统的完整性</p>
<h3 id="初始化一个文件系统"><a href="#初始化一个文件系统" class="headerlink" title="初始化一个文件系统"></a><strong>初始化一个文件系统</strong></h3><p>mkfs &#x2F;dev&#x2F;hda1 在 hda1 分区创建一个文件系统<br>mke2fs &#x2F;dev&#x2F;hda1 在 hda1 分区创建一个 linux ext2 的文件系统<br>mke2fs -j &#x2F;dev&#x2F;hda1 在 hda1 分区创建一个 linux ext3(日志型)的文件系统<br>mkfs -t vfat 32 -F &#x2F;dev&#x2F;hda1 创建一个 FAT32 文件系统<br>fdformat -n &#x2F;dev&#x2F;fd0 格式化一个软盘<br>mkswap &#x2F;dev&#x2F;hda3 创建一个 swap 文件系统</p>
<h3 id="SWAP-文件系统"><a href="#SWAP-文件系统" class="headerlink" title="SWAP 文件系统"></a><strong>SWAP 文件系统</strong></h3><p>mkswap &#x2F;dev&#x2F;hda3 创建一个 swap 文件系统<br>swapon &#x2F;dev&#x2F;hda3 启用一个新的 swap 文件系统<br>swapon &#x2F;dev&#x2F;hda2 &#x2F;dev&#x2F;hdb3 启用两个 swap 分区</p>
<h3 id="备份"><a href="#备份" class="headerlink" title="备份"></a><strong>备份</strong></h3><p>dump -0aj -f &#x2F;tmp&#x2F;home0.bak &#x2F;home 制作一个 ‘&#x2F;home’ 目录的完整备份<br>dump -1aj -f &#x2F;tmp&#x2F;home0.bak &#x2F;home 制作一个 ‘&#x2F;home’ 目录的交互式备份<br>restore -if &#x2F;tmp&#x2F;home0.bak 还原一个交互式备份<br>rsync -rogpav –delete &#x2F;home &#x2F;tmp 同步两边的目录<br>rsync -rogpav -e ssh –delete &#x2F;home ip_address:&#x2F;tmp 通过 SSH 通道 rsync<br>rsync -az -e ssh –delete ip_addr:&#x2F;home&#x2F;public &#x2F;home&#x2F;local 通过 ssh 和压缩将一个远程目录同步到本地目录<br>rsync -az -e ssh –delete &#x2F;home&#x2F;local ip_addr:&#x2F;home&#x2F;public 通过 ssh 和压缩将本地目录同步到远程目录<br>dd bs&#x3D;1M if&#x3D;&#x2F;dev&#x2F;hda | gzip | ssh user@ip_addr ‘dd of&#x3D;hda.gz’ 通过 ssh 在远程主机上执行一次备份本地磁盘的操作<br>dd if&#x3D;&#x2F;dev&#x2F;sda of&#x3D;&#x2F;tmp&#x2F;file1 备份磁盘内容到一个文件<br>tar -Puf backup.tar &#x2F;home&#x2F;user 执行一次对 ‘&#x2F;home&#x2F;user’ 目录的交互式备份操作<br>( cd &#x2F;tmp&#x2F;local&#x2F; &amp;&amp; tar c . ) | ssh -C user@ip_addr ‘cd &#x2F;home&#x2F;share&#x2F; &amp;&amp; tar x -p’ 通过 ssh 在远程目录中复制一个目录内容<br>( tar c &#x2F;home ) | ssh -C user@ip_addr ‘cd &#x2F;home&#x2F;backup-home &amp;&amp; tar x -p’ 通过 ssh 在远程目录中复制一个本地目录<br>tar cf - . | (cd &#x2F;tmp&#x2F;backup ; tar xf - ) 本地将一个目录复制到另一个地方，保留原有权限及链接<br>find &#x2F;home&#x2F;user1 -name ‘<em>.txt’ | xargs cp -av –target-directory&#x3D;&#x2F;home&#x2F;backup&#x2F; –parents 从一个目录查找并复制所有以 ‘.txt’ 结尾的文件到另一个目录<br>find &#x2F;var&#x2F;log -name ‘</em>.log’ | tar cv –files-from&#x3D;- | bzip2 &gt; log.tar.bz2 查找所有以 ‘.log’ 结尾的文件并做成一个 bzip 包<br>dd if&#x3D;&#x2F;dev&#x2F;hda of&#x3D;&#x2F;dev&#x2F;fd0 bs&#x3D;512 count&#x3D;1 做一个将 MBR (Master Boot Record)内容复制到软盘的动作<br>dd if&#x3D;&#x2F;dev&#x2F;fd0 of&#x3D;&#x2F;dev&#x2F;hda bs&#x3D;512 count&#x3D;1 从已经保存到软盘的备份中恢复 MBR 内容</p>
<h3 id="光盘"><a href="#光盘" class="headerlink" title="光盘"></a><strong>光盘</strong></h3><p>cdrecord -v gracetime&#x3D;2 dev&#x3D;&#x2F;dev&#x2F;cdrom -eject blank&#x3D;fast -force 清空一个可复写的光盘内容<br>mkisofs &#x2F;dev&#x2F;cdrom &gt; cd.iso 在磁盘上创建一个光盘的 iso 镜像文件<br>mkisofs &#x2F;dev&#x2F;cdrom | gzip &gt; cd_iso.gz 在磁盘上创建一个压缩了的光盘 iso 镜像文件<br>mkisofs -J -allow-leading-dots -R -V “Label CD” -iso-level 4 -o .&#x2F;cd.iso data_cd 创建一个目录的 iso 镜像文件<br>cdrecord -v dev&#x3D;&#x2F;dev&#x2F;cdrom cd.iso 刻录一个 ISO 镜像文件<br>gzip -dc cd_iso.gz | cdrecord dev&#x3D;&#x2F;dev&#x2F;cdrom - 刻录一个压缩了的 ISO 镜像文件<br>mount -o loop cd.iso &#x2F;mnt&#x2F;iso 挂载一个 ISO 镜像文件<br>cd-paranoia -B 从一个 CD 光盘转录音轨到 wav 文件中<br>cd-paranoia – “-3” 从一个 CD 光盘转录音轨到 wav 文件中（参数-3）<br>cdrecord –scanbus 扫描总线以识别 scsi 通道<br>dd if&#x3D;&#x2F;dev&#x2F;hdc | md5sum 校验一个设备的 md5sum 编码，例如一张 CD</p>
<h3 id="网络-（以太网和-WIFI-无线）"><a href="#网络-（以太网和-WIFI-无线）" class="headerlink" title="网络 - （以太网和 WIFI 无线）"></a><strong>网络 - （以太网和 WIFI 无线</strong>）</h3><p>ifconfig eth0 显示一个以太网卡的配置<br>ifup eth0 启用一个 ‘eth0’ 网络设备<br>ifdown eth0 禁用一个 ‘eth0’ 网络设备<br>ifconfig eth0 192.168.1.1 netmask 255.255.255.0 控制 IP 地址<br>ifconfig eth0 promisc 设置 ‘eth0’ 成混杂模式以嗅探数据包 (sniffing)<br>dhclient eth0 以 dhcp 模式启用 ‘eth0’<br>route -n show routing table<br>route add -net 0&#x2F;0 gw IP_Gateway configura default gateway<br>route add -net 192.168.0.0 netmask 255.255.0.0 gw 192.168.1.1 configure static route to reach network ‘192.168.0.0&#x2F;16’<br>route del 0&#x2F;0 gw IP_gateway remove static route<br>echo “1” &gt; &#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;ip_forward activate ip routing<br>hostname show hostname of system<br>host <a href="http://www.example.com/">www.example.com</a> lookup hostname to resolve name to ip address and viceversa<br>nslookup <a href="http://www.example.com/">www.example.com</a> lookup hostname to resolve name to ip address and viceversa<br>ip link show show link status of all interfaces<br>mii-tool eth0 show link status of ‘eth0’<br>ethtool eth0 show statistics of network card ‘eth0’<br>netstat -tup show all active network connections and their PID<br>netstat -tupl show all network services listening on the system and their PID<br>tcpdump tcp port 80 show all HTTP traffic<br>iwlist scan show wireless networks<br>iwconfig eth1 show configuration of a wireless network card<br>hostname show hostname<br>host <a href="http://www.example.com/">www.example.com</a> lookup hostname to resolve name to ip address and viceversa<br>nslookup <a href="http://www.example.com/">www.example.com</a> lookup hostname to resolve name to ip address and viceversa<br>whois <a href="http://www.example.com/">www.example.com</a> lookup on Whois database</p>
<h3 id="JPS-工具"><a href="#JPS-工具" class="headerlink" title="JPS 工具"></a><strong>JPS 工具</strong></h3><p>jps(Java Virtual Machine Process Status Tool)是 JDK 1.5 提供的一个显示当前所有 java 进程 pid 的命令，简单实用，非常适合在 linux&#x2F;unix 平台上简单察看当前 java 进程的一些简单情况。</p>
<p>我想很多人都是用过 unix 系统里的 ps 命令，这个命令主要是用来显示当前系统的进程情况，有哪些进程，及其 id。 jps 也是一样，它的作用是显示当前系统的 java 进程情况，及其 id 号。我们可以通过它来查看我们到底启动了几个 java 进程（因为每一个 java 程序都会独占一个 java 虚拟机实例），和他们的进程号（为下面几个程序做准备），并可通过 opt 来查看这些进程的详细启动参数。</p>
<p><strong>使用方法：在当前命令行下打 jps(需要 JAVA_HOME，没有的话，到改程序的目录下打) 。</strong></p>
<p><strong>jps 存放在 JAVA_HOME&#x2F;bin&#x2F;jps，使用时为了方便请将 JAVA_HOME&#x2F;bin&#x2F;加入到 Path.</strong></p>
<p>$&gt; <strong>jps</strong><br>23991 Jps<br>23789 BossMain<br>23651 Resin</p>
<p>比较常用的参数：</p>
<p><strong>-q 只显示 pid，不显示 class 名称,jar 文件名和传递给 main 方法的参数</strong><br>$&gt; <strong>jps -q</strong><br>28680<br>23789<br>23651</p>
<p><strong>-m 输出传递给 main 方法的参数，在嵌入式 jvm 上可能是 null</strong></p>
<p>$&gt; <strong>jps -m</strong><br>28715 Jps -m<br>23789 BossMain<br>23651 Resin -socketwait 32768 -stdout &#x2F;data&#x2F;aoxj&#x2F;resin&#x2F;log&#x2F;stdout.log -stderr &#x2F;data&#x2F;aoxj&#x2F;resin&#x2F;log&#x2F;stderr.log</p>
<p><strong>-l 输出应用程序 main class 的完整 package 名 或者 应用程序的 jar 文件完整路径名</strong></p>
<p>$&gt; <strong>jps -l</strong><br>28729 sun.tools.jps.Jps<br>23789 com.asiainfo.aimc.bossbi.BossMain<br>23651 com.caucho.server.resin.Resin</p>
<p><strong>-v 输出传递给 JVM 的参数</strong></p>
<p>$&gt; <strong>jps -v</strong><br>23789 BossMain<br>28802 Jps -Denv.class.path&#x3D;&#x2F;data&#x2F;aoxj&#x2F;bossbi&#x2F;twsecurity&#x2F;java&#x2F;trustwork140.jar:&#x2F;data&#x2F;aoxj&#x2F;bossbi&#x2F;twsecurity&#x2F;java&#x2F;:&#x2F;data&#x2F;aoxj&#x2F;bossbi&#x2F;twsecurity&#x2F;java&#x2F;twcmcc.jar:&#x2F;data&#x2F;aoxj&#x2F;jdk15&#x2F;lib&#x2F;rt.jar:&#x2F;data&#x2F;aoxj&#x2F;jd</p>
<p>k15&#x2F;lib&#x2F;tools.jar -Dapplication.home&#x3D;&#x2F;data&#x2F;aoxj&#x2F;jdk15 -Xms8m<br>23651 Resin -Xss1m -Dresin.home&#x3D;&#x2F;data&#x2F;aoxj&#x2F;resin -Dserver.root&#x3D;&#x2F;data&#x2F;aoxj&#x2F;resin -Djava.util.logging.manager&#x3D;com.caucho.log.LogManagerImpl -</p>
<p>Djavax.management.builder.initial&#x3D;com.caucho.jmx.MBeanServerBuilderImpl</p>
<p><strong>sudo jps 看到的进程数量最全</strong></p>
<p><strong>jps 192.168.0.77</strong></p>
<p><strong>列出远程服务器 192.168.0.77 机器所有的 jvm 实例，采用 rmi 协议，默认连接端口为 1099</strong></p>
<p><strong>（前提是远程服务器提供 jstatd 服务）</strong></p>
<p><strong>注：jps 命令有个地方很不好，似乎只能显示当前用户的 java 进程，要显示其他用户的还是只能用 unix&#x2F;linux 的 ps 命令。</strong></p>
<p>详细情况请参考 sun 官方文档。<br><a href="http://java.sun.com/j2se/1.5.0/docs/tooldocs/share/jps.html">http://java.sun.com/j2se/1.7.0/docs/tooldocs/share/jps.html</a></p>
<p>GO TOP INDEX ^<br>Microsoft Windows networks (SAMBA)<br>nbtscan ip_addr netbios name resolution<br>nmblookup -A ip_addr netbios name resolution<br>smbclient -L ip_addr&#x2F;hostname show remote shares of a windows host<br>smbget -Rr smb:&#x2F;&#x2F;ip_addr&#x2F;share like wget can download files from a host windows via smb<br>mount -t smbfs -o username&#x3D;user,password&#x3D;pass &#x2F;&#x2F;WinClient&#x2F;share &#x2F;mnt&#x2F;share mount a windows network share</p>
<p>A man must be on his own！</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>NexT主题的设置 - hexo新版主题next7.x设置</title>
    <url>/2020/08/01/Hexo/next%E4%B8%BB%E9%A2%98%E7%9A%84%E8%AE%BE%E7%BD%AE/</url>
    <content><![CDATA[<h1 id="hexo-新版主题-next7-x-设置"><a href="#hexo-新版主题-next7-x-设置" class="headerlink" title="hexo 新版主题 next7.x 设置"></a>hexo 新版主题 next7.x 设置</h1><p>内容提要</p>
<ul>
<li><p>开启赞赏打赏码</p>
</li>
<li><p>设置阅读时长和本文字数</p>
</li>
<li><p>添加背景动画效果</p>
</li>
<li><p>阅读全文设置</p>
</li>
<li><p>阅读全文 去掉自动定位 more</p>
</li>
<li><p>修改文章及主题样式</p>
</li>
<li><p>代码段调整上下行距及样式</p>
</li>
<li><p>代码块背景色缺失问题</p>
</li>
</ul>
<span id="more"></span>

<h2 id="开启赞赏打赏码"><a href="#开启赞赏打赏码" class="headerlink" title="开启赞赏打赏码"></a>开启赞赏打赏码</h2><h3 id="1-获取支付宝和微信打赏码"><a href="#1-获取支付宝和微信打赏码" class="headerlink" title="1.获取支付宝和微信打赏码"></a>1.获取支付宝和微信打赏码</h3><ul>
<li>支付宝打赏码<ul>
<li><a href="https://qr.alipay.com/paipai/open.htm">https://qr.alipay.com/paipai/open.htm</a></li>
</ul>
</li>
<li>微信打赏码<ul>
<li>打开手机微信</li>
<li>选择我的–支付</li>
<li>选择收付款–赞赏码</li>
<li>生成</li>
</ul>
</li>
</ul>
<h3 id="2-把生成的二维码下载放到-next-主题"><a href="#2-把生成的二维码下载放到-next-主题" class="headerlink" title="2.把生成的二维码下载放到 next 主题"></a>2.把生成的二维码下载放到 next 主题</h3><ul>
<li>放到 themes\next\source\images 文件夹中</li>
</ul>
<h3 id="3-配置主题-config-yml"><a href="#3-配置主题-config-yml" class="headerlink" title="3.配置主题_config.yml"></a>3.配置主题_config.yml</h3><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">reward_settings:</span></span><br><span class="line">  <span class="comment"># If true, reward will be displayed in every article by default.</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">animation:</span> <span class="literal">false</span> <span class="comment">#是否开启动画效果 可以自己调整样式</span></span><br><span class="line">  <span class="attr">comment:</span> <span class="string">原创技术分享，您的支持将鼓励我继续创作!</span></span><br><span class="line"></span><br><span class="line"><span class="attr">reward:</span></span><br><span class="line">  <span class="attr">wechatpay:</span> <span class="string">/images/wechatpay.png</span></span><br><span class="line">  <span class="attr">alipay:</span> <span class="string">/images/alipay.png</span></span><br><span class="line">  <span class="comment">#paypal: /images/paypal.png</span></span><br><span class="line">  <span class="comment">#bitcoin: /images/bitcoin.png</span></span><br></pre></td></tr></table></figure>

<h3 id="4-修改按钮样式"><a href="#4-修改按钮样式" class="headerlink" title="4.修改按钮样式"></a>4.修改按钮样式</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">//路径 next/source/css/_common/components/post/post-reward<span class="selector-class">.styl</span></span><br><span class="line">//简单的改了一下按钮样式</span><br><span class="line"><span class="selector-tag">button</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: transparent;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#fc6423</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fc6423</span>;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">outline</span>: none;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">15px</span>;</span><br><span class="line">  <span class="attribute">vertical-align</span>: text-top;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#fc6423</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid transparent;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-展示效果"><a href="#5-展示效果" class="headerlink" title="5.展示效果"></a>5.展示效果</h3><p><img data-src="https://bitbw.top/public/img/my_gallery/image-20200801125315315.png" alt="image-20200801125315315"></p>
<h2 id="设置阅读时长和本文字数"><a href="#设置阅读时长和本文字数" class="headerlink" title="设置阅读时长和本文字数"></a>设置阅读时长和本文字数</h2><h3 id="1-配置主题-config-yml"><a href="#1-配置主题-config-yml" class="headerlink" title="1.配置主题_config.yml"></a>1.配置主题_config.yml</h3><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">symbols_count_time:</span></span><br><span class="line">  <span class="attr">separated_meta:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">item_text_post:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">item_text_total:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">awl:</span> <span class="number">2</span> <span class="comment">#平均字长</span></span><br><span class="line">  <span class="attr">wpm:</span> <span class="number">200</span> <span class="comment">#每分钟字数</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>详细配置介绍 <a href="https://github.com/theme-next/hexo-symbols-count-time">https://github.com/theme-next/hexo-symbols-count-time</a></p>
</blockquote>
<h3 id="2-对应文字修改"><a href="#2-对应文字修改" class="headerlink" title="2.对应文字修改"></a>2.对应文字修改</h3><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#路径 next\languages\zh-CN.yml</span></span><br><span class="line"><span class="attr">symbols_count_time:</span></span><br><span class="line">  <span class="attr">count:</span> <span class="string">本文字数</span></span><br><span class="line">  <span class="attr">count_total:</span> <span class="string">站点总字数</span></span><br><span class="line">  <span class="attr">time:</span> <span class="string">阅读时长</span></span><br><span class="line">  <span class="attr">time_total:</span> <span class="string">站点阅读时长</span></span><br><span class="line">  <span class="attr">time_minutes:</span> <span class="string">分钟</span></span><br></pre></td></tr></table></figure>

<h3 id="3-展示效果"><a href="#3-展示效果" class="headerlink" title="3.展示效果"></a>3.展示效果</h3><p><img data-src="https://bitbw.top/public/img/my_gallery/image-20200801130036785.png" alt="image-20200801130036785"></p>
<h2 id="设置阅读次数和评论"><a href="#设置阅读次数和评论" class="headerlink" title="设置阅读次数和评论"></a>设置阅读次数和评论</h2><h3 id="建议添加-gitalk-评论系统"><a href="#建议添加-gitalk-评论系统" class="headerlink" title="建议添加 gitalk 评论系统"></a>建议添加 gitalk 评论系统</h3><p>参考文章：<a href="https://www.jianshu.com/p/02fc71f3633f">https://www.jianshu.com/p/02fc71f3633f</a></p>
<h3 id="展示效果"><a href="#展示效果" class="headerlink" title="展示效果"></a>展示效果</h3><p><img data-src="https://bitbw.top/public/img/my_gallery/image-20200916135526251.png" alt="image-20200916135526251"></p>
<h3 id="显示阅读次数"><a href="#显示阅读次数" class="headerlink" title="显示阅读次数"></a>显示阅读次数</h3><p>1.配置主题_config.yml</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">busuanzi_count:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">total_visitors:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">total_visitors_icon:</span> <span class="string">fa</span> <span class="string">fa-user</span></span><br><span class="line">  <span class="attr">total_views:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">total_views_icon:</span> <span class="string">fa</span> <span class="string">fa-eye</span></span><br><span class="line">  <span class="attr">post_views:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">post_views_icon:</span> <span class="string">fa</span> <span class="string">fa-eye</span></span><br></pre></td></tr></table></figure>

<h3 id="展示效果-1"><a href="#展示效果-1" class="headerlink" title="展示效果"></a>展示效果</h3><p><img data-src="https://bitbw.top/public/img/my_gallery/image-20200916135902653.png" alt="image-20200916135902653"></p>
<h2 id="添加背景动画效果"><a href="#添加背景动画效果" class="headerlink" title="添加背景动画效果"></a>添加背景动画效果</h2><h3 id="1-配置主题-config-yml-1"><a href="#1-配置主题-config-yml-1" class="headerlink" title="1.配置主题_config.yml"></a>1.配置主题_config.yml</h3><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 进度条</span></span><br><span class="line"><span class="comment"># Progress bar in the top during page loading.</span></span><br><span class="line"><span class="comment"># Dependencies: https://github.com/theme-next/theme-next-pace  更改配置详情看github说明</span></span><br><span class="line"><span class="comment"># For more information: https://github.com/HubSpot/pace</span></span><br><span class="line"><span class="attr">pace:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Themes list:</span></span><br><span class="line">  <span class="comment"># big-counter | bounce | barber-shop | center-atom | center-circle | center-radar | center-simple</span></span><br><span class="line">  <span class="comment"># corner-indicator | fill-left | flat-top | flash | loading-bar | mac-osx | material | minimal</span></span><br><span class="line">  <span class="attr">theme:</span> <span class="string">minimal</span></span><br><span class="line"><span class="comment"># 3D背景</span></span><br><span class="line"><span class="comment"># JavaScript 3D library.</span></span><br><span class="line"><span class="comment"># Dependencies: https://github.com/theme-next/theme-next-three  更改配置详情看github说明</span></span><br><span class="line"><span class="attr">three:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">three_waves:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">canvas_lines:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">canvas_sphere:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># 彩带背景</span></span><br><span class="line"><span class="comment"># Canvas-ribbon</span></span><br><span class="line"><span class="comment"># Dependencies: https://github.com/theme-next/theme-next-canvas-ribbon 更改配置详情看github说明</span></span><br><span class="line"><span class="comment"># For more information: https://github.com/zproo/canvas-ribbon</span></span><br><span class="line"><span class="attr">canvas_ribbon:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">size:</span> <span class="number">300</span> <span class="comment"># The width of the ribbon</span></span><br><span class="line">  <span class="attr">alpha:</span> <span class="number">0.6</span> <span class="comment"># The transparency of the ribbon</span></span><br><span class="line">  <span class="attr">zIndex:</span> <span class="number">-1</span> <span class="comment"># The display level of the ribbo</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#关键配置CDN</span></span><br><span class="line"><span class="attr">vendors:</span></span><br><span class="line">  <span class="comment"># 进度条</span></span><br><span class="line">  <span class="attr">pace:</span> <span class="string">//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js</span></span><br><span class="line">  <span class="attr">pace_css:</span> <span class="string">//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css</span></span><br><span class="line">  <span class="comment"># 3D背景</span></span><br><span class="line">  <span class="attr">three:</span> <span class="string">//cdn.jsdelivr.net/gh/theme-next/theme-next-three@1/three.min.js</span></span><br><span class="line">  <span class="attr">three_waves:</span> <span class="string">//cdn.jsdelivr.net/gh/theme-next/theme-next-three@1/three-waves.min.js</span></span><br><span class="line">  <span class="attr">canvas_lines:</span> <span class="string">//cdn.jsdelivr.net/gh/theme-next/theme-next-three@1/canvas_lines.min.js</span></span><br><span class="line">  <span class="attr">canvas_sphere:</span> <span class="string">//cdn.jsdelivr.net/gh/theme-next/theme-next-three@1/canvas_sphere.min.js</span></span><br><span class="line">  <span class="comment"># 彩带背景</span></span><br><span class="line">  <span class="attr">canvas_ribbon:</span> <span class="string">//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-ribbon@1/canvas-ribbon.js</span></span><br></pre></td></tr></table></figure>

<h3 id="2-本地查看效果"><a href="#2-本地查看效果" class="headerlink" title="2.本地查看效果"></a>2.本地查看效果</h3><ol>
<li>转到 NexT 目录</li>
</ol>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">$ cd themes/next</span><br><span class="line">$ ls</span><br><span class="line">_config<span class="selector-class">.yml</span>  crowdin<span class="selector-class">.yml</span>  docs  gulpfile<span class="selector-class">.js</span>  languages  layout  LICENSE<span class="selector-class">.md</span>  package<span class="selector-class">.json</span>  README<span class="selector-class">.md</span>  scripts  source</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>将模块安装到<code>source/lib</code>目录</li>
</ol>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">git clone https:<span class="regexp">//gi</span>thub.com<span class="regexp">/theme-next/</span>theme-<span class="keyword">next</span>-three source<span class="regexp">/lib/</span>three</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>启动服务查看效果</li>
</ol>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">hexo s</span></span><br></pre></td></tr></table></figure>

<h3 id="3-展示效果-1"><a href="#3-展示效果-1" class="headerlink" title="3.展示效果"></a>3.展示效果</h3><p><img data-src="https://bitbw.top/public/img/my_gallery/next%E8%83%8C%E6%99%AF%E5%BD%A9%E5%B8%A6%E5%B1%95%E7%A4%BA%E6%95%88%E6%9E%9C.gif" alt="next背景彩带展示效果"></p>
<h2 id="阅读全文设置"><a href="#阅读全文设置" class="headerlink" title="阅读全文设置"></a>阅读全文设置</h2><h3 id="1-配置主题-config-yml-2"><a href="#1-配置主题-config-yml-2" class="headerlink" title="1.配置主题_config.yml"></a>1.配置主题_config.yml</h3><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Automatically excerpt description in homepage as preamble text.  自动摘要</span></span><br><span class="line"><span class="attr">excerpt_description:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># Read more button</span></span><br><span class="line"><span class="comment"># If true, the read more button will be displayed in excerpt section. 显示阅读全文按钮</span></span><br><span class="line"><span class="attr">read_more_btn:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="2-install-自动摘录生成器"><a href="#2-install-自动摘录生成器" class="headerlink" title="2.install 自动摘录生成器"></a>2.install 自动摘录生成器</h3><figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">npm install hexo-excerpt <span class="comment">--save</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li><p>比较不好的一点是这个只能自动读取摘要 不是很智能 ，读取的摘要狠多 ，推荐编写文章时自己设置摘要</p>
</li>
<li><p>若想保留了样式并且自行选择显示哪些内容来预览。就可以在写 md 博文时，在想要显示预览的部分后加上<code>&lt;I--more--&gt;</code>，这样这样首页和列表页展示的文章内容就是<code>&lt;!--more--&gt;</code>之前的文字，而之后的就不会显示了，同时也保留文章原样式。</p>
</li>
</ul>
</blockquote>
<h3 id="3-展示效果-2"><a href="#3-展示效果-2" class="headerlink" title="3.展示效果"></a>3.展示效果</h3><p><img data-src="https://bitbw.top/public/img/my_gallery/image-20200801163505378.png" alt="image-20200801163505378"></p>
<h2 id="阅读全文-去掉自动定位-more"><a href="#阅读全文-去掉自动定位-more" class="headerlink" title="阅读全文 去掉自动定位 more"></a>阅读全文 去掉自动定位 more</h2><p>老版本中可以使用<code>scroll_to_more: false</code> 这个选项</p>
<p>最新版本已经移除此选项，官方认为 scroll_to_more 是个默认行为 for 任何 hexo 主题</p>
<p>新版本解决方案：强制修改\themes\next\layout_macro\post.swig 中</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a class=&quot;btn&quot; href=&quot;&#123;&#123; url_for(post.path) &#125;&#125;#more&quot; rel=&quot;contents&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>修改为 去除#more 锚点即可</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(post.path) &#125;&#125;&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;contents&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="修改文章及主题样式"><a href="#修改文章及主题样式" class="headerlink" title="修改文章及主题样式"></a>修改文章及主题样式</h2><h3 id="修改文件位置"><a href="#修改文件位置" class="headerlink" title="修改文件位置"></a>修改文件位置</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">//themes\next\source\css\_common\scaffolding\base<span class="selector-class">.styl</span></span><br><span class="line">//将样式手动调整</span><br><span class="line">//修改行距只需要修改<span class="selector-tag">p</span>标签的<span class="attribute">margin</span></span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">//引用样式调整</span><br><span class="line"><span class="selector-tag">blockquote</span> &#123;</span><br><span class="line">  <span class="attribute">border-left</span>: <span class="number">4px</span> solid $grey-lighter;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--blockquote-color);</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">15px</span>;</span><br><span class="line"></span><br><span class="line">  <span class="selector-tag">cite</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&quot;-&quot;</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">5px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="代码段调整上下行距及样式"><a href="#代码段调整上下行距及样式" class="headerlink" title="代码段调整上下行距及样式"></a>代码段调整上下行距及样式</h2><h3 id="1-配置主题-config-yml-3"><a href="#1-配置主题-config-yml-3" class="headerlink" title="1.配置主题_config.yml"></a>1.配置主题_config.yml</h3><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#代码块样式</span></span><br><span class="line"><span class="attr">codeblock:</span></span><br><span class="line">  <span class="comment"># Code Highlight theme</span></span><br><span class="line">  <span class="comment"># Available values: normal | night | night eighties | night blue | night bright | solarized | solarized dark | galactic</span></span><br><span class="line">  <span class="comment"># See: https://github.com/chriskempson/tomorrow-theme  白色主题 normal</span></span><br><span class="line">  <span class="attr">highlight_theme:</span> <span class="string">normal</span></span><br><span class="line">  <span class="comment"># Add copy button on codeblock 复制按钮</span></span><br><span class="line">  <span class="attr">copy_button:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># Show text copy result.</span></span><br><span class="line">    <span class="attr">show_result:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># Available values: default | flat | mac</span></span><br><span class="line">    <span class="attr">style:</span> <span class="string">mac</span></span><br></pre></td></tr></table></figure>

<h3 id="2-调整样式文件"><a href="#2-调整样式文件" class="headerlink" title="2.调整样式文件"></a>2.调整样式文件</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//文件位置：themes\next\source\css\_common\scaffolding\highlight\highlight.styl</span></span><br></pre></td></tr></table></figure>

<p>搜索 pre 将对应的 padding 值调整为自己想要的样式</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">pre &#123;</span><br><span class="line">  <span class="keyword">@extend</span> $code-block;</span><br><span class="line">  <span class="attribute">overflow</span>: auto;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">2px</span> <span class="number">10px</span>; //我这里上下调整为<span class="number">2px</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-展示效果-3"><a href="#3-展示效果-3" class="headerlink" title="3.展示效果"></a>3.展示效果</h3><p><img data-src="https://bitbw.top/public/img/my_gallery/image-20200801171206790.png" alt="image-20200801171206790"></p>
<h2 id="代码块背景色缺失问题"><a href="#代码块背景色缺失问题" class="headerlink" title="代码块背景色缺失问题"></a>代码块背景色缺失问题</h2><h3 id="1-问题展示"><a href="#1-问题展示" class="headerlink" title="1.问题展示"></a>1.问题展示</h3><blockquote>
<p>有时候编辑后的 md 文档会发生背景色缺失现象 如图</p>
</blockquote>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20200801172746730.png" alt="image-20200801172746730"></p>
<h3 id="2-形成原因"><a href="#2-形成原因" class="headerlink" title="2.形成原因"></a>2.形成原因</h3><blockquote>
<p>原因：编辑时回车 换行，会导致当前行渲染后元素高度无法达到正常高度，如图：</p>
</blockquote>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20200801175234139.png" alt="image-20200801175234139"></p>
<blockquote>
<p>正常的 pre 也就是当前行如图：</p>
</blockquote>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20200801175338090.png" alt="image-20200801175338090"></p>
<blockquote>
<p>而每行 tr 都有自己的背景色 （一般是白色），一但 pre 没有高度 ,就会造成背景色的混乱</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">//mian<span class="selector-class">.css</span> 下有段用于区分斑马纹表格和 hover样式的代码影响到了代码段的<span class="selector-tag">tr</span></span><br><span class="line"><span class="selector-tag">tbody</span> <span class="selector-tag">tr</span><span class="selector-pseudo">:nth-of-type</span>(odd) &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--table-row-odd-bg-color);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">tbody</span> <span class="selector-tag">tr</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--table-row-hover-bg-color);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-解决方案"><a href="#3-解决方案" class="headerlink" title="3.解决方案"></a>3.解决方案</h3><p><strong>1.在编辑 md 文档代码块时 回车换行都加个空格防止 pre 没有正常高度的情况</strong></p>
<blockquote>
<p>但是很麻烦 ， 所以还是用 css 调调样式吧</p>
<p>因为 pre 没有高度 tr 把背景色覆盖成了其他颜色， 但是 td 还是正常大小啊 ，把 td 的背景色调调成 pre 的就可以了</p>
</blockquote>
<p><strong>2.修改 css 样式</strong></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">//文件位置：themes\next\source\css\_common\scaffolding\highlight\highlight<span class="selector-class">.styl</span></span><br><span class="line">//找到<span class="selector-tag">td</span>修改样式</span><br><span class="line"><span class="selector-tag">td</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">background</span>: $highlight-background; //防止背景色缺失</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">td</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">background</span>: $highlight-background; //防止背景色缺失</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="字母溢出不自动换行问题"><a href="#字母溢出不自动换行问题" class="headerlink" title="字母溢出不自动换行问题"></a>字母溢出不自动换行问题</h2><blockquote>
<p>中文汉字不会溢出，英文字母会溢出<br>这个时候添加属性<br>word-break: break-all;<br><strong>修改 css 样式</strong></p>
</blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">// themes\next\source\css\_common\components\post\post-<span class="selector-tag">header</span><span class="selector-class">.styl</span></span><br><span class="line"><span class="selector-class">.posts-expand</span> <span class="selector-class">.post-title-link</span> &#123;</span><br><span class="line">  // ...</span><br><span class="line">  <span class="attribute">word-break</span>: break-all; // 添加样式防止字母不换行</span><br><span class="line">&#125;</span><br><span class="line">// themes\next\source\css\_common\components\post\post-<span class="selector-tag">header</span><span class="selector-class">.styl</span></span><br><span class="line"><span class="selector-class">.post-body</span> &#123;</span><br><span class="line">  // ...</span><br><span class="line">  <span class="attribute">word-break</span>: break-all; // 添加样式防止字母不换行</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Hexo-Next-主题博客提交百度谷歌收录"><a href="#Hexo-Next-主题博客提交百度谷歌收录" class="headerlink" title="Hexo + Next 主题博客提交百度谷歌收录"></a>Hexo + Next 主题博客提交百度谷歌收录</h2><p>原文地址：<a href="https://www.luanzhuxian.com/post/82d92ad4.html">https://www.luanzhuxian.com/post/82d92ad4.html</a></p>
<p>建议使用自动推送</p>
<p>也可以调用百度 api</p>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>next</tag>
        <tag>NexT</tag>
      </tags>
  </entry>
  <entry>
    <title>Nodejs常用方法</title>
    <url>/2022/03/07/Nodejs/nodejs%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<h2 id="路径是否存在，不存在则创建"><a href="#路径是否存在，不存在则创建" class="headerlink" title="路径是否存在，不存在则创建"></a>路径是否存在，不存在则创建</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>).<span class="property">promises</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 路径是否存在，不存在则创建</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; dir 路径</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">dirExists</span>(<span class="params">dir</span>) &#123;</span><br><span class="line">  <span class="comment">//如果该路径且不是文件，返回true</span></span><br><span class="line">  <span class="keyword">let</span> isExists;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    isExists = <span class="keyword">await</span> fs.<span class="title function_">stat</span>(dir);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[log][dirExists] path is not exist&quot;</span>);</span><br><span class="line">    <span class="comment">// 创建目录</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (isExists) &#123;</span><br><span class="line">    <span class="comment">//如果该路径存在但是文件，返回false</span></span><br><span class="line">    <span class="keyword">if</span> (isExists.<span class="title function_">isFile</span>()) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 存在返回 true</span></span><br><span class="line">    <span class="keyword">if</span> (isExists.<span class="title function_">isDirectory</span>()) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//如果该路径不存在</span></span><br><span class="line">  <span class="keyword">let</span> pDir = path.<span class="title function_">parse</span>(dir).<span class="property">dir</span>; <span class="comment">//拿到上级路径</span></span><br><span class="line">  <span class="comment">//递归判断，如果上级目录也不存在，则会代码会在此处继续循环执行，直到目录存在</span></span><br><span class="line">  <span class="keyword">let</span> status = <span class="keyword">await</span> <span class="title function_">dirExists</span>(pDir);</span><br><span class="line">  <span class="keyword">let</span> mkdirStatus;</span><br><span class="line">  <span class="keyword">if</span> (status) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      mkdirStatus = <span class="keyword">await</span> fs.<span class="title function_">mkdir</span>(dir);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[log] <span class="subst">$&#123;dir&#125;</span> created`</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="删除文件夹和内部所有文件"><a href="#删除文件夹和内部所有文件" class="headerlink" title="删除文件夹和内部所有文件"></a>删除文件夹和内部所有文件</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>); <span class="comment">//引入fs模块</span></span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>); <span class="comment">//引入path模块</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 删除文件夹和内部所有文件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; <span class="variable">dir</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">*</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">rmdirDeepSync</span>(<span class="params">dir</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> files = fs.<span class="title function_">readdirSync</span>(dir); <span class="comment">//同步读取文件夹内容</span></span><br><span class="line"></span><br><span class="line">  files.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">item, index</span>) &#123;</span><br><span class="line">    <span class="comment">//forEach循环</span></span><br><span class="line">    <span class="keyword">let</span> p = path.<span class="title function_">resolve</span>(dir, item); <span class="comment">//读取第二层的绝对路径</span></span><br><span class="line">    <span class="keyword">let</span> pathstat = fs.<span class="title function_">statSync</span>(p); <span class="comment">//独读取第二层文件状态</span></span><br><span class="line">    <span class="keyword">if</span> (!pathstat.<span class="title function_">isDirectory</span>()) &#123;</span><br><span class="line">      <span class="comment">//判断是否是文件夹</span></span><br><span class="line">      fs.<span class="title function_">unlinkSync</span>(p); <span class="comment">//不是文件夹就删除</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">rmdirDeepSync</span>(p); <span class="comment">//是文件夹就递归</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  fs.<span class="title function_">rmdirSync</span>(dir); <span class="comment">//删除已经为空的文件夹</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="nodejs-使用-axios-发送-fromdata-文件"><a href="#nodejs-使用-axios-发送-fromdata-文件" class="headerlink" title="nodejs 使用 axios 发送 fromdata 文件"></a>nodejs 使用 axios 发送 fromdata 文件</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&quot;axios&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>).<span class="property">promises</span>;</span><br><span class="line"><span class="keyword">const</span> fileSystem = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">FormData</span> = <span class="built_in">require</span>(<span class="string">&quot;form-data&quot;</span>); <span class="comment">// node 中没有 FormData 需要单独下载 form-data 包</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">HTTP</span> = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  baseURL,</span><br><span class="line">  <span class="attr">maxBodyLength</span>: <span class="title class_">Infinity</span>, <span class="comment">//设置适当的大小</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// axios 上添加上传文件方法</span></span><br><span class="line"><span class="variable constant_">HTTP</span>.<span class="property">uploadFile</span> = <span class="function">(<span class="params">url, formData</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">HTTP</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">    url,</span><br><span class="line">    <span class="attr">data</span>: formData,</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">      ...formData.<span class="title function_">getHeaders</span>(),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加请求拦截器</span></span><br><span class="line"><span class="variable constant_">HTTP</span>.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加响应拦截器</span></span><br><span class="line"><span class="variable constant_">HTTP</span>.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> response.<span class="property">data</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上传文件方法</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">uploadFile</span>(<span class="params">url, filepath</span>) &#123;</span><br><span class="line">  <span class="comment">// 这里需要使用 createReadStream</span></span><br><span class="line">  <span class="keyword">let</span> file =  fileSystem.<span class="title function_">createReadStream</span>(filepath);</span><br><span class="line">  <span class="keyword">let</span> formdata = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">  formdata.<span class="title function_">append</span>(<span class="string">&quot;filekey&quot;</span>, file);</span><br><span class="line">  <span class="keyword">return</span> <span class="variable constant_">HTTP</span>.<span class="title function_">uploadFile</span>(url, formdata)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="nodejs-创建交互式命令行工具"><a href="#nodejs-创建交互式命令行工具" class="headerlink" title="nodejs 创建交互式命令行工具"></a>nodejs 创建交互式命令行工具</h2><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><p><a href="https://blog.51cto.com/u_10585798/3269810">如何用node编写命令行工具，附上一个ginit示例，并推荐好用的命令行工具</a><br><a href="https://blog.51cto.com/u_15351653/3751979">inquirer的简单使用</a><br><a href="https://www.npmjs.com/package/inquirer#news">inquirer npm</a></p>
<h3 id="项目依赖"><a href="#项目依赖" class="headerlink" title="项目依赖"></a>项目依赖</h3><p>以下是完整列表：</p>
<ul>
<li>chalk ：彩色输出</li>
<li>clear ： 清空命令行屏幕</li>
<li>clui ：绘制命令行中的表格、仪表盘、加载指示器等。</li>
<li>figlet ：生成字符图案</li>
<li>inquirer ：创建交互式的命令行界面</li>
<li>minimist ：解析参数</li>
<li>configstore：轻松加载和保存配置</li>
</ul>
<p>还有这些：</p>
<ul>
<li>@octokit&#x2F;rest：Node.js 里的 GitHub REST API 客户端</li>
<li>lodash：JavaScript 工具库</li>
<li>simple-git：在 Node.js 应用程序中运行 Git 命令的工具</li>
</ul>
<h3 id="inquirer-的简单使用"><a href="#inquirer-的简单使用" class="headerlink" title="inquirer 的简单使用"></a>inquirer 的简单使用</h3><p>command.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> inquirer = <span class="built_in">require</span>(<span class="string">&quot;inquirer&quot;</span>);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> question = [</span><br><span class="line">    &#123; <span class="attr">type</span>: <span class="string">&quot;editor&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;dec&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;描述&quot;</span>, <span class="attr">default</span>: <span class="string">&quot;&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">type</span>: <span class="string">&quot;input&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;username&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;姓名&quot;</span>, <span class="attr">default</span>: <span class="string">&quot;&quot;</span> &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&quot;list&quot;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;study&quot;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&quot;学历&quot;</span>,</span><br><span class="line">      <span class="attr">choices</span>: [<span class="string">&quot;小学&quot;</span>, <span class="string">&quot;初中&quot;</span>, <span class="string">&quot;高中&quot;</span>, <span class="string">&quot;大学&quot;</span>, <span class="string">&quot;研究生&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&quot;checkbox&quot;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;hobby&quot;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&quot;爱好&quot;</span>,</span><br><span class="line">      <span class="attr">choices</span>: [<span class="string">&quot;篮球&quot;</span>, <span class="string">&quot;足球&quot;</span>, <span class="string">&quot;游泳&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; <span class="attr">type</span>: <span class="string">&quot;confirm&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;isMan&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;man&quot;</span>, <span class="attr">default</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> answer = <span class="keyword">await</span> inquirer.<span class="title function_">prompt</span>(question);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(answer);</span><br><span class="line">  <span class="comment">// 根据选项的结果继续交互</span></span><br><span class="line">  <span class="keyword">if</span> (answer.<span class="property">isMan</span>) &#123;</span><br><span class="line">    answer = <span class="keyword">await</span> inquirer.<span class="title function_">prompt</span>([</span><br><span class="line">      &#123; <span class="attr">type</span>: <span class="string">&quot;input&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;test&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;根据isMan结果&quot;</span>, <span class="attr">default</span>: <span class="string">&quot;&quot;</span> &#125;,</span><br><span class="line">    ]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">node command.js</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Nodejs</category>
      </categories>
      <tags>
        <tag>Nodejs</tag>
      </tags>
  </entry>
  <entry>
    <title>npm scripts  使用指南</title>
    <url>/2021/01/03/Nodejs/npm-scripts-%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<blockquote>
<p>本片文章转载于阮一峰老师的博客：<a href="http://www.ruanyifeng.com/blog/2016/10/npm_scripts.html">http://www.ruanyifeng.com/blog/2016/10/npm_scripts.html</a></p>
</blockquote>
<p>Node 开发离不开 npm，而脚本功能是 npm 最强大、最常用的功能之一。</p>
<p>本文介绍如何使用 npm 脚本（npm scripts）。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/bg2016101101.jpg" alt="img"></p>
<h2 id="一、什么是-npm-脚本？"><a href="#一、什么是-npm-脚本？" class="headerlink" title="一、什么是 npm 脚本？"></a>一、什么是 npm 脚本？</h2><p>npm 允许在<code>package.json</code>文件里面，使用<code>scripts</code>字段定义脚本命令。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;node build.js&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面代码是<code>package.json</code>文件的一个片段，里面的<code>scripts</code>字段是一个对象。它的每一个属性，对应一段脚本。比如，<code>build</code>命令对应的脚本是<code>node build.js</code>。</p>
<p>命令行下使用<code>npm run</code>命令，就可以执行这段脚本。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm run build</span><br><span class="line"><span class="comment"># 等同于执行</span></span><br><span class="line">$ node build.js</span><br></pre></td></tr></table></figure>
</blockquote>
<p>这些定义在<code>package.json</code>里面的脚本，就称为 npm 脚本。它的优点很多。</p>
<blockquote>
<ul>
<li>项目的相关脚本，可以集中在一个地方。</li>
<li>不同项目的脚本命令，只要功能相同，就可以有同样的对外接口。用户不需要知道怎么测试你的项目，只要运行<code>npm run test</code>即可。</li>
<li>可以利用 npm 提供的很多辅助功能。</li>
</ul>
</blockquote>
<p>查看当前项目的所有 npm 脚本命令，可以使用不带任何参数的<code>npm run</code>命令。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm run</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="二、原理"><a href="#二、原理" class="headerlink" title="二、原理"></a>二、原理</h2><p>npm 脚本的原理非常简单。每当执行<code>npm run</code>，就会自动新建一个 Shell，在这个 Shell 里面执行指定的脚本命令。因此，只要是 Shell（一般是 Bash）可以运行的命令，就可以写在 npm 脚本里面。</p>
<p>比较特别的是，<code>npm run</code>新建的这个 Shell，会将当前目录的<code>node_modules/.bin</code>子目录加入<code>PATH</code>变量，执行结束后，再将<code>PATH</code>变量恢复原样。</p>
<p>这意味着，当前目录的<code>node_modules/.bin</code>子目录里面的所有脚本，都可以直接用脚本名调用，而不必加上路径。比如，当前项目的依赖里面有 Mocha，只要直接写<code>mocha test</code>就可以了。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;test&quot;</span>: <span class="string">&quot;mocha test&quot;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>而不用写成下面这样。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;test&quot;</span>: <span class="string">&quot;./node_modules/.bin/mocha test&quot;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>由于 npm 脚本的唯一要求就是可以在 Shell 执行，因此它不一定是 Node 脚本，任何可执行文件都可以写在里面。</p>
<p>npm 脚本的退出码，也遵守 Shell 脚本规则。如果退出码不是<code>0</code>，npm 就认为这个脚本执行失败。</p>
<h2 id="三、通配符"><a href="#三、通配符" class="headerlink" title="三、通配符"></a>三、通配符</h2><p>由于 npm 脚本就是 Shell 脚本，因为可以使用 Shell 通配符。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;lint&quot;</span>: <span class="string">&quot;jshint *.js&quot;</span></span><br><span class="line"><span class="string">&quot;lint&quot;</span>: <span class="string">&quot;jshint **/*.js&quot;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面代码中，<code>*</code>表示任意文件名，<code>**</code>表示任意一层子目录。</p>
<p>如果要将通配符传入原始命令，防止被 Shell 转义，要将星号转义。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;test&quot;</span>: <span class="string">&quot;tap test/\*.js&quot;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="四、传参"><a href="#四、传参" class="headerlink" title="四、传参"></a>四、传参</h2><p>向 npm 脚本传入参数，要使用<code>--</code>标明。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;lint&quot;</span>: <span class="string">&quot;jshint **.js&quot;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>向上面的<code>npm run lint</code>命令传入参数，必须写成下面这样。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm run lint --  --reporter checkstyle &gt; checkstyle.xml</span><br></pre></td></tr></table></figure>
</blockquote>
<p>也可以在<code>package.json</code>里面再封装一个命令。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;lint&quot;</span>: <span class="string">&quot;jshint **.js&quot;</span>,</span><br><span class="line"><span class="string">&quot;lint:checkstyle&quot;</span>: <span class="string">&quot;npm run lint -- --reporter checkstyle &gt; checkstyle.xml&quot;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="五、执行顺序"><a href="#五、执行顺序" class="headerlink" title="五、执行顺序"></a>五、执行顺序</h2><p>如果 npm 脚本里面需要执行多个任务，那么需要明确它们的执行顺序。</p>
<p>如果是并行执行（即同时的平行执行），可以使用<code>&amp;</code>符号。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm run script1.js &amp; npm run script2.js</span><br></pre></td></tr></table></figure>
</blockquote>
<p>如果是继发执行（即只有前一个任务成功，才执行下一个任务），可以使用<code>&amp;&amp;</code>符号。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm run script1.js &amp;&amp; npm run script2.js</span><br></pre></td></tr></table></figure>
</blockquote>
<p>这两个符号是 Bash 的功能。此外，还可以使用 node 的任务管理模块：<a href="https://github.com/paulpflug/script-runner">script-runner</a>、<a href="https://github.com/mysticatea/npm-run-all">npm-run-all</a>、<a href="https://github.com/coderaiser/redrun">redrun</a>。</p>
<h2 id="六、默认值"><a href="#六、默认值" class="headerlink" title="六、默认值"></a>六、默认值</h2><p>一般来说，npm 脚本由用户提供。但是，npm 对两个脚本提供了默认值。也就是说，这两个脚本不用定义，就可以直接使用。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;start&quot;</span>: <span class="string">&quot;node server.js&quot;</span>，</span><br><span class="line"><span class="string">&quot;install&quot;</span>: <span class="string">&quot;node-gyp rebuild&quot;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面代码中，<code>npm run start</code>的默认值是<code>node server.js</code>，前提是项目根目录下有<code>server.js</code>这个脚本；<code>npm run install</code>的默认值是<code>node-gyp rebuild</code>，前提是项目根目录下有<code>binding.gyp</code>文件。</p>
<h2 id="七、钩子"><a href="#七、钩子" class="headerlink" title="七、钩子"></a>七、钩子</h2><p>npm 脚本有<code>pre</code>和<code>post</code>两个钩子。举例来说，<code>build</code>脚本命令的钩子就是<code>prebuild</code>和<code>postbuild</code>。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;prebuild&quot;</span>: <span class="string">&quot;echo I run before the build script&quot;</span>,</span><br><span class="line"><span class="string">&quot;build&quot;</span>: <span class="string">&quot;cross-env NODE_ENV=production webpack&quot;</span>,</span><br><span class="line"><span class="string">&quot;postbuild&quot;</span>: <span class="string">&quot;echo I run after the build script&quot;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>用户执行<code>npm run build</code>的时候，会自动按照下面的顺序执行。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm run prebuild &amp;&amp; npm run build &amp;&amp; npm run postbuild</span><br></pre></td></tr></table></figure>
</blockquote>
<p>因此，可以在这两个钩子里面，完成一些准备工作和清理工作。下面是一个例子。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;clean&quot;</span>: <span class="string">&quot;rimraf ./dist &amp;&amp; mkdir dist&quot;</span>,</span><br><span class="line"><span class="string">&quot;prebuild&quot;</span>: <span class="string">&quot;npm run clean&quot;</span>,</span><br><span class="line"><span class="string">&quot;build&quot;</span>: <span class="string">&quot;cross-env NODE_ENV=production webpack&quot;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>npm 默认提供下面这些钩子。</p>
<blockquote>
<ul>
<li>prepublish，postpublish</li>
<li>preinstall，postinstall</li>
<li>preuninstall，postuninstall</li>
<li>preversion，postversion</li>
<li>pretest，posttest</li>
<li>prestop，poststop</li>
<li>prestart，poststart</li>
<li>prerestart，postrestart</li>
</ul>
</blockquote>
<p>自定义的脚本命令也可以加上<code>pre</code>和<code>post</code>钩子。比如，<code>myscript</code>这个脚本命令，也有<code>premyscript</code>和<code>postmyscript</code>钩子。不过，双重的<code>pre</code>和<code>post</code>无效，比如<code>prepretest</code>和<code>postposttest</code>是无效的。</p>
<p>npm 提供一个<code>npm_lifecycle_event</code>变量，返回当前正在运行的脚本名称，比如<code>pretest</code>、<code>test</code>、<code>posttest</code>等等。所以，可以利用这个变量，在同一个脚本文件里面，为不同的<code>npm scripts</code>命令编写代码。请看下面的例子。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">TARGET</span> = process.<span class="property">env</span>.<span class="property">npm_lifecycle_event</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable constant_">TARGET</span> === <span class="string">&quot;test&quot;</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Running the test task!`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable constant_">TARGET</span> === <span class="string">&quot;pretest&quot;</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Running the pretest task!`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable constant_">TARGET</span> === <span class="string">&quot;posttest&quot;</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Running the posttest task!`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>注意，<code>prepublish</code>这个钩子不仅会在<code>npm publish</code>命令之前运行，还会在<code>npm install</code>（不带任何参数）命令之前运行。这种行为很容易让用户感到困惑，所以 npm 4 引入了一个新的钩子<code>prepare</code>，行为等同于<code>prepublish</code>，而从 npm 5 开始，<code>prepublish</code>将只在<code>npm publish</code>命令之前运行。</p>
<h2 id="八、简写形式"><a href="#八、简写形式" class="headerlink" title="八、简写形式"></a>八、简写形式</h2><p>四个常用的 npm 脚本有简写形式。</p>
<blockquote>
<ul>
<li><code>npm start</code>是<code>npm run start</code></li>
<li><code>npm stop</code>是<code>npm run stop</code>的简写</li>
<li><code>npm test</code>是<code>npm run test</code>的简写</li>
<li><code>npm restart</code>是<code>npm run stop &amp;&amp; npm run restart &amp;&amp; npm run start</code>的简写</li>
</ul>
</blockquote>
<p><code>npm start</code>、<code>npm stop</code>和<code>npm restart</code>都比较好理解，而<code>npm restart</code>是一个复合命令，实际上会执行三个脚本命令：<code>stop</code>、<code>restart</code>、<code>start</code>。具体的执行顺序如下。</p>
<blockquote>
<ol>
<li>prerestart</li>
<li>prestop</li>
<li>stop</li>
<li>poststop</li>
<li>restart</li>
<li>prestart</li>
<li>start</li>
<li>poststart</li>
<li>postrestart</li>
</ol>
</blockquote>
<h2 id="九、变量"><a href="#九、变量" class="headerlink" title="九、变量"></a>九、变量</h2><p>npm 脚本有一个非常强大的功能，就是可以使用 npm 的内部变量。</p>
<p>首先，通过<code>npm_package_</code>前缀，npm 脚本可以拿到<code>package.json</code>里面的字段。比如，下面是一个<code>package.json</code>。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;foo&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.2.5&quot;</span>,</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;view&quot;</span>: <span class="string">&quot;node view.js&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>那么，变量<code>npm_package_name</code>返回<code>foo</code>，变量<code>npm_package_version</code>返回<code>1.2.5</code>。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// view.js</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(process.<span class="property">env</span>.<span class="property">npm_package_name</span>); <span class="comment">// foo</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(process.<span class="property">env</span>.<span class="property">npm_package_version</span>); <span class="comment">// 1.2.5</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面代码中，我们通过环境变量<code>process.env</code>对象，拿到<code>package.json</code>的字段值。如果是 Bash 脚本，可以用<code>$npm_package_name</code>和<code>$npm_package_version</code>取到这两个值。</p>
<p><code>npm_package_</code>前缀也支持嵌套的<code>package.json</code>字段。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;repository&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;git&quot;</span>,</span><br><span class="line">  <span class="string">&quot;url&quot;</span>: <span class="string">&quot;xxx&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">scripts</span>: &#123;</span><br><span class="line">  <span class="string">&quot;view&quot;</span>: <span class="string">&quot;echo $npm_package_repository_type&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面代码中，<code>repository</code>字段的<code>type</code>属性，可以通过<code>npm_package_repository_type</code>取到。</p>
<p>下面是另外一个例子。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;install&quot;</span>: <span class="string">&quot;foo.js&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面代码中，<code>npm_package_scripts_install</code>变量的值等于<code>foo.js</code>。</p>
<p>然后，npm 脚本还可以通过<code>npm_config_</code>前缀，拿到 npm 的配置变量，即<code>npm config get xxx</code>命令返回的值。比如，当前模块的发行标签，可以通过<code>npm_config_tag</code>取到。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;view&quot;</span>: <span class="string">&quot;echo $npm_config_tag&quot;</span>,</span><br></pre></td></tr></table></figure>
</blockquote>
<p>注意，<code>package.json</code>里面的<code>config</code>对象，可以被环境变量覆盖。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span> : <span class="string">&quot;foo&quot;</span>,</span><br><span class="line">  <span class="string">&quot;config&quot;</span> : &#123; <span class="string">&quot;port&quot;</span> : <span class="string">&quot;8080&quot;</span> &#125;,</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span> : &#123; <span class="string">&quot;start&quot;</span> : <span class="string">&quot;node server.js&quot;</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面代码中，<code>npm_package_config_port</code>变量返回的是<code>8080</code>。这个值可以用下面的方法覆盖。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm config <span class="built_in">set</span> foo:port 80</span><br></pre></td></tr></table></figure>
</blockquote>
<p>最后，<code>env</code>命令可以列出所有环境变量。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;env&quot;</span>: <span class="string">&quot;env&quot;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="十、常用脚本示例"><a href="#十、常用脚本示例" class="headerlink" title="十、常用脚本示例"></a>十、常用脚本示例</h2> <figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 删除目录</span></span><br><span class="line"><span class="attr">&quot;clean&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rimraf dist/*&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 本地搭建一个 HTTP 服务</span></span><br><span class="line"><span class="attr">&quot;serve&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http-server -p 9090 dist/&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 打开浏览器</span></span><br><span class="line"><span class="attr">&quot;open:dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;opener http://localhost:9090&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实时刷新</span></span><br><span class="line"> <span class="attr">&quot;livereload&quot;</span><span class="punctuation">:</span> <span class="string">&quot;live-reload --port 9091 dist/&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 构建 HTML 文件</span></span><br><span class="line"><span class="attr">&quot;build:html&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jade index.jade &gt; dist/index.html&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 只要 CSS 文件有变动，就重新执行构建</span></span><br><span class="line"><span class="attr">&quot;watch:css&quot;</span><span class="punctuation">:</span> <span class="string">&quot;watch &#x27;npm run build:css&#x27; assets/styles/&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 只要 HTML 文件有变动，就重新执行构建</span></span><br><span class="line"><span class="attr">&quot;watch:html&quot;</span><span class="punctuation">:</span> <span class="string">&quot;watch &#x27;npm run build:html&#x27; assets/html&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 部署到 Amazon S3</span></span><br><span class="line"><span class="attr">&quot;deploy:prod&quot;</span><span class="punctuation">:</span> <span class="string">&quot;s3-cli sync ./dist/ s3://example-com/prod-site/&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 构建 favicon</span></span><br><span class="line"><span class="attr">&quot;build:favicon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node scripts/favicon.js&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// git 操作</span></span><br><span class="line"><span class="attr">&quot;preupdate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;git add . &quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;update&quot;</span><span class="punctuation">:</span> <span class="string">&quot;git commit -m&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;postupdate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;git pull &amp;&amp; git push&quot;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<h2 id="十一、参考链接"><a href="#十一、参考链接" class="headerlink" title="十一、参考链接"></a>十一、参考链接</h2><ul>
<li><a href="https://www.keithcirkel.co.uk/how-to-use-npm-as-a-build-tool/">How to Use npm as a Build Tool</a>, by Keith Cirkel</li>
<li><a href="https://github.com/RyanZim/awesome-npm-scripts#articles">Awesome npm scripts</a>, by Ryan Zimmerman</li>
</ul>
<p>（完）</p>
]]></content>
      <categories>
        <category>Nodejs</category>
      </categories>
      <tags>
        <tag>js</tag>
        <tag>Nodejs</tag>
        <tag>npm</tag>
        <tag>package.json</tag>
      </tags>
  </entry>
  <entry>
    <title>npm 下包问题</title>
    <url>/2020/12/12/Nodejs/npm-%E4%B8%8B%E5%8C%85%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h3 id="node-下包的过程"><a href="#node-下包的过程" class="headerlink" title="node 下包的过程"></a>node 下包的过程</h3><p>首先说下 node 下 需要预编译的包（例如<a href="https://npmmirror.com/mirrors/node-sass/">node-sass</a>）的过程 ：</p>
<ul>
<li>node 下包首先会在线上找对应本地 node 版本和操作系统的包</li>
<li>有的无需系统支持就直接下</li>
<li>有的需要根据系统下对应的 tar.gz 包 用到 node-pre-gyp，如果找不到对应的 node 版本号和系统的包，node 会下载源码进行编译</li>
<li>node 编译使用 node-gyp ,而 node-gyp 在不同的操作系统下需要不同的支持工具 ，win 是 python 和 Visual Studio ，在 linux 下需要 Python， make, 和 GCC ，在MacOS  需要 <a href="https://developer.apple.com/xcode/download/">Xcode</a>，Python v3.6、v3.7、v3.8 或 v3.9，这里有详细的描述 <a href="https://github.com/nodejs/node-gyp">https://github.com/nodejs/node-gyp</a></li>
</ul>
<h3 id="node版本问题"><a href="#node版本问题" class="headerlink" title="node版本问题"></a>node版本问题</h3><p>node 不同版本影响到是否能直接下对应的包，所以装包前可以先看下<a href="https://npmmirror.com/mirrors">淘宝镜像</a>上有没有对应 node 版本的包</p>
<blockquote>
<p>以这个为例<code>node-v72-win32-x64.tar.gz </code>代表 node 的 NODE_MODULE_VERSION 版本号是 72 的 windows64 位的包，NODE_MODULE_VERSION 对应的 node 版本可以在<a href="https://nodejs.org/zh-cn/download/releases/">https://nodejs.org/zh-cn/download/releases/</a> node 官网查询</p>
</blockquote>
<p>ps: 使用 <a href="https://www.jianshu.com/p/48185ef12fbf">nvm</a> 可以自如的切换 node 版本</p>
<h3 id="设置国内镜像源"><a href="#设置国内镜像源" class="headerlink" title="设置国内镜像源"></a>设置国内镜像源</h3><p>cnpm 安装：<a href="https://developer.aliyun.com/mirror/NPM?from=tnpm">https://developer.aliyun.com/mirror/NPM?from=tnpm</a></p>
<p>设置 npm 下包地址 ： <a href="https://blog.csdn.net/weixin_40920953/article/details/86547291">https://blog.csdn.net/weixin_40920953/article/details/86547291</a></p>
]]></content>
      <categories>
        <category>Nodejs</category>
      </categories>
      <tags>
        <tag>js</tag>
        <tag>Nodejs</tag>
        <tag>npm</tag>
      </tags>
  </entry>
  <entry>
    <title>npm发包</title>
    <url>/2022/01/05/Nodejs/npm%E5%8F%91%E5%8C%85/</url>
    <content><![CDATA[<h2 id="创建一个-npm-账号"><a href="#创建一个-npm-账号" class="headerlink" title="创建一个 npm 账号"></a>创建一个 npm 账号</h2><p><a href="https://docs.npmjs.com/creating-a-new-npm-user-account">创建一个 npm 账号</a></p>
<h3 id="本地添加账号"><a href="#本地添加账号" class="headerlink" title="本地添加账号"></a>本地添加账号</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm adduser</span><br><span class="line">npm notice Log <span class="keyword">in</span> on https://registry.npmjs.org/</span><br><span class="line">Username: username</span><br><span class="line">Password:xxx</span><br><span class="line">Email: (this IS public) xxx@xxx.com</span><br><span class="line">npm notice Please check your email <span class="keyword">for</span> a one-time password (OTP)</span><br><span class="line">Enter one-time password from your authenticator app: xxxxx</span><br><span class="line">Logged <span class="keyword">in</span> as bitbw on https://registry.npmjs.org/.</span><br></pre></td></tr></table></figure>

<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>如果提示<code>[FORBIDDEN] Public registration is not allowed</code><br>问题的原因是你的NPM使用了镜像地址.<br>解决方法：先不用镜像地址</p>
<h2 id="创建和发布作用域公共包"><a href="#创建和发布作用域公共包" class="headerlink" title="创建和发布作用域公共包"></a>创建和发布作用域公共包</h2><h3 id="创建作用域公共包"><a href="#创建作用域公共包" class="headerlink" title="创建作用域公共包"></a>创建作用域公共包</h3><blockquote>
<p>注意：在发布用户范围的 npm 包之前，您必须注册一个 npm 用户帐户。<br>此外，要发布组织范围的包，您必须创建一个 npm 用户帐户，然后创建一个 npm 组织</p>
</blockquote>
<p>1.为您的包创建一个目录：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> my-test-package</span><br></pre></td></tr></table></figure>

<p>2.在包根目录中，运行 npm init 命令并将范围传递给 scope 标志：<br>对于组织范围的包，替换 my-org 为您组织的名称：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm init --scope=@my-org</span><br></pre></td></tr></table></figure>

<p>对于用户范围的包，替换 my-username 为您的用户名：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm init --scope=@my-username</span><br></pre></td></tr></table></figure>

<p>3.提示以生成 package.json 文件。</p>
<h3 id="查看包裹内容以获取敏感或不必要的信息"><a href="#查看包裹内容以获取敏感或不必要的信息" class="headerlink" title="查看包裹内容以获取敏感或不必要的信息"></a>查看包裹内容以获取敏感或不必要的信息</h3><p>将敏感信息发布到注册表可能会损害您的用户、损害您的开发基础设施、修复成本高昂，并使您面临法律诉讼的风险。我们强烈建议在将包发布到注册表之前删除敏感信息，例如私钥、密码、个人身份信息(PII) 和信用卡数据。</p>
<p>对于不太敏感的信息，例如测试数据，请使用<code>.npmignore</code> 或<code>.gitignore</code> 文件来防止发布到注册表</p>
<h3 id="测试你的包裹"><a href="#测试你的包裹" class="headerlink" title="测试你的包裹"></a>测试你的包裹</h3><p>为了减少发布错误的机会，我们建议在将包发布到 npm 注册表之前对其进行测试。要测试您的包，<code>npm install</code> 请使用包目录的完整路径运行：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure>

<h3 id="发布范围内的公共包"><a href="#发布范围内的公共包" class="headerlink" title="发布范围内的公共包"></a>发布范围内的公共包</h3><p>默认情况下，范围包以私有可见性发布。要发布具有公共可见性的范围包，请使用<code>npm publish --access public</code>. 1.要将范围内的公共包发布到 npm 注册表，请运行：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm publish --access public</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ npm publish --access public</span><br><span class="line">npm notice</span><br><span class="line">npm notice 📦  @bitbw/my-test-package01@1.0.0</span><br><span class="line">npm notice === Tarball Contents ===</span><br><span class="line">npm notice 43B  README.md</span><br><span class="line">npm notice 241B index.js</span><br><span class="line">npm notice 238B package.json</span><br><span class="line">npm notice === Tarball Details ===</span><br><span class="line">npm notice name:          @bitbw/my-test-package01</span><br><span class="line">npm notice version:       1.0.0</span><br><span class="line">npm notice filename:      @bitbw/my-test-package01-1.0.0.tgz</span><br><span class="line">npm notice package size:  466 B</span><br><span class="line">npm notice unpacked size: 522 B</span><br><span class="line">npm notice shasum:        656cc61ee5de87d80dfc0a699b710e2163493f4f</span><br><span class="line">npm notice integrity:     sha512-bHtVFf7U3J+EL[...]AznC2Mfpz7Lvg==</span><br><span class="line">npm notice total files:   3</span><br><span class="line">npm notice</span><br><span class="line">+ @bitbw/my-test-package01@1.0.0</span><br></pre></td></tr></table></figure>

<p>2.要查看您的公共包页面，请访问<a href="https://npmjs.com/package/*package-name">https://npmjs.com/package/*package-name</a> ，将 package-name*替换为您的包名称。公共包会 public 在 npm 网站上的包名称下方注明。</p>
]]></content>
      <categories>
        <category>Nodejs</category>
      </categories>
      <tags>
        <tag>Nodejs</tag>
        <tag>npm</tag>
      </tags>
  </entry>
  <entry>
    <title>npm常见问题汇总</title>
    <url>/2022/07/18/Nodejs/npm%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h2 id="npm-每次提示-onfig-global-global-local-are-deprecated-Use-location-global-instead"><a href="#npm-每次提示-onfig-global-global-local-are-deprecated-Use-location-global-instead" class="headerlink" title="npm 每次提示 onfig global --global, --local are deprecated. Use --location=global instead"></a>npm 每次提示 onfig global <code>--global</code>, <code>--local</code> are deprecated. Use <code>--location=global</code> instead</h2><p><a href="https://github.com/npm/cli/pull/4982">github上的Issues</a></p>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>版本 v8.11 会出现这个问题</p>
<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>升级到 v8.12.x</p>
]]></content>
      <categories>
        <category>Nodejs</category>
      </categories>
      <tags>
        <tag>Nodejs</tag>
        <tag>npm</tag>
      </tags>
  </entry>
  <entry>
    <title>package.json中 npm依赖包版本前的符号的意义</title>
    <url>/2021/06/16/Nodejs/package-json%E4%B8%AD-npm%E4%BE%9D%E8%B5%96%E5%8C%85%E7%89%88%E6%9C%AC%E5%89%8D%E7%9A%84%E7%AC%A6%E5%8F%B7%E7%9A%84%E6%84%8F%E4%B9%89/</url>
    <content><![CDATA[<p><strong>版本的格式</strong></p>
<p>major.minor.patch</p>
<p>主版本号.次版本号.修补版本号</p>
<p>————————————————————</p>
<p>patch：修复 bug，兼容老版本</p>
<p>minor：新增功能，兼容老版本</p>
<p>major：新的架构调整，不兼容老版本</p>
<p><strong>version</strong></p>
<p>必须匹配某个版本</p>
<p>如：1.1.2，表示必须依赖 1.1.2 版</p>
<p><strong>&gt;version</strong></p>
<p>必须大于某个版本</p>
<p>如：&gt;1.1.2，表示必须大于 1.1.2 版</p>
<p><strong>&gt;&#x3D;version</strong></p>
<p>可大于或等于某个版本</p>
<p>如：&gt;&#x3D;1.1.2，表示可以等于 1.1.2，也可以大于 1.1.2 版本</p>
<p><strong>&lt;version</strong></p>
<p>必须小于某个版本</p>
<p>如：&lt;1.1.2，表示必须小于 1.1.2 版本</p>
<p><strong>&lt;&#x3D;version</strong></p>
<p>可以小于或等于某个版本</p>
<p>如：&lt;&#x3D;1.1.2，表示可以等于 1.1.2，也可以小于 1.1.2 版本</p>
<p><strong>~version</strong></p>
<p>大概匹配某个版本</p>
<p>如果 minor 版本号指定了，那么 minor 版本号不变，而 patch 版本号任意</p>
<p>如果 minor 和 patch 版本号未指定，那么 minor 和 patch 版本号任意</p>
<p>如：~1.1.2，表示&gt;&#x3D;1.1.2 &lt;1.2.0，可以是 1.1.2，1.1.3，1.1.4，…..，1.1.n</p>
<p>如：~1.1，表示&gt;&#x3D;1.1.0 &lt;1.2.0，可以是同上</p>
<p>如：~1，表示&gt;&#x3D;1.0.0 &lt;2.0.0，可以是 1.0.0，1.0.1，1.0.2，…..，1.0.n，1.1.n，1.2.n，…..，1.n.n</p>
<p><strong>^version</strong></p>
<p>兼容某个版本</p>
<p>版本号中最左边的非 0 数字的右侧可以任意</p>
<p>如果缺少某个版本号，则这个版本号的位置可以任意</p>
<p>如：^1.1.2 ，表示&gt;&#x3D;1.1.2 &lt;2.0.0，可以是 1.1.2，1.1.3，…..，1.1.n，1.2.n，…..，1.n.n</p>
<p>如：^0.2.3 ，表示&gt;&#x3D;0.2.3 &lt;0.3.0，可以是 0.2.3，0.2.4，…..，0.2.n</p>
<p>如：^0.0，表示 &gt;&#x3D;0.0.0 &lt;0.1.0，可以是 0.0.0，0.0.1，…..，0.0.n</p>
<p><strong>x-range</strong></p>
<p>x 的位置表示任意版本</p>
<p>如：1.2.x，表示可以 1.2.0，1.2.1，…..，1.2.n</p>
<p><strong>*-range</strong></p>
<p>任意版本，””也表示任意版本</p>
<p>如：*，表示&gt;&#x3D;0.0.0 的任意版本</p>
<p><strong>version1 - version2</strong></p>
<p>大于等于 version1，小于等于 version2</p>
<p>如：1.1.2 - 1.3.1，表示包括 1.1.2 和 1.3.1 以及他们件的任意版本</p>
<p><strong>range1 || range2</strong></p>
<p>满足 range1 或者满足 range2，可以多个范围</p>
<p>如：&lt;1.0.0 || &gt;&#x3D;2.3.1 &lt;2.4.5 || &gt;&#x3D;2.5.2 &lt;3.0.0，表示满足这 3 个范围的版本都可以</p>
<p>原文连接：<a href="https://www.cnblogs.com/wshiqtb/p/6395029.html">https://www.cnblogs.com/wshiqtb/p/6395029.html</a></p>
]]></content>
      <categories>
        <category>Nodejs</category>
      </categories>
      <tags>
        <tag>Nodejs</tag>
        <tag>npm</tag>
        <tag>package.json</tag>
      </tags>
  </entry>
  <entry>
    <title>path.resolve()的使用</title>
    <url>/2020/12/30/Nodejs/path-resolve-%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="路径解析：path-resolve-from-…-to"><a href="#路径解析：path-resolve-from-…-to" class="headerlink" title="路径解析：path.resolve([from …], to)"></a>路径解析：path.resolve([from …], to)</h2><p>学习 webpack 遇到 path.resolve 但文档读完一遍很懵圈；</p>
<p>网上搜到一篇比较有用的文章 <a href="https://blog.csdn.net/kikyou_csdn/article/details/83150538">https://blog.csdn.net/kikyou_csdn/article/details/83150538</a></p>
<p>同时也给出了 join 连接路径和 resolve 路径解析的不同 ：<a href="https://www.cnblogs.com/moqiutao/p/8523955.html">https://www.cnblogs.com/moqiutao/p/8523955.html</a></p>
<p>这篇文章中有个比较好理解的观点就是 把 resolve 想象成 cd 命令。这样就容易理解了：</p>
<p>path.resolve()方法可以将多个路径解析为一个规范化的绝对路径。其处理方式类似于对这些路径逐一进行 cd 操作，与 cd 操作不同的是，这引起路径可以是文件，并且可不必实际存在（resolve()方法不会利用底层的文件系统判断路径是否存在，而只是进行路径字符串操作）。例如：</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">path.<span class="built_in">resolve</span>(<span class="string">&#x27;foo/bar&#x27;</span>, <span class="string">&#x27;/tmp/file/&#x27;</span>, <span class="string">&#x27;..&#x27;</span>, <span class="string">&#x27;a/../subfile&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>相当于</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> foo/bar</span><br><span class="line"><span class="built_in">cd</span> /tmp/file/</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">cd</span> a/../subfile</span><br><span class="line"><span class="built_in">pwd</span></span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">path.resolve(<span class="string">&#x27;/foo/bar&#x27;</span>, <span class="string">&#x27;./baz&#x27;</span>)</span><br><span class="line"><span class="regexp">//</span> 输出结果为</span><br><span class="line"><span class="string">&#x27;/foo/bar/baz&#x27;</span></span><br><span class="line">path.resolve(<span class="string">&#x27;/foo/bar&#x27;</span>, <span class="string">&#x27;/tmp/file/&#x27;</span>)</span><br><span class="line"><span class="regexp">//</span> 输出结果为</span><br><span class="line"><span class="string">&#x27;/tmp/file&#x27;</span></span><br><span class="line"></span><br><span class="line">path.resolve(<span class="string">&#x27;wwwroot&#x27;</span>, <span class="string">&#x27;static_files/png/&#x27;</span>, <span class="string">&#x27;../gif/image.gif&#x27;</span>)</span><br><span class="line"><span class="regexp">//</span> 当前的工作路径是 <span class="regexp">/home/i</span>tbilu/node，则输出结果为</span><br><span class="line"><span class="string">&#x27;/home/itbilu/node/wwwroot/static_files/gif/image.gif&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li><p>.&#x2F; 和目录名前面什么都不加代表当前目录下执行 cd</p>
</li>
<li><p>&#x2F; 表示根目录下执行 cd</p>
</li>
<li><p>所以要判断最后出来的是根目录还是当前工作目录看第一个参数的目录名前面是&#x2F; 还是 .&#x2F;和什么都没加</p>
</li>
</ul>
]]></content>
      <categories>
        <category>Nodejs</category>
      </categories>
      <tags>
        <tag>Nodejs</tag>
        <tag>path</tag>
      </tags>
  </entry>
  <entry>
    <title>phpMyAdmin+XAMPP管理MySQL数据库</title>
    <url>/2021/04/22/SQL/phpMyAdmin+XAMPP%E7%AE%A1%E7%90%86MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
    <content><![CDATA[<h2 id="安装-XAMPP"><a href="#安装-XAMPP" class="headerlink" title="安装 XAMPP"></a>安装 XAMPP</h2><p>下载地址<a href="https://www.apachefriends.org/download_success.html">https://www.apachefriends.org/download_success.html</a></p>
<p>模块全部安装</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id="Apache-shutdown-unexpectedly-启动错误解决方法"><a href="#Apache-shutdown-unexpectedly-启动错误解决方法" class="headerlink" title="Apache shutdown unexpectedly 启动错误解决方法"></a>Apache shutdown unexpectedly 启动错误解决方法</h3><p>xampp 启动时显示的错误为：</p>
<p>9:52:41 [Apache] Attempting to start Apache app…</p>
<p>9:52:41 [Apache] Status change detected: running<br>9:52:42 [Apache] Status change detected: stopped<br>9:52:42 [Apache] Error: Apache shutdown unexpectedly.<br>9:52:42 [Apache] This may be due to a blocked port, missing dependencies,<br>9:52:42 [Apache] improper privileges, a crash, or a shutdown by another method.<br>9:52:42 [Apache] Check the “&#x2F;xampp&#x2F;apache&#x2F;logs&#x2F;error.log” file<br>9:52:42 [Apache] and the Windows Event Viewer for more clues</p>
<p>一、最快的处理方法就是修改端口号：</p>
<p>1、443 端口被占用，apache 无法监听 443 端口，该如何解决呢？</p>
<p>在&#x2F;xampp&#x2F;apache&#x2F;conf&#x2F;extra&#x2F;httpd-ssl.conf</p>
<p>把 Listen 443 修改为 444（可自定义）</p>
<p>2、80 端口被占用，apache 无法监听 80 端口，该如何解决呢？</p>
<p>在&#x2F;xampp&#x2F;apache&#x2F;conf&#x2F;extra&#x2F;httpd.conf</p>
<p>把 Listen 80 修改为 88 （可自定义）</p>
<h3 id="使用-phpmyadmin-http-localhost-88-phpmyadmin"><a href="#使用-phpmyadmin-http-localhost-88-phpmyadmin" class="headerlink" title="使用 phpmyadmin http://localhost:88/phpmyadmin/"></a>使用 phpmyadmin <a href="http://localhost:88/phpmyadmin/">http://localhost:88/phpmyadmin/</a></h3><h2 id="XAMMP-配置之-Attempting-to-start-MySQL-service…问题"><a href="#XAMMP-配置之-Attempting-to-start-MySQL-service…问题" class="headerlink" title="XAMMP 配置之 Attempting to start MySQL service…问题"></a>XAMMP 配置之 Attempting to start MySQL service…问题</h2><p>相信大家和我一样。刚接触到 XAMPP，配置 mysql 的时候，一头雾水。在网上参考一些博客跟着配置还不行，接下来说一个我的配置。</p>
<p>使用设备<br>（1）windows10<br>（2）XAMPP</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/20210826150603.png" alt="在这里插入图片描述"></p>
<p>（3）mysql 8x 版本</p>
<p>本机已经安装了 mysql<br>第一步：明确问题<br>查看自己的 XAMPP 的问题</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/20190727093444445.png" alt="在这里插入图片描述"></p>
<p>可见 mysql 启动不了</p>
<p>第二步：关闭你已经安装的 mysql 服务<br>ctrl+R：输入 services.msc</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/20190727180514111.png" alt="在这里插入图片描述"></p>
<p>关闭服务</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/20190727180457156.png" alt="在这里插入图片描述"></p>
<p>第三步：修改路径<br>（1）在上图服务中，找到 MySQL80 的属性</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/20210826150253.png" alt="img"></p>
<p>可以看到有一个可执行文件路径，对它进行修改<br>（2）找到注册表<br>ctrl+R：输入 regedit.exe</p>
<p>在下面的路径中找到你的 mysql</p>
<p><code>计算机\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\MySQL</code></p>
<p>这里我的 mysql 如图</p>
<p>（3）修改 ImagePath 路径</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/20210826150445.png" alt="image-20210826150445318"></p>
<p>把上图的路径修改到下图 XAMPP 中 my.ini 的路径上<br>注意：以防修改错误你可以把当前路径备份</p>
<p>操作如下<br>点击 ImagePath 把：“C:\Program Files\MySQL\MySQL Server 8.0\bin\mysqld.exe” –defaults-file&#x3D;“C:\ProgramData\MySQL\MySQL Server 8.0\my.ini” MySQL80<br>修改为一下的内容<br>“C:\Program Files\MySQL\MySQL Server 8.0\bin\mysqld.exe” –defaults-file&#x3D;“E:\XAMPP\XAMPP\mysql\bin\my.ini” MySQL80</p>
<p>第四步：回到 XAMPP 中启动 mysql</p>
<h2 id="关闭或修改信息时报错"><a href="#关闭或修改信息时报错" class="headerlink" title="关闭或修改信息时报错"></a>关闭或修改信息时报错</h2><p>Error: Cannot create file “D:xampp\xampp-controlin”.拒绝访问</p>
<h3 id="解决办法："><a href="#解决办法：" class="headerlink" title="解决办法："></a>解决办法：</h3><p>右键该应用程序，在属性对话框选择”兼容性”–&gt;“以管理员身份运行此程序”</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/9295a630b3aa4adc87c09ffd991663a9.png" alt="在这里插入图片描述"></p>
]]></content>
      <categories>
        <category>SQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>phpMyAdmin</tag>
      </tags>
  </entry>
  <entry>
    <title>picgo + typroa + github (gitee) 实现自动上传图床</title>
    <url>/2021/02/06/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/picgo-typora-github-%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E4%B8%8A%E4%BC%A0%E5%9B%BE%E5%BA%8A/</url>
    <content><![CDATA[<h2 id="typora-结合-PicGo-设置-github-图床"><a href="#typora-结合-PicGo-设置-github-图床" class="headerlink" title="typora 结合 PicGo 设置 github 图床"></a>typora 结合 PicGo 设置 github 图床</h2><p>详细教程：<a href="https://blog.csdn.net/beichuchuanyue/article/details/105493948">https://blog.csdn.net/beichuchuanyue/article/details/105493948</a></p>
<blockquote>
<p>最近一直在用 ubuntu 所以直接使用 picgo-core （命令行） 实现上传图片</p>
</blockquote>
<h2 id="picgo-core-配置文件"><a href="#picgo-core-配置文件" class="headerlink" title="picgo-core 配置文件"></a>picgo-core 配置文件</h2><blockquote>
<p>如果配置好了 picgo app 直接把 iconfig 粘进来就行</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;picBed&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;current&quot;</span><span class="punctuation">:</span> <span class="string">&quot;github&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 具体配置</span></span><br><span class="line">    <span class="attr">&quot;github&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;branch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;分支&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;customUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://raw.githubusercontent.com/用户名/仓库/分支&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;img/&quot;</span><span class="punctuation">,</span> <span class="comment">//具体文件夹`路径/`</span></span><br><span class="line">      <span class="attr">&quot;repo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zhangbowen-github/my-gallery&quot;</span><span class="punctuation">,</span> <span class="comment">//  `/用户名/仓库`</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sdfasdfasdfasdf&quot;</span> <span class="comment">//Settings -&gt; Developer settings -&gt; Personal access tokens-&gt;创建 全选</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;uploader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;github&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;shortKey&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;picgo:upload&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;enable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CommandOrControl+Shift+P&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;upload&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;快捷上传&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;server&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;enable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">36677</span> <span class="comment">//端口号不要改</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;showUpdateTip&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pasteStyle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;markdown&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;autoRename&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rename&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;autoStart&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;miniWindowOntop&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;checkBetaUpdate&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;picgoPlugins&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;debug&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;PICGO_ENV&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GUI&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;needReload&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意上传同名图片会导致失败</p>
</blockquote>
<p>常见报错：<a href="https://blog.csdn.net/qq754772661/article/details/111385955">https://blog.csdn.net/qq754772661/article/details/111385955</a></p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="PicGo-设置-gitee（码云）图床"><a href="#PicGo-设置-gitee（码云）图床" class="headerlink" title="PicGo 设置 gitee（码云）图床"></a>PicGo 设置 gitee（码云）图床</h2><p>详细教程：<a href="https://blog.csdn.net/qq_39564555/article/details/105080209">https://blog.csdn.net/qq_39564555/article/details/105080209</a></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 具体配置</span></span><br><span class="line"> <span class="attr">&quot;gitee&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;branch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;master&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;customPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;customUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/zhangbowen-1/my-gallery/raw/master&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/img&quot;</span><span class="punctuation">,</span><span class="comment">// `/路径`</span></span><br><span class="line">      <span class="attr">&quot;repo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zhangbowen-1/my-gallery/img&quot;</span><span class="punctuation">,</span><span class="comment">// `/用户名/仓库/路径`</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;asdfasdfdfasdfasdfsadfasd&quot;</span>  <span class="comment">// 设置-》私人令牌-》生产新令牌</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>工具使用</category>
      </categories>
      <tags>
        <tag>github</tag>
        <tag>typora</tag>
        <tag>picgo</tag>
        <tag>gitee</tag>
      </tags>
  </entry>
  <entry>
    <title>picgo插件开发</title>
    <url>/2022/05/11/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/picgo%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/</url>
    <content><![CDATA[<h2 id="借鉴文档"><a href="#借鉴文档" class="headerlink" title="借鉴文档"></a>借鉴文档</h2><p><a href="https://blog.csdn.net/weixin_45673647/article/details/121465975">Typora配置picgo-core自动上传图片，及picgo-core上传组件开发</a></p>
<p><a href="https://picgo.github.io/PicGo-Core-Doc/zh/dev-guide/cli.html#%E7%AE%80%E4%BB%8B">PicGo插件开发文档</a></p>
<h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>为什么要自定义一个上传插件呢<br>因为 gitee 用不了了😔<br>觉得图片还是放到自己的服务器上安全<br>使用过<code>web-uploader</code>插件但是有问题调不通我的接口，于是自己写个上传插件方便一些<br>我的自定义上传插件 :<a href="https://www.npmjs.com/package/picgo-plugin-bitbw-upload">picgo-plugin-bitbw-upload 插件地址</a></p>
<span id="more"></span>
<h2 id="插件开发"><a href="#插件开发" class="headerlink" title="插件开发"></a>插件开发</h2><h3 id="使用模板"><a href="#使用模板" class="headerlink" title="使用模板"></a>使用模板</h3> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">picgo init plugin &lt;your-project-name&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="进入编辑index-js"><a href="#进入编辑index-js" class="headerlink" title="进入编辑index.js"></a>进入编辑index.js</h3> <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"> <span class="comment">// https://picgo.github.io/PicGo-Core-Doc/zh/dev-guide/cli.html#transformer</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">ctx</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">register</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 上传</span></span><br><span class="line">    ctx.<span class="property">helper</span>.<span class="property">uploader</span>.<span class="title function_">register</span>(<span class="string">&quot;bitbw-uploader&quot;</span>, &#123;</span><br><span class="line">      <span class="keyword">async</span> <span class="title function_">handle</span>(<span class="params">ctx</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;=============ctx.output&quot;</span>, ctx.<span class="property">output</span>);</span><br><span class="line">        <span class="comment">// 获取当前插件的配置</span></span><br><span class="line">        <span class="keyword">let</span> config = ctx.<span class="title function_">getConfig</span>(<span class="string">&quot;picgo-plugin-bitbw-upload&quot;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;============= config&quot;</span>, config);</span><br><span class="line">        <span class="comment">// 图片列表</span></span><br><span class="line">        <span class="keyword">const</span> imgList = ctx.<span class="property">output</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">const</span> img <span class="keyword">of</span> imgList) &#123;</span><br><span class="line">            <span class="keyword">if</span> (img.<span class="property">fileName</span> &amp;&amp; img.<span class="property">buffer</span>) &#123;</span><br><span class="line">              <span class="keyword">const</span> base64Image = img.<span class="property">base64Image</span> || <span class="title class_">Buffer</span>.<span class="title function_">from</span>(img.<span class="property">buffer</span>);</span><br><span class="line">              <span class="keyword">const</span> options = &#123;</span><br><span class="line">                <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">                <span class="attr">url</span>:config.<span class="property">url</span>,</span><br><span class="line">                <span class="attr">formData</span>: &#123;</span><br><span class="line">                  [config.<span class="property">key</span>]: &#123;</span><br><span class="line">                    <span class="attr">value</span>: base64Image,</span><br><span class="line">                    <span class="attr">options</span>: &#123;</span><br><span class="line">                      <span class="attr">filename</span>: img.<span class="property">fileName</span>,</span><br><span class="line">                      <span class="attr">contentType</span>: <span class="string">&quot;image/jpg&quot;</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                  &#125;,</span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;;</span><br><span class="line">              <span class="comment">// request 使用 https://github.com/request/request</span></span><br><span class="line">              <span class="keyword">let</span> body = <span class="keyword">await</span> ctx.<span class="property">Request</span>.<span class="title function_">request</span>(options);</span><br><span class="line">              <span class="keyword">if</span> (body) &#123;</span><br><span class="line">                <span class="keyword">delete</span> img.<span class="property">base64Image</span>;</span><br><span class="line">                <span class="keyword">delete</span> img.<span class="property">buffer</span>;</span><br><span class="line">                <span class="comment">// 必须把 imgUrl 回填</span></span><br><span class="line">                img.<span class="property">imgUrl</span> = body;</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Server error, please try again&quot;</span>);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> ctx;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">          ctx.<span class="title function_">emit</span>(<span class="string">&quot;notification&quot;</span>, &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&quot;上传失败&quot;</span>,</span><br><span class="line">            <span class="attr">body</span>: <span class="string">&quot;请检查你的配置以及网络&quot;</span>,</span><br><span class="line">            <span class="attr">text</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="keyword">throw</span> err;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">commands</span> = (<span class="params">ctx</span>) =&gt; [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">label</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">key</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="keyword">async</span> <span class="title function_">handle</span>(<span class="params">ctx, guiApi</span>) &#123;&#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">uploader</span>: <span class="string">&quot;bitbw-uploader&quot;</span>,</span><br><span class="line">    commands,</span><br><span class="line">    register,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="加载插件"><a href="#加载插件" class="headerlink" title="加载插件"></a>加载插件</h3><p>然后将你所写的插件的文件夹放到picgo<a href="https://picgo.github.io/PicGo-Core-Doc/zh/guide/config.html#%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">默认的配置文件所在的目录</a>里。注意插件文件夹名字必须以picgo-plugin-作为前缀，否则安装的时候picgo将不会读取。<br>然后在picgo默认配置文件所在的目录下，输入：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm install ./picgo-plugin-&lt;your-plugin-name&gt;</span><br></pre></td></tr></table></figure>

<h3 id="编辑配置文件"><a href="#编辑配置文件" class="headerlink" title="编辑配置文件"></a>编辑配置文件</h3><p>修改 picgo<a href="https://picgo.github.io/PicGo-Core-Doc/zh/guide/config.html#%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">默认的配置文件所在的目录</a> 下config.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;picBed&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;uploader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bitbw-uploader&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;current&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bitbw-uploader&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;picgoPlugins&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;picgo-plugin-bitbw-upload&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;picgo-plugin-bitbw-upload&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">//  自定义 上传地址</span></span><br><span class="line">    <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://bitbw.top/xxxx/upload&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// 自定义 formData 中的 key</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Typora中配置Picgo-Core"><a href="#Typora中配置Picgo-Core" class="headerlink" title="Typora中配置Picgo-Core"></a>Typora中配置Picgo-Core</h2><p><img data-src="https://bitbw.top/public/img/my_gallery/image-20220511163057062.png" alt="image-20220511163057062"></p>
<h2 id="发布插件"><a href="#发布插件" class="headerlink" title="发布插件"></a>发布插件</h2><p><a href="https://picgo.github.io/PicGo-Core-Doc/zh/dev-guide/deploy.html#%E6%8F%92%E4%BB%B6%E5%8F%91%E5%B8%83">官方文档</a><br><a href="https://blog.bitbw.top/Nodejs/npm%E5%AD%A6%E4%B9%A0/">如何在npm上发布自己的包</a></p>
]]></content>
      <categories>
        <category>工具使用</category>
      </categories>
      <tags>
        <tag>typora</tag>
        <tag>picgo</tag>
      </tags>
  </entry>
  <entry>
    <title>postman 深入使用</title>
    <url>/2018/11/28/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/postman%E6%B7%B1%E5%85%A5%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="设置变量-用于地址拼接"><a href="#设置变量-用于地址拼接" class="headerlink" title="设置变量 用于地址拼接"></a>设置变量 用于地址拼接</h2><p><img data-src="https://bitbw.top/public/img/my_gallery/1574931493737.png" alt="1574931493737"></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 使用时跟插值表达式一样用&#123;&#123; &#125;&#125; 包裹 注意 /的拼接</span></span><br></pre></td></tr></table></figure>

<p><img data-src="https://bitbw.top/public/img/my_gallery/1574932590726.png" alt="1574932590726"></p>
<h2 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h2><h3 id="小技巧"><a href="#小技巧" class="headerlink" title="小技巧"></a>小技巧</h3><blockquote>
<p>可将不同环境的 baseurl 统一设置成一个变量名，然后只需要切换环境就可以请求不同 baseurl 的接口，在配合接口调试阶段很好用</p>
</blockquote>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20210425165810147.png" alt="image-20210425165810147"></p>
<h2 id="拦截器：统一设置-token"><a href="#拦截器：统一设置-token" class="headerlink" title="拦截器：统一设置 token"></a>拦截器：统一设置 token</h2><p><img data-src="https://bitbw.top/public/img/my_gallery/1574932641632.png" alt="1574932641632"></p>
<h2 id="导出自己的项目"><a href="#导出自己的项目" class="headerlink" title="导出自己的项目"></a>导出自己的项目</h2><p><img data-src="https://bitbw.top/public/img/my_gallery/1574932698478.png" alt="1574932698478"></p>
]]></content>
      <categories>
        <category>工具使用</category>
      </categories>
      <tags>
        <tag>工具使用</tag>
        <tag>postman</tag>
      </tags>
  </entry>
  <entry>
    <title>ReactRouterDom常见问题汇总</title>
    <url>/2021/11/13/React/react-router-dom%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h2 id="react-router-dom-v6-0"><a href="#react-router-dom-v6-0" class="headerlink" title="react-router-dom v6.0"></a>react-router-dom v6.0</h2><h3 id="基础用法"><a href="#基础用法" class="headerlink" title="基础用法"></a>基础用法</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span> <span class="keyword">as</span> <span class="title class_">Router</span>, <span class="title class_">Route</span>, <span class="title class_">Routes</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;../styles/global.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Layout</span> <span class="keyword">from</span> <span class="string">&quot;../containers/Layout&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Home</span> <span class="keyword">from</span> <span class="string">&quot;../pages/Home&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Login</span> <span class="keyword">from</span> <span class="string">&quot;../containers/Login&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">RecoveryPassword</span> <span class="keyword">from</span> <span class="string">&quot;../containers/RecoveryPassword&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">NotFound</span> <span class="keyword">from</span> <span class="string">&quot;../pages/NotFound&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">App</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Layout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Home</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Login</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Route</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">exact</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">path</span>=<span class="string">&quot;/recovery-password&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">RecoveryPassword</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">          /&gt;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;*&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">NotFound</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<h3 id="中类组件的用法"><a href="#中类组件的用法" class="headerlink" title="中类组件的用法"></a>中类组件的用法</h3><p>自定义 withRouter 包装类组件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// in hocs.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">withNavigation</span>(<span class="params">Component</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">props</span>) =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">navigate</span>=<span class="string">&#123;useNavigate()&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">withParams</span>(<span class="params">Component</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">props</span>) =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">params</span>=<span class="string">&#123;useParams()&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// in BlogPost.js</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BlogPost</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; id &#125; = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">params</span>;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">withParams</span>(<span class="title class_">BlogPost</span>);</span><br></pre></td></tr></table></figure>

<h3 id="嵌套路由"><a href="#嵌套路由" class="headerlink" title="嵌套路由"></a>嵌套路由</h3><p>App.jsx</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">App</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Login</span> /&gt;</span>&#125;&gt;<span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/register&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Register</span> /&gt;</span>&#125;&gt;<span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;/* 嵌套路由 */&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/*&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Main</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;userInfo&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">UserInfo</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;detail&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">UserDetail</span> /&gt;</span>&#125;&gt;<span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;test&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Test</span> /&gt;</span>&#125;&gt;<span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;*&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">NotFound</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<p>main.jsx</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Outlet</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Main</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Main</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Outlet</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>React</category>
      </categories>
      <tags>
        <tag>ReactRouterDom</tag>
      </tags>
  </entry>
  <entry>
    <title>sqlite的常见问题汇总</title>
    <url>/2021/04/22/SQL/sqlite%E7%9A%84%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h2 id="sqlite-常用文档"><a href="#sqlite-常用文档" class="headerlink" title="sqlite 常用文档"></a>sqlite 常用文档</h2><p><a href="https://www.sqlite.org/docs.html">sqlite文档</a><br><a href="https://www.zetetic.net/sqlcipher/sqlcipher-api/#sqlcipher-api">SQLCipher 文档</a><br><a href="https://github.com/sqlcipher/sqlcipher">SQLCipher 文档2</a><br><a href="https://github.com/journeyapps/node-sqlcipher">node-sqlcipher 文档</a><br><a href="https://github.com/TryGhost/node-sqlite3">node-sqlite3r 文档</a></p>
<h2 id="关于执行-sql-时单双引号的问题"><a href="#关于执行-sql-时单双引号的问题" class="headerlink" title="关于执行 sql 时单双引号的问题"></a>关于执行 sql 时单双引号的问题</h2><p>执行多个插入信息时发现到某条会出现报错：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Error: SQLITE_ERROR: near <span class="string">&quot;s&quot;</span>: syntax error</span><br></pre></td></tr></table></figure>

<p>js 代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">sql = <span class="string">`INSERT INTO &#x27;t_def_component_independentService&#x27; </span></span><br><span class="line"><span class="string">      (PNCode, FCCode, nameCHN, nameENG, descriptionCHN, descriptionENG, specialTips, picture, icon, type, subType, serverModel, serverName, serverPN, serverCategory, AnnounceDate, GeneralAvailableDate, WDAnnounceDate, WithdrawDate, comment, CfgRule, disable, priority, inventory, inventoryClean, version, status) VALUES (&#x27;<span class="subst">$&#123;PNCode&#125;</span>&#x27;, &#x27;<span class="subst">$&#123;FCCode&#125;</span>&#x27;, &#x27;<span class="subst">$&#123;nameCHN&#125;</span>&#x27;, &#x27;<span class="subst">$&#123;nameENG&#125;</span>&#x27;,&#x27;<span class="subst">$&#123;descriptionCHN&#125;</span>&#x27; ,&#x27;<span class="subst">$&#123;descriptionENG&#125;</span>&#x27;, &#x27;<span class="subst">$&#123;specialTips&#125;</span>&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;SERVICE_COMPONENT&#x27;, &#x27;SERVICE&#x27;, &#x27;SERV-IPS&#x27;, &#x27;SERVICE&#x27;, &#x27;FUM-SERVICE-0000&#x27;, &#x27;IPS service product&#x27;, &#x27;2020/4/30&#x27;, &#x27;2020/7/10&#x27;, &#x27;2050/1/1&#x27;, &#x27;2050/1/1&#x27;, NULL, NULL, &#x27;0&#x27;, &#x27;0&#x27;, &#x27;100&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;0&#x27;);`</span>;</span><br></pre></td></tr></table></figure>

<p>生成的 sql</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">&#x27;t_def_component_independentService&#x27;</span>       (PNCode, FCCode, nameCHN, nameENG, descriptionCHN, descriptionENG, specialTips, picture, icon, type, subType, serverModel, serverName, serverPN, serverCategory, AnnounceDate, GeneralAvailableDate, WDAnnounceDate, WithdrawDate, comment, CfgRule, disable, priority, inventory, inventoryClean, version, status)       <span class="keyword">VALUES</span> (<span class="string">&#x27;FUB-SERVICE-SLA1&#x27;</span>, <span class="string">&#x27;SLA1&#x27;</span>, <span class="string">&#x27;人员SLA服务(3/6h到场) （年）&#x27;</span>, <span class="string">&#x27;中文。。。&#x27;</span> , <span class="string">&#x27;... user&#x27;</span>s site according <span class="keyword">to</span> Party A<span class="string">&#x27;s requirements and actual situation</span></span><br><span class="line"><span class="string">1) In 22 cities including Beijing, Shanghai, Guangzhou, Shenyang, Harbin, Xi&#x27;</span>an, ....;<span class="string">&#x27;, &#x27;</span>价格计算方式为&quot;服务器硬件价格*系数&quot;<span class="string">&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;</span>SERVICE_COMPONENT<span class="string">&#x27;, &#x27;</span>SERVICE<span class="string">&#x27;, &#x27;</span>SERV<span class="operator">-</span>IPS<span class="string">&#x27;, &#x27;</span>SERVICE<span class="string">&#x27;, &#x27;</span>FUM<span class="operator">-</span>SERVICE<span class="number">-0000</span><span class="string">&#x27;, &#x27;</span>IPS service product<span class="string">&#x27;, &#x27;</span><span class="number">2020</span><span class="operator">/</span><span class="number">4</span><span class="operator">/</span><span class="number">30</span><span class="string">&#x27;, &#x27;</span><span class="number">2020</span><span class="operator">/</span><span class="number">7</span><span class="operator">/</span><span class="number">10</span><span class="string">&#x27;, &#x27;</span><span class="number">2050</span><span class="operator">/</span><span class="number">1</span><span class="operator">/</span><span class="number">1</span><span class="string">&#x27;, &#x27;</span><span class="number">2050</span><span class="operator">/</span><span class="number">1</span><span class="operator">/</span><span class="number">1</span><span class="string">&#x27;, NULL, NULL, &#x27;</span><span class="number">0</span><span class="string">&#x27;, &#x27;</span><span class="number">0</span><span class="string">&#x27;, &#x27;</span><span class="number">100</span><span class="string">&#x27;, &#x27;</span><span class="number">1</span><span class="string">&#x27;, &#x27;</span><span class="number">1</span><span class="string">&#x27;, &#x27;</span><span class="number">0</span><span class="string">&#x27;);</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<p>可以直接发现 有段描述</p>
<p>&#96;’… user’s site according to Party A’s requirements and actual situation</p>
<ol>
<li>In 22 cities including Beijing, Shanghai, Guangzhou, Shenyang, Harbin, Xi’an, ….;’&#96;</li>
</ol>
<p>因为是英文 所以内容中出现了<code>&#39;</code>单引号 导致语句被截断，造成 sql 语句错误</p>
<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>改 js 代码中字符串的拼接 ，将容易出现单引号的字段内容用双引号包住</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;$&#123;descriptionENG&#125;&quot;</span>;</span><br><span class="line"><span class="comment">//修改为</span></span><br><span class="line"><span class="string">&quot;$&#123;descriptionENG&#125;&quot;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="sqlite-数据库读取不正确问题"><a href="#sqlite-数据库读取不正确问题" class="headerlink" title="sqlite 数据库读取不正确问题"></a>sqlite 数据库读取不正确问题</h2><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>直接替换数据库文件后发生数据库读取不正确的问题</p>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>db连接对象( new sqlite3.Database(dbPath)) 读取一个表后， 当这个表结构改变 （直接替换文件），再读取这个表就会导致数据库读取不正确</p>
<h3 id="解决-1"><a href="#解决-1" class="headerlink" title="解决"></a>解决</h3><p>替换数据库文件后，需要重新创建db连接对象 new sqlite3.Database(dbPath);</p>
<h2 id="使用-sqlcipher-对-sqlite-数据库加密解密"><a href="#使用-sqlcipher-对-sqlite-数据库加密解密" class="headerlink" title="使用 sqlcipher 对 sqlite 数据库加密解密"></a>使用 sqlcipher 对 sqlite 数据库加密解密</h2><p>sqlcipher 数据库解密</p>
<p>使用 sqlcipher.exe 可以在输入密码后，查看加密数据库的内容。</p>
<p>使用sqlcipher windows 命令工具</p>
<p>注意 使用的工具也分版本，要与加密数据库的版本对应起来，否则查看不到表</p>
<p>下载地址：<br>解密时要用与加密时相同的版本<br><a href="https://github.com/sqlcipher/sqlcipher/releases">https://github.com/sqlcipher/sqlcipher/releases</a><br><a href="https://github.com/CovenantEyes/sqlcipher-windows/releases">https://github.com/CovenantEyes/sqlcipher-windows/releases</a></p>
<p>加密后使用命令行还是可以查看滴</p>
<p>创建加密数据库</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ sqlcipher encrypted.db</span><br><span class="line">SQLCipher version 3.8.4.3 2014-04-03 16:53:12</span><br><span class="line">Enter <span class="string">&quot;.help&quot;</span> <span class="keyword">for</span> instructions</span><br><span class="line">Enter SQL statements terminated with a <span class="string">&quot;;&quot;</span></span><br><span class="line">sqlite&gt; PRAGMA key = <span class="string">&#x27;thisiskey&#x27;</span>;</span><br><span class="line">sqlite&gt; create table encrypted (<span class="built_in">id</span> <span class="built_in">integer</span>, name text);</span><br><span class="line">sqlite&gt; .schema</span><br><span class="line">CREATE TABLE encrypted (<span class="built_in">id</span> <span class="built_in">integer</span>, name text);</span><br><span class="line">sqlite&gt; .q</span><br></pre></td></tr></table></figure>

<p>打开加密数据库</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ sqlcipher encrypted.db</span><br><span class="line">SQLCipher version 3.8.4.3 2014-04-03 16:53:12</span><br><span class="line">Enter <span class="string">&quot;.help&quot;</span> <span class="keyword">for</span> instructions</span><br><span class="line">Enter SQL statements terminated with a <span class="string">&quot;;&quot;</span></span><br><span class="line">sqlite&gt; PRAGMA key = <span class="string">&#x27;thisiskey&#x27;</span>;</span><br><span class="line">sqlite&gt; .schema</span><br><span class="line">CREATE TABLE encrypted (<span class="built_in">id</span> <span class="built_in">integer</span>, name text);</span><br></pre></td></tr></table></figure>

<p>修改数据库密码</p>
<p>sqlite&gt; PRAGMA rekey &#x3D; ‘newkey’;</p>
<h3 id="加密已有的数据库"><a href="#加密已有的数据库" class="headerlink" title="加密已有的数据库"></a>加密已有的数据库</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ sqlcipher banklist.sqlite3</span><br><span class="line">SQLCipher version 3.8.4.3 2014-04-03 16:53:12</span><br><span class="line">Enter <span class="string">&quot;.help&quot;</span> <span class="keyword">for</span> instructions</span><br><span class="line">Enter SQL statements terminated with a <span class="string">&quot;;&quot;</span></span><br><span class="line">sqlite&gt; ATTACH DATABASE <span class="string">&#x27;encrypted.db&#x27;</span> AS encrypted KEY <span class="string">&#x27;thisiskey&#x27;</span>;</span><br><span class="line">sqlite&gt; SELECT sqlcipher_export(<span class="string">&#x27;encrypted&#x27;</span>);</span><br><span class="line">sqlite&gt; DETACH DATABASE encrypted;</span><br></pre></td></tr></table></figure>

<h3 id="解密数据库（生成无密码的数据库：-plaintext-db）"><a href="#解密数据库（生成无密码的数据库：-plaintext-db）" class="headerlink" title="解密数据库（生成无密码的数据库： plaintext.db）"></a>解密数据库（生成无密码的数据库： plaintext.db）</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ sqlcipher-shell32 encrypted.db</span><br><span class="line"></span><br><span class="line">sqlite&gt; PRAGMA key = <span class="string">&#x27;thisiskey&#x27;</span>;</span><br><span class="line">sqlite&gt; ATTACH DATABASE <span class="string">&#x27;plaintext.db&#x27;</span> AS plaintext KEY <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">sqlite&gt; SELECT sqlcipher_export(<span class="string">&#x27;plaintext&#x27;</span>);</span><br><span class="line">sqlite&gt; DETACH DATABASE plaintext;</span><br></pre></td></tr></table></figure>

<h2 id="sqlite3数据库备份、导出方法汇总"><a href="#sqlite3数据库备份、导出方法汇总" class="headerlink" title="sqlite3数据库备份、导出方法汇总"></a>sqlite3数据库备份、导出方法汇总</h2><p><a href="https://blog.csdn.net/u010168781/article/details/103311340">sqlite3数据库备份、导出方法汇总</a></p>
]]></content>
      <categories>
        <category>SQL</category>
      </categories>
      <tags>
        <tag>SQL</tag>
        <tag>sqlite</tag>
      </tags>
  </entry>
  <entry>
    <title>switch 多个case的用法</title>
    <url>/2018/12/15/js/switch-%E5%A4%9A%E4%B8%AAcase%E7%9A%84%E7%94%A8%E6%B3%95/</url>
    <content><![CDATA[<p>switch 中想要多个判断都进到一个分支中可以这样写</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (item) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>: <span class="comment">//以上case都执行这个分支</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;进到1,2,3,4里&quot;</span>, item);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;进到5,6里&quot;</span>, item);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//进到1,2,3,4里 1</span></span><br><span class="line"><span class="comment">//进到1,2,3,4里 2</span></span><br><span class="line"><span class="comment">//进到1,2,3,4里 3</span></span><br><span class="line"><span class="comment">//进到1,2,3,4里 4</span></span><br><span class="line"><span class="comment">//进到5,6里 5</span></span><br><span class="line"><span class="comment">//进到5,6里 6</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>treer生成文件结构目录</title>
    <url>/2020/05/22/js/treer%E7%94%9F%E6%88%90%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E7%9B%AE%E5%BD%95/</url>
    <content><![CDATA[<p>参考资料：<a href="https://blog.csdn.net/weixin_43998681/article/details/88708847">https://blog.csdn.net/weixin_43998681/article/details/88708847</a></p>
<blockquote>
<p>tip : treer 生成的机构目录是按大小写倒序生成 ，看起来会怪怪的 可以使用 git bash tree 命令生成 好看正序的</p>
</blockquote>
<h2 id="treer"><a href="#treer" class="headerlink" title="treer"></a>treer</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm install treer -g</span><br><span class="line">// 全局安装treer，如果只想安装在当前目录可以去掉-g</span><br></pre></td></tr></table></figure>

<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ treer --<span class="built_in">help</span> 					//输出treer的使用帮助信息</span><br><span class="line">选项:</span><br><span class="line">-V, --version          			//输出版本号信息</span><br><span class="line">-d, --directory [<span class="built_in">dir</span>]  			//指定一个目录来生成目录树</span><br><span class="line">-i, --ignore [ig]      			//忽略特定的目录名</span><br><span class="line">-e, --<span class="built_in">export</span> [epath]   			//导出目录到一个文件中</span><br></pre></td></tr></table></figure>

<h3 id="具体示例"><a href="#具体示例" class="headerlink" title="具体示例"></a>具体示例</h3><p>输出到 tree.md</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">treer -i <span class="string">&quot;/node_modules|dist_electron|devtools|nouse|.git|.vscode/&quot;</span> -e <span class="string">&quot;tree.md&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="使用-git-bash-tree-命令"><a href="#使用-git-bash-tree-命令" class="headerlink" title="使用 git bash tree 命令"></a>使用 git bash tree 命令</h2><p>git 中默认不带 tree 命令 需要下载 <code>tree.exe</code> 并将其复制到 <code>/git/usr/bin</code> 目录下,这样 <code>git bash</code> 本身就支持 <code>tree</code> 命令了.</p>
<p>下载地址： <a href="https://github.com/zruibin/tree/blob/master/tree.exe">https://github.com/zruibin/tree/blob/master/tree.exe</a></p>
<h3 id="使用方法-1"><a href="#使用方法-1" class="headerlink" title="使用方法"></a>使用方法</h3><p>输出到 tree.md</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ tree -I  <span class="string">&quot;node_modules|devtools|dist_electron|public|nouse&quot;</span>  &gt; tree.md</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>ubuntu 安装 oh-my-posh</title>
    <url>/2021/04/15/Linux/ubuntu-%E5%AE%89%E8%A3%85-oh-my-posh/</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>根据 Windows Terminal 中 powerline 的教程发现 oh-my-posh 还可以安装到 ubuntu 系统下，于是尝试了一下</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>Windows Terminal 中 ubuntu 安装 oh-my-posh 教程：<a href="https://docs.microsoft.com/en-us/windows/terminal/tutorials/powerline-setup">https://docs.microsoft.com/en-us/windows/terminal/tutorials/powerline-setup</a></p>
<p>oh-my-posh 官网：<a href="https://ohmyposh.dev/docs/">https://ohmyposh.dev/docs/</a></p>
<ul>
<li>linux 安装教程：<a href="https://ohmyposh.dev/docs/linux">https://ohmyposh.dev/docs/linux</a></li>
<li>字体安装教程：<a href="https://ohmyposh.dev/docs/fonts">https://ohmyposh.dev/docs/fonts</a></li>
</ul>
<h3 id="安装-oh-my-posh"><a href="#安装-oh-my-posh" class="headerlink" title="安装 oh-my-posh"></a>安装 oh-my-posh</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://github.com/JanDeDobbeleer/oh-my-posh/releases/latest/download/posh-linux-amd64 -O /usr/local/bin/oh-my-posh</span><br><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/oh-my-posh</span><br></pre></td></tr></table></figure>

<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> ~/.poshthemes</span><br><span class="line">wget https://github.com/JanDeDobbeleer/oh-my-posh/releases/latest/download/themes.zip -O ~/.poshthemes/themes.zip</span><br><span class="line">unzip ~/.poshthemes/themes.zip -d ~/.poshthemes</span><br><span class="line"><span class="built_in">chmod</span> u+rw ~/.poshthemes/*.json</span><br><span class="line"><span class="built_in">rm</span> ~/.poshthemes/themes.zip</span><br></pre></td></tr></table></figure>

<p>如果您使用的是 Ubuntu 18.04 或 16.04，则需要先安装正确版本的 golang：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository ppa:longsleep/golang-backports</span><br><span class="line">sudo apt update</span><br></pre></td></tr></table></figure>

<h3 id="自定义您的-Ubuntu-提示"><a href="#自定义您的-Ubuntu-提示" class="headerlink" title="自定义您的 Ubuntu 提示"></a>自定义您的 Ubuntu 提示</h3><p>查看所有主题</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> ~/.poshthemes/*.omp.json; <span class="keyword">do</span> <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$file</span>\n&quot;</span>; oh-my-posh --config <span class="variable">$file</span> --shell universal; <span class="built_in">echo</span> <span class="string">&quot;\n&quot;</span>; <span class="keyword">done</span>;</span><br></pre></td></tr></table></figure>

<p><code>~/.bashrc</code>使用<code>nano ~/.bashrc</code>或您选择的文本编辑器打开文件。这是一个 bash 脚本，每次 bash 启动时运行。添加以下内容（将主题更改为您喜欢的主题）：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">eval</span> <span class="string">&quot;<span class="subst">$(oh-my-posh --init --shell bash --config ~/.poshthemes/jandedobbeleer.omp.json)</span>&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果出现乱码注意安装字体 官方推荐字体 Cascadia Mono PL 使用上会有问题 ，推荐 <a href="https://github.com/ryanoasis/nerd-fonts/releases/download/v2.1.0/Meslo.zip">Meslo LGM NF</a></p>
</blockquote>
<h3 id="字体安装"><a href="#字体安装" class="headerlink" title="字体安装"></a>字体安装</h3><p>官方推荐<a href="https://github.com/ryanoasis/nerd-fonts/releases/download/v2.1.0/Meslo.zip">Meslo LGM NF</a>：<a href="https://ohmyposh.dev/docs/fonts">https://ohmyposh.dev/docs/fonts</a></p>
<p>下载地址：<a href="https://github.com/ryanoasis/nerd-fonts/releases/download/v2.1.0/Meslo.zip">https://github.com/ryanoasis/nerd-fonts/releases/download/v2.1.0/Meslo.zip</a></p>
<p>安装方法：<a href="https://www.cnblogs.com/yuqianwen/p/3715835.html">https://www.cnblogs.com/yuqianwen/p/3715835.html</a></p>
<p>解压</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">unzip Meslo.zip -d Meslo</span><br><span class="line"><span class="built_in">cd</span> Meslo</span><br></pre></td></tr></table></figure>

<p>安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> /usr/share/fonts/ttf</span><br><span class="line">sudo <span class="built_in">cp</span> *.ttf /usr/share/fonts/ttf</span><br><span class="line"><span class="built_in">cd</span> /usr/share/fonts/ttf</span><br><span class="line">sudo <span class="built_in">chmod</span> 744 *</span><br><span class="line">sudo mkfontscale</span><br><span class="line">sudo mkfontdir</span><br><span class="line">sudo fc-cache -f -v</span><br></pre></td></tr></table></figure>

<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20210415135918711.png" alt="image-01"></p>
<h2 id="在-vscode-中字体设置"><a href="#在-vscode-中字体设置" class="headerlink" title="在 vscode 中字体设置"></a>在 vscode 中字体设置</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;terminal.integrated.fontFamily&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MesloLGM NF&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>ubuntu</tag>
        <tag>powerline</tag>
        <tag>oh-my-posh</tag>
      </tags>
  </entry>
  <entry>
    <title>ubuntu下常用软件的安装</title>
    <url>/2021/01/10/Linux/ubuntu%E4%B8%8B%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6%E7%9A%84%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h2 id="安装-git"><a href="#安装-git" class="headerlink" title="安装 git"></a>安装 git</h2><p>官方：<a href="https://git-scm.com/download/linux">https://git-scm.com/download/linux</a></p>
<h2 id="安装搜狗拼音"><a href="#安装搜狗拼音" class="headerlink" title="安装搜狗拼音"></a>安装搜狗拼音</h2><p>官方：<a href="https://pinyin.sogou.com/linux/">https://pinyin.sogou.com/linux/</a> ，<a href="https://pinyin.sogou.com/linux/help.php">https://pinyin.sogou.com/linux/help.php</a></p>
<h2 id="qq"><a href="#qq" class="headerlink" title="qq"></a>qq</h2><p>官方：<a href="https://im.qq.com/linuxqq/download.html">https://im.qq.com/linuxqq/download.html</a></p>
<h3 id="百度网盘"><a href="#百度网盘" class="headerlink" title="百度网盘"></a>百度网盘</h3><p>官方：<a href="https://pan.baidu.com/download">https://pan.baidu.com/download</a></p>
<h2 id="微信网页可用版本"><a href="#微信网页可用版本" class="headerlink" title="微信网页可用版本"></a>微信网页可用版本</h2><p><a href="https://dcstore.spark-app.store/store/chat/wechat-linux-spark/">https://dcstore.spark-app.store/store/chat/wechat-linux-spark/</a></p>
<h2 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h2><p>安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get install nginx</span><br></pre></td></tr></table></figure>

<p>查看 nginx 是否安装成功</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nginx -v</span><br></pre></td></tr></table></figure>

<p>启动 nginx</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service nginx start</span><br></pre></td></tr></table></figure>

<p>关闭</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service nginx stop</span><br></pre></td></tr></table></figure>

<p>详细教程：<a href="https://blog.csdn.net/qq_23832313/article/details/83578836">https://blog.csdn.net/qq_23832313/article/details/83578836</a></p>
<h2 id="使用深度进行安装"><a href="#使用深度进行安装" class="headerlink" title="使用深度进行安装"></a>使用深度进行安装</h2><blockquote>
<p>官方地址：<a href="https://github.com/zq1997/deepin-wine">https://github.com/zq1997/deepin-wine</a></p>
</blockquote>
<ol>
<li>执行命令</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget -O- https://deepin-wine.i-m.dev/setup.sh | sh</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这一步将 apt 的存储库重定向到 Deeppin 储存库</p>
</blockquote>
<p>成功将提示</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">大功告成，现在可以试试安装更新deepin-wine软件了，如：</span><br><span class="line">微信：sudo apt-get install com.qq.weixin.deepin</span><br><span class="line">QQ：sudo apt-get install com.qq.im.deepin</span><br><span class="line">钉钉：sudo apt-get install com.dingtalk.deepin</span><br><span class="line">由于新版变化，安装完成后需要注销重登录才能正常显示应用图标。</span><br><span class="line">如果觉得有用，请到 https://github.com/zq1997/deepin-wine 点个star吧。</span><br></pre></td></tr></table></figure>

<p>微信 文字乱码问题：<a href="https://github.com/zq1997/deepin-wine/issues/15">https://github.com/zq1997/deepin-wine/issues/15</a></p>
<p>自己测试没问题的解决方案</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get install ttf-wqy-microhei  <span class="comment">#文泉驿-微米黑</span></span><br><span class="line">sudo apt-get install ttf-wqy-zenhei  <span class="comment">#文泉驿-正黑</span></span><br><span class="line">sudo apt-get install xfonts-wqy <span class="comment">#文泉驿-点阵宋体</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>ubuntu</tag>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>vscode中jsconfig.json和tsconfig.json的配置</title>
    <url>/2021/04/12/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/vscode%E4%B8%ADjsconfig-json%E5%92%8Ctsconfig-json%E7%9A%84%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<p>前言：在使用 webpack 打包的项目中一般都会设置路径别名，但 vscode 中使用路径别名导入模块后，想通过点击模块跳到对应文件就做不到了，这时需要用到 jsconfig.json 或 tsconfig.json 配置，</p>
<p>官方文档：<a href="https://code.visualstudio.com/docs/languages/jsconfig">https://code.visualstudio.com/docs/languages/jsconfig</a></p>
]]></content>
      <categories>
        <category>工具使用</category>
      </categories>
      <tags>
        <tag>vscode</tag>
        <tag>TS</tag>
      </tags>
  </entry>
  <entry>
    <title>vscode的使用</title>
    <url>/2022/05/21/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/vscode%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="vscode-工作区-settings-json-位置"><a href="#vscode-工作区-settings-json-位置" class="headerlink" title="vscode 工作区 settings.json 位置"></a>vscode 工作区 settings.json 位置</h2><p><a href="https://code.visualstudio.com/docs/getstarted/settings#_workspace-settingsjson-location">官方文档</a></p>
]]></content>
      <categories>
        <category>工具使用</category>
      </categories>
      <tags>
        <tag>vscode</tag>
      </tags>
  </entry>
  <entry>
    <title>vscode设置文件以何种方式高亮解析</title>
    <url>/2020/12/24/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/vscode%E8%AE%BE%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%A5%E4%BD%95%E7%A7%8D%E6%96%B9%E5%BC%8F%E9%AB%98%E4%BA%AE%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<blockquote>
<p>在实际工作中有时需要用到只定义文件后缀 ， 我最近遇到的项目需要定义.rule 文件 ，但语法类似 javascript，文件编辑起来很费劲，因为不带高亮和语法提示，每次修改文件后缀也麻烦 ，我需要的是.rule 文件，以 jjavascript 的方式让 vscode 解析提示和高亮；</p>
</blockquote>
<h2 id="修改设置"><a href="#修改设置" class="headerlink" title="修改设置"></a>修改设置</h2><p>首选项 -&gt; 设置 -&gt;文本编辑器 -&gt;文件</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20201224095242258.png" alt="image-20201224095242258"></p>
<p>修改保存即可 ，语言要写全名 像<code>javascript </code>不要写成<code>js</code></p>
<p>也可以直接编辑 setting</p>
<h2 id="setting-修改"><a href="#setting-修改" class="headerlink" title="setting 修改"></a>setting 修改</h2><p><img data-src="https://bitbw.top/public/img/my_gallery/image-20201224095505868.png" alt="image-20201224095505868"></p>
<p>json 中添加</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;files.associations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;*.rule&quot;</span><span class="punctuation">:</span> <span class="string">&quot;javascript&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>工具使用</category>
      </categories>
      <tags>
        <tag>vscode</tag>
      </tags>
  </entry>
  <entry>
    <title>vue-cli3+git-hook实现代码提交前自动eslint验证和格式化</title>
    <url>/2021/04/22/Vue/vue-cli3+git-hook%E5%AE%9E%E7%8E%B0%E4%BB%A3%E7%A0%81%E6%8F%90%E4%BA%A4%E5%89%8D%E8%87%AA%E5%8A%A8eslint%E9%AA%8C%E8%AF%81%E5%92%8C%E6%A0%BC%E5%BC%8F%E5%8C%96/</url>
    <content><![CDATA[<h2 id="Git-Hook"><a href="#Git-Hook" class="headerlink" title="Git Hook"></a>Git Hook</h2><blockquote>
<p>官方文档：<a href="https://cli.vuejs.org/zh/guide/cli-service.html#git-hook">https://cli.vuejs.org/zh/guide/cli-service.html#git-hook</a><br>在安装@vue&#x2F;cli-service 之后, 也会安装 yorkie，它会让你在 package.json 的 gitHooks 字段中方便地指定 Git hook：</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;gitHooks&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;pre-commit&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lint-staged&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;lint-staged&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;*.&#123;js,vue&#125;&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;vue-cli-service lint&quot;</span><span class="punctuation">,</span> <span class="string">&quot;git add&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><blockquote>
<p>yorkie fork 自 husky 并且与后者不兼容。</p>
</blockquote>
<h3 id="lint-staged-需要安装-否则会报找不到-lint-staged-命令"><a href="#lint-staged-需要安装-否则会报找不到-lint-staged-命令" class="headerlink" title="lint-staged 需要安装 否则会报找不到 lint-staged 命令"></a>lint-staged 需要安装 否则会报找不到 lint-staged 命令</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn add lint-staged --dev</span><br></pre></td></tr></table></figure>

<p>再次 commit 时会看到这样的提示</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git commit -m <span class="string">&quot;Update&quot;</span></span><br><span class="line"> &gt; running pre-commit hook: lint-staged</span><br><span class="line">[STARTED] Preparing...</span><br><span class="line">[SUCCESS] Preparing...</span><br><span class="line">[STARTED] Running tasks...</span><br><span class="line">[STARTED] Running tasks <span class="keyword">for</span> *.&#123;js,vue&#125;</span><br><span class="line">[STARTED] vue-cli-service lint</span><br><span class="line">[SUCCESS] vue-cli-service lint</span><br><span class="line">[SUCCESS] Running tasks <span class="keyword">for</span> *.&#123;js,vue&#125;</span><br><span class="line">[SUCCESS] Running tasks...</span><br><span class="line">[STARTED] Applying modifications...</span><br><span class="line">[SUCCESS] Applying modifications...</span><br><span class="line">[STARTED] Cleaning up...</span><br><span class="line">[SUCCESS] Cleaning up...</span><br><span class="line">[dev 486fef8] Update</span><br><span class="line"> 2 files changed, 2 insertions(+), 2 deletions(-)</span><br></pre></td></tr></table></figure>

<h3 id="commit时有警告"><a href="#commit时有警告" class="headerlink" title="commit时有警告"></a><code>commit</code>时有警告</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">⚠ Some of your tasks use `git add` <span class="built_in">command</span>. Please remove it from the config since all modifications made by tasks will be automatically added to the git commit index.</span><br></pre></td></tr></table></figure>

<p>意思是将<code>git add</code>删除 因为 lint-staged 会将格式化的后的代码自动添加到当前 commit 中</p>
<h2 id="使用-husky"><a href="#使用-husky" class="headerlink" title="使用 husky"></a>使用 husky</h2><p>因为 yorkie 无法向后兼容 所以建议直接使用 husky 做 git hook<br>自动安装配置 lint-staged 和 husky</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npx mrm@2 lint-staged</span><br></pre></td></tr></table></figure>

<p>修改 package.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;lint-staged&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;*.&#123;js,vue&#125;&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;vue-cli-service lint&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>再次 commit 时会看到这样的提示</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git commit -m <span class="string">&quot;Update&quot;</span></span><br><span class="line">[STARTED] Preparing...</span><br><span class="line">[SUCCESS] Preparing...</span><br><span class="line">[STARTED] Running tasks...</span><br><span class="line">[STARTED] Running tasks <span class="keyword">for</span> *.&#123;js,vue&#125;</span><br><span class="line">[STARTED] vue-cli-service lint</span><br><span class="line">[SUCCESS] vue-cli-service lint</span><br><span class="line">[SUCCESS] Running tasks <span class="keyword">for</span> *.&#123;js,vue&#125;</span><br><span class="line">[SUCCESS] Running tasks...</span><br><span class="line">[STARTED] Applying modifications...</span><br><span class="line">[SUCCESS] Applying modifications...</span><br><span class="line">[STARTED] Cleaning up...</span><br><span class="line">[SUCCESS] Cleaning up...</span><br><span class="line">[master c33d119] Update</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br></pre></td></tr></table></figure>

<h2 id="自动-eslint-验证和格式化"><a href="#自动-eslint-验证和格式化" class="headerlink" title="自动 eslint 验证和格式化"></a>自动 eslint 验证和格式化</h2><p>如果项目创建时没有 选择 linter &#x2F; formatter config 需要设置一个标准让 eslint 执行格式化<br>正常有三种标准可以选择</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ESLint + Airbnb config</span><br><span class="line">ESLint + Standard config</span><br><span class="line">ESLint + Prettier</span><br></pre></td></tr></table></figure>

<p>简单的方法想使用哪个标准 使用 vue-cli 创建一个新项目选择对应的标准然后跟现在的项目对比看看缺了些什么<br>下面简单说下各个标准的配置和需要的插件</p>
<h3 id="Airbnb"><a href="#Airbnb" class="headerlink" title="Airbnb"></a>Airbnb</h3><p>下载插件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save-dev @vue/eslint-config-airbnb</span><br></pre></td></tr></table></figure>

<p>修改 eslintConfig</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;eslintConfig&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="attr">&quot;extends&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      ...</span><br><span class="line">      <span class="string">&quot;@vue/airbnb&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<h3 id="Standard"><a href="#Standard" class="headerlink" title="Standard"></a>Standard</h3><p>下载插件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save-dev @vue/eslint-config-standard</span><br></pre></td></tr></table></figure>

<p>修改 eslintConfig</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;eslintConfig&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="attr">&quot;extends&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      ...</span><br><span class="line">      <span class="string">&quot;@vue/standard&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<h3 id="Prettier"><a href="#Prettier" class="headerlink" title="Prettier"></a>Prettier</h3><p>下载插件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save-dev @vue/eslint-config-prettier@6.0.0  eslint-plugin-prettier@3.3.1 prettier@2.2.1</span><br></pre></td></tr></table></figure>

<p>修改 eslintConfig</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">root</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">env</span>: &#123;</span><br><span class="line">    <span class="attr">node</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">extends</span>: [<span class="string">&#x27;plugin:vue/essential&#x27;</span>, <span class="string">&#x27;eslint:recommended&#x27;</span>, <span class="string">&#x27;@vue/prettier&#x27;</span>],</span><br><span class="line">  <span class="attr">parserOptions</span>: &#123;</span><br><span class="line">    <span class="attr">parser</span>: <span class="string">&#x27;babel-eslint&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;no-console&#x27;</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span> ? <span class="string">&#x27;warn&#x27;</span> : <span class="string">&#x27;off&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;no-debugger&#x27;</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span> ? <span class="string">&#x27;warn&#x27;</span> : <span class="string">&#x27;off&#x27;</span>,</span><br><span class="line">    <span class="comment">// 如果强烈要自定义规则，否则不需要添加下面代码 </span></span><br><span class="line">    <span class="string">&#x27;prettier/prettier&#x27;</span>: [</span><br><span class="line">      <span class="string">&#x27;warn&#x27;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">printWidth</span>: <span class="number">80</span>,</span><br><span class="line">        <span class="attr">semi</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">singleQuote</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">trailingComma</span>: <span class="string">&#x27;es5&#x27;</span>,</span><br><span class="line">        <span class="attr">jsxBracketSameLine</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">arrowParens</span>: <span class="string">&#x27;avoid&#x27;</span>,</span><br><span class="line">        <span class="attr">insertPragma</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">tabWidth</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">useTabs</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">bracketSpacing</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">endOfLine</span>: <span class="string">&#x27;auto&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="关于vscode-prettier"><a href="#关于vscode-prettier" class="headerlink" title="关于vscode-prettier"></a>关于vscode-prettier</h4><p>添加.prettierrc 和 修改vscode-prettier规则 会改变 prettier 的默认规则，可能会出现与eslint-config-prettier规则不一致问题 (注意：’prettier&#x2F;prettier’选项将合并并覆盖任何带有<code>.prettierrc</code>文件的配置集)</p>
<blockquote>
<p>建议 ：不修改 eslintConfig 中的规则 ，  不添加.prettierrc ， 不修改 vscode-prettier 规则 ，保持统一风格</p>
</blockquote>
<p>如果非要自定义风格 需要保持 eslintConfig  规则和 .prettierrc 统一风格，或干脆排除 .prettierrc</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;prettier/prettier&quot;</span>: [<span class="string">&quot;error&quot;</span>, &#123;&#125;, &#123;</span><br><span class="line">   <span class="string">//</span> 排除  <span class="string">.prettierrc</span>  防止规则合并</span><br><span class="line">  <span class="string">&quot;usePrettierrc&quot;</span>: <span class="literal">false</span></span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>vue-cli</tag>
      </tags>
  </entry>
  <entry>
    <title>vue + vuetify + electron 实现ctrl+f的搜索功能</title>
    <url>/2021/01/12/Vue/vue-vuetify-electron-%E5%AE%9E%E7%8E%B0ctrl-f%E7%9A%84%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD/</url>
    <content><![CDATA[<blockquote>
<p>因为在 electron 中没有找到 ctrl+f 调用浏览器搜索的方法 于是借鉴文章自己撸了一个搜索组件</p>
</blockquote>
<p>借鉴文章地址：<a href="https://www.jb51.net/article/181616.htm">https://www.jb51.net/article/181616.htm</a></p>
<h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><p><img data-src="https://bitbw.top/public/img/my_gallery/%E5%AE%9E%E7%8E%B0ctrl+f%E7%9A%84%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD.gif" alt="实现ctrl+f的搜索功能"></p>
<span id="more"></span>

<p>模板部分</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;v-card class=&quot;history-info-drawer&quot;&gt;</span><br><span class="line">    &lt;!-- 头部操作栏 --&gt;</span><br><span class="line">      &lt;v-toolbar dense dark color=&quot;primary&quot;&gt;</span><br><span class="line">        &lt;!-- input --&gt;</span><br><span class="line">        &lt;v-text-field</span><br><span class="line">          type=&quot;text&quot;</span><br><span class="line">          hide-details</span><br><span class="line">          prepend-icon=&quot;mdi-magnify&quot;</span><br><span class="line">          single-line</span><br><span class="line">          clearable</span><br><span class="line">          placeholder=&quot;请输入要搜索的字符串 回车进行定位&quot;</span><br><span class="line">          v-model=&quot;searchStr&quot;</span><br><span class="line">          @keyup.enter=&quot;e =&gt; submit()&quot;</span><br><span class="line">        &gt;&lt;/v-text-field&gt;</span><br><span class="line">        &lt;!-- 上下按钮 --&gt;</span><br><span class="line">        &lt;v-btn icon @click=&quot;submit(&#x27;up&#x27;)&quot;&gt;</span><br><span class="line">          &lt;v-icon&gt;mdi-chevron-up&lt;/v-icon&gt;</span><br><span class="line">        &lt;/v-btn&gt;</span><br><span class="line">        &lt;v-btn icon @click=&quot;submit(&#x27;down&#x27;)&quot;&gt;</span><br><span class="line">          &lt;v-icon&gt;mdi-chevron-down&lt;/v-icon&gt;</span><br><span class="line">        &lt;/v-btn&gt;</span><br><span class="line">        &lt;!-- 关闭按钮 --&gt;</span><br><span class="line">        &lt;v-btn icon @click=&quot;$emit(&#x27;input&#x27;, false)&quot;&gt;</span><br><span class="line">          &lt;v-icon&gt;mdi-close&lt;/v-icon&gt;</span><br><span class="line">        &lt;/v-btn&gt;</span><br><span class="line">      &lt;/v-toolbar&gt;</span><br><span class="line">      &lt;!-- 内容显示区域 --&gt;</span><br><span class="line">      &lt;v-card-text&gt;</span><br><span class="line">        &lt;div v-html=&quot;transitionContent&quot; class=&quot;history-info-content&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;/v-card-text&gt;</span><br><span class="line">    &lt;/v-card&gt;</span><br></pre></td></tr></table></figure>

<p>逻辑部分</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;HistoryInfoDrawer&quot;</span>,</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="comment">// 传入的内容字符串</span></span><br><span class="line">    <span class="attr">content</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">      <span class="attr">defualt</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">//搜索内容</span></span><br><span class="line">      <span class="attr">searchStr</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="comment">// 搜索定位</span></span><br><span class="line">      <span class="attr">currentPosition</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="comment">// 经过转换的展示内容</span></span><br><span class="line">      <span class="attr">transitionContent</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="comment">// 当前搜索字符串是否是首次定位</span></span><br><span class="line">      <span class="attr">firstPosition</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">handleTransitionContent</span>(<span class="params">searchStr</span>) &#123;</span><br><span class="line">      <span class="comment">//获取动态变化的搜索词</span></span><br><span class="line">      <span class="keyword">if</span> (searchStr !== <span class="string">&quot;&quot;</span> &amp;&amp; searchStr) &#123;</span><br><span class="line">        <span class="comment">// 将特殊符号转义</span></span><br><span class="line">        <span class="keyword">let</span> searchRegExp = searchStr.<span class="title function_">replace</span>(<span class="regexp">/(\.|\+|\?|\*)/g</span>, <span class="string">&quot;\\$1&quot;</span>);</span><br><span class="line">        <span class="comment">//若搜索词不为空，对搜索词进行替换 背景颜色变黄色</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">content</span></span><br><span class="line">          .<span class="title function_">replace</span>(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">RegExp</span>(searchRegExp, <span class="string">&quot;g&quot;</span>),</span><br><span class="line">            <span class="string">&#x27;&lt;a style=&quot;background-color: yellow;&quot;  &gt;&#x27;</span> + searchStr + <span class="string">&quot;&lt;/a&gt;&quot;</span></span><br><span class="line">          )</span><br><span class="line">          .<span class="title function_">replace</span>(<span class="regexp">/\n/g</span>, <span class="string">&quot;&lt;/br&gt;&quot;</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">content</span>.<span class="title function_">replace</span>(<span class="regexp">/\n/g</span>, <span class="string">&quot;&lt;/br&gt;&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 定位</span></span><br><span class="line">    <span class="title function_">handlePosition</span>(<span class="params">flag = <span class="string">&quot;down&quot;</span></span>) &#123;</span><br><span class="line">      <span class="comment">// 容器</span></span><br><span class="line">      <span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.history-info-content&quot;</span>);</span><br><span class="line">      <span class="comment">// 获取所有a</span></span><br><span class="line">      <span class="keyword">let</span> alist = container.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">      <span class="keyword">let</span> aListLength = alist.<span class="property">length</span>;</span><br><span class="line">      <span class="comment">// 首次搜索不执行定位的增减</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">firstPosition</span>) &#123;</span><br><span class="line">        flag = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">switch</span> (flag) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;down&quot;</span>: &#123;</span><br><span class="line">          <span class="comment">//定位+1，走满一圈归0</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">currentPosition</span> &lt; aListLength - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">currentPosition</span> += <span class="number">1</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">currentPosition</span> == aListLength - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">currentPosition</span> = <span class="number">0</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//定位-1，走满一圈归最后一位</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;up&quot;</span>: &#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">currentPosition</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">currentPosition</span> -= <span class="number">1</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">currentPosition</span> == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">currentPosition</span> = aListLength - <span class="number">1</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Bowen: change &quot;</span>, <span class="variable language_">this</span>.<span class="property">currentPosition</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (aListLength != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 当前的定位元素的背景颜色变红</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> a <span class="keyword">of</span> alist) &#123;</span><br><span class="line">          a.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&quot;yellow&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> currentA = alist[<span class="variable language_">this</span>.<span class="property">currentPosition</span>];</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Bowen: handlePosition -&gt; currentA&quot;</span>, currentA);</span><br><span class="line">        currentA &amp;&amp; (currentA.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&quot;red&quot;</span>);</span><br><span class="line">        <span class="comment">// 滚动到当前元素</span></span><br><span class="line">        currentA.<span class="title function_">scrollIntoView</span>(&#123;</span><br><span class="line">          <span class="attr">behavior</span>: <span class="string">&quot;smooth&quot;</span>,</span><br><span class="line">          <span class="attr">block</span>: <span class="string">&quot;center&quot;</span>,</span><br><span class="line">          <span class="attr">inline</span>: <span class="string">&quot;nearest&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">firstPosition</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">watch</span>: &#123;</span><br><span class="line">    <span class="title function_">searchStr</span>(<span class="params">searchStr</span>) &#123;</span><br><span class="line">      <span class="comment">// 输入改变定位清零</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">currentPosition</span> = <span class="number">0</span>;</span><br><span class="line">      <span class="comment">// 赋值转化后的字符串</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">transitionContent</span> = <span class="variable language_">this</span>.<span class="title function_">handleTransitionContent</span>(searchStr);</span><br><span class="line">      <span class="comment">// 设置为首次定位</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">firstPosition</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 首次先赋值</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">transitionContent</span> = <span class="variable language_">this</span>.<span class="title function_">handleTransitionContent</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>组件使用的是 vuetify ，主要可以看逻辑部分 element 等组件的用法大同小异</p>
</blockquote>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vuetify</tag>
        <tag>Electron</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>vuetify常见问题汇总</title>
    <url>/2021/06/09/Vue/vuetify%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h2 id="vuetify-2-5-3-版本提示-DEPRECATION-WARNING-Using-x2F-for-division-is-deprecated-and-will-be-removed-in-Dart-Sass-2-0-0"><a href="#vuetify-2-5-3-版本提示-DEPRECATION-WARNING-Using-x2F-for-division-is-deprecated-and-will-be-removed-in-Dart-Sass-2-0-0" class="headerlink" title="vuetify 2.5.3 版本提示 DEPRECATION WARNING: Using &#x2F; for division is deprecated and will be removed in Dart Sass 2.0.0."></a>vuetify 2.5.3 版本提示 DEPRECATION WARNING: Using &#x2F; for division is deprecated and will be removed in Dart Sass 2.0.0.</h2><h3 id="github-issues"><a href="#github-issues" class="headerlink" title="github issues:"></a>github issues:</h3><p><a href="https://github.com/vuetifyjs/vuetify/issues/13694">https://github.com/vuetifyjs/vuetify/issues/13694</a></p>
<h3 id="完整提示"><a href="#完整提示" class="headerlink" title="完整提示"></a>完整提示</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">DEPRECATION WARNING: Using / <span class="keyword">for</span> division is deprecated and will be removed <span class="keyword">in</span> Dart Sass 2.0.0.</span><br><span class="line"></span><br><span class="line">Recommendation: math.div(<span class="variable">$grid</span>-gutter, 6)</span><br><span class="line"></span><br><span class="line">More info and automated migrator: https://sass-lang.com/d/slash-div</span><br><span class="line"></span><br><span class="line">   ╷</span><br><span class="line">62 │     <span class="string">&#x27;sm&#x27;</span>: <span class="variable">$grid</span>-gutter / 6,</span><br><span class="line">   │           ^^^^^^^^^^^^^^^^</span><br><span class="line">   ╵</span><br><span class="line">    node_modules/vuetify/src/styles/settings/_variables.scss 62:11      @import</span><br><span class="line">    node_modules/vuetify/src/styles/settings/_index.sass 1:9            @import</span><br><span class="line">    node_modules/vuetify/src/styles/styles.sass 2:9                     @import</span><br><span class="line">    node_modules/vuetify/src/components/VDataTable/_variables.scss 1:9  @import</span><br><span class="line">    stdin 2:9                                                           root stylesheet</span><br><span class="line"></span><br><span class="line">DEPRECATION WARNING: Using / <span class="keyword">for</span> division is deprecated and will be removed <span class="keyword">in</span> Dart Sass 2.0.0.</span><br><span class="line"></span><br><span class="line">Recommendation: math.div(<span class="variable">$grid</span>-gutter, 6)</span><br><span class="line"></span><br><span class="line">More info and automated migrator: https://sass-lang.com/d/slash-div</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>用 sass &lt; 1.33 作为解决方法</p>
<p>官方的说明：我正在为此恢复修复，它完全破坏了注入自定义 sass 变量（<a href="https://github.com/vuetifyjs/vuetify/issues/13737">#13737</a>）的项目。要使警告静音，请安装<code>sass@~1.32</code></p>
<p>步骤：</p>
<p>修改 package.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;sass&quot;</span><span class="punctuation">:</span> <span class="string">&quot;~1.32&quot;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>然后 npm install</p>
<h1 id="v-autocomplete-多选-不保留滚动位置"><a href="#v-autocomplete-多选-不保留滚动位置" class="headerlink" title="v-autocomplete 多选 不保留滚动位置"></a>v-autocomplete 多选 不保留滚动位置</h1><h3 id="github-issues-1"><a href="#github-issues-1" class="headerlink" title="github issues:"></a>github issues:</h3><p><a href="https://github.com/vuetifyjs/vuetify/issues/11969">https://github.com/vuetifyjs/vuetify/issues/11969</a></p>
<h3 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h3><p><a href="https://github.com/treardon17/vuetify/commit/9f8059112eabbd890f9f3efbc59459235a777996">https://github.com/treardon17/vuetify/commit/9f8059112eabbd890f9f3efbc59459235a777996</a></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//packages/vuetify/src/components/VSelect/VSelect.ts</span></span><br><span class="line"><span class="comment">// 删除下面的代码</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">setMenuIndex</span>(-<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<h3 id="解决-1"><a href="#解决-1" class="headerlink" title="解决"></a>解决</h3><p>可以使用 github issues 中的解决方案 ，或者等官方更新修复这个 bug</p>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vuetify</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>vuetify自定义过度动画createSimpleTransition的使用实现左右抽屉效果</title>
    <url>/2021/01/11/Vue/vuetify%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E5%BA%A6%E5%8A%A8%E7%94%BBcreateSimpleTransition%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<blockquote>
<p>因为 vuetify 中 dailog 只有上下抽屉的效果，想要左右抽屉效果 于是自己写了一个左右抽屉的组件 其中比较难搞的还是样式 和过渡</p>
<p>vuetify 中创建过渡组件的方式：<a href="https://vuetifyjs.com/zh-Hans/styles/transitions/#todo-list">https://vuetifyjs.com/zh-Hans/styles/transitions/#todo-list</a></p>
</blockquote>
<p>实现效果：</p>
<span id="more"></span>

<p><img data-src="https://bitbw.top/public/img/my_gallery/vuetfiy%E6%8A%BD%E5%B1%89%E6%95%88%E6%9E%9C.gif" alt="vuetfiy抽屉效果"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;v-dialog</span><br><span class="line">    class=&quot;slide-drawer&quot;</span><br><span class="line">    content-class=&quot;my-slide-drawer&quot;</span><br><span class="line">    :value=&quot;value&quot;</span><br><span class="line">    @input=&quot;(val) =&gt; $emit(&#x27;input&#x27;, val)&quot;</span><br><span class="line">    scrollable</span><br><span class="line">    width=&quot;600px&quot;</span><br><span class="line">    v-bind=&quot;$attrs&quot;</span><br><span class="line">    v-on=&quot;$listeners&quot;</span><br><span class="line">    transition=&quot;my-transition&quot;</span><br><span class="line">    origin=&quot;0px 0px&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;v-card&gt;</span><br><span class="line">      &lt;v-card-title&gt;</span><br><span class="line">        &lt;v-btn icon @click=&quot;$emit(&#x27;input&#x27;, false)&quot;&gt;</span><br><span class="line">          &lt;v-icon&gt;mdi-close&lt;/v-icon&gt;</span><br><span class="line">        &lt;/v-btn&gt;</span><br><span class="line">      &lt;/v-card-title&gt;</span><br><span class="line">      &lt;v-divider&gt;&lt;/v-divider&gt;</span><br><span class="line">      &lt;v-card-text&gt;</span><br><span class="line">        &lt;div v-html=&quot;content&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;/v-card-text&gt;</span><br><span class="line">    &lt;/v-card&gt;</span><br><span class="line">  &lt;/v-dialog&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// 导入创建组件方法</span><br><span class="line">import &#123; createSimpleTransition &#125; from &quot;vuetify/lib/components/transitions/createTransition&quot;;</span><br><span class="line">// 创建 my-transition 过渡组件  这个组件在模板中的transition属性使用</span><br><span class="line">const myTransition = createSimpleTransition(&quot;my-transition&quot;);</span><br><span class="line">// 注册组件</span><br><span class="line">import Vue from &quot;vue&quot;;</span><br><span class="line">Vue.component(&quot;my-transition&quot;, myTransition);</span><br><span class="line">// import Dialog from &quot;@/components/common/dialog&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;HistoryInfoDrawer&quot;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    // Dialog</span><br><span class="line">  &#125;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    value: &#123;</span><br><span class="line">      type: Boolean,</span><br><span class="line">      defualt: false,</span><br><span class="line">    &#125;,</span><br><span class="line">    content: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">      defualt: &quot;&quot;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">.v-dialog__content &#123;</span><br><span class="line">  // 改变dialog布局 靠右</span><br><span class="line">  justify-content: start !important;</span><br><span class="line">&#125;</span><br><span class="line">::v-deep &#123;</span><br><span class="line">  .my-slide-drawer &#123;</span><br><span class="line">    border-radius: 0;</span><br><span class="line">    margin: 0;</span><br><span class="line">    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);</span><br><span class="line">    max-height: 100% !important;</span><br><span class="line">    .v-sheet.v-card &#123;</span><br><span class="line">      border-radius: 0;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  // 添加侧面抽屉效果</span><br><span class="line">  .my-transition &#123;</span><br><span class="line">    // 进入和离开的状态</span><br><span class="line">    &amp;-enter,</span><br><span class="line">    &amp;-leave-to &#123;</span><br><span class="line">      transform: translateX(-800px);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">或者=================================</span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">// 添加侧面抽屉效果</span><br><span class="line">.my-transition &#123;</span><br><span class="line">  &amp;-enter,</span><br><span class="line">  &amp;-leave-to &#123;</span><br><span class="line">    transform: translateX(-800px);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意事项：样式不能在 scoped 中要不不会生效 或者放到 ::v-deep 中</p>
</blockquote>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vuetify</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>vue 移动端采坑</title>
    <url>/2019/03/02/Vue/vue%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%87%87%E5%9D%91/</url>
    <content><![CDATA[<h2 id="1-报错"><a href="#1-报错" class="headerlink" title="1.报错"></a>1.报错</h2><h3 id="组件没注册报错"><a href="#组件没注册报错" class="headerlink" title="组件没注册报错"></a>组件没注册报错</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">vue.<span class="property">esm</span>.<span class="property">js</span>?<span class="attr">efeb</span>:<span class="number">591</span> [<span class="title class_">Vue</span> warn]: <span class="title class_">Unknown</span> custom <span class="attr">element</span>: &lt;el-container&gt; - did you register the component correctly? <span class="title class_">For</span> recursive components, make sure to provide the <span class="string">&quot;name&quot;</span> option.</span><br><span class="line"></span><br><span class="line">found <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">---&gt; &lt;<span class="title class_">Container</span>&gt; at src/components/<span class="title class_">Container</span>.<span class="property">vue</span></span><br><span class="line">       &lt;<span class="title class_">App</span>&gt; at src/<span class="title class_">App</span>.<span class="property">vue</span></span><br><span class="line">         &lt;<span class="title class_">Root</span>&gt;</span><br></pre></td></tr></table></figure>

<p><strong>以上错误 表示你没有注册这个组件 需要单独注册</strong></p>
<h3 id="JSON-parse-的使用"><a href="#JSON-parse-的使用" class="headerlink" title="JSON.parse()的使用"></a><code>JSON.parse()</code>的使用</h3><p><img data-src="https://bitbw.top/public/img/my_gallery/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20191201171855.jpg" alt="搜狗截图20191201171855"></p>
<blockquote>
<p>注意：**<code>JSON.parse(null)</code> 是返回 null 其他除了 string 类型的数据都会报错**</p>
</blockquote>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>webpack5配置示例</title>
    <url>/2022/04/29/Webpack/webpack5%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B/</url>
    <content><![CDATA[<h2 id="简易-webpack-开发环境配置"><a href="#简易-webpack-开发环境配置" class="headerlink" title="简易 webpack 开发环境配置"></a>简易 webpack 开发环境配置</h2><p>用于开发一些简易功能和页面</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm i -D webpack webpack-cli webpack-dev-server@next</span><br></pre></td></tr></table></figure>

<h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack-dev-server&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<h3 id="webpack-config-js"><a href="#webpack-config-js" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;bundle.js&quot;</span>,</span><br><span class="line">    <span class="comment">// 虚拟路径 引入时使用 /virtual/bundle.js</span></span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&quot;/virtual/&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="comment">// 告诉服务器从哪个目录中提供内容。只有在你想要提供静态文件时才需要。。</span></span><br><span class="line">    <span class="attr">static</span>: &#123;</span><br><span class="line">      <span class="attr">directory</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;public&quot;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 压缩</span></span><br><span class="line">    <span class="attr">compress</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">9000</span>,</span><br><span class="line">    <span class="attr">hot</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">    <span class="comment">// source-map 方便进行调试</span></span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;eval-source-map&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="scr-和-public-文件夹"><a href="#scr-和-public-文件夹" class="headerlink" title="scr 和 public 文件夹"></a>scr 和 public 文件夹</h3><p> 新建 &#x2F;src&#x2F;index.js</p>
 <figure class="highlight js"><table><tr><td class="code"><pre><span class="line"> <span class="comment">// 需要进行开发的入口</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello webpack&quot;</span>)</span><br></pre></td></tr></table></figure>

<p> 新建 &#x2F;public&#x2F;index.html</p>
 <figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>webpack5 dev<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/virtual/bundle.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="启动开发服务器"><a href="#启动开发服务器" class="headerlink" title="启动开发服务器"></a>启动开发服务器</h3> <figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"> npm run dev</span><br><span class="line">&lt;i&gt; [webpack-dev-server] <span class="keyword">Project</span> is running at:</span><br><span class="line">&lt;i&gt; [webpack-dev-server] Loopback: http:<span class="comment">//localhost:9000/</span></span><br><span class="line">&lt;i&gt; [webpack-dev-server] On Your Network (IPv4): http:<span class="comment">//192.168.1.71:9000/</span></span><br><span class="line">&lt;i&gt; [webpack-dev-server] Content not <span class="keyword">from</span> webpack is served <span class="keyword">from</span> <span class="string">&#x27;C:\BowenData\study\vue-theory\03_ast\public&#x27;</span> directory</span><br><span class="line">asset bundle.js <span class="number">537</span> KiB [emitted] (name: main)</span><br><span class="line"><span class="keyword">runtime</span> modules <span class="number">26.3</span> KiB <span class="number">11</span> modules</span><br><span class="line">modules by path .<span class="regexp">/node_modules/</span> <span class="number">157</span> KiB</span><br><span class="line">  modules by path .<span class="regexp">/node_modules/</span>webpack-dev-server<span class="regexp">/client/</span> <span class="number">52.4</span> KiB <span class="number">12</span> modules</span><br><span class="line">  modules by path .<span class="regexp">/node_modules/</span>webpack<span class="regexp">/hot/</span>*.js <span class="number">4.3</span> KiB</span><br><span class="line">    .<span class="regexp">/node_modules/</span>webpack<span class="regexp">/hot/</span>dev-server.js <span class="number">1.59</span> KiB [built] [code generated] </span><br><span class="line">    .<span class="regexp">/node_modules/</span>webpack<span class="regexp">/hot/</span>log.js <span class="number">1.34</span> KiB [built] [code generated]</span><br><span class="line">    + <span class="number">2</span> modules</span><br><span class="line">  modules by path .<span class="regexp">/node_modules/</span>html-entities<span class="regexp">/lib/</span>*.js <span class="number">81.3</span> KiB</span><br><span class="line">    .<span class="regexp">/node_modules/</span>html-entities<span class="regexp">/lib/i</span>ndex.js <span class="number">7.74</span> KiB [built] [code generated]</span><br><span class="line">    .<span class="regexp">/node_modules/</span>html-entities<span class="regexp">/lib/</span>named-references.js <span class="number">72.7</span> KiB [built] [code generated]</span><br><span class="line">    + <span class="number">2</span> modules</span><br><span class="line">  .<span class="regexp">/node_modules/</span>ansi-html-community/index.js <span class="number">4.16</span> KiB [built] [code generated]</span><br><span class="line">  .<span class="regexp">/node_modules/</span>events/events.js <span class="number">14.5</span> KiB [built] [code generated]</span><br><span class="line">.<span class="regexp">/src/i</span>ndex.js <span class="number">28</span> bytes [built] [code generated]</span><br><span class="line">webpack <span class="number">5.72</span>.<span class="number">0</span> compiled successfully in <span class="number">1574</span> ms</span><br><span class="line">asset bundle.js <span class="number">537</span> KiB [emitted] (name: main)</span><br><span class="line">asset main.<span class="number">73</span>bd99d3636e685c7e88.hot-update.js <span class="number">1.47</span> KiB [emitted] [<span class="keyword">immutable</span>] [hmr] (name: main)</span><br><span class="line">asset main.<span class="number">73</span>bd99d3636e685c7e88.hot-update.json <span class="number">28</span> bytes [emitted] [<span class="keyword">immutable</span>] [hmr]</span><br><span class="line">Entrypoint main <span class="number">538</span> KiB = bundle.js <span class="number">537</span> KiB main.<span class="number">73</span>bd99d3636e685c7e88.hot-update.js <span class="number">1.47</span> KiB</span><br><span class="line">cached modules <span class="number">157</span> KiB [cached] <span class="number">22</span> modules</span><br><span class="line"><span class="keyword">runtime</span> modules <span class="number">26.3</span> KiB <span class="number">11</span> modules</span><br><span class="line">.<span class="regexp">/src/i</span>ndex.js <span class="number">64</span> bytes [built] [code generated]</span><br><span class="line">webpack <span class="number">5.72</span>.<span class="number">0</span> compiled successfully in <span class="number">136</span> ms</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Webpack</category>
      </categories>
      <tags>
        <tag>Webpack</tag>
        <tag>Webpack-cli</tag>
      </tags>
  </entry>
  <entry>
    <title>webpack入门(webpak4)</title>
    <url>/2021/01/02/Webpack/webpack%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<h2 id="webpack-基础知识"><a href="#webpack-基础知识" class="headerlink" title="webpack 基础知识"></a>webpack 基础知识</h2><h3 id="需要用到的包介绍"><a href="#需要用到的包介绍" class="headerlink" title="需要用到的包介绍"></a>需要用到的包介绍</h3><ul>
<li>webpack - webpack 的核心包</li>
<li>webpack-cli - webpack 的命令行工具</li>
<li>webpack-dev-server - webpack 的开发服务器 （热更新）</li>
</ul>
<h3 id="webpack-cil-命令参考"><a href="#webpack-cil-命令参考" class="headerlink" title="webpack-cil 命令参考"></a>webpack-cil 命令参考</h3><p><a href="https://webpack.js.org/api/cli/">https://webpack.js.org/api/cli/</a></p>
<h3 id="webpack-的打包过程"><a href="#webpack-的打包过程" class="headerlink" title="webpack 的打包过程"></a>webpack 的打包过程</h3><p><img data-src="https://bitbw.top/public/img/my_gallery/web%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png"></p>
<h3 id="webpack-初体验"><a href="#webpack-初体验" class="headerlink" title="webpack 初体验"></a>webpack 初体验</h3><ul>
<li>webpack 将 ES6 的模块化编译成浏览器能够识别的模块化</li>
<li>webpack 默认只能打包 js 和 json 文件</li>
<li>生产环境和开发环境的区别 ，开发环境是经过压缩的代码</li>
</ul>
<p>使用命令行设置打包入口出口和 mode</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">webpack --entry  ./src/index.js -o ./dist --mode=development <span class="comment">#开发模式</span></span><br><span class="line"></span><br><span class="line">webpack --entry  ./src/index.js -o ./dist --mode=production <span class="comment">#生产模式</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="webpack-config-js"><a href="#webpack-config-js" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h3><blockquote>
<p>指示 webpack 来干那些活 当运行 webpack 指令时 会加载里面的配置</p>
</blockquote>
<h2 id="打包样式资源"><a href="#打包样式资源" class="headerlink" title="打包样式资源"></a>打包样式资源</h2><h4 id="下载插件"><a href="#下载插件" class="headerlink" title="下载插件"></a>下载插件</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm i css-loader style-loader less-loader less -D</span><br></pre></td></tr></table></figure>

<h4 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h4><h5 id="普通-css-文件"><a href="#普通-css-文件" class="headerlink" title="普通 css 文件"></a>普通 css 文件</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">//入口</span></span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  <span class="comment">//出口</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;bundle.js&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//模式 development 、 production</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="comment">// loader</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// 执行顺序由右到左</span></span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// plugins 插件 （数组）</span></span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//index.js 中引入样式 webpack 会通过import加载css 再通过 css-loader -&gt;style-loader 转换为style标签放在head中</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./index.css&quot;</span>;</span><br></pre></td></tr></table></figure>

<h5 id="引入-less-或-sass-样式处理文件"><a href="#引入-less-或-sass-样式处理文件" class="headerlink" title="引入 less 或 sass 样式处理文件"></a>引入 less 或 sass 样式处理文件</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// rules 中 添加 less  或 sass 的处理规则</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">test</span>:<span class="regexp">/\.less$/</span>,</span><br><span class="line">    <span class="attr">use</span>:[</span><br><span class="line">      <span class="comment">//转化为style</span></span><br><span class="line">      <span class="string">&quot;style-loader&quot;</span>,</span><br><span class="line">      <span class="comment">// 处理css</span></span><br><span class="line">      <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">      <span class="comment">// 转化为css</span></span><br><span class="line">      <span class="string">&quot;less-loader&quot;</span></span><br><span class="line">    ]</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><p>less 和 sass 不光要下对应的 loader 还需要 less 或 sass 包</p>
<p>ps：node-sass 安装起来比较麻烦 可以参照 <a href="https://www.cnblogs.com/zhishaofei/p/12712937.html">https://www.cnblogs.com/zhishaofei/p/12712937.html</a></p>
<h2 id="打包-HTML-资源"><a href="#打包-HTML-资源" class="headerlink" title="打包 HTML 资源"></a>打包 HTML 资源</h2><h4 id="下载插件-1"><a href="#下载插件-1" class="headerlink" title="下载插件"></a>下载插件</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save-dev html-webpack-plugin</span><br></pre></td></tr></table></figure>

<p>tip: html-webpack-plugin 和 html-loader 的不同</p>
<ul>
<li>html-loader 是用来解析入口文件中关联的 html 中的 image 图片的引入</li>
<li>html-webpack-plugin 是用来自动生成最后 dist 目录下的 index.html (并自动导入打包好的 js)</li>
</ul>
<p>html-webpack-plugin 插件的更多配置见官网 ：<a href="https://github.com/jantimon/html-webpack-plugin">https://github.com/jantimon/html-webpack-plugin</a></p>
<h4 id="修改配置-1"><a href="#修改配置-1" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;bundle.js&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// HtmlWebpackPlugin 会自动在output目录下生成index.html</span></span><br><span class="line">    <span class="comment">// 并自动引入打包好的 bundle.js</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 以./src/index.html 为模板 生成最后打包好的html</span></span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./src/index.html&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="打包图片资源"><a href="#打包图片资源" class="headerlink" title="打包图片资源"></a>打包图片资源</h2><h4 id="下载插件-2"><a href="#下载插件-2" class="headerlink" title="下载插件"></a>下载插件</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save-dev html-loader url-loader file-loader</span><br></pre></td></tr></table></figure>

<h4 id="修改配置-2"><a href="#修改配置-2" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;bunle.js&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&quot;&quot;</span>, <span class="comment">// webpack5 中html中导入image需要设置publicPath （升级html-webpack-plugin 到 5.xx可以不用）</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 解析图标 将小图标直接转base64 url-loader 依赖 file-loader 需要一起下载</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(jpg|png|gif)$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&quot;url-loader&quot;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">              <span class="comment">// 小于8kb的以base64位插入 data:image/jpeg;base64,/9j</span></span><br><span class="line">              <span class="comment">// 大于8kb的以改为hash值为名称的原文件插入</span></span><br><span class="line">              <span class="attr">limit</span>: <span class="number">8</span> * <span class="number">1024</span>,</span><br><span class="line">              <span class="attr">esModule</span>: <span class="literal">false</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 处理html文件的img图片（负责引入img，从而能被url-loader进行处理）</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.html$/</span>,</span><br><span class="line">        <span class="attr">use</span>: <span class="string">&quot;html-loader&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./index.html&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="打包其他资源（字体等）"><a href="#打包其他资源（字体等）" class="headerlink" title="打包其他资源（字体等）"></a>打包其他资源（字体等）</h2><h4 id="修改配置-3"><a href="#修改配置-3" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 处理其他资源</span></span><br><span class="line">  <span class="attr">exclude</span>: <span class="regexp">/\.(html|js|css|less|jpg|png|gif)/</span>,</span><br><span class="line">  <span class="attr">loader</span>: <span class="string">&#x27;file-loader&#x27;</span>,</span><br><span class="line">  <span class="attr">options</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;[hash:10].[ext]&#x27;</span>,</span><br><span class="line">    <span class="attr">outputPath</span>: <span class="string">&#x27;font&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="devServer"><a href="#devServer" class="headerlink" title="devServer"></a>devServer</h2><h4 id="下载插件-3"><a href="#下载插件-3" class="headerlink" title="下载插件"></a>下载插件</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm i webpack-dev-server -D</span><br></pre></td></tr></table></figure>

<h4 id="修改配置-4"><a href="#修改配置-4" class="headerlink" title="修改配置"></a>修改配置</h4><p>webpack.config.js 中添加</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 开发服务器 devServer：用来自动化（自动编译，自动打开浏览器，自动刷新浏览器~~）</span></span><br><span class="line"><span class="comment">// 特点：只会在内存中编译打包，不会有任何输出</span></span><br><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="comment">// 项目构建后路径</span></span><br><span class="line">    <span class="attr">contentBase</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;build&#x27;</span>),</span><br><span class="line">    <span class="comment">// 启动gzip压缩</span></span><br><span class="line">    <span class="attr">compress</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 端口号</span></span><br><span class="line">    <span class="attr">port</span>: <span class="number">3000</span>,</span><br><span class="line">    <span class="comment">// 自动打开浏览器</span></span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="webpack-5"><a href="#webpack-5" class="headerlink" title="webpack 5"></a>webpack 5</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">  <span class="comment">// 告诉服务器从哪个目录中提供内容。只有在你想要提供静态文件时才需要。。</span></span><br><span class="line">  <span class="attr">static</span>: &#123;</span><br><span class="line">    <span class="attr">directory</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;public&quot;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 压缩</span></span><br><span class="line">  <span class="attr">compress</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">port</span>: <span class="number">9000</span>,</span><br><span class="line">  <span class="attr">hot</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">devMiddleware</span>: &#123;</span><br><span class="line">    <span class="comment">// 虚拟路径 devServer.publicPath 将用于确定应该从哪里提供 bundle，并且此选项优先</span></span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&quot;/public/&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p><strong>调用服务使用命令</strong></p>
<p>如全局安装 wabpack 直接: <code>webpack serve</code></p>
<p>没有全局安装 webpack :<code>npx webpack serve</code></p>
<p>启动服务后不会生成固定文件 devserver 会在内存中进行编译</p>
<h4 id="使用-express-作为开发服务器配置"><a href="#使用-express-作为开发服务器配置" class="headerlink" title="使用 express 作为开发服务器配置"></a>使用 express 作为开发服务器配置</h4><p><a href="https://webpack.docschina.org/guides/development/#using-webpack-dev-middleware">https://webpack.docschina.org/guides/development/#using-webpack-dev-middleware</a></p>
<h2 id="提取-css-文件为单独资源"><a href="#提取-css-文件为单独资源" class="headerlink" title="提取 css 文件为单独资源"></a>提取 css 文件为单独资源</h2><blockquote>
<p>用上面的方法打包出来的 css 都在 js 文件中 感觉加载时会闪一下 所以单独提炼出 css (使用 link 标签)</p>
</blockquote>
<h4 id="下载插件-4"><a href="#下载插件-4" class="headerlink" title="下载插件"></a>下载插件</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save-dev mini-css-extract-plugin</span><br></pre></td></tr></table></figure>

<h4 id="修改配置-5"><a href="#修改配置-5" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">   <span class="attr">rules</span>: [</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">       <span class="attr">use</span>: [</span><br><span class="line">         <span class="comment">// 这个loader取代style-loader。作用：提取js中的css成单独文件</span></span><br><span class="line">         <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">         <span class="string">&quot;css-loader&quot;</span></span><br><span class="line">       ]</span><br><span class="line">     &#125;</span><br><span class="line">   ]</span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">plugins</span>: [</span><br><span class="line">   <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">     <span class="attr">template</span>: <span class="string">&quot;./src/index.html&quot;</span></span><br><span class="line">   &#125;),</span><br><span class="line">   <span class="comment">// 对输出的css文件进行重命名</span></span><br><span class="line">   <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">     <span class="attr">filename</span>: <span class="string">&quot;css/index.css&quot;</span></span><br><span class="line">   &#125;),</span><br><span class="line"> ]</span><br></pre></td></tr></table></figure>

<h2 id="css-兼容性处理"><a href="#css-兼容性处理" class="headerlink" title="css 兼容性处理"></a>css 兼容性处理</h2><p>基于：<a href="https://www.postcss.com.cn/">postcss</a></p>
<p>postcss 相当于一个启动器，里面可以装各种 插件 如 postcss-preset-env（预设环境） 和 autoprefixer(自动前缀)</p>
<h4 id="下载插件-5"><a href="#下载插件-5" class="headerlink" title="下载插件"></a>下载插件</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save-dev postcss-loader postcss-preset-env</span><br></pre></td></tr></table></figure>

<ul>
<li>postcss-loader ：</li>
</ul>
<blockquote>
<p>在所有 css | sass | less loader 前使用 作用： 使用 postcss 来解析 css</p>
</blockquote>
<ul>
<li>postcss-preset-env :</li>
</ul>
<blockquote>
<p>帮你将最新的 CSS 语法转换成大多数浏览器都能理解的语法，并根据你的目标浏览器或运行时环境来确定你需要的 polyfillss （postcss-preset-env 为 postcss 的 预设环境）</p>
</blockquote>
<h4 id="修改配置-6"><a href="#修改配置-6" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">rules</span>: [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">    <span class="attr">use</span>: [</span><br><span class="line">      <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">      <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">            css兼容性处理：postcss --&gt; postcss-loader -postcsspreset-env</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            帮postcss找到package.json中browserslist里面的配置，通过配置加载指定的css兼容性样式</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            &quot;browserslist&quot;: &#123;</span></span><br><span class="line"><span class="comment">              // 开发环境 --&gt; 设置node环境变量：process.env.NODE_ENV = development</span></span><br><span class="line"><span class="comment">              &quot;development&quot;: [</span></span><br><span class="line"><span class="comment">                &quot;last 1 chrome version&quot;,</span></span><br><span class="line"><span class="comment">                &quot;last 1 firefox version&quot;,</span></span><br><span class="line"><span class="comment">                &quot;last 1 safari version&quot;</span></span><br><span class="line"><span class="comment">              ],</span></span><br><span class="line"><span class="comment">              // 生产环境：默认是看生产环境</span></span><br><span class="line"><span class="comment">              &quot;production&quot;: [</span></span><br><span class="line"><span class="comment">                &quot;&gt;0.2%&quot;,</span></span><br><span class="line"><span class="comment">                &quot;not dead&quot;,</span></span><br><span class="line"><span class="comment">                &quot;not op_mini all&quot;</span></span><br><span class="line"><span class="comment">              ]</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">          */</span></span><br><span class="line">      <span class="comment">// 使用loader的默认配置</span></span><br><span class="line">      <span class="comment">// &#x27;postcss-loader&#x27;,</span></span><br><span class="line">      <span class="comment">// 修改loader的配置</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">          <span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">            <span class="attr">plugins</span>: [</span><br><span class="line">              [</span><br><span class="line">                <span class="string">&quot;postcss-preset-env&quot;</span>,</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="comment">// Options</span></span><br><span class="line">                &#125;,</span><br><span class="line">              ],</span><br><span class="line">              <span class="comment">// 或者 require(&quot;postcss-preset-env&quot;)()</span></span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h4 id="browserslist"><a href="#browserslist" class="headerlink" title="browserslist"></a>browserslist</h4><p>具体配置说明 <a href="https://github.com/browserslist/browserslist">https://github.com/browserslist/browserslist</a></p>
<p>在 package.json 中配置 browserslist 或添加 .browserslistrc 文件</p>
<p>具体的环境是根据 process.env.NODE_ENV 确定， 所以需要设置 process.env.NODE_ENV ，只设置 mode: ‘production’ 不好使</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;browserslist&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;development&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;last 1 chrome version&quot;</span><span class="punctuation">,</span><span class="comment">//兼容最近的谷歌浏览器</span></span><br><span class="line">      <span class="string">&quot;last 1 firefox version&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;last 1 safari version&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;production&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;&gt;0.01%&quot;</span><span class="punctuation">,</span><span class="comment">//兼容&gt;0.01%</span></span><br><span class="line">      <span class="string">&quot;not dead&quot;</span><span class="punctuation">,</span><span class="comment">//不用管弃用的浏览器</span></span><br><span class="line">      <span class="string">&quot;not op_mini all&quot;</span><span class="comment">//不用op</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="压缩-css"><a href="#压缩-css" class="headerlink" title="压缩 css"></a>压缩 css</h2><p>webpack v4 使用 optimize-css-assets-webpack-plugin</p>
<p>对于 webpack v5 或更高版本，请改用 css-minimizer-webpack-plugin。</p>
<h4 id="下载插件-6"><a href="#下载插件-6" class="headerlink" title="下载插件"></a>下载插件</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save-dev css-minimizer-webpack-plugin</span><br></pre></td></tr></table></figure>

<h4 id="修改配置-7"><a href="#修改配置-7" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">CssMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;css-minimizer-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span> :...,</span><br><span class="line"><span class="attr">plugins</span>:...,</span><br><span class="line"><span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimize</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="comment">// For webpack@5 you can use the `...` syntax to extend existing minimizers (i.e. `terser-webpack-plugin`), uncomment the next line</span></span><br><span class="line">      <span class="comment">// `...`,</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">CssMinimizerPlugin</span>(),</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="js-语法检查"><a href="#js-语法检查" class="headerlink" title="js 语法检查"></a>js 语法检查</h2><h4 id="下载插件-7"><a href="#下载插件-7" class="headerlink" title="下载插件"></a>下载插件</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save-dev eslint-loader eslint eslint-config-airbnb-base eslint-plugin-import</span><br></pre></td></tr></table></figure>

<ul>
<li><p>eslint-loader 已经弃用 请使用 eslint-webpack-plugin</p>
</li>
<li><p>eslint-config-airbnb-base ：airbnb 标准的所以规则 需要<code>eslint</code>和<code>eslint-plugin-import</code>。</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save-dev eslint-webpack-plugin</span><br></pre></td></tr></table></figure>

<h4 id="修改配置-8"><a href="#修改配置-8" class="headerlink" title="修改配置"></a>修改配置</h4><h5 id="eslint-loader-（已经弃用）"><a href="#eslint-loader-（已经弃用）" class="headerlink" title="eslint-loader （已经弃用）"></a>eslint-loader （已经弃用）</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        语法检查： eslint-loader  eslint</span></span><br><span class="line"><span class="comment">          注意：只检查自己写的源代码，第三方的库是不用检查的</span></span><br><span class="line"><span class="comment">          设置检查规则：</span></span><br><span class="line"><span class="comment">            package.json中eslintConfig中设置~</span></span><br><span class="line"><span class="comment">              &quot;eslintConfig&quot;: &#123;</span></span><br><span class="line"><span class="comment">                &quot;extends&quot;: &quot;airbnb-base&quot;</span></span><br><span class="line"><span class="comment">              &#125;</span></span><br><span class="line"><span class="comment">            airbnb --&gt; eslint-config-airbnb-base  eslint-plugin-import eslint</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&#x27;eslint-loader&#x27;</span>,</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">          <span class="comment">// 自动修复eslint的错误</span></span><br><span class="line">          <span class="attr">fix</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h5 id="eslint-webpack-plugin"><a href="#eslint-webpack-plugin" class="headerlink" title="eslint-webpack-plugin"></a>eslint-webpack-plugin</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">plugins</span>: [<span class="keyword">new</span> <span class="title class_">ESLintPlugin</span>(options)],</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="eslint-的配置"><a href="#eslint-的配置" class="headerlink" title="eslint 的配置"></a>eslint 的配置</h5><p>在 package.json 中的<code>&quot;eslintConfig&quot;</code> 或者 <code>.eslintrc.js</code> 中修改 eslint 的配置</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">extends</span>: <span class="string">&quot;airbnb-base&quot;</span>,</span><br><span class="line"><span class="attr">env</span>: &#123;</span><br><span class="line">  <span class="attr">browser</span>: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">rules</span>: &#123;</span><br><span class="line">  <span class="string">&quot;no-console&quot;</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;development&quot;</span> ? <span class="string">&quot;off&quot;</span> : <span class="string">&quot;warn&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>eslint 全配置：<a href="https://eslint.bootcss.com/docs/user-guide/configuring#extending-configuration-files">https://eslint.bootcss.com/docs/user-guide/configuring#extending-configuration-files</a></p>
</blockquote>
<h2 id="js-兼容性处理"><a href="#js-兼容性处理" class="headerlink" title="js 兼容性处理"></a>js 兼容性处理</h2><h4 id="下载插件-8"><a href="#下载插件-8" class="headerlink" title="下载插件"></a>下载插件</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save-dev  babel babel-loader @babel/core @babel/preset-env @babel/polyfill core-js</span><br></pre></td></tr></table></figure>

<ul>
<li><p>@babel&#x2F;preset-env babel 预设环境</p>
</li>
<li><p>@babel&#x2F;polyfill 所有的转换包集合 Babel 7.4.0 开始，不赞成使用此软件包</p>
</li>
<li><p>core-js 是 babel-polyfill 的底层依赖 可以配合 useBuiltIns 选项实现按需加载</p>
</li>
</ul>
<h4 id="修改配置-9"><a href="#修改配置-9" class="headerlink" title="修改配置"></a>修改配置</h4><p>有两种方式配置 babel</p>
<ul>
<li>在 webpack.config.js 中配置</li>
<li>在 babel.config.js 中配置</li>
</ul>
<h5 id="在-webpack-config-js-中配置"><a href="#在-webpack-config-js-中配置" class="headerlink" title="在 webpack.config.js 中配置"></a>在 webpack.config.js 中配置</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">          <span class="attr">rootMode</span>: <span class="string">&quot;upward&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">          <span class="comment">// 预设：指示babel做怎么样的兼容性处理</span></span><br><span class="line">          <span class="attr">presets</span>: [</span><br><span class="line">            [</span><br><span class="line">              <span class="string">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="comment">// 按需加载</span></span><br><span class="line">                <span class="attr">useBuiltIns</span>: <span class="string">&#x27;usage&#x27;</span>,</span><br><span class="line">                <span class="comment">// 指定core-js版本</span></span><br><span class="line">                <span class="attr">corejs</span>: &#123;</span><br><span class="line">                  <span class="attr">version</span>: <span class="number">3</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="comment">// 指定兼容性做到哪个版本浏览器</span></span><br><span class="line">                <span class="attr">targets</span>: &#123;</span><br><span class="line">                  <span class="attr">chrome</span>: <span class="string">&#x27;60&#x27;</span>,</span><br><span class="line">                  <span class="attr">firefox</span>: <span class="string">&#x27;60&#x27;</span>,</span><br><span class="line">                  <span class="attr">ie</span>: <span class="string">&#x27;9&#x27;</span>,</span><br><span class="line">                  <span class="attr">safari</span>: <span class="string">&#x27;10&#x27;</span>,</span><br><span class="line">                  <span class="attr">edge</span>: <span class="string">&#x27;17&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h5 id="在-babel-config-js-中配置"><a href="#在-babel-config-js-中配置" class="headerlink" title="在 babel.config.js 中配置"></a>在 babel.config.js 中配置</h5><p>或者将配置放到项目根目录的 babel.config.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">  <span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">rootMode</span>: <span class="string">&quot;upward&quot;</span>,  <span class="comment">// 需要配置 rootMode: &quot;upward&quot; 意思是向上查找 找到 babel.config.[json | js]</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>babel.config.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 预设：指示 babel 做怎么样的兼容性处理</span></span><br><span class="line">  <span class="attr">presets</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">&quot;@babel/preset-env&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 按需加载</span></span><br><span class="line">        <span class="attr">useBuiltIns</span>: <span class="string">&quot;usage&quot;</span>,</span><br><span class="line">        <span class="comment">// 指定core-js版本</span></span><br><span class="line">        <span class="attr">corejs</span>: &#123;</span><br><span class="line">          <span class="attr">version</span>: <span class="number">3</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 指定兼容性做到哪个版本浏览器</span></span><br><span class="line">        <span class="attr">targets</span>: &#123;</span><br><span class="line">          <span class="attr">chrome</span>: <span class="string">&quot;60&quot;</span>,</span><br><span class="line">          <span class="attr">firefox</span>: <span class="string">&quot;60&quot;</span>,</span><br><span class="line">          <span class="attr">ie</span>: <span class="string">&quot;9&quot;</span>,</span><br><span class="line">          <span class="attr">safari</span>: <span class="string">&quot;10&quot;</span>,</span><br><span class="line">          <span class="attr">edge</span>: <span class="string">&quot;17&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="js-压缩和-html-压缩"><a href="#js-压缩和-html-压缩" class="headerlink" title="js 压缩和 html 压缩"></a>js 压缩和 html 压缩</h2><h4 id="修改配置-10"><a href="#修改配置-10" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">// 生产环境下会自动压缩js代码 和 html代码</span></span><br><span class="line"><span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span></span><br></pre></td></tr></table></figure>

<p>也可以自定义压缩配置</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">    <span class="attr">template</span>: <span class="string">&quot;./src/index.html&quot;</span>,</span><br><span class="line">    <span class="comment">// 当webpack的默认mode值为&#x27;production&#x27; 自动设置 minify: true</span></span><br><span class="line">    <span class="comment">// 全部配置查看：https://www.npmjs.com/package/html-webpack-plugin#minification</span></span><br><span class="line">    <span class="comment">// 压缩html代码</span></span><br><span class="line">    <span class="attr">minify</span>: &#123;</span><br><span class="line">      <span class="comment">// 移除空格</span></span><br><span class="line">      <span class="attr">collapseWhitespace</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// 移除注释</span></span><br><span class="line">      <span class="attr">removeComments</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;),</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h2 id="webpack-性能优化"><a href="#webpack-性能优化" class="headerlink" title="webpack 性能优化"></a>webpack 性能优化</h2><ul>
<li>开发环境性能优化</li>
<li>生产环境性能优化</li>
</ul>
<h3 id="开发环境性能优化"><a href="#开发环境性能优化" class="headerlink" title="开发环境性能优化"></a>开发环境性能优化</h3><ul>
<li>优化打包构建速度<ul>
<li>HMR</li>
</ul>
</li>
<li>优化代码调试<ul>
<li>source-map</li>
</ul>
</li>
</ul>
<h3 id="生产环境性能优化"><a href="#生产环境性能优化" class="headerlink" title="生产环境性能优化"></a>生产环境性能优化</h3><ul>
<li>优化打包构建速度<ul>
<li>oneOf</li>
<li>babel 缓存</li>
<li>多进程打包</li>
<li>externals</li>
<li>dll</li>
</ul>
</li>
<li>优化代码运行的性能<ul>
<li>缓存(hash-chunkhash-contenthash)</li>
<li>tree shaking</li>
<li>code split</li>
<li>懒加载&#x2F;预加载</li>
<li>pwa</li>
</ul>
</li>
</ul>
<h2 id="HMR"><a href="#HMR" class="headerlink" title="HMR"></a>HMR</h2><h3 id="tip"><a href="#tip" class="headerlink" title="tip"></a>tip</h3><p>webpack 5 需要使用 npm i <a href="mailto:&#x77;&#x65;&#x62;&#112;&#x61;&#x63;&#x6b;&#45;&#100;&#101;&#118;&#45;&#115;&#101;&#114;&#x76;&#101;&#x72;&#64;&#52;&#x2e;&#x30;&#46;&#48;&#x2d;&#x62;&#101;&#x74;&#x61;&#x2e;&#x30;">&#x77;&#x65;&#x62;&#112;&#x61;&#x63;&#x6b;&#45;&#100;&#101;&#118;&#45;&#115;&#101;&#114;&#x76;&#101;&#x72;&#64;&#52;&#x2e;&#x30;&#46;&#48;&#x2d;&#x62;&#101;&#x74;&#x61;&#x2e;&#x30;</a></p>
<p>但是目前 4.0.0-beta.0 还不完善 文档没有更新 热模块重载不好使</p>
<h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>hot module replacement 热模块替换 &#x2F; 模块热替换</p>
<h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>一个模块发生变化，只会重新打包这一个模块（而不是打包所有模块）<br>极大提升构建速度</p>
<ul>
<li><p>样式文件：可以使用 HMR 功能：因为 style-loader 内部实现了~</p>
<ul>
<li>js 文件：默认不能使用 HMR 功能 –&gt; 需要修改 js 代码，添加支持 HMR 功能的代码<br>注意：HMR 功能对 js 的处理，只能处理非入口 js 文件的其他文件。</li>
<li>html 文件: 默认不能使用 HMR 功能.同时会导致问题：html 文件不能热更新了~ （不用做 HMR 功能）<br>解决：修改 entry 入口，将 html 文件引入</li>
</ul>
</li>
</ul>
<h3 id="各大框架的-loader-内部支持了-HMR"><a href="#各大框架的-loader-内部支持了-HMR" class="headerlink" title="各大框架的 loader 内部支持了 HMR"></a>各大框架的 loader 内部支持了 HMR</h3><ul>
<li>React Hot Loader: 实时调整 react 组件。</li>
<li>Vue Loader: 此 loader 支持 vue 组件的 HMR，提供开箱即用体验。</li>
<li>Elm Hot webpack Loader: 支持 Elm 编程语言的 HMR。</li>
<li>Angular HMR: 没有必要使用 loader！直接修改 NgModule 主文件就够了</li>
</ul>
<h4 id="修改配置-11"><a href="#修改配置-11" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 4.0 开启热更新</span></span><br><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">contentBase</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    <span class="comment">// 开启HMR功能</span></span><br><span class="line">    <span class="comment">// 当修改了webpack配置，新配置要想生效，必须重新webpack服务</span></span><br><span class="line">    <span class="attr">hot</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">compress</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">3000</span>,</span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h2 id="source-map"><a href="#source-map" class="headerlink" title="source-map"></a>source-map</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">source-<span class="attr">map</span>: 一种 提供源代码到构建后代码映射 技术 （如果构建后代码出错了，通过映射可以追踪源代码错误）</span><br><span class="line"></span><br><span class="line">    [inline-|hidden-|<span class="built_in">eval</span>-][nosources-][cheap-[<span class="variable language_">module</span>-]]source-map</span><br><span class="line"></span><br><span class="line">    source-map：外部</span><br><span class="line">      错误代码准确信息 和 源代码的错误位置</span><br><span class="line">    inline-source-map：内联</span><br><span class="line">      只生成一个内联source-map</span><br><span class="line">      错误代码准确信息 和 源代码的错误位置</span><br><span class="line">    hidden-source-map：外部</span><br><span class="line">      错误代码错误原因，但是没有错误位置</span><br><span class="line">      不能追踪源代码错误，只能提示到构建后代码的错误位置</span><br><span class="line">    <span class="built_in">eval</span>-source-map：内联</span><br><span class="line">      每一个文件都生成对应的source-map，都在<span class="built_in">eval</span></span><br><span class="line">      错误代码准确信息 和 源代码的错误位置</span><br><span class="line">    nosources-source-map：外部</span><br><span class="line">      错误代码准确信息, 但是没有任何源代码信息</span><br><span class="line">    cheap-source-map：外部</span><br><span class="line">      错误代码准确信息 和 源代码的错误位置</span><br><span class="line">      只能精确的行</span><br><span class="line">    cheap-<span class="variable language_">module</span>-source-map：外部</span><br><span class="line">      错误代码准确信息 和 源代码的错误位置</span><br><span class="line">      <span class="variable language_">module</span>会将loader的source map加入</span><br><span class="line"></span><br><span class="line">    内联 和 外部的区别：<span class="number">1.</span> 外部生成了文件，内联没有 <span class="number">2.</span> 内联构建速度更快</span><br><span class="line"></span><br><span class="line">    开发环境：速度快，调试更友好</span><br><span class="line">      速度快(<span class="built_in">eval</span>&gt;inline&gt;cheap&gt;...)</span><br><span class="line">        <span class="built_in">eval</span>-cheap-souce-map</span><br><span class="line">        <span class="built_in">eval</span>-source-map</span><br><span class="line">      调试更友好</span><br><span class="line">        souce-map</span><br><span class="line">        cheap-<span class="variable language_">module</span>-souce-map</span><br><span class="line">        cheap-souce-map</span><br><span class="line"></span><br><span class="line">      --&gt; <span class="built_in">eval</span>-source-map  / <span class="built_in">eval</span>-cheap-<span class="variable language_">module</span>-souce-map</span><br><span class="line"></span><br><span class="line">    生产环境：源代码要不要隐藏? 调试要不要更友好</span><br><span class="line">      内联会让代码体积变大，所以在生产环境不用内联</span><br><span class="line">      nosources-source-map 全部隐藏</span><br><span class="line">      hidden-source-map 只隐藏源代码，会提示构建后代码错误信息</span><br><span class="line"></span><br><span class="line">      --&gt; source-map / cheap-<span class="variable language_">module</span>-souce-map</span><br></pre></td></tr></table></figure>

<h4 id="修改配置-12"><a href="#修改配置-12" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 开发环境</span></span><br><span class="line"><span class="attr">devtool</span>: <span class="string">&quot;eval-source-map&quot;</span>;</span><br><span class="line"><span class="comment">// 生产环境</span></span><br><span class="line"><span class="attr">devtool</span>: <span class="string">&quot;source-map&quot;</span>; <span class="comment">// 根据需求进行选择</span></span><br></pre></td></tr></table></figure>

<h2 id="oneOf"><a href="#oneOf" class="headerlink" title="oneOf"></a>oneOf</h2><p>oneOf：让一个文件只有一个 loader 处理 ，找打对应的 loader 就不往下遍历了。</p>
<h4 id="修改配置-13"><a href="#修改配置-13" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">  <span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line"><span class="comment">// 需要每个类型的文件都处理的loader 单独在oneOf外面</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//  oneOf 内部 一个 rule 只处理一个类型 找到对应类型的 rule 就不再继续往下遍历</span></span><br><span class="line">      <span class="attr">oneOf</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">          <span class="attr">use</span>: styleCommonLodar</span><br><span class="line">        &#125;,</span><br><span class="line">      ...</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h4 id="优化效果"><a href="#优化效果" class="headerlink" title="优化效果"></a>优化效果</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#优化前</span></span><br><span class="line">webpack 5.22.0 compiled with 1 warning <span class="keyword">in</span> 12820 ms</span><br><span class="line"><span class="comment">#优化后</span></span><br><span class="line">webpack 5.22.0 compiled with 1 warning <span class="keyword">in</span> 9615 ms</span><br></pre></td></tr></table></figure>

<h2 id="babel-缓存"><a href="#babel-缓存" class="headerlink" title="babel 缓存"></a>babel 缓存</h2><p>缓存文件会放在 <code>node_modules\.cache\babel-loader</code>中，如果编译的不对删除这个文件再试</p>
<h4 id="修改配置-14"><a href="#修改配置-14" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">  <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">  <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">  <span class="attr">options</span>: &#123;</span><br><span class="line">    <span class="comment">// 开启babel缓存</span></span><br><span class="line">    <span class="comment">// 第二次构建时，会读取之前的缓存</span></span><br><span class="line">    <span class="comment">// 缓存文件会放在 node_modules\.cache\babel-loader中  如果编译的不对删除这个文件再试</span></span><br><span class="line">    <span class="attr">cacheDirectory</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">rootMode</span>: <span class="string">&quot;upward&quot;</span> <span class="comment">// 需要配置 rootMode: &quot;upward&quot; 意思是向上查找 找到 babel.config.[json | js]</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h4 id="优化效果-1"><a href="#优化效果-1" class="headerlink" title="优化效果"></a>优化效果</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#优化前</span></span><br><span class="line">webpack 5.22.0 compiled with 1 warning <span class="keyword">in</span> 11641 ms</span><br><span class="line"><span class="comment">#优化后 再次打包</span></span><br><span class="line">webpack 5.22.0 compiled with 1 warning <span class="keyword">in</span> 8476 ms</span><br></pre></td></tr></table></figure>

<h2 id="tree-shaking-树摇"><a href="#tree-shaking-树摇" class="headerlink" title="tree shaking 树摇"></a>tree shaking 树摇</h2><p>tree shaking：去除无用代码</p>
<h4 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h4><ol>
<li><p>必须使用 ES6 模块化</p>
</li>
<li><p>开启 production 环境</p>
</li>
</ol>
<h4 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h4><p>减少代码体积</p>
<h4 id="修改配置-15"><a href="#修改配置-15" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>;</span><br></pre></td></tr></table></figure>

<h5 id="sideEffects"><a href="#sideEffects" class="headerlink" title="sideEffects"></a>sideEffects</h5><p>在 package.json 中配置 sideEffects ：副作用 （导入了例如 css less 等样式 ，代码上是没用到的 ，但是需要保留的 ）</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="string">&quot;sideEffects&quot;</span>: <span class="literal">false</span></span><br><span class="line"><span class="comment">//所有代码都没有副作用（都可以进行tree shaking） 问题：可能会把css / @babel/polyfill （副作用）文件干掉</span></span><br><span class="line"><span class="string">&quot;sideEffects&quot;</span>: [<span class="string">&quot;*.css&quot;</span>, <span class="string">&quot;*.less&quot;</span>,<span class="string">&quot;*iconfont.js&quot;</span> ] <span class="comment">//当需要保留的文件名放到数组中</span></span><br></pre></td></tr></table></figure>

<h4 id="官方结论"><a href="#官方结论" class="headerlink" title="官方结论"></a>官方结论</h4><p>因此，我们学到为了利用 <em>tree shaking</em> 的优势， 你必须…</p>
<ul>
<li>使用 ES2015 模块语法（即 <code>import</code> 和 <code>export</code>）。</li>
<li>确保没有编译器将您的 ES2015 模块语法转换为 CommonJS 的（顺带一提，这是现在常用的 @babel&#x2F;preset-env 的默认行为，详细信息请参阅<a href="https://babeljs.io/docs/en/babel-preset-env#modules">文档</a>）。</li>
<li>在项目的 <code>package.json</code> 文件中，添加 <code>&quot;sideEffects&quot;</code> 属性。</li>
<li>使用 <code>mode</code> 为 <code>&quot;production&quot;</code> 的配置项以启用<a href="https://webpack.docschina.org/concepts/mode/#usage">更多优化项</a>，包括压缩代码与 tree shaking。</li>
</ul>
<p>你可以将应用程序想象成一棵树。绿色表示实际用到的 source code(源码) 和 library(库)，是树上活的树叶。灰色表示未引用代码，是秋天树上枯萎的树叶。为了除去死去的树叶，你必须摇动这棵树，使它们落下。</p>
<h2 id="code-split-代码分割"><a href="#code-split-代码分割" class="headerlink" title="code split 代码分割"></a>code split 代码分割</h2><h4 id="修改配置-16"><a href="#修改配置-16" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="attr">output</span>: &#123;</span><br><span class="line">  <span class="comment">// 这里使用 chunk name  +  contenthash 进行命名</span></span><br><span class="line">  <span class="attr">filename</span>: <span class="string">&#x27;js/[name].[contenthash:10].js&#x27;</span>,</span><br><span class="line">  <span class="comment">//..</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">optimization</span>: &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="comment">// 代码块 切割</span></span><br><span class="line">  <span class="comment">// 可以将node_modules中代码单独打包一个chunk最终输出 如果想分割node_modules中的代码需要配合dll</span></span><br><span class="line">  <span class="comment">// 项目的中业务代码通过 import() 语法进行分割</span></span><br><span class="line">  <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">    <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="修改业务代码"><a href="#修改业务代码" class="headerlink" title="修改业务代码"></a>修改业务代码</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 需要进行切割的js需要使用 import() 异步引入使用</span></span><br><span class="line"><span class="comment">// /* webpackChunkName: &#x27;test01&#x27; */ test01 代表分割后 ChunkName, 比如以上配置会生成  test01.f20318151f.js</span></span><br><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &#x27;test01&#x27; */</span> <span class="string">&quot;./test&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; mul, count &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Bowen: mul&quot;</span>, mul);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="PWA"><a href="#PWA" class="headerlink" title="PWA"></a>PWA</h2><h3 id="下载插件-9"><a href="#下载插件-9" class="headerlink" title="下载插件"></a>下载插件</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 开启 service worker</span></span><br><span class="line">npm install --save-dev workbox-webpack-plugin</span><br><span class="line"><span class="comment"># 生成清单文件 manifest.json</span></span><br><span class="line">npm install --save-dev webpack-pwa-manifest</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="修改配置-17"><a href="#修改配置-17" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// pwa</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">WorkboxWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;workbox-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// 建议放到最下面  放到MiniCssExtractPlugin 会报错 Error: Cannot find module &#x27;optimize-css-assets-webpack-plugin</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">WorkboxWebpackPlugin</span>.<span class="title class_">GenerateSW</span>(&#123;</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        1. 帮助serviceworker快速启动</span></span><br><span class="line"><span class="comment">        2. 删除旧的 serviceworker</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        生成一个 serviceworker 配置文件~</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      <span class="attr">clientsClaim</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">skipWaiting</span>: <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 生成清单文件 manifest.json  的目的是将Web应用程序安装到设备的主屏幕 谷歌上会提示下载图标</span></span><br><span class="line">    <span class="comment">// https://developer.mozilla.org/zh-CN/docs/Web/Manifest</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">WebpackPwaManifest</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;My Progressive Web App&#x27;</span>,</span><br><span class="line">      <span class="attr">short_name</span>: <span class="string">&#x27;MyPWA&#x27;</span>,</span><br><span class="line">      <span class="attr">description</span>: <span class="string">&#x27;My awesome Progressive Web App!&#x27;</span>,</span><br><span class="line">      <span class="attr">background_color</span>: <span class="string">&#x27;#ffffff&#x27;</span>,</span><br><span class="line">      <span class="attr">crossorigin</span>: <span class="string">&#x27;use-credentials&#x27;</span>, <span class="comment">//can be null, use-credentials or anonymous</span></span><br><span class="line">      <span class="attr">icons</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">src</span>: <span class="title function_">resolve</span>(<span class="string">&#x27;src/assets/icon.png&#x27;</span>),</span><br><span class="line">          <span class="attr">sizes</span>: [<span class="number">96</span>, <span class="number">128</span>, <span class="number">192</span>, <span class="number">256</span>, <span class="number">384</span>, <span class="number">512</span>], <span class="comment">// multiple sizes</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">src</span>: <span class="title function_">resolve</span>(<span class="string">&#x27;src/assets/icon.png&#x27;</span>),</span><br><span class="line">          <span class="attr">size</span>: <span class="string">&#x27;1024x1024&#x27;</span>, <span class="comment">// you can also use the specifications pattern</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">src</span>: <span class="title function_">resolve</span>(<span class="string">&#x27;src/assets/icon.png&#x27;</span>),</span><br><span class="line">          <span class="attr">size</span>: <span class="string">&#x27;1024x1024&#x27;</span>,</span><br><span class="line">          <span class="attr">purpose</span>: <span class="string">&#x27;maskable&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;),</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="业务代码修改"><a href="#业务代码修改" class="headerlink" title="业务代码修改"></a>业务代码修改</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  1. eslint不认识 window、navigator全局变量</span></span><br><span class="line"><span class="comment">    解决：需要修改package.json中eslintConfig配置</span></span><br><span class="line"><span class="comment">      &quot;env&quot;: &#123;</span></span><br><span class="line"><span class="comment">        &quot;browser&quot;: true // 支持浏览器端全局变量</span></span><br><span class="line"><span class="comment">      &#125;</span></span><br><span class="line"><span class="comment">   2. sw代码必须运行在服务器上</span></span><br><span class="line"><span class="comment">      --&gt; nodejs</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line"><span class="comment">        npm i serve -g</span></span><br><span class="line"><span class="comment">        serve -s build 启动服务器，将build目录下所有资源作为静态资源暴露出去</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 注册serviceWorker</span></span><br><span class="line"><span class="comment">// 处理兼容性问题</span></span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;serviceWorker&quot;</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;load&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    navigator.<span class="property">serviceWorker</span></span><br><span class="line">      .<span class="title function_">register</span>(<span class="string">&quot;/service-worker.js&quot;</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;sw注册成功了~&quot;</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;sw注册失败了~&quot;</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="多进程打包"><a href="#多进程打包" class="headerlink" title="多进程打包"></a>多进程打包</h2><p>官方文档：<a href="https://webpack.docschina.org/loaders/thread-loader/#root">https://webpack.docschina.org/loaders/thread-loader/#root</a></p>
<h3 id="下载依赖"><a href="#下载依赖" class="headerlink" title="下载依赖"></a>下载依赖</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save-dev thread-loader</span><br></pre></td></tr></table></figure>

<h3 id="修改配置-18"><a href="#修改配置-18" class="headerlink" title="修改配置"></a>修改配置</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">include</span>: path.<span class="title function_">resolve</span>(<span class="string">&quot;src&quot;</span>),</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">          开启多进程打包</span></span><br><span class="line"><span class="comment">          进程启动大概为600ms，进程通信也有开销。</span></span><br><span class="line"><span class="comment">          只有工作消耗时间比较长，才需要多进程打包</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="string">&quot;thread-loader&quot;</span>,</span><br><span class="line">          <span class="comment">// 耗时的 loader （例如 babel-loader）</span></span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="externals-外部扩展-（排除无需打包的外部依赖）"><a href="#externals-外部扩展-（排除无需打包的外部依赖）" class="headerlink" title="externals 外部扩展 （排除无需打包的外部依赖）"></a>externals 外部扩展 （排除无需打包的外部依赖）</h2><p>官方文档：<a href="https://webpack.docschina.org/configuration/externals/">https://webpack.docschina.org/configuration/externals/</a><br>防止将某些 import 的包(package)打包到 bundle 中，而是在运行时(runtime)再去从外部获取这些扩展依赖(external dependencies)。<br>例如，从 CDN 引入 react，而不是把它打包</p>
<h3 id="修改-html-模板"><a href="#修改-html-模板" class="headerlink" title="修改 html 模板"></a>修改 html 模板</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">  <span class="attr">crossorigin</span></span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/react@17/umd/react.production.min.js&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">  <span class="attr">crossorigin</span></span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/react-dom@17/umd/react-dom.production.min.js&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="修改配置-19"><a href="#修改配置-19" class="headerlink" title="修改配置"></a>修改配置</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="attr">externals</span>: &#123;</span><br><span class="line">    <span class="comment">// 拒绝react被打包进来</span></span><br><span class="line">    <span class="comment">// key -&gt; import react from &quot;react&quot; 中的 &quot;react&quot;</span></span><br><span class="line">    <span class="comment">// value -&gt; react 的命名空间 namespace React</span></span><br><span class="line">    <span class="attr">react</span>: <span class="string">&quot;React&quot;</span>,</span><br><span class="line">    <span class="string">&quot;react-dom&quot;</span>: <span class="string">&quot;ReactDOM&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="DllPlugin-（打包优化）"><a href="#DllPlugin-（打包优化）" class="headerlink" title="DllPlugin （打包优化）"></a>DllPlugin （打包优化）</h2><p>官方文档：<a href="https://webpack.docschina.org/plugins/dll-plugin/">https://webpack.docschina.org/plugins/dll-plugin/</a><br>dll 主要用户用于将第三方依赖 或者公共依赖 进行打包， 目的与 externals 差不多都是为了加快构建速度</p>
<h2 id="添加-webpack-dll-js"><a href="#添加-webpack-dll-js" class="headerlink" title="添加 webpack.dll.js"></a>添加 webpack.dll.js</h2><p>webpack.dll.js 专门用于打包第三方依赖 或者公共依赖</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *    webpack.dll.js</span></span><br><span class="line"><span class="comment"> *   使用dll技术，对某些库（第三方库：jquery、react、vue...）进行单独打包</span></span><br><span class="line"><span class="comment"> *     当你运行 webpack 时，默认查找 webpack.config.js 配置文件</span></span><br><span class="line"><span class="comment"> *     需求：需要运行 webpack.dll.js 文件</span></span><br><span class="line"><span class="comment"> *       --&gt; webpack --config webpack.dll.js</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@format</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 清理上次的打包文件</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;clean-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="comment">// 最终打包生成的 vendor --&gt; MyDll.[name].js  name=vendor</span></span><br><span class="line">    <span class="comment">// [&#x27;react&#x27;,&#x27;&#x27;react-dom&#x27;] --&gt; 要打包的库是react  跟包名一致react</span></span><br><span class="line">    <span class="attr">vendor</span>: [<span class="string">&quot;react&quot;</span>, <span class="string">&quot;react-dom&quot;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// 生成文件名</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;[name].dll.js&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dll&quot;</span>),</span><br><span class="line">    <span class="comment">// 打包的库里面向外暴露出去的内容叫什么名字（全局变量名） 需要和 webpack.DllPlugin 中的 name 抱持一致</span></span><br><span class="line">    <span class="attr">library</span>: <span class="string">&quot;[name]_[fullhash]_library&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(),</span><br><span class="line">    <span class="comment">// 打包生成一个 manifest.json --&gt; 提供和react映射 manifest.json中映射library名称</span></span><br><span class="line">    <span class="keyword">new</span> webpack.<span class="title class_">DllPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;[name]_[fullhash]_library&quot;</span>, <span class="comment">// 映射库的暴露的内容名称 不用管叫什么 打包后的代码会使用 咱们构建前的代码还是该怎么使就怎么使</span></span><br><span class="line">      <span class="attr">path</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dll/manifest.json&quot;</span>), <span class="comment">// 生成的清单文件 包含了react 和 react-dom</span></span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>执行 <code>npx webpack --config webpack.dll.js</code><br>会在当前目录下生成 dll 目录</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">dll</span><br><span class="line">├── manifest<span class="selector-class">.json</span> <span class="comment">// 清单</span></span><br><span class="line">├── vendor<span class="selector-class">.dll</span><span class="selector-class">.js</span> <span class="comment">// 第三方包的集合</span></span><br><span class="line">└── vendor<span class="selector-class">.dll</span><span class="selector-class">.js</span><span class="selector-class">.LICENSE</span>.txt</span><br></pre></td></tr></table></figure>

<p>manifest.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vendor_311590c415821fbaedf4_library&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;../node_modules/react/index.js&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">378</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;buildMeta&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;exportsType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dynamic&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;defaultObject&quot;</span><span class="punctuation">:</span> <span class="string">&quot;redirect&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;exports&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;Children&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;Component&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;Fragment&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;Profiler&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;PureComponent&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;StrictMode&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;Suspense&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;cloneElement&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;createContext&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;createElement&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;createFactory&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;createRef&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;forwardRef&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;isValidElement&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;lazy&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;memo&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;useCallback&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;useContext&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;useDebugValue&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;useEffect&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;useImperativeHandle&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;useLayoutEffect&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;useMemo&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;useReducer&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;useRef&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;useState&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;version&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;../node_modules/react-dom/index.js&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">542</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;buildMeta&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;exportsType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dynamic&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;defaultObject&quot;</span><span class="punctuation">:</span> <span class="string">&quot;redirect&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;exports&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;createPortal&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;findDOMNode&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;flushSync&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;hydrate&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;render&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;unmountComponentAtNode&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;unstable_batchedUpdates&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;unstable_createPortal&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;unstable_renderSubtreeIntoContainer&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;version&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="修改配置-20"><a href="#修改配置-20" class="headerlink" title="修改配置"></a>修改配置</h2><p>webpack.config.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"><span class="comment">// 自动在html中引入资源插件 (不用插件 手动在模板html中添加也可以)</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AddAssetHtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;add-asset-html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// 告诉webpack哪些库不参与打包</span></span><br><span class="line">    <span class="keyword">new</span> webpack.<span class="title class_">DllReferencePlugin</span>(&#123;</span><br><span class="line">      <span class="attr">manifest</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dll/manifest.json&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 将某个文件打包输出去，并在html中自动引入该资源</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">AddAssetHtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">filepath</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dll/vendor.dll.js&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>打包生成的结构</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">dist</span><br><span class="line">├── assets</span><br><span class="line">├── css</span><br><span class="line">├── index<span class="selector-class">.html</span>  <span class="comment">// html中引入 vendor.dll.js &lt;script defer=&quot;defer&quot; src=&quot;./vendor.dll.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line">├── js</span><br><span class="line">├── vendor<span class="selector-class">.dll</span><span class="selector-class">.js</span> <span class="comment">// 将dll下的 vendor.dll.js  放到当前打包后的目录下</span></span><br><span class="line">└── vendor<span class="selector-class">.dll</span><span class="selector-class">.js</span><span class="selector-class">.LICENSE</span>.txt</span><br></pre></td></tr></table></figure>

<h2 id="DLL-和-externals-、code-split-的区别"><a href="#DLL-和-externals-、code-split-的区别" class="headerlink" title="DLL 和 externals 、code split 的区别"></a>DLL 和 externals 、code split 的区别</h2><h3 id="DLL"><a href="#DLL" class="headerlink" title="DLL"></a>DLL</h3><ul>
<li>用于将第三方依赖单独打包构建，跟项目一起放到同一个服务器下进行加载</li>
<li>优点：优化项目本地的构建速度</li>
</ul>
<h3 id="externals"><a href="#externals" class="headerlink" title="externals"></a>externals</h3><ul>
<li>不打包第三方依赖，第三方依赖使用 CDN</li>
<li>优点：优化项目本地的构建速度，因为使用 CDN 优化第三方依赖加载速度</li>
</ul>
<h3 id="code-split"><a href="#code-split" class="headerlink" title="code split"></a>code split</h3><ul>
<li>将项目中的进行模块代码分割成多个 js 文件</li>
<li>优点：优化项目本身加载速度，依靠代码分割可以实现模块的懒加载和预加载</li>
</ul>
<h2 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h2><h3 id="生产环境配置官方文档"><a href="#生产环境配置官方文档" class="headerlink" title="生产环境配置官方文档"></a>生产环境配置官方文档</h3><p><a href="https://webpack.docschina.org/guides/production/">https://webpack.docschina.org/guides/production/</a></p>
<h3 id="css-压缩、提取"><a href="#css-压缩、提取" class="headerlink" title="css 压缩、提取"></a>css 压缩、提取</h3><p><a href="https://webpack.docschina.org/plugins/mini-css-extract-plugin/#minimizing-for-production">https://webpack.docschina.org/plugins/mini-css-extract-plugin/#minimizing-for-production</a></p>
<h2 id="每次打包清除打包文件"><a href="#每次打包清除打包文件" class="headerlink" title="每次打包清除打包文件"></a>每次打包清除打包文件</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>);</span><br><span class="line">...</span><br><span class="line"><span class="attr">plugins</span>:[</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="报错"><a href="#报错" class="headerlink" title="报错"></a>报错</h2><p>Error: Automatic publicPath is not supported in this browser</p>
<p>设置 output 中 publicPath: ‘’ 为空字符串</p>
<h2 id="tip-：项目中的基础知识"><a href="#tip-：项目中的基础知识" class="headerlink" title="tip ：项目中的基础知识"></a>tip ：项目中的基础知识</h2><h3 id="node-模块的搜索流程"><a href="#node-模块的搜索流程" class="headerlink" title="node 模块的搜索流程"></a>node 模块的搜索流程</h3><blockquote>
<p>node 在使用模块名来引入模块时,会首先在当前目录的 node_modules 中寻找是否有该模块<br>如果有则直接使用,如果没有则会一直向上一级目录的 node_modules 中寻找，直到磁盘的根目录</p>
</blockquote>
<h3 id="browserslistrc"><a href="#browserslistrc" class="headerlink" title=".browserslistrc"></a>.browserslistrc</h3><p>对应 package.json 中的 browserslist</p>
<p>postcss-preset-env 会找到 browserslist 作为兼容的基础</p>
<p>browserslist 配置 <a href="https://github.com/browserslist/browserslist">https://github.com/browserslist/browserslist</a></p>
<h3 id="eslintrc-js"><a href="#eslintrc-js" class="headerlink" title=".eslintrc.js"></a>.eslintrc.js</h3><p>对应 package.json 中的 eslintConfig</p>
<p>eslint 配置 <a href="https://eslint.org/docs/developer-guide/nodejs-api#%E2%97%86-new-eslint-options">https://eslint.org/docs/developer-guide/nodejs-api#%E2%97%86-new-eslint-options</a></p>
<h3 id="babel-config-js"><a href="#babel-config-js" class="headerlink" title="babel.config.js"></a>babel.config.js</h3><p>bable 的配置文件 对应 webpack.config.js 中 babel-loader 的 options</p>
<p>babel.config.js 文件，可以使用不同的扩展名（<code>.js</code>，<code>.cjs</code>，<code>.mjs</code>)</p>
<p>bable 的配置文件分为两种：</p>
<ul>
<li>babel.config.js 整个项目都用这个 babel 配置（项目范围的配置）</li>
<li>.babelrc.js 配置文件是否仅适用于项目的某个部分 （相对文件配置）</li>
</ul>
<p>具体配置：<a href="https://babeljs.io/docs/en/config-files">https://babeljs.io/docs/en/config-files</a></p>
<h3 id="prettierrc-js"><a href="#prettierrc-js" class="headerlink" title=".prettierrc.js"></a>.prettierrc.js</h3><p>vscode 中的 prettier 插件 会优先已这个文件作为格式化的配置</p>
<p>配置同 prettier 插件 <a href="https://prettier.io/docs/en/options.html">https://prettier.io/docs/en/options.html</a></p>
<h2 id="核心模块"><a href="#核心模块" class="headerlink" title="核心模块"></a>核心模块</h2><h3 id="postcss"><a href="#postcss" class="headerlink" title="postcss"></a>postcss</h3><blockquote>
<p>css 兼容性插件</p>
</blockquote>
<p>配合 webpack 使用 ：postcss-loader <a href="https://www.npmjs.com/package/postcss-loader">https://www.npmjs.com/package/postcss-loader</a></p>
<h3 id="eslint"><a href="#eslint" class="headerlink" title="eslint"></a>eslint</h3><blockquote>
<p>语法检查校验插件</p>
</blockquote>
<p>配合 webpack 使用 ：eslint-webpack-plugin <a href="https://www.npmjs.com/package/eslint-webpack-plugin">https://www.npmjs.com/package/eslint-webpack-plugin</a></p>
<h3 id="babel"><a href="#babel" class="headerlink" title="babel"></a>babel</h3><blockquote>
<p>js 兼容性插件</p>
</blockquote>
<p>配合 webpack 使用 ： babel-loader <a href="https://www.npmjs.com/package/babel-loader">https://www.npmjs.com/package/babel-loader</a></p>
]]></content>
      <categories>
        <category>Webpack</category>
      </categories>
      <tags>
        <tag>Webpack</tag>
        <tag>Webpack-cli</tag>
      </tags>
  </entry>
  <entry>
    <title>webpack教程(5)</title>
    <url>/2021/01/02/Webpack/webpack%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<h1 id="webpack-入门"><a href="#webpack-入门" class="headerlink" title="webpack 入门"></a>webpack 入门</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>webpack 是一个模块打包器，它本身主要打包 JavaScript 模块，结合它的生态中的一些 loader 可以实现对很多其他资源的打包，例如 less、sass、图片、es6 转 es5、.vue 等等文件资源都可以。</p>
<p>使用 webpack，我们最终就能实现类似于 VueCLI 这个工具提供给我们的功能：</p>
<ul>
<li>打包 JavaScript</li>
<li>打包 css</li>
<li>打包 图片</li>
<li>打包 less</li>
<li>打包 .vue 资源</li>
<li>….</li>
<li>开发阶段的 Web 服务</li>
<li>代码热更新</li>
<li>打包部署命令</li>
<li>。。。。</li>
</ul>
<p>我们之所以能使用到 VueCLI 这么方便的工具，一切都归功于 webpack。</p>
<p>webpack 出来之前，还有一些别的构建工具：</p>
<ul>
<li><strong>grunt</strong></li>
<li><strong>gulp</strong></li>
<li>百度的 fis</li>
<li>PARCEL</li>
<li>rollup</li>
<li>……</li>
</ul>
<p>现在 webpack 已经被各大主流前端框架作为自己的脚手架工具的基层，例如：</p>
<ul>
<li>Vue：Vue CLI</li>
<li>React：crate-react-app</li>
<li>Angular：angular-cli</li>
<li>。。。。</li>
</ul>
<p>为什么要学习 webpack？</p>
<p>如果你需要定制这些脚手架工具，那么最好了解一点儿 webpack 相关的内容，例如对项目进行打包优化，配置开发工具模式，。。。。一些更高级的使用方式。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191122114402722.png" alt="image-20191122114402722"></p>
<p>打包 -&gt; 打包结果 -&gt; 浏览器就可以识别运行。</p>
<ul>
<li>官网：<a href="https://webpack.js.org/">https://webpack.js.org/</a><ul>
<li>官方教程：<a href="https://webpack.js.org/guides/">https://webpack.js.org/guides/</a></li>
<li>官方 API 参考文档：<a href="https://webpack.js.org/api/">https://webpack.js.org/api/</a></li>
<li>官方的中文文档链接： <a href="https://webpack.docschina.org/">https://webpack.docschina.org/</a></li>
</ul>
</li>
<li>GitHub：<a href="https://github.com/webpack/webpack">https://github.com/webpack/webpack</a></li>
</ul>
<h2 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h2><blockquote>
<p>目标：体验 webpack 的使用</p>
</blockquote>
<p>一、准备</p>
<p>1、创建 <code>demo1</code> 练习项目</p>
<p>2、创建 <code>index.js</code></p>
<blockquote>
<p>现在必须叫 <code>index.js</code>，之后可以通过配置文件修改</p>
</blockquote>
<p>3、创建 <code>foo.js</code></p>
<p>4、创建 <code>index.html</code></p>
<p>二、安装并配置 webpack 到项目中</p>
<p>1、创建 <code>package.json</code> 文件（保存安装包的依赖信息）</p>
<p>2、安装 webpack 到项目的开发依赖中</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># yarn add --dev webpack webpack-cli 或者 yarn add -D webpack webpack-cli</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># npm install -D webpack webpack-cli</span></span><br><span class="line">npm install --save-dev webpack webpack-cli</span><br></pre></td></tr></table></figure>

<blockquote>
<p>建议把开发工具打包相关的包的依赖信息保存到 <code>devDependencies</code> 中，其实就是一个归类，都安装包到项目中，有利于阅读，更清晰。</p>
</blockquote>
<p>3、将 package.json 的 <code>scripts</code> 中新增</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191122121632366.png" alt="image-20191122121632366"></p>
<p>三、打包</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>

<blockquote>
<p>npm 就会找到 package.json 中的 <code>build</code> 配置项，运行 webpak 构建打包。</p>
</blockquote>
<p>正确的话你应该可以看到：</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">$ npm run build</span><br><span class="line"></span><br><span class="line">&gt; demo1@<span class="number">1.0</span><span class="number">.0</span> build C:\Users\LPZ\Desktop\FE88\webpack-demos\demo1</span><br><span class="line">&gt; webpack</span><br><span class="line"></span><br><span class="line">Hash: <span class="number">893</span>a9c400f1f92ab6974</span><br><span class="line"><span class="keyword">Version</span>: webpack <span class="number">4.41</span><span class="number">.2</span></span><br><span class="line"><span class="type">Time</span>: <span class="number">96</span>ms</span><br><span class="line">Built at: <span class="number">2019</span><span class="number">-11</span><span class="number">-22</span> <span class="number">12</span>:<span class="number">19</span>:<span class="number">00</span></span><br><span class="line">  Asset       Size  Chunks             Chunk Names</span><br><span class="line">main.js  <span class="number">976</span> bytes       <span class="number">0</span>  [emitted]  main</span><br><span class="line">Entrypoint main = main.js</span><br><span class="line">[<span class="number">0</span>] ./src/<span class="keyword">index</span>.js + <span class="number">1</span> modules <span class="number">95</span> bytes &#123;<span class="number">0</span>&#125; [built]</span><br><span class="line">    | ./src/<span class="keyword">index</span>.js <span class="number">34</span> bytes [built]</span><br><span class="line">    | ./src/foo.js <span class="number">61</span> bytes [built]</span><br><span class="line"></span><br><span class="line"><span class="built_in">WARNING</span> <span class="keyword">in</span> <span class="keyword">configuration</span></span><br><span class="line">The <span class="string">&#x27;mode&#x27;</span> <span class="keyword">option</span> has <span class="keyword">not</span> been <span class="keyword">set</span>, webpack will fallback <span class="keyword">to</span> <span class="string">&#x27;production&#x27;</span> <span class="keyword">for</span> this <span class="keyword">value</span>. <span class="keyword">Set</span> <span class="string">&#x27;mode&#x27;</span> <span class="keyword">option</span> <span class="keyword">to</span> <span class="string">&#x27;development&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;production&#x27;</span> <span class="keyword">to</span> <span class="keyword">enable</span> defaults <span class="keyword">for</span> <span class="keyword">each</span> environment.</span><br><span class="line">You can <span class="keyword">also</span> <span class="keyword">set</span> it <span class="keyword">to</span> <span class="string">&#x27;none&#x27;</span> <span class="keyword">to</span> <span class="keyword">disable</span> <span class="keyword">any</span> <span class="keyword">default</span> behavior. Learn more: https://webpack.js.org/<span class="keyword">configuration</span>/mode/</span><br></pre></td></tr></table></figure>

<p>webpack 默认会找到 <code>src/index.js</code> 作为打包的入口，然后从入口分析所有的依赖：</p>
<ul>
<li>a 依赖了 b</li>
<li>b 依赖了 c</li>
<li>c 依赖 d</li>
<li>。。。。</li>
<li>所有依赖的文件</li>
</ul>
<p>将它们编译构建处理，最终生成一个默认名字叫 <code>main.js</code> 文件写入 <code>dist</code> 目录。</p>
<p>四、加载执行</p>
<p>在你 HTML 文件中加载打包的结果 <code>dist/main.js</code>，访问测试。</p>
<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>webpack 打包的入口和出口具有默认规则，如果想要自定义，或者其他一些更高级功能配置，那么我们就需要使用它的配置文件了。</p>
<p>1、在项目根目录创建 <code>webpack.config.js</code> 并写入</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * webpack 配置文件</span></span><br><span class="line"><span class="comment"> * 该文件必须导出一个对象</span></span><br><span class="line"><span class="comment"> * 对象中声明 webpack 的配置项</span></span><br><span class="line"><span class="comment"> * 注意：webpack 是基于 Node.js 开发运行的一个构件工具，它的打包运行的时候会来执行这个文件得到导出的配置对象</span></span><br><span class="line"><span class="comment"> * 所以你要知道：这里使用的都是 Node.js 中的代码相关语法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 入口配置</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 出口配置</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// __dirname 可以动态的获取当前文件所属目录的绝对路径</span></span><br><span class="line">    <span class="comment">// path 是 Node 中一个专门处理路径的一个模块</span></span><br><span class="line">    <span class="comment">// 它的 join 方法转么用来拼接路径，</span></span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;./dist&quot;</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// path: &#x27;C:\\Users\\LPZ\\Desktop\\FE88\\webpack-demos\\demo1\\dist&#x27;, // 打包的结果目录，默认是 dist，必须是一个绝对路径</span></span><br><span class="line">    <span class="comment">// path: &#x27;./dist/&#x27;, // 打包的结果目录，默认是 dist，必须是一个绝对路径</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;bundle.js&quot;</span>, <span class="comment">// 打包的结果文件名，默认叫 main.js</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>2、然后修改 <code>package.json</code> 文件中的 <code>build</code> 配置项（非必须）</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191122124307295.png" alt="image-20191122124307295"></p>
<blockquote>
<p>webpack 会自动加载执行名字叫 <code>webpack.config.js</code> 的配置文件，如果你使用了别的名字，那么就在这里自定义.</p>
</blockquote>
<p>3、打包</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>

<h2 id="关于-npm-scripts"><a href="#关于-npm-scripts" class="headerlink" title="关于 npm scripts"></a>关于 npm scripts</h2><p>推荐阅读：<a href="http://www.ruanyifeng.com/blog/2016/10/npm_scripts.html">阮一峰 - npm scripts 使用指南</a></p>
<p>我们安装到项目中的 webpack，手动的方式需要这样来使用：</p>
<h2 id="打包模式-mode"><a href="#打包模式-mode" class="headerlink" title="打包模式 mode"></a>打包模式 mode</h2><blockquote>
<p>官方文档： <a href="https://webpack.js.org/configuration/mode/">https://webpack.js.org/configuration/mode/</a></p>
</blockquote>
<p>mode 用来配置打包模式，有两种模式可选：</p>
<ul>
<li>development 开发模式<ul>
<li>更快的编译速度</li>
</ul>
</li>
<li>production 生产模式<ul>
<li>相比开发模式构建速度慢，拥有更好的编译结果</li>
<li>例如代码压缩</li>
</ul>
</li>
</ul>
<p>建议开发过程使用开发模式，发布上线使用生产模式。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191122155129511.png" alt="image-20191122155129511"></p>
<h2 id="打包-CSS"><a href="#打包-CSS" class="headerlink" title="打包 CSS"></a>打包 CSS</h2><p>1、安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save-dev style-loader css-loader</span><br></pre></td></tr></table></figure>

<p>2、修改打包配置文件</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191122152632937.png" alt="image-20191122152632937"></p>
<p>3、打包测试</p>
<h2 id="打包图片"><a href="#打包图片" class="headerlink" title="打包图片"></a>打包图片</h2><p>1、安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save-dev file-loader</span><br></pre></td></tr></table></figure>

<p>2、配置</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191122153520233.png" alt="image-20191122153520233"></p>
<p>3、打包配置</p>
<h2 id="设置-HtmlWebpackPlugin"><a href="#设置-HtmlWebpackPlugin" class="headerlink" title="设置 HtmlWebpackPlugin"></a>设置 HtmlWebpackPlugin</h2><p>为了解决打包之后的路径问题，我们也必须把 HTML 文件也打包到 dist 目录中，然后运行 dist 中的 HTML 文件，这才是正确的方式。</p>
<p>1、安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save-dev html-webpack-plugin</span><br></pre></td></tr></table></figure>

<p>2、配置</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">+ <span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    ...</span><br><span class="line">+   <span class="attr">plugins</span>: [</span><br><span class="line">+     <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">+       <span class="attr">title</span>: <span class="string">&#x27;管理输出&#x27;</span></span><br><span class="line">+     &#125;)</span><br><span class="line">+   ]</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>关于 HTMLwebpackplugin 更多内容，请参考： <a href="https://github.com/jantimon/html-webpack-plugin">https://github.com/jantimon/html-webpack-plugin</a></p>
</blockquote>
<p>3、打包测试</p>
<h2 id="自动清除-dist-目录"><a href="#自动清除-dist-目录" class="headerlink" title="自动清除 dist 目录"></a>自动清除 dist 目录</h2><p>建议每次打包之前把 dist 目录删除，每次都生成最新的干干净净的内容。</p>
<p>1、安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save-dev clean-webpack-plugin</span><br></pre></td></tr></table></figure>

<p>2、配置</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(),</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="打包字体文件"><a href="#打包字体文件" class="headerlink" title="打包字体文件"></a>打包字体文件</h2><p>还是使用 file-loader，只需要增加一个配置规则即可：</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191122162620802.png" alt="image-20191122162620802"></p>
<h2 id="打包-Less"><a href="#打包-Less" class="headerlink" title="打包 Less"></a>打包 Less</h2><p>1、安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 安装过的就不用重新安装了</span></span><br><span class="line">npm install less less-loader style-loader css-loader --save-dev</span><br></pre></td></tr></table></figure>

<p>2、配置</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191122163446652.png" alt="image-20191122163446652"></p>
<p>3、打包测试</p>
<h2 id="ES6-转-ES5"><a href="#ES6-转-ES5" class="headerlink" title="ES6 转 ES5"></a>ES6 转 ES5</h2><p>为了让代码中的 ES6 能运行在低版本浏览器，我们需要把 ES6 转为 ES5 向下兼容。</p>
<p>Babel 是一个专门将 ES6 转 ES5 的编译工具。</p>
<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><p>1、安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -D babel-loader @babel/core @babel/preset-env webpack</span><br></pre></td></tr></table></figure>

<p>2、配置</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191122165529066.png" alt="image-20191122165529066"></p>
<p>3、打包测试</p>
<p>它只能把基本的语法转换兼容处理，例如：</p>
<ul>
<li>const</li>
<li>let</li>
<li>箭头函数</li>
<li>解构赋值</li>
<li>。。。</li>
</ul>
<p>当时它不会处理一些 API 方法，例如：</p>
<ul>
<li>字符串的 includes 方法</li>
<li>数组的<ul>
<li>find</li>
<li>findIndex</li>
<li>includes</li>
<li>。。。。</li>
</ul>
</li>
</ul>
<h3 id="API-兼容处理"><a href="#API-兼容处理" class="headerlink" title="API 兼容处理"></a>API 兼容处理</h3><p>1、安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save @babel/polyfill</span><br></pre></td></tr></table></figure>

<p>2、配置</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191124090523101.png" alt="image-20191124090523101"></p>
<p>3、打包测试</p>
<h3 id="开启缓存"><a href="#开启缓存" class="headerlink" title="开启缓存"></a>开启缓存</h3><p>当代码文件比较多的时候，babel 打包非常耗时，我们建议开启缓存用以提高打包的效率。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191124091122427.png" alt="image-20191124091122427"></p>
<h2 id="增加-source-maps"><a href="#增加-source-maps" class="headerlink" title="增加 source maps"></a>增加 source maps</h2><blockquote>
<p>建议阅读：<a href="https://blog.teamtreehouse.com/introduction-source-maps">An Introduction to Source Maps</a></p>
</blockquote>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191124093220937.png" alt="image-20191124093220937"></p>
<h2 id="使用-watch-监视模式"><a href="#使用-watch-监视模式" class="headerlink" title="使用 watch 监视模式"></a>使用 watch 监视模式</h2><p>在 package.json 文件中新增一个 scripts 脚本：</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191124095723565.png" alt="image-20191124095723565"></p>
<h2 id="使用-webpack-dev-server"><a href="#使用-webpack-dev-server" class="headerlink" title="使用 webpack-dev-server"></a>使用 webpack-dev-server</h2><ul>
<li>开启一个 Web 服务器</li>
<li>监视打包</li>
<li>自动刷新浏览器</li>
<li>。。。。</li>
</ul>
<p>1、安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save-dev webpack-dev-server</span><br></pre></td></tr></table></figure>

<p>2、配置</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191124100620633.png" alt="image-20191124100620633"></p>
<blockquote>
<p>在 <code>webpack.config.js</code> 中新增的配置项</p>
</blockquote>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191124100646425.png" alt="image-20191124100646425"></p>
<blockquote>
<p>在 <code>package.json</code> 文件中新增 NPM Scripts 脚本</p>
</blockquote>
<p>3、打包测试</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm run serve</span><br></pre></td></tr></table></figure>

<h2 id="热更新"><a href="#热更新" class="headerlink" title="热更新"></a>热更新</h2><p>webpack-dev-server 默认是刷新整个页面实现更新。我们有一种更好的方式：热更新，可以在不刷新页面的情况下更新内容变化，效率更高。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191124101715767.png" alt="image-20191124101715767"></p>
<blockquote>
<p>在 webpack 配置文件中</p>
</blockquote>
<blockquote>
<p>提示：如果修改了配置文件，必须重启打包才能生效。</p>
</blockquote>
<h2 id="打包-Vue"><a href="#打包-Vue" class="headerlink" title="打包 Vue"></a>打包 Vue</h2><p>1、安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -D vue-loader vue-template-compiler</span><br></pre></td></tr></table></figure>

<p>2、配置</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191124104029319.png" alt="image-20191124104029319"></p>
<p>3、打包测试</p>
<h2 id="配置可以省略的后缀名"><a href="#配置可以省略的后缀名" class="headerlink" title="配置可以省略的后缀名"></a>配置可以省略的后缀名</h2><p>webpack 默认只支持省略：</p>
<ul>
<li>.wasm</li>
<li>.mjs</li>
<li>.js</li>
<li>.json</li>
</ul>
<p>等文件的后缀名。</p>
<p>如果想要让其支持其它的可省略的后缀名，需要单独配置。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191124110450652.png" alt="image-20191124110450652"></p>
<h2 id="配置路径别名"><a href="#配置路径别名" class="headerlink" title="配置路径别名"></a>配置路径别名</h2><p>在 Vue CLI 项目中，使用过一个路径别名：<code>@</code>，它表示 <code>src</code> 的路径。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191124111510567.png" alt="image-20191124111510567"></p>
<h2 id="使用-ESLint"><a href="#使用-ESLint" class="headerlink" title="使用 ESLint"></a>使用 ESLint</h2><p>ESLint 专门用于 JavaScript 代码格式校验工具。</p>
<ul>
<li>作者：<ul>
<li>《JavaScript 高级程序设计》</li>
<li>《深入理解 ECMAScript 6》</li>
<li>ESLint</li>
<li>。。。</li>
</ul>
</li>
</ul>
<p>1、安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install eslint eslint-loader --save-dev</span><br></pre></td></tr></table></figure>

<p>2、配置 webpack 配置文件</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191124115208034.png" alt="image-20191124115208034"></p>
<blockquote>
<p>在 webpack 配置文件的 module.rules 中新增</p>
</blockquote>
<p>3、配置生成 eslint 配置文件</p>
<p>在终端下执行：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 如果你是 macOS 后者 Linux 系统，则使用 ./node_modules/.bin/eslint.cmd --init</span></span><br><span class="line">.\node_modules\.bin\eslint.cmd --init</span><br></pre></td></tr></table></figure>

<p>然后就是在终端中根据向导完成配置：</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">$ .\node_modules\.bin\eslint.cmd --init</span><br><span class="line">? How would you like to use ESLint?</span><br><span class="line">  To<span class="built_in"> check </span>syntax only</span><br><span class="line">  To<span class="built_in"> check </span>syntax<span class="built_in"> and </span>find problems</span><br><span class="line">&gt; To<span class="built_in"> check </span>syntax, find problems,<span class="built_in"> and </span>enforce code style</span><br></pre></td></tr></table></figure>

<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">$ .\node_modules\.bin\eslint.cmd --init</span><br><span class="line">? How would you like to use ESLint? To<span class="built_in"> check </span>syntax, find problems,<span class="built_in"> and </span>enforce code style</span><br><span class="line">? What type of modules does your project use?</span><br><span class="line">&gt; JavaScript modules (import/export)</span><br><span class="line">  CommonJS (require/exports)</span><br><span class="line">  None of these</span><br></pre></td></tr></table></figure>

<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">$ .\node_modules\.bin\eslint.cmd --init</span><br><span class="line">? How would you like to use ESLint? To<span class="built_in"> check </span>syntax, find problems,<span class="built_in"> and </span>enforce code style</span><br><span class="line">? What type of modules does your project use? JavaScript modules (import/export)</span><br><span class="line">? Which framework does your project use?</span><br><span class="line">  React</span><br><span class="line">&gt; Vue.js</span><br><span class="line">  None of these</span><br></pre></td></tr></table></figure>

<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">$ .\node_modules\.bin\eslint.cmd --init</span><br><span class="line">? How would you like to use ESLint? To<span class="built_in"> check </span>syntax, find problems,<span class="built_in"> and </span>enforce code style</span><br><span class="line">? What type of modules does your project use? JavaScript modules (import/export)</span><br><span class="line">? Which framework does your project use? Vue.js</span><br><span class="line">? Does your project use TypeScript? (y/N) n</span><br></pre></td></tr></table></figure>

<figure class="highlight vhdl"><table><tr><td class="code"><pre><span class="line">$ .\node_modules\.bin\eslint.cmd <span class="comment">--init</span></span><br><span class="line">? How would you like <span class="keyword">to</span> <span class="keyword">use</span> ESLint? <span class="keyword">To</span> check syntax, find problems, <span class="keyword">and</span> enforce code style</span><br><span class="line">? What <span class="keyword">type</span> <span class="keyword">of</span> modules does your project <span class="keyword">use</span>? JavaScript modules (import/export)</span><br><span class="line">? Which framework does your project <span class="keyword">use</span>? Vue.js</span><br><span class="line">? Does your project <span class="keyword">use</span> TypeScript? No</span><br><span class="line">? Where does your code run? (Press &lt;space&gt; <span class="keyword">to</span> <span class="keyword">select</span>, &lt;a&gt; <span class="keyword">to</span> toggle <span class="keyword">all</span>, &lt;i&gt; <span class="keyword">to</span> invert selection)</span><br><span class="line">&gt;(*) Browser</span><br><span class="line"> ( ) Node</span><br></pre></td></tr></table></figure>

<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">$ .\node_modules\.bin\eslint.cmd --init</span><br><span class="line">? How would you like to <span class="keyword">use</span> ESLint? To check <span class="keyword">syntax</span>, find problems, and enforce code style</span><br><span class="line">? What <span class="keyword">type</span> of modules does your project <span class="keyword">use</span>? JavaScript modules (import/export)</span><br><span class="line">? <span class="keyword">Which</span> framework does your project <span class="keyword">use</span>? Vue.js</span><br><span class="line">? Does your project <span class="keyword">use</span> TypeScript? <span class="keyword">No</span></span><br><span class="line">? Where does your code <span class="keyword">run</span>? Browser</span><br><span class="line">? How would you like to define a style <span class="keyword">for</span> your project?</span><br><span class="line">&gt; <span class="keyword">Use</span> a popular style guide</span><br><span class="line">  Answer questions <span class="keyword">about</span> your style</span><br><span class="line">  <span class="keyword">Inspect</span> your JavaScript <span class="keyword">file</span>(s)</span><br></pre></td></tr></table></figure>

<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">$ .\node_modules\.bin\eslint.cmd --init</span><br><span class="line">? How would you like to <span class="keyword">use</span> ESLint? To check <span class="keyword">syntax</span>, find problems, and enforce code style</span><br><span class="line">? What <span class="keyword">type</span> of modules does your project <span class="keyword">use</span>? JavaScript modules (import/export)</span><br><span class="line">? <span class="keyword">Which</span> framework does your project <span class="keyword">use</span>? Vue.js</span><br><span class="line">? Does your project <span class="keyword">use</span> TypeScript? <span class="keyword">No</span></span><br><span class="line">? Where does your code <span class="keyword">run</span>? Browser</span><br><span class="line">? How would you like to define a style <span class="keyword">for</span> your project? <span class="keyword">Use</span> a popular style guide</span><br><span class="line">? <span class="keyword">Which</span> style guide <span class="keyword">do</span> you want to follow?</span><br><span class="line">  Airbnb: https:<span class="comment">//github.com/airbnb/javascript</span></span><br><span class="line">&gt; Standard: https:<span class="comment">//github.com/standard/standard</span></span><br><span class="line">  Google: https:<span class="comment">//github.com/google/eslint-config-google</span></span><br></pre></td></tr></table></figure>

<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">$ .\node_modules\.bin\eslint.cmd <span class="comment">--init</span></span><br><span class="line">? How would you <span class="keyword">like</span> <span class="keyword">to</span> use ESLint? <span class="keyword">To</span> <span class="keyword">check</span> syntax, find problems, <span class="keyword">and</span> enforce code style</span><br><span class="line">? What <span class="keyword">type</span> <span class="keyword">of</span> modules does your project use? JavaScript modules (<span class="keyword">import</span>/export)</span><br><span class="line">? Which framework does your project use? Vue.js</span><br><span class="line">? Does your project use TypeScript? <span class="keyword">No</span></span><br><span class="line">? <span class="keyword">Where</span> does your code run? Browser</span><br><span class="line">? How would you <span class="keyword">like</span> <span class="keyword">to</span> define a style <span class="keyword">for</span> your project? Use a popular style guide</span><br><span class="line">? Which style guide <span class="keyword">do</span> you want <span class="keyword">to</span> follow? Standard: https://github.com/standard/standard</span><br><span class="line">? What <span class="keyword">format</span> <span class="keyword">do</span> you want your config file <span class="keyword">to</span> be <span class="keyword">in</span>?</span><br><span class="line">&gt; JavaScript</span><br><span class="line">  YAML</span><br><span class="line">  <span class="type">JSON</span></span><br></pre></td></tr></table></figure>

<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">$ .\node_modules\.bin\eslint.cmd --init</span><br><span class="line">? How would you like to <span class="keyword">use</span> ESLint? To check <span class="keyword">syntax</span>, find problems, and enforce code style</span><br><span class="line">? What <span class="keyword">type</span> of modules does your project <span class="keyword">use</span>? JavaScript modules (import/export)</span><br><span class="line">? <span class="keyword">Which</span> framework does your project <span class="keyword">use</span>? Vue.js</span><br><span class="line">? Does your project <span class="keyword">use</span> TypeScript? <span class="keyword">No</span></span><br><span class="line">? Where does your code <span class="keyword">run</span>? Browser</span><br><span class="line">? How would you like to define a style <span class="keyword">for</span> your project? <span class="keyword">Use</span> a popular style guide</span><br><span class="line">? <span class="keyword">Which</span> style guide <span class="keyword">do</span> you want to follow? Standard: https:<span class="comment">//github.com/standard/standard</span></span><br><span class="line">? What <span class="keyword">format</span> <span class="keyword">do</span> you want your config <span class="keyword">file</span> to be <span class="keyword">in</span>? JavaScript</span><br><span class="line">Checking peerDependencies of eslint-config-standard@latest</span><br><span class="line">The config that you&#x27;ve selected requires the following dependencies:</span><br><span class="line"></span><br><span class="line">eslint-<span class="keyword">plugin</span>-vue@latest eslint-config-standard@latest eslint@&gt;=6.2.2 eslint-<span class="keyword">plugin</span>-import@&gt;=2.18.0 eslint-<span class="keyword">plugin</span>-node@&gt;=9.1.0 eslint-<span class="keyword">plugin</span>-promise@&gt;=4.2.1 eslint-<span class="keyword">plugin</span>-standard@&gt;=4.0.0</span><br><span class="line">? Would you like to install them now with npm? (Y/<span class="keyword">n</span>) y</span><br></pre></td></tr></table></figure>

<h3 id="自定义配置校验规则"><a href="#自定义配置校验规则" class="headerlink" title="自定义配置校验规则"></a>自定义配置校验规则</h3><p>ESLint 附带有大量的规则。你可以使用注释或配置文件修改你项目中要使用的规则。要改变一个规则设置，你必须将规则 ID 设置为下列值之一：</p>
<ul>
<li><code>&quot;off&quot;</code> 或 <code>0</code> - 关闭规则</li>
<li><code>&quot;warn&quot;</code> 或 <code>1</code> - 开启规则，使用警告级别的错误：<code>warn</code> (不会导致程序退出)</li>
<li><code>&quot;error&quot;</code> 或 <code>2</code> - 开启规则，使用错误级别的错误：<code>error</code> (当被触发的时候，程序会退出)</li>
</ul>
<p>详细的规则说明请查阅： <a href="https://eslint.bootcss.com/docs/rules/">https://eslint.bootcss.com/docs/rules/</a> 。</p>
<p>也可以在代码中使用注释临时控制代码格式校验：</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">/* eslint eqeqeq: <span class="string">&quot;off&quot;</span>, curly: <span class="string">&quot;error&quot;</span> */</span><br></pre></td></tr></table></figure>

<p>在这个例子里，<a href="https://eslint.bootcss.com/docs/user-guide/rules/eqeqeq"><code>eqeqeq</code></a> 规则被关闭，<a href="https://eslint.bootcss.com/docs/user-guide/rules/curly"><code>curly</code></a> 规则被打开，定义为错误级别。你也可以使用对应的数字定义规则严重程度：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/* eslint eqeqeq: 0, curly: 2 */</span></span><br></pre></td></tr></table></figure>

<p>更多配置，建议参考： <a href="https://eslint.bootcss.com/docs/user-guide/configuring/">https://eslint.bootcss.com/docs/user-guide/configuring/</a> 。</p>
<h2 id="在-Vue-CLI-创建的项目中配置-webpack"><a href="#在-Vue-CLI-创建的项目中配置-webpack" class="headerlink" title="在 Vue CLI 创建的项目中配置 webpack"></a>在 Vue CLI 创建的项目中配置 webpack</h2><p>优化。</p>
]]></content>
      <categories>
        <category>Webpack</category>
      </categories>
      <tags>
        <tag>Webpack</tag>
        <tag>Webpack-cli</tag>
      </tags>
  </entry>
  <entry>
    <title>Webpack注意事项</title>
    <url>/2021/02/18/Webpack/webpack%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/</url>
    <content><![CDATA[<h2 id="html-webpack-plugin-报错"><a href="#html-webpack-plugin-报错" class="headerlink" title="html-webpack-plugin 报错"></a>html-webpack-plugin 报错</h2><h3 id="Error-The-loader-didn’t-return-html"><a href="#Error-The-loader-didn’t-return-html" class="headerlink" title="Error: The loader didn’t return html"></a>Error: The loader didn’t return html</h3><p>报错原因：[Webpack v5.22.0&#96;破坏了 HTMLWebpackLoader ](<a href="https://github.com/jantimon/html-webpack-plugin/issues/1603">https://github.com/jantimon/html-webpack-plugin/issues/1603</a>)</p>
<p>解决方案： package.json 中 html-webpack-plugin 版本号是<code>&quot;^4.5.0&quot;</code> 直接更新至<code>5.1.0</code></p>
<h3 id="Error-Automatic-publicPath-is-not-supported-in-this-browser"><a href="#Error-Automatic-publicPath-is-not-supported-in-this-browser" class="headerlink" title="Error: Automatic publicPath is not supported in this browser"></a>Error: Automatic publicPath is not supported in this browser</h3><p>设置 webpack.config.js 中 output 中 publicPath: ‘’ 为空字符串</p>
]]></content>
      <categories>
        <category>Webpack</category>
      </categories>
      <tags>
        <tag>Webpack</tag>
        <tag>Webpack-cli</tag>
      </tags>
  </entry>
  <entry>
    <title>webpack进阶</title>
    <url>/2021/05/02/Webpack/webpack%E8%BF%9B%E9%98%B6/</url>
    <content><![CDATA[<h2 id="loader"><a href="#loader" class="headerlink" title="loader"></a>loader</h2><p>loader 用于转换某些类型的模块<br>loader 用于对某些导入的资源进行特定处理 例如 css image…</p>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p> loader本质上是一个函数</p>
<h3 id="手写一个-babelLoader"><a href="#手写一个-babelLoader" class="headerlink" title="手写一个 babelLoader"></a>手写一个 babelLoader</h3><p>webpack.config.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&#x27;babelLoader&#x27;</span>, <span class="comment">// 自定义的 babelLoader</span></span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">          <span class="attr">presets</span>: [</span><br><span class="line">            <span class="string">&#x27;@babel/preset-env&#x27;</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 配置 loader 路径解析规则  babelLoader 先去  node_modules 中找找不到再去 &quot;./loaders&quot; 下找</span></span><br><span class="line">  <span class="attr">resolveLoader</span>: &#123;</span><br><span class="line">    <span class="attr">modules</span>: [</span><br><span class="line">      <span class="string">&#x27;node_modules&#x27;</span>,</span><br><span class="line">      path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;loaders&#x27;</span>)</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>babelLoader.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; getOptions &#125; = <span class="built_in">require</span>(<span class="string">&#x27;loader-utils&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; validate &#125; = <span class="built_in">require</span>(<span class="string">&#x27;schema-utils&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> babel = <span class="built_in">require</span>(<span class="string">&#x27;@babel/core&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> babelSchema = <span class="built_in">require</span>(<span class="string">&#x27;./babelSchema.json&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// babel.transform用来编译代码的方法 是一个普通异步方法</span></span><br><span class="line"><span class="comment">// util.promisify将普通异步方法转化成基于promise的异步方法</span></span><br><span class="line"><span class="keyword">const</span> transform = util.<span class="title function_">promisify</span>(babel.<span class="property">transform</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params">content, map, meta</span>) &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 获取loader的options配置</span></span><br><span class="line">  <span class="keyword">const</span> options = <span class="title function_">getOptions</span>(<span class="variable language_">this</span>) || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 校验babel的options的配置</span></span><br><span class="line">  <span class="title function_">validate</span>(babelSchema, options, &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Babel Loader&#x27;</span> <span class="comment">// 报错的提示名称</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建异步 callback 将内容传给下一个 loader</span></span><br><span class="line">  <span class="keyword">const</span> callback = <span class="variable language_">this</span>.<span class="title function_">async</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用babel编译代码</span></span><br><span class="line">  <span class="title function_">transform</span>(content, options)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">&#123;code, map&#125;</span>) =&gt;</span> <span class="title function_">callback</span>(<span class="literal">null</span>, code, map, meta))</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> <span class="title function_">callback</span>(e))</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>babelSchema.json  验证规则</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// 需要验证的参数的类型</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;object&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// 参数名称</span></span><br><span class="line">    <span class="attr">&quot;presets&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="comment">// 参数类型</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;array&quot;</span> </span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 是否允许添加新的属性</span></span><br><span class="line">  <span class="attr">&quot;addtionalProperties&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Plugins"><a href="#Plugins" class="headerlink" title="Plugins"></a>Plugins</h2><p>Plugin  插件可以用于执行范围更广的任务。包括：打包优化，资源管理，注入环境变量。</p>
<h3 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h3><p> Plugin 实例 插件是一个具有 apply 方法的 JavaScript 对象。apply 方法会被 webpack compiler 调用，并且在 整个 编译生命周期都可以访问 compiler 对象。</p>
<p>ConsoleLogOnBuildWebpackPlugin.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> pluginName = <span class="string">&#x27;ConsoleLogOnBuildWebpackPlugin&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConsoleLogOnBuildWebpackPlugin</span> &#123;</span><br><span class="line">  <span class="title function_">apply</span>(<span class="params">compiler</span>) &#123;</span><br><span class="line">    compiler.<span class="property">hooks</span>.<span class="property">run</span>.<span class="title function_">tap</span>(pluginName, <span class="function">(<span class="params">compilation</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;webpack 构建正在启动！&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">ConsoleLogOnBuildWebpackPlugin</span>;</span><br></pre></td></tr></table></figure>

<h3 id="compiler-钩子"><a href="#compiler-钩子" class="headerlink" title="compiler 钩子"></a>compiler 钩子</h3><p>Compiler 可以看做是 运行时的webpack对象<br>Compiler.hooks 上有 webpack 运行时生命周期的各个 hook， 这些 hook（extends）自 Tapable 类</p>
<h4 id="Tapable-使用"><a href="#Tapable-使用" class="headerlink" title="Tapable 使用"></a>Tapable 使用</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// tabpable 提供一系列创建钩子和调用钩子的方法  （发布者订阅者模式）</span></span><br><span class="line"><span class="keyword">const</span> tapable = <span class="built_in">require</span>(<span class="string">&#x27;tapable&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  <span class="comment">// 同步执行 串行</span></span><br><span class="line">  <span class="title class_">SyncHook</span>,</span><br><span class="line">  <span class="comment">// 同步执行 串行 遇到返回值 退出执行</span></span><br><span class="line">  <span class="title class_">SyncBailHook</span>,</span><br><span class="line">  <span class="comment">// 异步并行 并行行1个钩子出错 不影响其他钩子触发</span></span><br><span class="line">  <span class="title class_">AsyncParallelHook</span>,</span><br><span class="line">  <span class="comment">// 异步串行 串行1个钩子出错 后面的钩子就不再触发</span></span><br><span class="line">  <span class="title class_">AsyncSeriesHook</span>,</span><br><span class="line">&#125; = tapable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HookTest</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span> = &#123;</span><br><span class="line">      <span class="comment">// hooks 的容器</span></span><br><span class="line">      <span class="attr">go</span>: <span class="keyword">new</span> <span class="title class_">SyncHook</span>([<span class="string">&#x27;arg1&#x27;</span>, <span class="string">&#x27;arg2&#x27;</span>]), <span class="comment">// 参数数组的长度 是 回调函数的所能接受参数的长度</span></span><br><span class="line">      <span class="attr">asyncGo</span>: <span class="keyword">new</span> <span class="title class_">AsyncParallelHook</span>([<span class="string">&#x27;arg1&#x27;</span>]),</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//  向容器里添加对应的钩子函数 （添加订阅者）</span></span><br><span class="line">  <span class="title function_">tap</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// tap  在 go （SyncHook）容器（相当于一个map） 添加键值--- key -&gt; synchook1, value -&gt; 回调函数</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">go</span>.<span class="title function_">tap</span>(<span class="string">&#x27;synchook1&#x27;</span>, <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;synchook1 触发了 args:&#x27;</span>, args);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">123</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">go</span>.<span class="title function_">tap</span>(<span class="string">&#x27;synchook2&#x27;</span>, <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;synchook2 触发了 args:&#x27;</span>, args);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// tapAsync 添加一个异步执行的函数  函数内部接受一个 callback , callback 调用代表 函数执行完毕</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">asyncGo</span>.<span class="title function_">tapAsync</span>(<span class="string">&#x27;asynchook1&#x27;</span>, <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> callback = args[args.<span class="property">length</span> - <span class="number">1</span>];</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;asynchook1 回调异步 触发了 arg1:&#x27;</span>, args[<span class="number">0</span>]);</span><br><span class="line">        <span class="comment">// 异步函数执行完毕 callback 第一参数 是错误</span></span><br><span class="line">        <span class="title function_">callback</span>(<span class="literal">null</span>, <span class="string">&#x27;asynchook1&#x27;</span>);</span><br><span class="line">      &#125;, <span class="number">3000</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// tapPromise 添加一个异步执行的函数 函数返回一个 promise</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">asyncGo</span>.<span class="title function_">tapPromise</span>(<span class="string">&#x27;asynchook2&#x27;</span>, <span class="function">(<span class="params">arg1</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;asynchook2  Promise 异步 触发了 arg1:&#x27;</span>, arg1);</span><br><span class="line">          <span class="comment">// 异步函数执行完毕</span></span><br><span class="line">          <span class="title function_">resolve</span>(<span class="string">&#x27;asynchook2&#x27;</span>);</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//   触发所有钩子中的函数 （发布订阅）</span></span><br><span class="line">  <span class="title function_">call</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">go</span>.<span class="title function_">call</span>(<span class="string">&#x27;这是同步钩子调用的参数&#x27;</span>);</span><br><span class="line">    <span class="comment">// 最后一个传入的参数 就是回调函数 callback</span></span><br><span class="line">    <span class="comment">// 当所有 钩子都执行完了,(或有一个出错误时) 就会触发这个 函数</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hooks</span>.<span class="property">asyncGo</span>.<span class="title function_">callAsync</span>(<span class="string">&#x27;这是异步钩子调用的参数&#x27;</span>, <span class="keyword">function</span> (<span class="params">err, res</span>) &#123;</span><br><span class="line">      <span class="comment">// 代表所有leave容器中的函数触发完了，才触发</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;异步钩子 end~~~&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> test = <span class="keyword">new</span> <span class="title class_">HookTest</span>();</span><br><span class="line"></span><br><span class="line">test.<span class="title function_">tap</span>();</span><br><span class="line">test.<span class="title function_">call</span>();</span><br></pre></td></tr></table></figure>

<h3 id="Compilation"><a href="#Compilation" class="headerlink" title="Compilation"></a>Compilation</h3><p><a href="https://webpack.docschina.org/api/compilation-hooks/">Compilation</a><br>compilation 由 Compiler 创建, 包含所有模块和对应依赖 , 同样也有各个生命周期的 hook 同 compiler.hooks</p>
<h3 id="手写一个-CopyWebpackPlugin"><a href="#手写一个-CopyWebpackPlugin" class="headerlink" title="手写一个 CopyWebpackPlugin"></a>手写一个 CopyWebpackPlugin</h3><p>CopyWebpackPlugin.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; validate &#125; = <span class="built_in">require</span>(<span class="string">&#x27;schema-utils&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> schema = <span class="built_in">require</span>(<span class="string">&#x27;./schema&#x27;</span>).<span class="property">CopyWebpackPlugin</span>;</span><br><span class="line"><span class="keyword">const</span> globby = <span class="built_in">require</span>(<span class="string">&#x27;globby&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; readFile &#125; = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="property">promises</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">RawSource</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>).<span class="property">sources</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CopyWebpackPlugin</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">options</span> = options;</span><br><span class="line">    <span class="title function_">validate</span>(schema, options);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">compiler</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">compilation</span> = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">apply</span>(<span class="params">compiler</span>) &#123;</span><br><span class="line">    <span class="comment">// compiler  初始化 compilation</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">compiler</span> = compiler;</span><br><span class="line">    compiler.<span class="property">hooks</span>.<span class="property">thisCompilation</span>.<span class="title function_">tap</span>(<span class="string">&#x27;CopyWebpackPlugin&#x27;</span>, <span class="function">(<span class="params">compilation</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">compilation</span> = compilation;</span><br><span class="line">      <span class="comment">// 为 compilation 创建额外 asset</span></span><br><span class="line">      compilation.<span class="property">hooks</span>.<span class="property">additionalAssets</span>.<span class="title function_">tapPromise</span>(</span><br><span class="line">        <span class="string">&#x27;CopyWebpackPlugin&#x27;</span>,</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hanleCopy</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>),</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">hanleCopy</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; <span class="keyword">from</span>, ignore, to = <span class="string">&#x27;.&#x27;</span> &#125; = <span class="variable language_">this</span>.<span class="property">options</span>;</span><br><span class="line">    <span class="keyword">const</span> context = <span class="variable language_">this</span>.<span class="property">compiler</span>.<span class="property">options</span>.<span class="property">context</span>; <span class="comment">// process.cwd()</span></span><br><span class="line">    <span class="comment">// 判断是 from 否为绝对路径</span></span><br><span class="line">    <span class="keyword">from</span> = path.<span class="title function_">isAbsolute</span>(<span class="keyword">from</span>) ? <span class="keyword">from</span> : path.<span class="title function_">resolve</span>(process.<span class="title function_">cwd</span>(), <span class="keyword">from</span>);</span><br><span class="line">    <span class="comment">// window 下有路径问题</span></span><br><span class="line">    <span class="keyword">from</span> = <span class="keyword">from</span>.<span class="title function_">replace</span>(<span class="regexp">/\\/g</span>, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    <span class="comment">// 1. 获取 from 文件列表</span></span><br><span class="line">    <span class="keyword">let</span> files = <span class="keyword">await</span> <span class="title function_">globby</span>(<span class="keyword">from</span>, &#123;</span><br><span class="line">      ignore,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> file <span class="keyword">of</span> files) &#123;</span><br><span class="line">      <span class="comment">// 2. 读取文件</span></span><br><span class="line">      <span class="keyword">let</span> filename = path.<span class="title function_">join</span>(to, path.<span class="title function_">basename</span>(file));</span><br><span class="line">      <span class="keyword">let</span> buf = <span class="keyword">await</span> <span class="title function_">readFile</span>(file);</span><br><span class="line">      <span class="comment">// 3. 写入文件</span></span><br><span class="line">      <span class="keyword">let</span> source = <span class="keyword">new</span> <span class="title class_">RawSource</span>(buf);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">compilation</span>.<span class="title function_">emitAsset</span>(filename, source);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">CopyWebpackPlugin</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>webpack.config.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">CopyWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;../plugins/CopyWebpackPlugin&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>, <span class="comment">// production</span></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CopyWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">to</span>: <span class="string">&#x27;.&#x27;</span>,</span><br><span class="line">      <span class="attr">from</span>: <span class="string">&#x27;public&#x27;</span>,</span><br><span class="line">      <span class="attr">ignore</span>: [<span class="string">&#x27;*/index.html&#x27;</span>],</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>schema</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="title class_">CopyWebpackPlugin</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;object&#x27;</span>, <span class="comment">// options 类型</span></span><br><span class="line">    <span class="attr">properties</span>: &#123;</span><br><span class="line">      <span class="attr">to</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">from</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">ignore</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;array&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">additionalProperties</span>: <span class="literal">false</span>, <span class="comment">// 可以添加更多key</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="手写简易版-webpack"><a href="#手写简易版-webpack" class="headerlink" title="手写简易版 webpack"></a>手写简易版 webpack</h2><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://github.com/ronami/minipack">mini webpack</a> 将多个文件打包到一个文件中</li>
</ul>
]]></content>
      <categories>
        <category>Webpack</category>
      </categories>
      <tags>
        <tag>Webpack</tag>
        <tag>Webpack-cli</tag>
      </tags>
  </entry>
  <entry>
    <title>windows系统下的环境变量</title>
    <url>/2021/03/19/Windows/windows%E7%B3%BB%E7%BB%9F%E4%B8%8B%E7%9A%84%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/</url>
    <content><![CDATA[<p>windows 系统下 如需要在命令行中执行某个程序 如：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">typora xx.md</span><br></pre></td></tr></table></figure>

<p>需要配置环境变量</p>
<p>找到用户环境变量配置 PATH 将 typora 的可执行文件的所在目录的路径添加进去 ,例如：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">C:\app\Typora\bin</span><br></pre></td></tr></table></figure>

<p>注意：只需要添加 exe 文件的目录即可 C:\app\Typora\bin，不需要要加上 typora.exe；</p>
<p>添加完后需要重启命令行工具 ，命令才可以正常执行</p>
]]></content>
      <categories>
        <category>Windows</category>
      </categories>
      <tags>
        <tag>windows</tag>
      </tags>
  </entry>
  <entry>
    <title>windows系统常用命令</title>
    <url>/2022/07/18/Windows/windows%E7%B3%BB%E7%BB%9F%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<h2 id="查看所有进程"><a href="#查看所有进程" class="headerlink" title="查看所有进程"></a>查看所有进程</h2><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">tasklist</span><br></pre></td></tr></table></figure>

<h2 id="杀死具体进程"><a href="#杀死具体进程" class="headerlink" title="杀死具体进程"></a>杀死具体进程</h2><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line"><span class="built_in">taskkill</span> /F /FI &quot;imagename eq IsaHelp.exe&quot;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Windows</category>
      </categories>
      <tags>
        <tag>windows</tag>
      </tags>
  </entry>
  <entry>
    <title>windows系统常见问题</title>
    <url>/2021/08/06/Windows/windows%E7%B3%BB%E7%BB%9F%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h2 id="电脑不进系统之开机重复自动修复不进系统"><a href="#电脑不进系统之开机重复自动修复不进系统" class="headerlink" title="电脑不进系统之开机重复自动修复不进系统"></a>电脑不进系统之开机重复自动修复不进系统</h2><div class="note primary"><p>修复建议使用 wepe </p>
</div>

<h3 id="修复："><a href="#修复：" class="headerlink" title="修复："></a>修复：</h3><p>b 站视频：<a href="https://www.bilibili.com/video/BV1Gv41177gU?p=1&share_medium=android&share_plat=android&share_session_id=19331413-99af-4377-82ff-8b31a9cc451c&share_source=WEIXIN&share_tag=s_i&timestamp=1628169593&unique_k=IAUbQn">https://www.bilibili.com/video/BV1Gv41177gU?p=1&amp;share_medium=android&amp;share_plat=android&amp;share_session_id=19331413-99af-4377-82ff-8b31a9cc451c&amp;share_source=WEIXIN&amp;share_tag=s_i&amp;timestamp=1628169593&amp;unique_k=IAUbQn</a></p>
<h3 id="wepe-下载地址"><a href="#wepe-下载地址" class="headerlink" title="wepe 下载地址"></a>wepe 下载地址</h3><p><a href="http://www.wepe.com.cn/download.html">http://www.wepe.com.cn/download.html</a></p>
<h4 id="安装-U-盘卡在-38-左右不动的问题"><a href="#安装-U-盘卡在-38-左右不动的问题" class="headerlink" title="安装 U 盘卡在 38%左右不动的问题"></a>安装 U 盘卡在 38%左右不动的问题</h4><p>原因：应该是 ui 界面卡住了</p>
<p>解决：打开任务管理器 找到 wepe 的任务 ，右键切换到，或双击 就可以了</p>
<h3 id="各类型主机启动方式快捷键"><a href="#各类型主机启动方式快捷键" class="headerlink" title="各类型主机启动方式快捷键"></a>各类型主机启动方式快捷键</h3><p><img data-src="https://bitbw.top/public/img/my_gallery/%E7%94%B5%E8%84%91%E5%93%81%E7%89%8C%E7%9A%84%E5%BC%80%E6%9C%BA%E7%83%AD%E9%94%AE1-200P31H100463.jpg" alt="微PE工具箱bootice引导修复如何用？Windows系统引导修复教程"></p>
<h3 id="修改环境变量并立即生效"><a href="#修改环境变量并立即生效" class="headerlink" title="修改环境变量并立即生效"></a>修改环境变量并立即生效</h3><p><a href="http://www.wjhsh.net/zht-blog-p-4033951.html">详解Windows不重启使环境变量修改生效(经典)</a></p>
<ul>
<li>修改完环境变量</li>
<li>打开cmd输入： set PATH&#x3D;C:  （这里改的是 PATH 变量 修改别的变量就 key&#x3D;value, value 无所谓是什么）</li>
<li>关闭cmd</li>
<li>重新打开cmd输入： echo %PATH% （验证一下是否生效）</li>
</ul>
]]></content>
      <categories>
        <category>Windows</category>
      </categories>
      <tags>
        <tag>windows</tag>
      </tags>
  </entry>
  <entry>
    <title>yarn 和 npm</title>
    <url>/2018/04/30/Nodejs/yarn%E5%92%8Cnpm/</url>
    <content><![CDATA[<h2 id="关于-npm-和-yarn"><a href="#关于-npm-和-yarn" class="headerlink" title="关于 npm 和 yarn"></a>关于 npm 和 yarn</h2><p>npm 和 yarn 都是管理第三方包的。</p>
<p>yarn 相比 npm 稍微快一些。</p>
<p>下面是 npm 和 yarn 常用命令对照表：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># yarn init</span></span><br><span class="line">npm init</span><br><span class="line"></span><br><span class="line"><span class="comment"># yarn add 包名</span></span><br><span class="line">npm install 包名</span><br><span class="line"></span><br><span class="line"><span class="comment"># yarn install 或者直接 yarn</span></span><br><span class="line">npm install</span><br><span class="line"></span><br><span class="line"><span class="comment"># yarn add -D 包名</span></span><br><span class="line">npm install -D 包名</span><br><span class="line"></span><br><span class="line"><span class="comment"># yarn remove 包名</span></span><br><span class="line">npm uninstall 包名</span><br><span class="line"></span><br><span class="line"><span class="comment"># yarn global add 包名</span></span><br><span class="line">npm install --global 包名</span><br><span class="line"></span><br><span class="line"><span class="comment"># yarn global remove 包名</span></span><br><span class="line">npm uninstall --global 包名</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>在一个项目中，使用哪个包管理工具那你就自始至终都使用这个工具，千万不要混用，否则会导致文件丢失。</p>
<p>如果你想切换项目使用的包管理工具或者你因为混用包管理工具导致项目的模块丢失报错了，使用下面的方式解决：</p>
<p>1、删除 node_modules</p>
<p>2、使用你要使用的包管理工具把所有依赖重新安装一遍</p>
<ul>
<li>如果是 yarn 就直接执行 <code>yarn</code> 或者 <code>yarn install</code></li>
<li>如果 npm 就执行 <code>npm install</code></li>
</ul>
<p>3、之后都使用你切换之后的包管理工具进行装包</p>
<h2 id="补充：关于-VueCLI-创建项目使用的包管理器"><a href="#补充：关于-VueCLI-创建项目使用的包管理器" class="headerlink" title="补充：关于 VueCLI 创建项目使用的包管理器"></a>补充：关于 VueCLI 创建项目使用的包管理器</h2><p>使用 VueCLI 创建项目的时候会帮我们自动装包。</p>
<ul>
<li>如果你的机器只有 npm，则它默认就使用 npm 安装包</li>
<li>如果你的机器只有 yarn，则它默认就使用 yarn 安装包</li>
</ul>
<p>如果你的机器同时存在 npm 和 yarn，则它会提示你使用 npm 还是 yarn 来装包，例如下面这样：</p>
<figure class="highlight vhdl"><table><tr><td class="code"><pre><span class="line">Vue CLI v4.<span class="number">1.1</span></span><br><span class="line">? Please pick a preset: <span class="keyword">default</span> (babel, eslint)</span><br><span class="line">? Pick the <span class="keyword">package</span> manager <span class="keyword">to</span> <span class="keyword">use</span> <span class="keyword">when</span> installing dependencies: (<span class="keyword">Use</span> arrow keys)</span><br><span class="line">&gt; <span class="keyword">Use</span> Yarn</span><br><span class="line">  <span class="keyword">Use</span> NPM</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Use Yarn：使用 yarn</p>
<p>Use NPM：使用 npm</p>
</blockquote>
<p>根据提示选择对应的包管理器工具之后，接下来它就会使用你选择的包管理器工具安装项目依赖。</p>
<p>但是之后你使用 <code>vue</code> 命令创建项目的时候，它都会使用你之前选择的包管理工具安装依赖，而不再给你提示选择的机会。</p>
<p>这是因为 VueCLI 默认记住了你第 1 次选择使用的包管理器，是好事儿也是坏事儿。</p>
<p>如果你想要在初始化的时候重新选择使用的包管理工具，那就找到你操作系统用户目录下的 <code>.vuerc</code> 将其删除即可。</p>
]]></content>
      <categories>
        <category>Nodejs</category>
      </categories>
      <tags>
        <tag>工具使用</tag>
        <tag>npm</tag>
        <tag>yarn</tag>
      </tags>
  </entry>
  <entry>
    <title>转从深入到通俗Object.prototype.toString.call()</title>
    <url>/2021/07/23/js/%E4%BB%8E%E6%B7%B1%E5%85%A5%E5%88%B0%E9%80%9A%E4%BF%97Object-prototype-toString-call/</url>
    <content><![CDATA[<p>原文地址：<a href="https://zhuanlan.zhihu.com/p/118793721">https://zhuanlan.zhihu.com/p/118793721</a></p>
<p>没有废话，直入主题。</p>
<h3 id="一、Object-prototype-toString-的调用"><a href="#一、Object-prototype-toString-的调用" class="headerlink" title="一、Object.prototype.toString() 的调用"></a>一、Object.prototype.toString() 的调用</h3><p>对于 <code>Object.prototype.toString()</code> 方法，会返回一个形如 <code>&quot;[object XXX]&quot;</code> 的字符串。</p>
<p>如果对象的 <code>toString()</code> 方法未被重写，就会返回如上面形式的字符串。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(&#123;&#125;.<span class="title function_">toString</span>()); <span class="comment">// =&gt; &quot;[object Object]&quot;</span></span><br><span class="line"><span class="title class_">Math</span>.<span class="title function_">toString</span>(); <span class="comment">// =&gt; &quot;[object Math]&quot;</span></span><br></pre></td></tr></table></figure>

<p>但是，大多数对象，<code>toString()</code> 方法都是重写了的，这时，需要用 <code>call()</code> 或 <code>Reflect.apply()</code> 等方法来调用。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> x = &#123;</span><br><span class="line">  <span class="title function_">toString</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;X&quot;</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">x.<span class="title function_">toString</span>(); <span class="comment">// =&gt; &quot;X&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(x); <span class="comment">// =&gt; &quot;[object Object]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">apply</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>, x, []); <span class="comment">// =&gt; &quot;[object Object]&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="二、Object-prototype-toString-的原理"><a href="#二、Object-prototype-toString-的原理" class="headerlink" title="二、Object.prototype.toString() 的原理"></a>二、<code>Object.prototype.toString()</code> 的原理</h3><p>对于 <code>Object.prototype.toString.call(arg)</code>，若参数为 <code>null</code> 或 <code>undefined</code>，直接返回结果。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="literal">null</span>); <span class="comment">// =&gt; &quot;[object Null]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="literal">undefined</span>); <span class="comment">// =&gt; &quot;[object Undefined]&quot;</span></span><br></pre></td></tr></table></figure>

<p>若参数不为 <code>null</code> 或 <code>undefined</code>，则将参数转为对象，再作判断。对于原始类型，转为对象的方法即装箱，此处不赘述。</p>
<p>转为对象后，取得该对象的 <code>[Symbol.toStringTag]</code> 属性值（可能会遍历原型链）作为 <code>tag</code>，如无该属性，或该属性值不为字符串类型，则依下表取得 <code>tag</code>, 然后返回 <code>&quot;[object &quot; + tag + &quot;]&quot;</code> 形式的字符串。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Boolean 类型，tag 为 &quot;Boolean&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="literal">true</span>); <span class="comment">// =&gt; &quot;[object Boolean]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Number 类型，tag 为 &quot;Number&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="number">1</span>); <span class="comment">// =&gt; &quot;[object Boolean]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// String 类型，tag 为 &quot;String&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="string">&quot;&quot;</span>); <span class="comment">// =&gt; &quot;[object String]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Array 类型，tag 为 &quot;String&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>([]); <span class="comment">// =&gt; &quot;[object Array]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Arguments 类型，tag 为 &quot;Arguments&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(</span><br><span class="line">  (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">arguments</span>;</span><br><span class="line">  &#125;)()</span><br><span class="line">); <span class="comment">// =&gt; &quot;[object Arguments]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Function 类型， tag 为 &quot;Function&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;); <span class="comment">// =&gt; &quot;[object Function]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Error 类型（包含子类型），tag 为 &quot;Error&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="keyword">new</span> <span class="title class_">Error</span>()); <span class="comment">// =&gt; &quot;[object Error]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// RegExp 类型，tag 为 &quot;RegExp&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="regexp">/\d+/</span>); <span class="comment">// =&gt; &quot;[object RegExp]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Date 类型，tag 为 &quot;Date&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="keyword">new</span> <span class="title class_">Date</span>()); <span class="comment">// =&gt; &quot;[object Date]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 其他类型，tag 为 &quot;Object&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="keyword">new</span> (<span class="keyword">class</span> &#123;&#125;)()); <span class="comment">// =&gt; &quot;[object Object]&quot;</span></span><br></pre></td></tr></table></figure>

<p>下面为部署了 <code>Symbol.toStringTag</code> 的例子。可以看出，属性值期望是一个字符串，否则会被忽略。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> o1 = &#123; [<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]: <span class="string">&quot;A&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> o2 = &#123; [<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]: <span class="literal">null</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(o1); <span class="comment">// =&gt; &quot;[object A]&quot;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(o2); <span class="comment">// =&gt; &quot;[object Object]&quot;</span></span><br></pre></td></tr></table></figure>

<p><code>Symbol.toStringTag</code> 也可以部署在原型链上：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;&#125;</span><br><span class="line">A.<span class="property"><span class="keyword">prototype</span></span>[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>] = <span class="string">&quot;A&quot;</span>;</span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="keyword">new</span> <span class="title function_">A</span>()); <span class="comment">// =&gt; &quot;[object A]&quot;</span></span><br></pre></td></tr></table></figure>

<p>新标准引入了 <code>[Symbol.toStringTag]</code> 属性，是为了把此方法接口化，用于规范新引入的对象对此方法的调用。但对于“老旧”的对象，就只能直接输出值，以保证兼容性。</p>
<h3 id="三、部署了此属性的内置对象"><a href="#三、部署了此属性的内置对象" class="headerlink" title="三、部署了此属性的内置对象"></a>三、部署了此属性的内置对象</h3><p>下面，我列出所有部署了此属性的内置对象。</p>
<ol>
<li><strong>三个容器对象</strong>。这类对象用作命名空间，用于存储同一类方法。</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">JSON</span>[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;JSON&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Math</span>[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;Math&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Atomics</span>[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;Atomic&quot;</span></span><br></pre></td></tr></table></figure>

<p>这三个对象的 <code>toString()</code> 都没有重写，直接调用 <code>toString()</code> 方法也可以得到相同的结果。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">JSON</span>.<span class="title function_">toString</span>(); <span class="comment">// =&gt; &quot;[object JSON]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Math</span>.<span class="title function_">toString</span>(); <span class="comment">// =&gt; &quot;[object Math]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Atomics</span>.<span class="title function_">toString</span>(); <span class="comment">// =&gt; &quot;[object Atomics]&quot;</span></span><br></pre></td></tr></table></figure>

<p>\2. **两个新引入的类型 <code>BigInt</code> 和 <code>Symbol</code>**。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">BigInt</span>.<span class="property"><span class="keyword">prototype</span></span>[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;BigInt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Symbol</span>.<span class="property"><span class="keyword">prototype</span></span>[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;Symbol&quot;</span></span><br></pre></td></tr></table></figure>

<p>\3. <strong>四个集合（Collection）对象</strong>。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Set</span>.<span class="property"><span class="keyword">prototype</span></span>[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;Set&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Map</span>.<span class="property"><span class="keyword">prototype</span></span>[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;Map&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">WeakSet</span>.<span class="property"><span class="keyword">prototype</span></span>[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;WeakSet&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">WeakMap</span>.<span class="property"><span class="keyword">prototype</span></span>[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;WeakMap&quot;</span></span><br></pre></td></tr></table></figure>

<p>\4. <strong><code>ArrayBuffer</code> 及其视图对象</strong>。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">ArrayBuffer</span>.<span class="property"><span class="keyword">prototype</span></span>[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>];       <span class="comment">// =&gt; &quot;ArrayBuffer&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">SharedArrayBuffer</span>.<span class="property"><span class="keyword">prototype</span></span>[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;SharedArrayBuffer&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">DataView</span>.<span class="property"><span class="keyword">prototype</span></span>[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>];          <span class="comment">// =&gt; &quot;DataView&quot;</span></span><br><span class="line"></span><br><span class="line">%<span class="title class_">TypedArray</span>%.<span class="property"><span class="keyword">prototype</span></span>[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>];      <span class="comment">// 返回各 %TypedArray% 的名称</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 各 %TypedArray%：</span></span><br><span class="line"><span class="comment"> *   Int8Array;</span></span><br><span class="line"><span class="comment"> *   Uint8Array;</span></span><br><span class="line"><span class="comment"> *   Uint8ClampedArray;</span></span><br><span class="line"><span class="comment"> *   Int16Array;</span></span><br><span class="line"><span class="comment"> *   Uint16Array;</span></span><br><span class="line"><span class="comment"> *   Int32Array;</span></span><br><span class="line"><span class="comment"> *   Uint32Array;</span></span><br><span class="line"><span class="comment"> *   BigInt64Array;</span></span><br><span class="line"><span class="comment"> *   BigUint64Array;</span></span><br><span class="line"><span class="comment"> *   Float32Array;</span></span><br><span class="line"><span class="comment"> *   Float64Array;</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<p>其中，<code>%TypedArray%</code> 比较特殊。<code>Symbol.toStringTag</code> 并没有直接部署在各个 <code>%TypedArray%</code> 的原型对象上。</p>
<p>而是，各个 <code>%TypedArray%</code> 拥有同一个原型对象 <code>%TypedArray%.prototype</code>，<code>Symbol.toStringTag</code> 属性就部署在这个对象上。而且，该属性为一个只读访问器属性，访问该属性时，会根据 <code>this</code> 的类型来判断返回哪一个 <code>%TypedArray%</code> 的名称。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> p0 = <span class="title class_">Int8Array</span>.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line"><span class="keyword">var</span> p1 = <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(<span class="title class_">Int8Array</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(<span class="title class_">BigUint64Array</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 各个 %TypedArray% 具有同一个原型对象 %TypedArray%.prototype</span></span><br><span class="line">p1 === p2; <span class="comment">// =&gt; true</span></span><br><span class="line">p1.<span class="property">constructor</span>.<span class="property">name</span>; <span class="comment">// =&gt; &quot;TypedArray&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Symbol.toStringTag 即部署在 %TypedArray%.prototype 上</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">getOwnPropertySymbols</span>(p0).<span class="title function_">includes</span>(<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>); <span class="comment">// =&gt; false</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">getOwnPropertySymbols</span>(p1).<span class="title function_">includes</span>(<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>); <span class="comment">// =&gt; true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 该属性为只读访问器属性</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(p1, <span class="title class_">Symbol</span>.<span class="property">toStringTag</span>); <span class="comment">// =&gt; &#123; get: ...,</span></span><br><span class="line"><span class="comment">//      set: undefined,</span></span><br><span class="line"><span class="comment">//      ... &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用该访问器属性时</span></span><br><span class="line"><span class="comment">// 如果 this 不为对象或 TypedArray，返回 undefined</span></span><br><span class="line"><span class="comment">// 否则返回该 TypedArray 的名称</span></span><br><span class="line"><span class="keyword">var</span> get = <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(p1, <span class="title class_">Symbol</span>.<span class="property">toStringTag</span>).<span class="property">get</span>;</span><br><span class="line">p1[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; undefined</span></span><br><span class="line">get.<span class="title function_">call</span>(&#123;&#125;); <span class="comment">// =&gt; undefined</span></span><br><span class="line">get.<span class="title function_">call</span>(<span class="literal">null</span>); <span class="comment">// =&gt; undefined</span></span><br><span class="line">get.<span class="title function_">call</span>(<span class="keyword">new</span> <span class="title class_">Set</span>()); <span class="comment">// =&gt; undefined</span></span><br><span class="line">get.<span class="title function_">call</span>(<span class="keyword">new</span> <span class="title class_">Int8Array</span>()); <span class="comment">// =&gt; &quot;Int8Array&quot;</span></span><br><span class="line">get.<span class="title function_">call</span>(<span class="keyword">new</span> <span class="title class_">BigInt64Array</span>()); <span class="comment">// =&gt; &quot;BigInt64Array&quot;</span></span><br></pre></td></tr></table></figure>

<p>这个设计还是挺精妙的。</p>
<p>\5. <strong><code>Iterator</code> 的一些实现</strong>。新标准实现了 <code>Iterator</code> 接口，以下实现也部署了该属性。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">%<span class="title class_">ArrayIteratorPrototype</span>%;         <span class="comment">// =&gt; &quot;Array Iterator&quot;</span></span><br><span class="line"></span><br><span class="line">%<span class="title class_">SetIteratorPrototype</span>%;           <span class="comment">// =&gt; &quot;Set Iterator&quot;</span></span><br><span class="line"></span><br><span class="line">%<span class="title class_">MapIteratorPrototype</span>%;           <span class="comment">// =&gt; &quot;Map Iterator&quot;</span></span><br><span class="line"></span><br><span class="line">%<span class="title class_">StringIteratorPrototype</span>%;        <span class="comment">// =&gt; &quot;String Iterator&quot;</span></span><br><span class="line"></span><br><span class="line">%<span class="title class_">RegExpStringIteratorPrototype</span>%;  <span class="comment">// =&gt; &quot;RegExp String Iterator&quot;</span></span><br></pre></td></tr></table></figure>

<p>例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">[][<span class="title class_">Symbol</span>.<span class="property">iterator</span>]()[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;Array Iterator&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Set</span>().<span class="title function_">keys</span>()[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;Set Iterator&quot;</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Set</span>().<span class="title function_">values</span>()[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;Set Iterator&quot;</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Set</span>().<span class="title function_">entries</span>()[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;Set Iterator&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Map</span>().<span class="title function_">keys</span>()[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;Set Iterator&quot;</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Map</span>().<span class="title function_">values</span>()[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;Set Iterator&quot;</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Map</span>().<span class="title function_">entries</span>()[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;Set Iterator&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]()[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;String Iterator&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;1a2b3c&quot;</span>.<span class="title function_">matchAll</span>(<span class="regexp">/\d/</span>)[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;RegExp String Iterator&quot;</span></span><br></pre></td></tr></table></figure>

<p>\6. <strong>新引入的函数引型及其原型，包含 <code>async</code> 和 <code>generator</code> 函数以及他们的组合</strong>。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">%<span class="title class_">GeneratorFunction</span>%[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>];            <span class="comment">// =&gt; &quot;GeneratorFunction&quot;</span></span><br><span class="line"></span><br><span class="line">%<span class="title class_">GeneratorFunction</span>%.<span class="property"><span class="keyword">prototype</span></span>[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>];  <span class="comment">// =&gt; &quot;Generator&quot;</span></span><br><span class="line"></span><br><span class="line">%<span class="title class_">AsyncFunction</span>%[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>];                <span class="comment">// =&gt; &quot;AsyncFunction&quot;</span></span><br><span class="line"></span><br><span class="line">%<span class="title class_">AsyncGenerator</span>%[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>];               <span class="comment">// =&gt; &quot;AsyncGenerator&quot;</span></span><br><span class="line"></span><br><span class="line">%<span class="title class_">AsyncGeneratorFunction</span>%[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>];       <span class="comment">// =&gt; &quot;AsyncGeneratorFunction&quot;</span></span><br></pre></td></tr></table></figure>

<p>例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">f1</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">f1[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;GeneratorFunction&quot;</span></span><br><span class="line"></span><br><span class="line">f1.<span class="property"><span class="keyword">prototype</span></span>[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;Generator&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">f2</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">f2[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;AsyncFunction&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span>* <span class="title function_">f3</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">f2[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;AsyncGeneratorFunction&quot;</span></span><br><span class="line"></span><br><span class="line">f3.<span class="property"><span class="keyword">prototype</span></span>[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;AsyncGenerator&quot;</span></span><br></pre></td></tr></table></figure>

<p>实际上，<code>Generator Function</code> 为 <code>Function</code> 的子类；<code>%GeneratorFunction%.prototype</code> 为 <code>Iterator</code> 的子类。</p>
<p>\7. <strong>模块命名空间对象（Module Namespace Object）</strong>。</p>
<p>新引入的模块命名空间对象（Module Namespace Object）也是部署了此属性的。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="variable language_">module</span> <span class="keyword">from</span> <span class="string">&quot;./export.js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;Moduel&quot;</span></span><br></pre></td></tr></table></figure>

<p>\8. 另外，<strong>在不同的实现中，有些第三方对象也部署了此属性</strong>。</p>
<p>比如在浏览器中：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Window</span>.<span class="property"><span class="keyword">prototype</span></span>[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;Window&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">HTMLElement</span>.<span class="property"><span class="keyword">prototype</span></span>[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;HTMLElement&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Blob</span>.<span class="property"><span class="keyword">prototype</span></span>[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;Blob&quot;</span></span><br></pre></td></tr></table></figure>

<p>在 Node.js 中：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">global</span>[<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]; <span class="comment">// =&gt; &quot;global&quot;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>代码编辑器插件 codemirror 和 monaco-editor 的使用</title>
    <url>/2022/09/06/js%E6%8F%92%E4%BB%B6/%E4%BB%A3%E7%A0%81%E7%BC%96%E8%BE%91%E5%99%A8%E6%8F%92%E4%BB%B6codemirror%E5%92%8Cmonaco-editor%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="codemirror"><a href="#codemirror" class="headerlink" title="codemirror"></a>codemirror</h2><p><a href="https://codemirror.net/5/index.html">codemirror 官方文档</a><br><a href="https://v1.github.surmon.me/vue-codemirror/">vue-codemirror 官方文档</a><br><a href="https://github.com/surmon-china/surmon-china.github.io/tree/vue2/projects/vue-codemirror/examples">vue-codemirror 官方 examples</a><br>因为是本项目是 vue2 所以先记录 vue2 中的使用</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>4.0.6 配合 vue2</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm install vue-codemirror@4.0.6 </span><br></pre></td></tr></table></figure>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;codemirror&quot;&gt;</span><br><span class="line">    &lt;codemirror v-model=&quot;code&quot; :options=&quot;cmOption&quot; /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import dedent from &quot;dedent&quot;;</span><br><span class="line">import &#123; codemirror &#125; from &quot;vue-codemirror&quot;;</span><br><span class="line">// base style</span><br><span class="line">import &quot;codemirror/lib/codemirror.css&quot;;</span><br><span class="line">// language</span><br><span class="line">import &quot;codemirror/mode/vue/vue.js&quot;;</span><br><span class="line">// theme css</span><br><span class="line">import &quot;codemirror/theme/base16-dark.css&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;codemirror-example-vue&quot;,</span><br><span class="line">  title: &quot;Mode: text/x-vue &amp; Theme: base16-dark&quot;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    codemirror,</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      code: dedent`</span><br><span class="line">          &lt;template&gt;</span><br><span class="line">            &lt;h1&gt;Hello World!&lt;/h1&gt;</span><br><span class="line">            &lt;codemirror v-model=&quot;code&quot; :options=&quot;cmOption&quot; /&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">          &lt;script&gt;</span><br><span class="line">            // import &#x27;some-codemirror-resource&#x27;</span><br><span class="line">            export default &#123;</span><br><span class="line">              data() &#123;</span><br><span class="line">                return &#123;</span><br><span class="line">                  code: &#x27;const A = 10&#x27;,</span><br><span class="line">                  cmOption: &#123;</span><br><span class="line">                    tabSize: 4,</span><br><span class="line">                    styleActiveLine: true,</span><br><span class="line">                    lineNumbers: true,</span><br><span class="line">                    line: true,</span><br><span class="line">                    foldGutter: true,</span><br><span class="line">                    styleSelectedText: true,</span><br><span class="line">                    mode: &#x27;text/javascript&#x27;,</span><br><span class="line">                    keyMap: &quot;sublime&quot;,</span><br><span class="line">                    matchBrackets: true,</span><br><span class="line">                    showCursorWhenSelecting: true,</span><br><span class="line">                    theme: &quot;monokai&quot;,</span><br><span class="line">                    extraKeys: &#123; &quot;Ctrl&quot;: &quot;autocomplete&quot; &#125;,</span><br><span class="line">                    hintOptions:&#123;</span><br><span class="line">                      completeSingle: false</span><br><span class="line">                    &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          $&#123;&quot;&lt;\\/script&gt;&quot;&#125;</span><br><span class="line"></span><br><span class="line">          &lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">            @import &#x27;./sass/mixins&#x27;;</span><br><span class="line">            @import &#x27;./sass/variables&#x27;;</span><br><span class="line">            main &#123;</span><br><span class="line">              position: relative;</span><br><span class="line">            &#125;</span><br><span class="line">          &lt;/style&gt;</span><br><span class="line">        `,</span><br><span class="line">      cmOption: &#123;</span><br><span class="line">        tabSize: 4,</span><br><span class="line">        styleActiveLine: true,</span><br><span class="line">        lineNumbers: true,</span><br><span class="line">        line: true,</span><br><span class="line">        mode: &quot;text/x-vue&quot;,</span><br><span class="line">        lineWrapping: true,</span><br><span class="line">        theme: &quot;base16-dark&quot;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">.codemirror &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 100vh;</span><br><span class="line">  ::v-deep &#123;</span><br><span class="line">    .CodeMirror &#123;</span><br><span class="line">      height: 100vh;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意 没有如果默认安装 <code>dedent</code> 还需要安装一下 <code>dedent</code></p>
</blockquote>
<h2 id="Monaco-Editor"><a href="#Monaco-Editor" class="headerlink" title="Monaco Editor"></a>Monaco Editor</h2><p><a href="https://github.com/microsoft/monaco-editor">github地址</a><br><a href="https://microsoft.github.io/monaco-editor/">Monaco Editor 官网</a></p>
<p>Monaco Editor 就是 网页版的 vscode 所以编辑功能更强大, 但相对体积也更大</p>
<h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm install monaco-editor</span><br></pre></td></tr></table></figure>

<h3 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h3><p><a href="https://github.com/microsoft/monaco-editor/tree/main/samples">Monaco Editor 所以使用示例</a></p>
<p>使用方式有很多种 因为是 vue 项目所以直接使用<a href="https://github.com/microsoft/monaco-editor/blob/main/docs/integrate-esm.md">集成 ESM</a>方式</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;monaco-editor&quot;&gt;</span><br><span class="line">    &lt;div id=&quot;container&quot; style=&quot;height: 100%&quot;&gt;&lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import * as monaco from &quot;monaco-editor&quot;;</span><br><span class="line">let monacoInstance;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;MonacoEditor&quot;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    monacoInstance = monaco.editor.create(</span><br><span class="line">      document.getElementById(&quot;container&quot;),</span><br><span class="line">      &#123;</span><br><span class="line">        value: &quot;function hello() &#123;\n\talert(&#x27;Hello world!&#x27;);\n&#125;&quot;,</span><br><span class="line">        language: &quot;javascript&quot;,</span><br><span class="line">        theme: &quot;vs-dark&quot;,</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;,</span><br><span class="line">  destroyed() &#123;</span><br><span class="line">    monacoInstance.dispose();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">.monaco-editor &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 100vh;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>vue.config.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; defineConfig &#125; = <span class="built_in">require</span>(<span class="string">&quot;@vue/cli-service&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MonacoWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;monaco-editor-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">transpileDependencies</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">configureWebpack</span>: &#123;</span><br><span class="line">    <span class="attr">plugins</span>: [<span class="keyword">new</span> <span class="title class_">MonacoWebpackPlugin</span>()],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>js插件</category>
      </categories>
      <tags>
        <tag>monaco-editor</tag>
        <tag>codemirror</tag>
      </tags>
  </entry>
  <entry>
    <title>使用 ubuntu 打造 NAS</title>
    <url>/2021/06/03/Linux/%E4%BD%BF%E7%94%A8-ubuntu-%E6%89%93%E9%80%A0-NAS/</url>
    <content><![CDATA[<h1 id="Ubuntu-文件管理软件安装"><a href="#Ubuntu-文件管理软件安装" class="headerlink" title="Ubuntu 文件管理软件安装"></a>Ubuntu 文件管理软件安装</h1><h2 id="Ubuntu-的安装"><a href="#Ubuntu-的安装" class="headerlink" title="Ubuntu 的安装"></a>Ubuntu 的安装</h2><p>参考： <a href="https://www.cnblogs.com/masbay/p/10745170.html">https://www.cnblogs.com/masbay/p/10745170.html</a></p>
<h2 id="开启-ssh-服务"><a href="#开启-ssh-服务" class="headerlink" title="开启 ssh 服务"></a>开启 ssh 服务</h2><p>Ubuntu 默认不会开启 ssh 服务。所以我们无法对 Ubuntu 进行远程连接，这对 Ubuntu 的运维造成了很大不便。本文详细讲解如何在 Ubuntu18 下开启 ssh 服务。</p>
<p><em>关键指令(root 用户下，非 root 用户所有指令前加 sudo)</em></p>
<p><strong>*ps -e | grep ssh（查看 ssh 服务是否开启）*</strong></p>
<p><strong>*apt-get install openssh-client（安装 ssh 客户端程序）*</strong></p>
<p><strong>*apt-get install openssh-server（安装 ssh 服务端程序）*</strong></p>
<p><strong>*service ssh start 或者 &#x2F;etc&#x2F;init.d&#x2F;ssh start（开启 ssh 服务）*</strong></p>
<p><strong>*service ssh stop 或者 &#x2F;etc&#x2F;init.d&#x2F;ssh stop（关闭 ssh 服务）*</strong></p>
<p><strong>*指令 1：ps -e | grep ssh（ 查看 ssh 服务是否开启）*</strong></p>
<p>运行**<em>ps -e | grep ssh</em>**得出如图一的两行结果。ssh-agent 指的是 ubuntu 的 ssh 服务的客户端，用于该 ubuntu 远程连接其它 Linux 主机。sshd 指的是 ubuntu 的 ssh 服务的服务端，用于其它主机通过 ssh 服务连接该主机。</p>
<p>换句话说，如果没有 sshd 进程的话，别的系统是不能连接该 ubuntu 主机的，若是没有 ssh-agent 的话，该 ubuntu 主机也无法通过 ssh 连接其它主机。</p>
<p><strong>*指令 2：apt-get install openssh-client（安装 ssh 客户端程序）*</strong></p>
<p>若是运行***ps -e | grep ssh*<strong>没有查出 ssh-agent 服务，但是你又想通过 ssh 服务连接别的系统。那么就执行</strong>*apt-get install openssh-client*<strong>安装 ssh 客户端。接着执行</strong><em>ssh 目标用户@目标 ip</em>**即可连接目标主机。正常情况 Ubuntu 默认开启 ssh-agent 服务。所以一般用不打指令 2。</p>
<p><strong>*指令 3：apt-get install openssh-server（安装 ssh 服务端程序）*</strong></p>
<p>默认 ssh 的服务端是没有安装的，可用***ps -e | grep ssh*<strong>查看。若是没有 sshd 的进程，则运行</strong><em>apt-get install openssh-server</em>**安装 ssh 服务端。接着重新执行 ps -e | grep ssh 便可发现 sshd 已启动。至此，其它主机便可通过 ssh 连接该主机。</p>
<p>sshd 和 ssh-agent 都已经启动。其它主机便可通过 ssh 连接该主机</p>
<p><strong>*指令 4：service ssh start 或者 &#x2F;etc&#x2F;init.d&#x2F;ssh start（开启 ssh 服务）*</strong></p>
<p><strong>*指令 5：service ssh stop 或者 &#x2F;etc&#x2F;init.d&#x2F;ssh stop（关闭 ssh 服务）*</strong></p>
<p>指令 4 和指令 5 便是开启和关闭 sshd 服务进程的。</p>
<p>以上便是 Ubuntu18 下安装开启 ssh 进程的所有流程。<br>来源：<a href="https://www.jianshu.com/p/4b50b55ebb4d">https://www.jianshu.com/p/4b50b55ebb4d</a></p>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><h4 id="SSH连服务器提示“Permission-denied-publickey-…-”的原因与解决办法"><a href="#SSH连服务器提示“Permission-denied-publickey-…-”的原因与解决办法" class="headerlink" title="SSH连服务器提示“Permission denied(publickey,…).”的原因与解决办法"></a>SSH连服务器提示“Permission denied(publickey,…).”的原因与解决办法</h4><p><strong>原因分析：</strong></p>
<p>错误提示的大意是拒绝许可，括号中的各种验证失败或未能验证</p>
<p><strong>解决办法：</strong></p>
<p>（1）编辑&#x2F;etc&#x2F;ssh&#x2F;sshd_config配置文件：</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">vim /etc/ssh/sshd_config </span><br></pre></td></tr></table></figure>

<p>（2）将  第34行左右的  PermitRootLogin 设置为 yes  第58行左右的 PasswordAuthentication 设置为yes，如下图</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20220527213951303.png" alt="image-20220527213951303"></p>
<p>（3）重启sshd服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl restart sshd</span><br></pre></td></tr></table></figure>



<h2 id="Samba-共享文件服务"><a href="#Samba-共享文件服务" class="headerlink" title="Samba 共享文件服务"></a>Samba 共享文件服务</h2><p>参考：<a href="https://www.linuxidc.com/Linux/2018-11/155466.htm">https://www.linuxidc.com/Linux/2018-11/155466.htm</a></p>
<h2 id="FTP-文件传输服务"><a href="#FTP-文件传输服务" class="headerlink" title="FTP 文件传输服务"></a>FTP 文件传输服务</h2><p>安装完 ssh 就可以使用 sftp ，也可以再装一个 vsftpd </p>
<p>运行：sudo apt-get install vsftpd 命令，安装 VSFTP 工具</p>
<p>安装好了之后，使用如下命令启动 FTP 服务：</p>
<p>sudo systemctl start vsftpd<br>sudo systemctl enable vsftpd</p>
<p>查看是否开启</p>
<p>sudo ss -tunlp | grep -i ftp</p>
<h2 id="Gitlab"><a href="#Gitlab" class="headerlink" title="Gitlab"></a>Gitlab</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>gitlab 企业版 –&gt; ee</p>
<p>gitlab 社区版 –&gt; ce</p>
<blockquote>
<p>tip 官方文档很详细 建议查看官方文档</p>
</blockquote>
<p>官方社区版安装教程：<a href="https://docs.gitlab.com/ce/install/">https://docs.gitlab.com/ce/install/</a></p>
<p>推荐使用 docker 容器方式：</p>
<p><a href="https://docs.gitlab.com/omnibus/docker/">docker容器方式安装教程</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo docker run --detach \</span><br><span class="line">  --hostname gitlab.example.com \</span><br><span class="line">  --publish 9443:443 --publish 9080:80 --publish 9022:22 \</span><br><span class="line">  --name gitlab \</span><br><span class="line">  --restart always \</span><br><span class="line">  --volume <span class="variable">$GITLAB_HOME</span>/config:/etc/gitlab \</span><br><span class="line">  --volume <span class="variable">$GITLAB_HOME</span>/logs:/var/log/gitlab \</span><br><span class="line">  --volume <span class="variable">$GITLAB_HOME</span>/data:/var/opt/gitlab \</span><br><span class="line">  --shm-size 256m \</span><br><span class="line">  gitlab/gitlab-ce:latest</span><br></pre></td></tr></table></figure>

<p><a href="https://docs.gitlab.com/ee/install/docker.html#configuration">docker容器方式配置教程</a></p>
<h1 id="内网穿透"><a href="#内网穿透" class="headerlink" title="内网穿透"></a>内网穿透</h1><h2 id="ZeroTier-One"><a href="#ZeroTier-One" class="headerlink" title="ZeroTier One"></a>ZeroTier One</h2><h3 id="安装-ZeroTier-One-内网穿透"><a href="#安装-ZeroTier-One-内网穿透" class="headerlink" title="安装 ZeroTier One 内网穿透"></a>安装 ZeroTier One 内网穿透</h3><p>官网：<a href="https://www.zerotier.com/">https://www.zerotier.com/</a></p>
<p>使用这行命令安装 ZeroTier One</p>
<p>curl -s <a href="https://install.zerotier.com/">https://install.zerotier.com/</a> | sudo bash</p>
<p>复制下面代码，将 NetWork ID 从 zerotier 官方网站中复制到下面代码中</p>
<p>sudo zerotier-cli join （NetWork ID）</p>
<p>若出现”200 join OK”则添加成功</p>
<h2 id="frp"><a href="#frp" class="headerlink" title="frp"></a>frp</h2><h3 id="安装-frp-内网穿透"><a href="#安装-frp-内网穿透" class="headerlink" title="安装 frp 内网穿透"></a>安装 frp 内网穿透</h3><p><a href="https://gofrp.org/docs/setup/">官方文档</a></p>
<h4 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h4><p>目前可以在 Github 的 <a href="https://github.com/fatedier/frp/releases">Release</a> 页面中下载到最新版本的客户端和服务端二进制文件，所有文件被打包在一个压缩包中。</p>
<h4 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h4><p>解压缩下载的压缩包，将其中的 frpc 拷贝到内网服务所在的机器上，将 frps 拷贝到具有公网 IP 的机器上，放置在任意目录。</p>
<h4 id="开始使用"><a href="#开始使用" class="headerlink" title="开始使用"></a>开始使用</h4><p>编写配置文件，先通过 <code>./frps -c ./frps.ini</code> 启动服务端，再通过 <code>./frpc -c ./frpc.ini</code> 启动客户端。如果需要在后台长期运行，建议结合其他工具使用，例如 <code>systemd</code> 和 <code>supervisor</code>。 </p>
<p>如果是 Windows 用户，需要在 cmd 终端中执行命令。</p>
<p>配置文件如何编写可以参考 <a href="https://gofrp.org/docs/examples/">示例</a> 中的内容。</p>
<p>这个示例通过简单配置 TCP 类型的代理让用户访问到内网的服务器。</p>
<h3 id="阿里云配置"><a href="#阿里云配置" class="headerlink" title="阿里云配置"></a>阿里云配置</h3><p>需要开启防火墙 中的对应端口  <code>7000</code> <code>6000</code> …</p>
<h3 id="通过-SSH-访问内网机器"><a href="#通过-SSH-访问内网机器" class="headerlink" title="通过 SSH 访问内网机器"></a>通过 SSH 访问内网机器</h3><ol>
<li><p>在具有公网 IP 的机器上部署 frps，修改 frps.ini 文件，这里使用了最简化的配置，设置了 frp 服务器用户接收客户端连接的端口：</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span> <span class="comment"># 用于与 frpc 连接</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在需要被访问的内网机器上（SSH 服务通常监听在 22 端口）部署 frpc，修改 frpc.ini 文件，假设 frps 所在服务器的公网 IP 为 x.x.x.x：</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = test.com</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span>  <span class="comment"># 用于与 frps 连接</span></span><br><span class="line"></span><br><span class="line"><span class="section">[ssh]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">22</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">6000</span>  <span class="comment"># 代理 访问 test.com:6000 相当于访问 127.0.0.1:22</span></span><br></pre></td></tr></table></figure>

<p><code>local_ip</code> 和 <code>local_port</code> 配置为本地需要暴露到公网的服务地址和端口。<code>remote_port</code> 表示在 frp 服务端监听的端口，访问此端口的流量将会被转发到本地服务对应的端口。</p>
</li>
<li><p>分别启动 frps 和 frpc。</p>
</li>
<li><p>通过 SSH 访问内网机器，假设用户名为 test：</p>
<p><code>ssh -oPort=6000 test@x.x.x.x</code></p>
<p>frp 会将请求 <code>x.x.x.x:6000</code> 的流量转发到内网机器的 22 端口。</p>
<p>MEIFGMOCJGAGTQFR</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>使用class创建函数对象</title>
    <url>/2022/04/15/es6/%E4%BD%BF%E7%94%A8class%E5%88%9B%E5%BB%BA%E5%87%BD%E6%95%B0%E5%AF%B9%E8%B1%A1/</url>
    <content><![CDATA[<p>使用class创建函数对象 ,可以在 constructor 中返回一个函数 并设置其原型 &#x3D;&#x3D;&#x3D; this</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">tags</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">tags</span> = [].<span class="title function_">concat</span>(tags);</span><br><span class="line">    <span class="keyword">let</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">tags</span>) &#123;</span><br><span class="line">      _this.<span class="property">tags</span> = _this.<span class="property">tags</span>.<span class="title function_">concat</span>(tags);</span><br><span class="line">      <span class="keyword">return</span> fn;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(<span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(fn), <span class="variable language_">this</span>);</span><br><span class="line">    <span class="keyword">return</span> fn;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">info</span>(<span class="params">info</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">tags</span>.<span class="title function_">map</span>(<span class="function"><span class="params">tag</span>=&gt;</span><span class="string">`[<span class="subst">$&#123;tag&#125;</span>]`</span>).<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>), info);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 日志 支持链式调用例如 logger(&quot;tag1&quot;)(&quot;tag2&quot;)(&quot;tag3&quot;).info(&quot;info&quot;) 和 logger([&quot;tag1&quot;,&quot;tag2&quot;]).info(&quot;info&quot;)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; tag  [tag1][tag2]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="type">*</span>&#125; 返回 函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="keyword">let</span> logger = <span class="keyword">new</span> <span class="title class_">Logger</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>es6</category>
      </categories>
  </entry>
  <entry>
    <title>使用vscode调试代码</title>
    <url>/2021/03/09/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/%E4%BD%BF%E7%94%A8vscode%E8%B0%83%E8%AF%95/</url>
    <content><![CDATA[<h2 id="使用-vscode-直接调试-js-代码"><a href="#使用-vscode-直接调试-js-代码" class="headerlink" title="使用 vscode 直接调试 js 代码"></a>使用 vscode 直接调试 js 代码</h2><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><ul>
<li>将当前标签页设置为需要调试的 js</li>
<li>将需要打断点的地方标上小红点</li>
<li>左侧工具栏点击小虫子（Run and Debug）</li>
<li>点击运行和调试</li>
<li>选择 nodejs 作为调试工具</li>
<li>开始调试</li>
</ul>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20210309103224511.png" alt="image-20210309103224511"></p>
<p>如果只调试 js 代码的话，选择 nodejs 即可</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20210309103344902.png" alt="image-20210309103344902"></p>
<h3 id="调试界面"><a href="#调试界面" class="headerlink" title="调试界面"></a>调试界面</h3><p><img data-src="https://bitbw.top/public/img/my_gallery/image-20210309103733550.png" alt="image-20210309103733550"></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>使用 vscode 调试非常方便，比直接在浏览器中调式体验更好，可以边调试边改代码，很爽的体验；</p>
<h2 id="launch-和-tasks-的使用"><a href="#launch-和-tasks-的使用" class="headerlink" title="launch 和 tasks 的使用"></a>launch 和 tasks 的使用</h2><h3 id="launch-的使用"><a href="#launch-的使用" class="headerlink" title="launch 的使用"></a>launch 的使用</h3><p>待完成</p>
<h3 id="tasks（任务）的使用"><a href="#tasks（任务）的使用" class="headerlink" title="tasks（任务）的使用"></a>tasks（任务）的使用</h3><p>官网：<a href="https://code.visualstudio.com/docs/editor/tasks#_variable-substitution">https://code.visualstudio.com/docs/editor/tasks#_variable-substitution</a></p>
<h3 id="预定义变量"><a href="#预定义变量" class="headerlink" title="预定义变量"></a>预定义变量</h3><p>官网：<a href="https://code.visualstudio.com/docs/editor/variables-reference#_predefined-variables">https://code.visualstudio.com/docs/editor/variables-reference#_predefined-variables</a></p>
<p>知乎：<a href="https://zhuanlan.zhihu.com/p/92175757">https://zhuanlan.zhihu.com/p/92175757</a></p>
<h3 id="tasks-json"><a href="#tasks-json" class="headerlink" title="tasks.json"></a>tasks.json</h3><blockquote>
<p>具体的配置文件</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// See https://go.microsoft.com/fwlink/?LinkId=733558</span></span><br><span class="line">    <span class="comment">// for the documentation about the tasks.json format</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;options&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;cwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;fileDirname&#125;&quot;</span> <span class="comment">// 定义执行环境</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tasks&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;build&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shell&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ruler  -p  $&#123;fileBasename&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;problemMatcher&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;fileLocation&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="string">&quot;relative&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="string">&quot;$&#123;fileDirname&#125;&quot;</span></span><br><span class="line">                <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;pattern&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="comment">// 提示文本进行分组 下面是具体的提示文本</span></span><br><span class="line">                    <span class="comment">// s920.rule:652:1: warning 规则Server,&quot;软件预装&quot;,&quot;os&quot;已在647行定义</span></span><br><span class="line">                    <span class="attr">&quot;regexp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^(.*):(\\d+):(\\d+):\\s+(warning|error)\\s+(.*)$&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;file&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span>			<span class="comment">// 文件名所在组</span></span><br><span class="line">                    <span class="attr">&quot;line&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span>			<span class="comment">// 代码所在行</span></span><br><span class="line">                    <span class="attr">&quot;column&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span>		<span class="comment">// 代码所在列</span></span><br><span class="line">                    <span class="attr">&quot;severity&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span>		<span class="comment">// warning 还是 error</span></span><br><span class="line">                    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="number">5</span>		<span class="comment">// 提示文本</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;presentation&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;echo&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;reveal&quot;</span><span class="punctuation">:</span> <span class="string">&quot;always&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;focus&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;panel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shared&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;showReuseMessage&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;clear&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;group&quot;</span><span class="punctuation">:</span> <span class="string">&quot;build&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    	<span class="punctuation">&#123;</span></span><br><span class="line">            ...</span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>使用 launch 时.vscode 目录一定要在所打开文件夹的根节点下</p>
<p>否则点击运行启动调试则只能调试当天打开的 tab 标签页</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/vscode%E8%B0%83%E8%AF%95%E6%B3%A8%E6%84%8F01.png" alt="image-20210723134611394"></p>
]]></content>
      <categories>
        <category>工具使用</category>
      </categories>
      <tags>
        <tag>vscode</tag>
      </tags>
  </entry>
  <entry>
    <title>使用xlsx.js 实现隐藏工作簿</title>
    <url>/2020/12/13/js%E6%8F%92%E4%BB%B6/%E4%BD%BF%E7%94%A8xlsx-js-%E5%AE%9E%E7%8E%B0%E9%9A%90%E8%97%8F%E5%B7%A5%E4%BD%9C%E7%B0%BF/</url>
    <content><![CDATA[<p><a href="http://sheetjs.com/">SheetJS js-xlsx</a> 中文文档： <a href="https://github.com/rockboom/SheetJS-docs-zh-CN">https://github.com/rockboom/SheetJS-docs-zh-CN</a></p>
<p>下面是对工作簿能见度的描述文档</p>
<h2 id="数据表能见度"><a href="#数据表能见度" class="headerlink" title="数据表能见度"></a>数据表能见度</h2><p>Excel 支持将表格隐藏在更低的标签栏。表格数据存储文件内，但是 UI 不容易让它可以使用。标准的隐藏表格会被显示在”Unhide”菜单内。Excel 也有”very hidden”表格，这些表格不能被显示在菜单内。只可以通过 Vb 编辑器访问。</p>
<p>能见度的设置被存储在表格属性数组的<code>Hidden</code>属性当中。</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Definition</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>Visible</td>
</tr>
<tr>
<td>1</td>
<td>Hidden</td>
</tr>
<tr>
<td>2</td>
<td>Very Hidden</td>
</tr>
</tbody></table>
<p>更多详情请查看<a href="https://rawgit.com/SheetJS/test_files/master/sheet_visibility.xlsx%EF%BC%9A">https://rawgit.com/SheetJS/test_files/master/sheet_visibility.xlsx：</a></p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">&gt; wb<span class="selector-class">.Workbook</span><span class="selector-class">.Sheets</span><span class="selector-class">.map</span>(<span class="built_in">function</span>(x) &#123; return <span class="selector-attr">[x.name, x.Hidden]</span> &#125;)</span><br><span class="line"><span class="selector-attr">[ [ <span class="string">&#x27;Visible&#x27;</span>, 0 ]</span>, <span class="selector-attr">[ <span class="string">&#x27;Hidden&#x27;</span>, 1 ]</span>, <span class="selector-attr">[ <span class="string">&#x27;VeryHidden&#x27;</span>, 2 ]</span> ]</span><br></pre></td></tr></table></figure>

<p>非 Excel 格式不支持”Very Hidden”状态。测试一个数据比哦啊是否可见的最好方式是检查是否<code>Hidden</code>属性为逻辑 truth：</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">&gt; wb<span class="selector-class">.Workbook</span><span class="selector-class">.Sheets</span><span class="selector-class">.map</span>(<span class="built_in">function</span>(x) &#123; return <span class="selector-attr">[x.name, !x.Hidden]</span> &#125;)</span><br><span class="line"><span class="selector-attr">[ [ <span class="string">&#x27;Visible&#x27;</span>, true ]</span>, <span class="selector-attr">[ <span class="string">&#x27;Hidden&#x27;</span>, false ]</span>, <span class="selector-attr">[ <span class="string">&#x27;VeryHidden&#x27;</span>, false ]</span> ]</span><br></pre></td></tr></table></figure>

<p>文档上对工作簿隐藏有说明，但是没有具体的隐藏方法，尝试直接修改工作簿的<code>Hidden</code>属性，没有任何效果， 但是皇天不负有心人， 通过查看 <a href="https://github.com/SheetJS/sheetjs/blob/master/xlsx.js">源码</a> 发现了实现工作簿隐藏的方法</p>
<h2 id="XLSX-utils-book-set-sheet-visibility-方法"><a href="#XLSX-utils-book-set-sheet-visibility-方法" class="headerlink" title="XLSX.utils.book_set_sheet_visibility 方法"></a>XLSX.utils.book_set_sheet_visibility 方法</h2><p>下面是源码中方法的定义</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* set sheet visibility (visible/hidden/very hidden) */</span></span><br><span class="line">utils.<span class="property">book_set_sheet_visibility</span> = <span class="keyword">function</span> (<span class="params">wb, sh, vis</span>) &#123;</span><br><span class="line">  <span class="title function_">get_default</span>(wb, <span class="string">&quot;Workbook&quot;</span>, &#123;&#125;);</span><br><span class="line">  <span class="title function_">get_default</span>(wb.<span class="property">Workbook</span>, <span class="string">&quot;Sheets&quot;</span>, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> idx = <span class="title function_">wb_sheet_idx</span>(wb, sh);</span><br><span class="line">  <span class="comment">// $FlowIgnore</span></span><br><span class="line">  <span class="title function_">get_default</span>(wb.<span class="property">Workbook</span>.<span class="property">Sheets</span>, idx, &#123;&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (vis) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Bad sheet visibility setting &quot;</span> + vis);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// $FlowIgnore</span></span><br><span class="line">  wb.<span class="property">Workbook</span>.<span class="property">Sheets</span>[idx].<span class="property">Hidden</span> = vis;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>方法分别传入三个参数：</p>
<ul>
<li>工作表对象，</li>
<li>工作簿在工作簿数组中的下标，</li>
<li>需要设置的<code>Hidden</code>属性的值 （0，1，2）</li>
</ul>
<p>工作表对象生成方法见文档,下面用<code>workbook</code>表示，工作簿在工作簿数组中的下标，可以通过 workbook.SheetNames 找到对应的下标</p>
<h2 id="具体实现："><a href="#具体实现：" class="headerlink" title="具体实现："></a>具体实现：</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 隐藏采购员表   因为整个xlsx的使用是以class实现的这里截取隐藏工作表的方法</span></span><br><span class="line"><span class="title function_">hideBuyerSheet</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">let</span> indexs = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> [i,name] <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">workbook</span>.<span class="property">SheetNames</span>.<span class="title function_">entries</span>()) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="regexp">/采购员/</span>.<span class="title function_">test</span>(name))&#123; <span class="comment">//找到所有带采购员名称的表的下标</span></span><br><span class="line">      indexs.<span class="title function_">push</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">of</span> indexs) &#123;</span><br><span class="line">     <span class="comment">// 将对应下标的工作簿隐藏</span></span><br><span class="line">    <span class="variable constant_">XLSX</span>.<span class="property">utils</span>.<span class="title function_">book_set_sheet_visibility</span>(<span class="variable language_">this</span>.<span class="property">workbook</span>, i, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>js插件</category>
      </categories>
      <tags>
        <tag>js</tag>
        <tag>XLSX</tag>
        <tag>插件</tag>
      </tags>
  </entry>
  <entry>
    <title>关于vue组件样式的作用域问题</title>
    <url>/2019/12/03/Vue/%E5%85%B3%E4%BA%8Evue%E7%BB%84%E4%BB%B6%E6%A0%B7%E5%BC%8F%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%97%AE%E9%A2%98%E5%92%8C%E7%AC%AC%E4%B8%89%E6%96%B9%E7%BB%84%E4%BB%B6%E6%8F%92%E6%A7%BD/</url>
    <content><![CDATA[<blockquote>
<p>参考文档：</p>
<ul>
<li><a href="https://vue-loader.vuejs.org/zh/guide/scoped-css.html">https://vue-loader.vuejs.org/zh/guide/scoped-css.html</a></li>
</ul>
</blockquote>
<h2 id="关于组件的作用域样式"><a href="#关于组件的作用域样式" class="headerlink" title="关于组件的作用域样式"></a>关于组件的作用域样式</h2><p>影响全局：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="comment">/* 全局样式 */</span></span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>作用域样式，只对当前组件内部生效：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.example</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;example&quot;</span>&gt;</span>hi<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>所谓的作用域，其实就是在转换的时候为其添加了一个唯一的属性名原理：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.example</span><span class="selector-attr">[data-v-f3f3eg9]</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;example&quot;</span> <span class="attr">data-v-f3f3eg9</span>&gt;</span>hi<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>你可以在一个组件中同时使用有 scoped 和非 scoped 样式：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="comment">/* 全局样式 */</span></span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="comment">/* 本地样式 */</span></span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="子组件的根元素"><a href="#子组件的根元素" class="headerlink" title="子组件的根元素"></a>子组件的根元素</h2><p>使用 <code>scoped</code> 后，父组件的样式将不会渗透到子组件中。不过一个子组件的根节点会同时受其父组件的 scoped CSS 和子组件的 scoped CSS 的影响。这样设计是为了让父组件可以从布局的角度出发，调整其子组件根元素的样式。</p>
<p>注意：只能是根元素。</p>
<h2 id="如何设置子组件根元素的样式"><a href="#如何设置子组件根元素的样式" class="headerlink" title="如何设置子组件根元素的样式"></a>如何设置子组件根元素的样式</h2><p>方式一：审查元素，观察该组件根节点的 class 类名</p>
<p>方式二：手动给组件添加 class，该类名会自动作用到组件的根元素</p>
<p>以上两种方式也只能作用到子组件的根节点 ，想要作用子组件内部的节点有两种方法</p>
<p>方法一：为当前样式单独包一个 style 标签，去掉 scoped 作用全局即可，但不是很推荐</p>
<p>方法二：使用 vue 提供的深度作用选择器， 强烈推荐！</p>
<h2 id="深度作用选择器"><a href="#深度作用选择器" class="headerlink" title="深度作用选择器"></a>深度作用选择器</h2><p>如果你希望 <code>scoped</code> 样式中的一个选择器能够作用得“更深”，例如影响子组件，你可以使用 <code>&gt;&gt;&gt;</code> 操作符：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.a</span> &gt;&gt;&gt; <span class="selector-class">.b</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* ... */</span></span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上述代码将会编译成：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.a</span><span class="selector-attr">[data-v-f3f3eg9]</span> <span class="selector-class">.b</span> &#123;</span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有些像 Sass 之类的预处理器无法正确解析 <code>&gt;&gt;&gt;</code>。这种情况下你可以使用 <code>/deep/</code> 或 <code>::v-deep</code> 操作符取而代之——两者都是 <code>&gt;&gt;&gt;</code> 的别名，同样可以正常工作。</p>
<p>建议使用 <code>/deep/</code> 或者 <code>::v-deep</code>，因为 <code>&gt;&gt;&gt;</code> 可能在预处理器中报错。</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">&lt;style scoped&gt;</span><br><span class="line"><span class="selector-class">.a</span> /deep/ <span class="selector-class">.b</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>如果想要在父组件中影响子组件样式：</p>
<ul>
<li>要嘛不要有作用域，那就是全局，影响任何组件</li>
<li>有作用域<ul>
<li>默认只能影响根节点<ul>
<li>审查元素找到子组件根节点类名使用</li>
<li>或者手动给子组件添加一个 class，它会自动添加到子组件根节点的 class 中</li>
</ul>
</li>
<li>如果需要影响的更深，则使用深度选择器：<code>&gt;&gt;&gt;</code>、<code>/deep/</code>、<code>::v-deep</code></li>
</ul>
</li>
</ul>
<h2 id="关于如何自定义第三方组件的内容"><a href="#关于如何自定义第三方组件的内容" class="headerlink" title="关于如何自定义第三方组件的内容"></a>关于如何自定义第三方组件的内容</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  一般在使用第三方组件的时候，它们默认给出的是最常用的功能</span></span><br><span class="line"><span class="comment">  如果需要自定义内容展示，那就看文档，看看人家是否支持自定义插槽</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;单元格&quot;</span> <span class="attr">value</span>=<span class="string">&quot;内容&quot;</span> <span class="attr">label</span>=<span class="string">&quot;hello&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">van-cell</span> <span class="attr">title</span>=<span class="string">&quot;单元格&quot;</span> <span class="attr">value</span>=<span class="string">&quot;内容&quot;</span> <span class="attr">label</span>=<span class="string">&quot;hello&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 当你没有给元素插槽起名字的时候，这个组件提供了默认插槽 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>默认内容<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">slot</span>=<span class="string">&quot;default&quot;</span>&gt;</span>默认内容<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 同名插槽可以插入多次 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span>world<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">van-cell</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>内网穿透（为什么需要内网穿透）</title>
    <url>/2021/02/16/%E7%BD%91%E7%BB%9C%E5%BA%94%E7%94%A8/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%EF%BC%88%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%EF%BC%89/</url>
    <content><![CDATA[<blockquote>
<p>想要了解什么是内网穿透 ， 首先要知道为什么需要内网穿透</p>
</blockquote>
<h2 id="为什么需要内网穿透"><a href="#为什么需要内网穿透" class="headerlink" title="为什么需要内网穿透"></a>为什么需要内网穿透</h2><p>首先我们日常上网是通过 ip 地址来进行访问的（域名通过 DNS 解析成 ip）</p>
<p>而 ip 地址分为 内网 ip （路由器分配）和 外网 ip （公网）</p>
<p>我们（普通人）想本地开发一个 web 服务 或者 一个文件共享服务 （内网） ，想其他地方的人（外网）也能来访问这个服务是办不到的</p>
<p>为什么？因为下面这张图</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/20210216193832.png" alt="内网外网图示"></p>
<ul>
<li>小内网内的设备可以通过 IP 地址相互访问 ，但是无法访问大内网中设备的 ip</li>
<li>小内网 和 大内网 都可以访问公网的 ip ，但是公网 ip 无法访问 访问内网 ip</li>
<li>公网 IP 间可以直接相互访问 不过多数人是没有公网 ip 的</li>
</ul>
<h3 id="如何判断自己是否有公网-ip"><a href="#如何判断自己是否有公网-ip" class="headerlink" title="如何判断自己是否有公网 ip"></a>如何判断自己是否有公网 ip</h3><p>通过 百度 搜索 IP 和 登入路由管理界面查看的 IP 如果一致 就是公网 IP , 如果不一致 那路由管理界面显示的 IP 就是大内网 或 小内网 IP</p>
<p>如果 我们只有内网 ip 但是想要外网可以访问怎么办 ？ 这时就需要用到内网穿透技术</p>
<h2 id="内网穿透工具"><a href="#内网穿透工具" class="headerlink" title="内网穿透工具"></a>内网穿透工具</h2><p>这里先介绍一个简单的工具</p>
<h3 id="ngrok"><a href="#ngrok" class="headerlink" title="ngrok"></a>ngrok</h3><p>tip:需要管理员权限打开命令行工具</p>
<p>1.首先到 ngrok 官网<a href="https://ngrok.com/download">下载</a>相应软件</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20220531114107408.png" alt="image-20220531114107408"></p>
<p>2.注册并登录</p>
<p><a href="https://dashboard.ngrok.com/signup">注册</a></p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20220531114142796.png" alt="image-20220531114142796"></p>
<p>3.添加authtoken</p>
<p>登录后按照提示获取到 authtoken</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ngrok config add-authtoken 1t9eD80uIGZ1sewAY8NZYaI4PFJ_7QBsY7YpSeG8hRaerveDd</span><br></pre></td></tr></table></figure>

<p>3.设置需要代理到公网的端口</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ngrok http 80</span><br></pre></td></tr></table></figure>



<p>注意：这里的 80 得根据实际你 tomcat 的端口改写，假设你的 tomcat 端口用的是 81 端口，这里就要改成 81 ！！！</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/20210216195455.png" alt="img"></p>
<p>4.接着我们就可以用 <a href="https://d2988052.ngrok.io/">https://d2988052.ngrok.io</a>+项目名 来访问我们的网站啦!</p>
<h3 id="所有工具的集合"><a href="#所有工具的集合" class="headerlink" title="所有工具的集合"></a>所有工具的集合</h3><p><a href="https://www.cnblogs.com/xiaozi/p/13589138.html">https://www.cnblogs.com/xiaozi/p/13589138.html</a></p>
<h2 id="使用云服务-FRP-实现内网穿透"><a href="#使用云服务-FRP-实现内网穿透" class="headerlink" title="使用云服务 + FRP 实现内网穿透"></a>使用云服务 + FRP 实现内网穿透</h2><p>全教程视频 ：<a href="https://www.bilibili.com/video/BV1J74117714">https://www.bilibili.com/video/BV1J74117714</a></p>
]]></content>
      <categories>
        <category>网络应用</category>
      </categories>
      <tags>
        <tag>网络应用</tag>
      </tags>
  </entry>
  <entry>
    <title>利用博客园的MetaWeblog协议+nodejs同步hexo中md文件</title>
    <url>/2021/10/11/Hexo/%E5%88%A9%E7%94%A8%E5%8D%9A%E5%AE%A2%E5%9B%AD%E7%9A%84MetaWeblog%E5%8D%8F%E8%AE%AE%E5%90%8C%E6%AD%A5hexo%E4%B8%ADmd%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="博客园的-MetaWeblog-协议的使用"><a href="#博客园的-MetaWeblog-协议的使用" class="headerlink" title="博客园的 MetaWeblog 协议的使用"></a>博客园的 MetaWeblog 协议的使用</h2><p>资料地址：<a href="https://www.cnblogs.com/caipeiyu/p/5354341.html%E8%83%8C%E6%99%AF">https://www.cnblogs.com/caipeiyu/p/5354341.html背景</a></p>
<p>想实现自己的文章一处编写，多处发布到各大平台（比如博客园，CSDN）等要怎么实现呢。需要由这些组成：</p>
<ol>
<li>文章管理：一个管理文章知识的平台（网站），在这里撰写，编辑文章。比如：写博客的客户端软件，博客园等。</li>
<li>第三方网站(平台）具有开放的 API 接口，比如博客园的 metaWebBlog。</li>
<li>同步服务：读取文章，调开放的 API，将文章发布出去。</li>
</ol>
<p>一般来说，写文章的软件很容易获得，如果目标平台再有开放接口，我们可以将文章通过接口进行发布。</p>
<p><strong>博客园支持 metaWebBlog 接口，使得可以接收来自 接口 的文章</strong></p>
<h3 id="1-metaWebBlog-概述"><a href="#1-metaWebBlog-概述" class="headerlink" title="1. metaWebBlog 概述"></a>1. metaWebBlog 概述</h3><blockquote>
<p>MetaWeblog API（MWA）是一个 Blog 程序接口标准。通过 MetaWeblog API，博客平台可以对外公布 blog 提供的服务，从而允许外面的程序新建，编辑，删除，发布 bolg。</p>
</blockquote>
<p>MetaWeblog 使用 xml-RPC 作为通讯协议。</p>
<blockquote>
<p>XML-RPC 是一个远程过程调用（远端程序呼叫）（remote procedure call，RPC)的分布式计算协议，通过 XML 将调用函数封装，并使用 HTTP 协议作为传送机制。一个 XML-RPC 消息就是一个请求体为 xml 的 http-post 请求，被调用的方法在服务器端执行并将执行结果以 xml 格式编码后返回。</p>
</blockquote>
<p>简单理解就是：在 HTTP 请求 中，发送 xml 格式描述的“调用指令”，如果调用成功，会收到 xml 格式描述的“执行结果”。</p>
<h3 id="2-博客园文章相关接口："><a href="#2-博客园文章相关接口：" class="headerlink" title="2. 博客园文章相关接口："></a>2. 博客园文章相关接口：</h3><ul>
<li>blogger.getUsersBlogs —— 获取用户博客信息</li>
<li>metaWeblog.getRecentPosts —— 获取最近的文章</li>
<li>metaWeblog.getPost —— 获取文章内容</li>
<li>metaWeblog.newPost —— 添加文章</li>
<li>metaWeblog.editPost —— 编辑文章</li>
<li>blogger.deletePost —— 删除文章</li>
</ul>
<p>还有一些关于 文章分类 的接口，可以在其接口文档中找到。</p>
<h3 id="2-1-接口说明"><a href="#2-1-接口说明" class="headerlink" title="2.1 接口说明"></a>2.1 接口说明</h3><p>在 博客园 设置页面的地步可以找到 API 接口的说明，类似这样：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">https</span>:<span class="comment">//rpc.cnblogs.com/metaweblog/&#123;userName&#125;</span></span><br></pre></td></tr></table></figure>

<p>上面的 {userName} 替换成实际的用户名。</p>
<p>下文仅说明“请求的接口和参数”，响应内容在发送成功后一看便知。</p>
<h3 id="2-2-发送方式"><a href="#2-2-发送方式" class="headerlink" title="2.2 发送方式"></a>2.2 发送方式</h3><ul>
<li>HTTP 请求</li>
<li>POST 方式到： <a href="https://links.jianshu.com/go?to=https://rpc.cnblogs.com/metaweblog/">https://rpc.cnblogs.com/metaweblog/</a>{userName}</li>
<li>请求中的内容是 HTML 格式，描述了调用参数</li>
</ul>
<h3 id="2-3-接口协议"><a href="#2-3-接口协议" class="headerlink" title="2.3 接口协议"></a>2.3 接口协议</h3><h4 id="2-3-1-获取用户博客信息"><a href="#2-3-1-获取用户博客信息" class="headerlink" title="2.3.1 获取用户博客信息"></a>2.3.1 获取用户博客信息</h4><ul>
<li>功能：获取用户博客信息</li>
<li>方法名: blogger.getUsersBlogs</li>
<li>参数：见下文代码</li>
</ul>
<p>示例：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">methodCall</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">methodName</span>&gt;</span>blogger.getUsersBlogs<span class="tag">&lt;/<span class="name">methodName</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">params</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>&#123;userName&#125;<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>&#123;password&#125;<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">params</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">methodCall</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h4 id="2-3-2-获取最近的文章"><a href="#2-3-2-获取最近的文章" class="headerlink" title="2.3.2 获取最近的文章"></a>2.3.2 获取最近的文章</h4><ul>
<li>功能：获取最近的文章</li>
<li>方法名: metaWeblog.getRecentPosts</li>
<li>参数：见下文代码</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">methodCall</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">methodName</span>&gt;</span>metaWeblog.getRecentPosts<span class="tag">&lt;/<span class="name">methodName</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">params</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>000000<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>&#123;userName&#125;<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>&#123;password&#125;<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">i4</span>&gt;</span>1<span class="tag">&lt;/<span class="name">i4</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">params</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">methodCall</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h4 id="2-3-3-获取文章内容"><a href="#2-3-3-获取文章内容" class="headerlink" title="2.3.3 获取文章内容"></a>2.3.3 获取文章内容</h4><ul>
<li>功能：获取文章内容</li>
<li>方法名: metaWeblog.getPost</li>
<li>参数：见下文代码</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">methodCall</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">methodName</span>&gt;</span>metaWeblog.getPost<span class="tag">&lt;/<span class="name">methodName</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">params</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>&#123;postid&#125;<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>&#123;userName&#125;<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>&#123;password&#125;<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">params</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">methodCall</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h4 id="2-3-4-添加文章"><a href="#2-3-4-添加文章" class="headerlink" title="2.3.4 添加文章"></a>2.3.4 添加文章</h4><ul>
<li>功能：添加文章</li>
<li>方法名: metaWeblog.newPost</li>
<li>参数：见下文代码</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">methodCall</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">methodName</span>&gt;</span>metaWeblog.newPost<span class="tag">&lt;/<span class="name">methodName</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">params</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>&#123;userName&#125;<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>&#123;password&#125;<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">         <span class="tag">&lt;<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">struct</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">member</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">name</span>&gt;</span>description<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">string</span>&gt;</span>博客测试内容<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">member</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">member</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">name</span>&gt;</span>title<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">string</span>&gt;</span>标题测试内容<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">member</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">member</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">name</span>&gt;</span>categories<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">array</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                <span class="tag">&lt;<span class="name">data</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                    <span class="tag">&lt;<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                        <span class="tag">&lt;<span class="name">string</span>&gt;</span>[Markdown]<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                    <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">member</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">struct</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">boolean</span>&gt;</span>0<span class="tag">&lt;/<span class="name">boolean</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">params</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">methodCall</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h4 id="2-3-5-编辑文章"><a href="#2-3-5-编辑文章" class="headerlink" title="2.3.5 编辑文章"></a>2.3.5 编辑文章</h4><ul>
<li>功能：编辑文章</li>
<li>方法名: metaWeblog.editPost</li>
<li>参数：见下文代码</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">methodCall</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">methodName</span>&gt;</span>metaWeblog.editPost<span class="tag">&lt;/<span class="name">methodName</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">params</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>&#123;postid&#125;<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>&#123;userName&#125;<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>&#123;password&#125;<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">         <span class="tag">&lt;<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">struct</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">member</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">name</span>&gt;</span>description<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">string</span>&gt;</span>博客测试内容222<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">member</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">member</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">name</span>&gt;</span>title<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">string</span>&gt;</span>标题测试内容222<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">member</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">member</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">name</span>&gt;</span>categories<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">array</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                <span class="tag">&lt;<span class="name">data</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                    <span class="tag">&lt;<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                        <span class="tag">&lt;<span class="name">string</span>&gt;</span>[Markdown]<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                    <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">member</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">struct</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">boolean</span>&gt;</span>0<span class="tag">&lt;/<span class="name">boolean</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">params</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">methodCall</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h4 id="2-3-6-删除文章"><a href="#2-3-6-删除文章" class="headerlink" title="2.3.6 删除文章"></a>2.3.6 删除文章</h4><ul>
<li>功能：删除文章</li>
<li>方法名: blogger.deletePost</li>
<li>参数：见下文代码</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">methodCall</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">methodName</span>&gt;</span>blogger.deletePost<span class="tag">&lt;/<span class="name">methodName</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">params</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>&#123;postid&#125;<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>&#123;userName&#125;<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>&#123;password&#125;<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;<span class="name">boolean</span>&gt;</span>0<span class="tag">&lt;/<span class="name">boolean</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">param</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">params</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">methodCall</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="使用-nodejs-完成文件读写和接口调用"><a href="#使用-nodejs-完成文件读写和接口调用" class="headerlink" title="使用 nodejs 完成文件读写和接口调用"></a>使用 nodejs 完成文件读写和接口调用</h2><h3 id="index-js"><a href="#index-js" class="headerlink" title="index.js"></a>index.js</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Description: 批量将hexo中的md文件上传博客园</span></span><br><span class="line"><span class="comment"> * @Autor: Bowen</span></span><br><span class="line"><span class="comment"> * @Date: 2021-10-09 16:56:43</span></span><br><span class="line"><span class="comment"> * @LastEditors: Bowen</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2021-10-11 15:05:03</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>).<span class="property">promises</span>;</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">YAML</span> = <span class="built_in">require</span>(<span class="string">&quot;yaml&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&quot;crypto&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; pushPost, getPost &#125; = <span class="built_in">require</span>(<span class="string">&quot;./api&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dirPath = <span class="string">&quot;C:xxx/source/_posts&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发布所有的文章</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">hanleAllPushPost</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> files = <span class="keyword">await</span> fs.<span class="title function_">readdir</span>(dirPath);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> fileName <span class="keyword">of</span> files) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="regexp">/\.md/</span>.<span class="title function_">test</span>(fileName)) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[********************************]&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[fileName]&quot;</span>, fileName);</span><br><span class="line">    <span class="keyword">const</span> filePath = path.<span class="title function_">resolve</span>(dirPath, fileName);</span><br><span class="line">    <span class="comment">// await new Promise((r) =&gt; setTimeout(r, 1000), true);</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">handlePushPost</span>(filePath);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 将文章原始字符分解为obj数据</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">genArticleDate</span>(<span class="params">articleOrigin</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> datas = articleOrigin.<span class="title function_">split</span>(<span class="string">&quot;---&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> temp = datas[<span class="number">1</span>].<span class="title function_">replace</span>(<span class="regexp">/\t/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> titleObj = <span class="variable constant_">YAML</span>.<span class="title function_">parse</span>(temp);</span><br><span class="line">  <span class="comment">// datas.length &gt; 3 为边际情况特殊处理一下</span></span><br><span class="line">  <span class="keyword">const</span> contentData = datas.<span class="property">length</span> &gt; <span class="number">3</span> ? datas.<span class="title function_">slice</span>(<span class="number">2</span>).<span class="title function_">join</span>(<span class="string">&quot;---&quot;</span>) : datas[<span class="number">2</span>];</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    titleObj,</span><br><span class="line">    contentData,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 将obj数据合成文章</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">genArticleStr</span>(<span class="params">&#123; titleObj, contentData &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> titleStr = <span class="string">&quot;\n&quot;</span> + <span class="variable constant_">YAML</span>.<span class="title function_">stringify</span>(titleObj);</span><br><span class="line">  <span class="keyword">const</span> datas = [<span class="string">&quot;&quot;</span>, titleStr, contentData];</span><br><span class="line">  <span class="keyword">const</span> str = datas.<span class="title function_">join</span>(<span class="string">&quot;---&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 根据path修改或者新建文章</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">handlePushPost</span>(<span class="params">filePath</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> fileName = path.<span class="title function_">basename</span>(filePath);</span><br><span class="line">  <span class="keyword">const</span> articleOrigin = <span class="keyword">await</span> fs.<span class="title function_">readFile</span>(filePath, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> &#123; titleObj, contentData &#125; = <span class="title function_">genArticleDate</span>(articleOrigin);</span><br><span class="line">  <span class="keyword">const</span> hash = crypto.<span class="title function_">createHash</span>(<span class="string">&quot;sha256&quot;</span>);</span><br><span class="line">  hash.<span class="title function_">update</span>(contentData);</span><br><span class="line">  <span class="comment">// 当前hash</span></span><br><span class="line">  <span class="keyword">let</span> nowContentHash = hash.<span class="title function_">digest</span>(<span class="string">&quot;hex&quot;</span>);</span><br><span class="line">  <span class="keyword">let</span> &#123; cnblogs, <span class="attr">hash</span>: contentHash &#125; = titleObj;</span><br><span class="line">  <span class="keyword">let</span> res;</span><br><span class="line">  <span class="keyword">if</span> (contentHash &amp;&amp; contentHash == nowContentHash) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[hash值未变退出当前循环]&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// yaml中添加 hash</span></span><br><span class="line">  titleObj.<span class="property">hash</span> = nowContentHash;</span><br><span class="line">  <span class="comment">// 编辑</span></span><br><span class="line">  <span class="keyword">if</span> (cnblogs &amp;&amp; cnblogs.<span class="property">postid</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[-------------修改-------------]&quot;</span>);</span><br><span class="line">    res = <span class="keyword">await</span> <span class="title function_">pushPost</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&quot;edit&quot;</span>,</span><br><span class="line">      <span class="attr">content</span>: contentData,</span><br><span class="line">      <span class="attr">title</span>: titleObj.<span class="property">title</span>,</span><br><span class="line">      <span class="attr">postid</span>: cnblogs.<span class="property">postid</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (res.<span class="property">methodResponse</span>.<span class="property">fault</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">        <span class="string">&quot;[修改失败]&quot;</span>,</span><br><span class="line">        res.<span class="property">methodResponse</span>.<span class="property">fault</span>.<span class="property">value</span>.<span class="property">struct</span>.<span class="property">member</span>[<span class="number">1</span>].<span class="property">value</span>.<span class="property">string</span></span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">throw</span> <span class="title class_">Error</span>(res.<span class="property">methodResponse</span>.<span class="property">fault</span>.<span class="property">value</span>.<span class="property">struct</span>.<span class="property">member</span>[<span class="number">1</span>].<span class="property">value</span>.<span class="property">string</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[修改成功]&quot;</span>, res.<span class="property">methodResponse</span>.<span class="property">params</span>.<span class="property">param</span>.<span class="property">value</span>.<span class="property">boolean</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[-------------新建-------------]&quot;</span>);</span><br><span class="line">    titleObj.<span class="property">cnblogs</span> = &#123;&#125;;</span><br><span class="line">    res = <span class="keyword">await</span> <span class="title function_">pushPost</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&quot;add&quot;</span>,</span><br><span class="line">      <span class="attr">content</span>: contentData,</span><br><span class="line">      <span class="attr">title</span>: titleObj.<span class="property">title</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    res;</span><br><span class="line">    <span class="keyword">if</span> (res.<span class="property">methodResponse</span>.<span class="property">fault</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">        <span class="string">&quot;[上传失败]&quot;</span>,</span><br><span class="line">        res.<span class="property">methodResponse</span>.<span class="property">fault</span>.<span class="property">value</span>.<span class="property">struct</span>.<span class="property">member</span>[<span class="number">1</span>].<span class="property">value</span>.<span class="property">string</span></span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">throw</span> <span class="title class_">Error</span>(res.<span class="property">methodResponse</span>.<span class="property">fault</span>.<span class="property">value</span>.<span class="property">struct</span>.<span class="property">member</span>[<span class="number">1</span>].<span class="property">value</span>.<span class="property">string</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[上传成功]&quot;</span>, res.<span class="property">methodResponse</span>.<span class="property">params</span>.<span class="property">param</span>.<span class="property">value</span>.<span class="property">string</span>);</span><br><span class="line">    <span class="comment">// yaml中添加 postid</span></span><br><span class="line">    titleObj.<span class="property">cnblogs</span>.<span class="property">postid</span> = res.<span class="property">methodResponse</span>.<span class="property">params</span>.<span class="property">param</span>.<span class="property">value</span>.<span class="property">string</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 回写数据</span></span><br><span class="line">  <span class="keyword">const</span> str = <span class="title function_">genArticleStr</span>(&#123; titleObj, contentData &#125;);</span><br><span class="line">  <span class="keyword">await</span> fs.<span class="title function_">writeFile</span>(filePath, str);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[回写成功]&quot;</span>, fileName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// test</span></span><br><span class="line"><span class="comment">// handlePushPost(&quot;C:xxx/source/_posts/js中的微观任务和宏观任务.md&quot;);</span></span><br><span class="line"><span class="title function_">hanleAllPushPost</span>();</span><br></pre></td></tr></table></figure>

<h3 id="api-js"><a href="#api-js" class="headerlink" title="api.js"></a>api.js</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Description: 博客园 api 封装 ，common 中填写 用户名和密码</span></span><br><span class="line"><span class="comment"> * @Autor: Bowen</span></span><br><span class="line"><span class="comment"> * @Date: 2021-10-09 16:07:25</span></span><br><span class="line"><span class="comment"> * @LastEditors: Bowen</span></span><br><span class="line"><span class="comment"> * @LastEditTime: 2021-10-11 15:09:36</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 解析 xml</span></span><br><span class="line"><span class="keyword">const</span> parser = <span class="built_in">require</span>(<span class="string">&quot;xml2json&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&quot;axios&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> _axios = axios.<span class="title function_">create</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> common = <span class="string">`&lt;param&gt;</span></span><br><span class="line"><span class="string">    &lt;value&gt;&lt;string&gt;&#123;userName&#125;&lt;/string&gt;&lt;/value&gt;</span></span><br><span class="line"><span class="string">&lt;/param&gt;</span></span><br><span class="line"><span class="string">&lt;param&gt;</span></span><br><span class="line"><span class="string">    &lt;value&gt;&lt;string&gt;&#123;password&#125;&lt;/string&gt;&lt;/value&gt;</span></span><br><span class="line"><span class="string">&lt;/param&gt;`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加响应拦截器</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 对响应数据做点什么</span></span><br><span class="line">    <span class="keyword">const</span> json = parser.<span class="title function_">toJson</span>(response.<span class="property">data</span>);</span><br><span class="line">    <span class="keyword">const</span> data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(json);</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 对响应错误做点什么</span></span><br><span class="line">    <span class="keyword">let</span> msg =</span><br><span class="line">      error.<span class="property">response</span> &amp;&amp; error.<span class="property">response</span>.<span class="property">data</span>.<span class="property">message</span></span><br><span class="line">        ? error.<span class="property">response</span>.<span class="property">data</span>.<span class="property">message</span></span><br><span class="line">        : error;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(</span><br><span class="line">      error.<span class="property">response</span> ? <span class="string">`<span class="subst">$&#123;error.response.status&#125;</span> : <span class="subst">$&#123;msg&#125;</span>`</span> : <span class="string">`网络不可用`</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"><span class="comment">// 发布或修改文章</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">pushPost</span>(<span class="params">&#123; type = <span class="string">&quot;add&quot;</span>, content, title, postid &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> axios.<span class="title function_">post</span>(</span><br><span class="line">    <span class="string">&quot;https://rpc.cnblogs.com/metaweblog/bitbw&quot;</span>,</span><br><span class="line">    <span class="string">`&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="string">    &lt;methodCall&gt;</span></span><br><span class="line"><span class="string">    &lt;methodName&gt;metaWeblog.<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">      type === <span class="string">&quot;add&quot;</span> ? <span class="string">&quot;newPost&quot;</span> : <span class="string">&quot;editPost&quot;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">    &#125;</span>&lt;/methodName&gt;</span></span><br><span class="line"><span class="string">    &lt;params&gt;</span></span><br><span class="line"><span class="string">    &lt;param&gt;</span></span><br><span class="line"><span class="string">        &lt;value&gt;&lt;string&gt;<span class="subst">$&#123;type === <span class="string">&quot;add&quot;</span> ? <span class="string">&quot;623687&quot;</span> : postid&#125;</span>&lt;/string&gt;&lt;/value&gt;</span></span><br><span class="line"><span class="string">    &lt;/param&gt;</span></span><br><span class="line"><span class="string">    <span class="subst">$&#123;common&#125;</span></span></span><br><span class="line"><span class="string">        &lt;param&gt;</span></span><br><span class="line"><span class="string">            &lt;value&gt;</span></span><br><span class="line"><span class="string">                    &lt;struct&gt;</span></span><br><span class="line"><span class="string">                        &lt;member&gt;</span></span><br><span class="line"><span class="string">                            &lt;name&gt;description&lt;/name&gt;</span></span><br><span class="line"><span class="string">                            &lt;value&gt;</span></span><br><span class="line"><span class="string">                                &lt;string&gt;<span class="subst">$&#123;XMLEscape(content)&#125;</span>&lt;/string&gt;</span></span><br><span class="line"><span class="string">                            &lt;/value&gt;</span></span><br><span class="line"><span class="string">                        &lt;/member&gt;</span></span><br><span class="line"><span class="string">                        &lt;member&gt;</span></span><br><span class="line"><span class="string">                            &lt;name&gt;title&lt;/name&gt;</span></span><br><span class="line"><span class="string">                            &lt;value&gt;</span></span><br><span class="line"><span class="string">                                &lt;string&gt;<span class="subst">$&#123;XMLEscape(title)&#125;</span>&lt;/string&gt;</span></span><br><span class="line"><span class="string">                            &lt;/value&gt;</span></span><br><span class="line"><span class="string">                        &lt;/member&gt;</span></span><br><span class="line"><span class="string">                        &lt;member&gt;</span></span><br><span class="line"><span class="string">                            &lt;name&gt;categories&lt;/name&gt;</span></span><br><span class="line"><span class="string">                            &lt;value&gt;</span></span><br><span class="line"><span class="string">                                &lt;array&gt;</span></span><br><span class="line"><span class="string">                                    &lt;data&gt;</span></span><br><span class="line"><span class="string">                                        &lt;value&gt;</span></span><br><span class="line"><span class="string">                                            &lt;string&gt;[Markdown]&lt;/string&gt;</span></span><br><span class="line"><span class="string">                                        &lt;/value&gt;</span></span><br><span class="line"><span class="string">                                    &lt;/data&gt;</span></span><br><span class="line"><span class="string">                                &lt;/array&gt;</span></span><br><span class="line"><span class="string">                            &lt;/value&gt;</span></span><br><span class="line"><span class="string">                        &lt;/member&gt;</span></span><br><span class="line"><span class="string">                    &lt;/struct&gt;</span></span><br><span class="line"><span class="string">                &lt;/value&gt;</span></span><br><span class="line"><span class="string">        &lt;/param&gt;</span></span><br><span class="line"><span class="string">        &lt;param&gt;</span></span><br><span class="line"><span class="string">            &lt;value&gt;&lt;boolean&gt;1&lt;/boolean&gt;&lt;/value&gt;</span></span><br><span class="line"><span class="string">        &lt;/param&gt;</span></span><br><span class="line"><span class="string">    &lt;/params&gt;</span></span><br><span class="line"><span class="string">    &lt;/methodCall&gt;`</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 获取文章数据</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getPost</span>(<span class="params">&#123; postid &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> axios.<span class="title function_">post</span>(</span><br><span class="line">    <span class="string">&quot;https://rpc.cnblogs.com/metaweblog/bitbw&quot;</span>,</span><br><span class="line">    <span class="string">`&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="string">&lt;methodCall&gt;</span></span><br><span class="line"><span class="string"> &lt;methodName&gt;metaWeblog.getPost&lt;/methodName&gt;</span></span><br><span class="line"><span class="string">  &lt;params&gt;</span></span><br><span class="line"><span class="string">    &lt;param&gt;</span></span><br><span class="line"><span class="string">        &lt;value&gt;&lt;string&gt;<span class="subst">$&#123;postid&#125;</span>&lt;/string&gt;&lt;/value&gt;</span></span><br><span class="line"><span class="string">    &lt;/param&gt;</span></span><br><span class="line"><span class="string">   <span class="subst">$&#123;common&#125;</span></span></span><br><span class="line"><span class="string">  &lt;/params&gt;</span></span><br><span class="line"><span class="string">&lt;/methodCall&gt;`</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">XMLEscape</span>(<span class="params">content</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> newContent = content;</span><br><span class="line">  newContent = newContent.<span class="title function_">replace</span>(<span class="regexp">/&amp;/g</span>, <span class="string">&quot;&amp;amp;&quot;</span>);</span><br><span class="line">  newContent = newContent.<span class="title function_">replace</span>(<span class="regexp">/&lt;/g</span>, <span class="string">&quot;&amp;lt;&quot;</span>);</span><br><span class="line">  newContent = newContent.<span class="title function_">replace</span>(<span class="regexp">/&gt;/g</span>, <span class="string">&quot;&amp;gt;&quot;</span>);</span><br><span class="line">  newContent = newContent.<span class="title function_">replace</span>(<span class="regexp">/&quot;/g</span>, <span class="string">&quot;&amp;quot;&quot;</span>);</span><br><span class="line">  newContent = newContent.<span class="title function_">replace</span>(<span class="regexp">/&#x27;/g</span>, <span class="string">&quot;&amp;apos;&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> newContent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  pushPost,</span><br><span class="line">  getPost,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Nodejs</tag>
        <tag>hexo</tag>
        <tag>博客园</tag>
      </tags>
  </entry>
  <entry>
    <title>力扣刷题两数之和</title>
    <url>/2019/07/21/%E7%AE%97%E6%B3%95/%E5%8A%9B%E6%89%A3%E5%88%B7%E9%A2%98%E4%B8%A4%E6%95%B0%E4%B9%8B%E5%92%8C/</url>
    <content><![CDATA[<h1 id="两数之和"><a href="#两数之和" class="headerlink" title="两数之和"></a>两数之和</h1><p>题目描述：<br>给定一个整数数组 nums 和一个目标值 target，请你在该数组中找出和为目标值的那两个整数，并返回他们的数组下标。<br>你可以假设每种输入只会对应一个答案。但是，你不能重复利用这个数组中同样的元素。</p>
<p>示例：<br>给定 nums &#x3D; [2, 7, 11, 15], target &#x3D; 9<br>因为 nums[0] + nums[1] &#x3D; 2 + 7 &#x3D; 9<br>所以返回 [0, 1]</p>
<p>目前是看到的最优解决方案：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> twoSum = <span class="keyword">function</span> (<span class="params">nums, target</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> hashMap = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> [i, num] <span class="keyword">of</span> nums.<span class="title function_">entries</span>()) &#123;</span><br><span class="line">    <span class="keyword">let</span> temp = target - num;</span><br><span class="line">    <span class="keyword">if</span> (hashMap.<span class="title function_">has</span>(temp)) &#123;</span><br><span class="line">      <span class="keyword">return</span> [hashMap.<span class="title function_">get</span>(temp), i];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      hashMap.<span class="title function_">set</span>(num, i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> [-<span class="number">1</span>, -<span class="number">1</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>算法</category>
      </categories>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>基于service-worker实现部署后提示用户刷新</title>
    <url>/2022/04/28/js/%E5%9F%BA%E4%BA%8Eservice-worker%E5%AE%9E%E7%8E%B0%E9%83%A8%E7%BD%B2%E5%90%8E%E6%8F%90%E7%A4%BA%E7%94%A8%E6%88%B7%E5%88%B7%E6%96%B0/</url>
    <content><![CDATA[<h2 id="Vue项目部署新版本后提示用户刷新浏览器"><a href="#Vue项目部署新版本后提示用户刷新浏览器" class="headerlink" title="Vue项目部署新版本后提示用户刷新浏览器"></a>Vue项目部署新版本后提示用户刷新浏览器</h2><h3 id="vue-cli-创建带pwd的项目"><a href="#vue-cli-创建带pwd的项目" class="headerlink" title="vue-cli 创建带pwd的项目"></a>vue-cli 创建带pwd的项目</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vue create pwa-product</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择 pwd</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="修改-src-x2F-registerServiceWorker-js"><a href="#修改-src-x2F-registerServiceWorker-js" class="headerlink" title="修改 src&#x2F;registerServiceWorker.js"></a>修改 src&#x2F;registerServiceWorker.js</h3><p><a href="https://github.com/yyx990803/register-service-worker#readme">registerServiceWorker</a></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* eslint-disable no-console */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; register &#125; <span class="keyword">from</span> <span class="string">&quot;register-service-worker&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;production&quot;</span> &amp;&amp; navigator.<span class="property">serviceWorker</span>) &#123;</span><br><span class="line">  <span class="title function_">register</span>(<span class="string">`<span class="subst">$&#123;process.env.BASE_URL&#125;</span>service-worker.js`</span>, &#123;</span><br><span class="line">    <span class="title function_">ready</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">        <span class="string">&quot;App is being served from cache by a service worker.\n&quot;</span> +</span><br><span class="line">          <span class="string">&quot;For more details, visit https://goo.gl/AFskqB&quot;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="title function_">registered</span>(<span class="params">registration</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Service worker has been registered.&quot;</span>);</span><br><span class="line">      <span class="comment">// 通过测试新的服务工作线程来定期检查应用更新</span></span><br><span class="line">      <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        registration.<span class="title function_">update</span>();</span><br><span class="line">      &#125;, <span class="number">1000</span>); <span class="comment">// 这里为了测试 每秒检查一次</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">cached</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Content has been cached for offline use.&quot;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">updatefound</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;New content is downloading.&quot;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 有个更新 通知页面更新</span></span><br><span class="line">    <span class="title function_">updated</span>(<span class="params">registration</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;New content is available; please refresh.&quot;</span>);</span><br><span class="line">        <span class="comment">//  创建一个自定义事件</span></span><br><span class="line">      <span class="keyword">const</span> event = <span class="keyword">new</span> <span class="title class_">CustomEvent</span>(<span class="string">&quot;swupdatefound&quot;</span>, &#123; <span class="attr">detail</span>: registration &#125;);</span><br><span class="line">        <span class="comment">// 触发这个事件</span></span><br><span class="line">      <span class="variable language_">document</span>.<span class="title function_">dispatchEvent</span>(event);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">offline</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">        <span class="string">&quot;No internet connection found. App is running in offline mode.&quot;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">error</span>(<span class="params">error</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Error during service worker registration:&quot;</span>, error);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> refreshing;</span><br><span class="line">    <span class="comment">// 监听需要更新事件  调用 window.location.reload()</span></span><br><span class="line">  navigator.<span class="property">serviceWorker</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;controllerchange&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (refreshing) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">reload</span>();</span><br><span class="line"></span><br><span class="line">    refreshing = <span class="literal">true</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="在页面中添加事件监听"><a href="#在页面中添加事件监听" class="headerlink" title="在页面中添加事件监听"></a>在页面中添加事件监听</h3><p>在 main.js 或 store 中添加事件监听</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 添加对应自定义事件的监听</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;swupdatefound&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 提示用户刷新</span></span><br><span class="line">  <span class="keyword">let</span> res = <span class="title function_">confirm</span>(<span class="string">&quot;新内容可用,请刷新&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (res) &#123;</span><br><span class="line">    <span class="comment">// e.detail == registration</span></span><br><span class="line">    <span class="comment">// waiting.postMessage(&#123; type: &quot;SKIP_WAITING&quot; &#125;) 是固定写法 </span></span><br><span class="line">    <span class="comment">// 用于触发更新  navigator.serviceWorker.addEventListener(&quot;controllerchange&quot;...)</span></span><br><span class="line">    e.<span class="property">detail</span>.<span class="property">waiting</span>.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&quot;SKIP_WAITING&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>为什么 waiting.postMessage({ type: “SKIP_WAITING” }) 会触发更新</p>
<p>在打包下的 dist 目录下service-worker.js 看到一下代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// self 是 worker 子线程的标准</span></span><br><span class="line"><span class="comment">//  waiting.postMessage(&#123; type: &quot;SKIP_WAITING&quot; &#125;) 会触发下面事件监听</span></span><br><span class="line">self.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (event.<span class="property">data</span> &amp;&amp; event.<span class="property">data</span>.<span class="property">type</span> === <span class="string">&#x27;SKIP_WAITING&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">//   调用 触发 controllerchange</span></span><br><span class="line">    self.<span class="title function_">skipWaiting</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>service-worker</tag>
      </tags>
  </entry>
  <entry>
    <title>字符编码笔记：ASCII，Unicode 和 UTF-8</title>
    <url>/2020/12/07/%E8%AE%A1%E7%AE%97%E6%9C%BA%E9%80%9A%E7%94%A8%E7%9F%A5%E8%AF%86/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%AC%94%E8%AE%B0%EF%BC%9AASCII%EF%BC%8CUnicode%20%E5%92%8C%20UTF-8/</url>
    <content><![CDATA[<p>这里引用阮一峰的两篇文章：</p>
<p><a href="http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html">http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html</a></p>
<p><a href="http://www.ruanyifeng.com/blog/2014/12/unicode.html">http://www.ruanyifeng.com/blog/2014/12/unicode.html</a></p>
<h2 id="一、ASCII-码"><a href="#一、ASCII-码" class="headerlink" title="一、ASCII 码"></a><strong>一、ASCII 码</strong></h2><p>我们知道，计算机内部，所有信息最终都是一个二进制值。每一个二进制位（bit）有<code>0</code>和<code>1</code>两种状态，因此八个二进制位就可以组合出 256 种状态，这被称为一个字节（byte）。也就是说，一个字节一共可以用来表示 256 种不同的状态，每一个状态对应一个符号，就是 256 个符号，从<code>00000000</code>到<code>11111111</code>。</p>
<p>上个世纪 60 年代，美国制定了一套字符编码，对英语字符与二进制位之间的关系，做了统一规定。这被称为 ASCII 码，一直沿用至今。</p>
<p>ASCII 码一共规定了 128 个字符的编码，比如空格<code>SPACE</code>是 32（二进制<code>00100000</code>），大写的字母<code>A</code>是 65（二进制<code>01000001</code>）。这 128 个符号（包括 32 个不能打印出来的控制符号），只占用了一个字节的后面 7 位，最前面的一位统一规定为<code>0</code>。</p>
<h2 id="二、非-ASCII-编码"><a href="#二、非-ASCII-编码" class="headerlink" title="二、非 ASCII 编码"></a><strong>二、非 ASCII 编码</strong></h2><p>英语用 128 个符号编码就够了，但是用来表示其他语言，128 个符号是不够的。比如，在法语中，字母上方有注音符号，它就无法用 ASCII 码表示。于是，一些欧洲国家就决定，利用字节中闲置的最高位编入新的符号。比如，法语中的<code>é</code>的编码为 130（二进制<code>10000010</code>）。这样一来，这些欧洲国家使用的编码体系，可以表示最多 256 个符号。</p>
<p>但是，这里又出现了新的问题。不同的国家有不同的字母，因此，哪怕它们都使用 256 个符号的编码方式，代表的字母却不一样。比如，130 在法语编码中代表了<code>é</code>，在希伯来语编码中却代表了字母<code>Gimel</code> (<code>ג</code>)，在俄语编码中又会代表另一个符号。但是不管怎样，所有这些编码方式中，0–127 表示的符号是一样的，不一样的只是 128–255 的这一段。</p>
<p>至于亚洲国家的文字，使用的符号就更多了，汉字就多达 10 万左右。一个字节只能表示 256 种符号，肯定是不够的，就必须使用多个字节表达一个符号。比如，简体中文常见的编码方式是 GB2312，使用两个字节表示一个汉字，所以理论上最多可以表示 256 x 256 &#x3D; 65536 个符号。</p>
<p>中文编码的问题需要专文讨论，这篇笔记不涉及。这里只指出，虽然都是用多个字节表示一个符号，但是 GB 类的汉字编码与后文的 Unicode 和 UTF-8 是毫无关系的。</p>
<h2 id="三-Unicode"><a href="#三-Unicode" class="headerlink" title="三. Unicode"></a><strong>三. Unicode</strong></h2><p>正如上一节所说，世界上存在着多种编码方式，同一个二进制数字可以被解释成不同的符号。因此，要想打开一个文本文件，就必须知道它的编码方式，否则用错误的编码方式解读，就会出现乱码。为什么电子邮件常常出现乱码？就是因为发信人和收信人使用的编码方式不一样。</p>
<p>可以想象，如果有一种编码，将世界上所有的符号都纳入其中。每一个符号都给予一个独一无二的编码，那么乱码问题就会消失。这就是 Unicode，就像它的名字都表示的，这是一种所有符号的编码。</p>
<p>Unicode 当然是一个很大的集合，现在的规模可以容纳 100 多万个符号。每个符号的编码都不一样，比如，<code>U+0639</code>表示阿拉伯字母<code>Ain</code>，<code>U+0041</code>表示英语的大写字母<code>A</code>，<code>U+4E25</code>表示汉字<code>严</code>。具体的符号对应表，可以查询<a href="http://www.unicode.org/">unicode.org</a>，或者专门的<a href="http://www.chi2ko.com/tool/CJK.htm">汉字对应表</a>。</p>
<h2 id="四、Unicode-的问题"><a href="#四、Unicode-的问题" class="headerlink" title="四、Unicode 的问题"></a><strong>四、Unicode 的问题</strong></h2><p>需要注意的是，Unicode 只是一个符号集，它只规定了符号的二进制代码，却没有规定这个二进制代码应该如何存储。</p>
<p>比如，汉字<code>严</code>的 Unicode 是十六进制数<code>4E25</code>，转换成二进制数足足有 15 位（<code>100111000100101</code>），也就是说，这个符号的表示至少需要 2 个字节。表示其他更大的符号，可能需要 3 个字节或者 4 个字节，甚至更多。</p>
<p>这里就有两个严重的问题，第一个问题是，如何才能区别 Unicode 和 ASCII ？计算机怎么知道三个字节表示一个符号，而不是分别表示三个符号呢？第二个问题是，我们已经知道，英文字母只用一个字节表示就够了，如果 Unicode 统一规定，每个符号用三个或四个字节表示，那么每个英文字母前都必然有二到三个字节是<code>0</code>，这对于存储来说是极大的浪费，文本文件的大小会因此大出二三倍，这是无法接受的。</p>
<p>它们造成的结果是：1）出现了 Unicode 的多种存储方式，也就是说有许多种不同的二进制格式，可以用来表示 Unicode。2）Unicode 在很长一段时间内无法推广，直到互联网的出现。</p>
<h2 id="五、UTF-8"><a href="#五、UTF-8" class="headerlink" title="五、UTF-8"></a><strong>五、UTF-8</strong></h2><p>互联网的普及，强烈要求出现一种统一的编码方式。UTF-8 就是在互联网上使用最广的一种 Unicode 的实现方式。其他实现方式还包括 UTF-16（字符用两个字节或四个字节表示）和 UTF-32（字符用四个字节表示），不过在互联网上基本不用。<strong>重复一遍，这里的关系是，UTF-8 是 Unicode 的实现方式之一。</strong></p>
<p>UTF-8 最大的一个特点，就是它是一种变长的编码方式。它可以使用 1~4 个字节表示一个符号，根据不同的符号而变化字节长度。</p>
<p>UTF-8 的编码规则很简单，只有二条：</p>
<p>1）对于单字节的符号，字节的第一位设为<code>0</code>，后面 7 位为这个符号的 Unicode 码。因此对于英语字母，UTF-8 编码和 ASCII 码是相同的。</p>
<p>2）对于<code>n</code>字节的符号（<code>n &gt; 1</code>），第一个字节的前<code>n</code>位都设为<code>1</code>，第<code>n + 1</code>位设为<code>0</code>，后面字节的前两位一律设为<code>10</code>。剩下的没有提及的二进制位，全部为这个符号的 Unicode 码。</p>
<p>下表总结了编码规则，字母<code>x</code>表示可用编码的位。</p>
<blockquote>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line">Unicode符号范围     |        UTF-8编码方式</span><br><span class="line"><span class="section">(十六进制)        |              （二进制）</span></span><br><span class="line"><span class="section">----------------------+---------------------------------------------</span></span><br><span class="line">0000 0000-0000 007F | 0xxxxxxx</span><br><span class="line">0000 0080-0000 07FF | 110xxxxx 10xxxxxx</span><br><span class="line">0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx</span><br><span class="line">0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx</span><br></pre></td></tr></table></figure>
</blockquote>
<p>跟据上表，解读 UTF-8 编码非常简单。如果一个字节的第一位是<code>0</code>，则这个字节单独就是一个字符；如果第一位是<code>1</code>，则连续有多少个<code>1</code>，就表示当前字符占用多少个字节。</p>
<p>下面，还是以汉字<code>严</code>为例，演示如何实现 UTF-8 编码。</p>
<p><code>严</code>的 Unicode 是<code>4E25</code>（<code>100111000100101</code>），根据上表，可以发现<code>4E25</code>处在第三行的范围内（<code>0000 0800 - 0000 FFFF</code>），因此<code>严</code>的 UTF-8 编码需要三个字节，即格式是<code>1110xxxx 10xxxxxx 10xxxxxx</code>。然后，从<code>严</code>的最后一个二进制位开始，依次从后向前填入格式中的<code>x</code>，多出的位补<code>0</code>。这样就得到了，<code>严</code>的 UTF-8 编码是<code>11100100 10111000 10100101</code>，转换成十六进制就是<code>E4B8A5</code>。</p>
<h2 id="六、Unicode-与-UTF-8-之间的转换"><a href="#六、Unicode-与-UTF-8-之间的转换" class="headerlink" title="六、Unicode 与 UTF-8 之间的转换"></a><strong>六、Unicode 与 UTF-8 之间的转换</strong></h2><p>通过上一节的例子，可以看到<code>严</code>的 Unicode 码 是<code>4E25</code>，UTF-8 编码是<code>E4B8A5</code>，两者是不一样的。它们之间的转换可以通过程序实现。</p>
<p>Windows 平台，有一个最简单的转化方法，就是使用内置的记事本小程序<code>notepad.exe</code>。打开文件后，点击<code>文件</code>菜单中的<code>另存为</code>命令，会跳出一个对话框，在最底部有一个<code>编码</code>的下拉条。</p>
<p><a href="http://www.ruanyifeng.com/blog/2007/10/bg2007102801.jpg"><img data-src="/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%AC%94%E8%AE%B0%EF%BC%9AASCII%EF%BC%8CUnicode%20%E5%92%8C%20UTF-8/bg2007102801-thumb-1607839331264.jpg" alt="bg2007102801.jpg"></a></p>
<p>里面有四个选项：<code>ANSI</code>，<code>Unicode</code>，<code>Unicode big endian</code>和<code>UTF-8</code>。</p>
<p>1）<code>ANSI</code>是默认的编码方式。对于英文文件是<code>ASCII</code>编码，对于简体中文文件是<code>GB2312</code>编码（只针对 Windows 简体中文版，如果是繁体中文版会采用 Big5 码）。</p>
<p>2）<code>Unicode</code>编码这里指的是<code>notepad.exe</code>使用的 UCS-2 编码方式，即直接用两个字节存入字符的 Unicode 码，这个选项用的 little endian 格式。</p>
<p>3）<code>Unicode big endian</code>编码与上一个选项相对应。我在下一节会解释 little endian 和 big endian 的涵义。</p>
<p>4）<code>UTF-8</code>编码，也就是上一节谈到的编码方法。</p>
<p>选择完”编码方式”后，点击”保存”按钮，文件的编码方式就立刻转换好了。</p>
<h2 id="七、Little-endian-和-Big-endian"><a href="#七、Little-endian-和-Big-endian" class="headerlink" title="七、Little endian 和 Big endian"></a><strong>七、Little endian 和 Big endian</strong></h2><p>上一节已经提到，UCS-2 格式可以存储 Unicode 码（码点不超过<code>0xFFFF</code>）。以汉字<code>严</code>为例，Unicode 码是<code>4E25</code>，需要用两个字节存储，一个字节是<code>4E</code>，另一个字节是<code>25</code>。存储的时候，<code>4E</code>在前，<code>25</code>在后，这就是 Big endian 方式；<code>25</code>在前，<code>4E</code>在后，这是 Little endian 方式。</p>
<p>这两个古怪的名称来自英国作家斯威夫特的《格列佛游记》。在该书中，小人国里爆发了内战，战争起因是人们争论，吃鸡蛋时究竟是从大头(Big-endian)敲开还是从小头(Little-endian)敲开。为了这件事情，前后爆发了六次战争，一个皇帝送了命，另一个皇帝丢了王位。</p>
<p>第一个字节在前，就是”大头方式”（Big endian），第二个字节在前就是”小头方式”（Little endian）。</p>
<p>那么很自然的，就会出现一个问题：计算机怎么知道某一个文件到底采用哪一种方式编码？</p>
<p>Unicode 规范定义，每一个文件的最前面分别加入一个表示编码顺序的字符，这个字符的名字叫做”零宽度非换行空格”（zero width no-break space），用<code>FEFF</code>表示。这正好是两个字节，而且<code>FF</code>比<code>FE</code>大<code>1</code>。</p>
<p>如果一个文本文件的头两个字节是<code>FE FF</code>，就表示该文件采用大头方式；如果头两个字节是<code>FF FE</code>，就表示该文件采用小头方式。</p>
<h2 id="八、实例"><a href="#八、实例" class="headerlink" title="八、实例"></a><strong>八、实例</strong></h2><p>下面，举一个实例。</p>
<p>打开”记事本”程序<code>notepad.exe</code>，新建一个文本文件，内容就是一个<code>严</code>字，依次采用<code>ANSI</code>，<code>Unicode</code>，<code>Unicode big endian</code>和<code>UTF-8</code>编码方式保存。</p>
<p>然后，用文本编辑软件<a href="http://www.google.cn/search?aq=t&oq=UltraEdit&complete=1&hl=zh-CN&newwindow=1&rlz=1B3GGGL_zh-CNCN216CN216&q=ultraedit+%E4%B8%8B%E8%BD%BD&btnG=Google+%E6%90%9C%E7%B4%A2&meta=">UltraEdit 中</a>的”十六进制功能”，观察该文件的内部编码方式。</p>
<p>1）ANSI：文件的编码就是两个字节<code>D1 CF</code>，这正是<code>严</code>的 GB2312 编码，这也暗示 GB2312 是采用大头方式存储的。</p>
<p>2）Unicode：编码是四个字节<code>FF FE 25 4E</code>，其中<code>FF FE</code>表明是小头方式存储，真正的编码是<code>4E25</code>。</p>
<p>3）Unicode big endian：编码是四个字节<code>FE FF 4E 25</code>，其中<code>FE FF</code>表明是大头方式存储。</p>
<p>4）UTF-8：编码是六个字节<code>EF BB BF E4 B8 A5</code>，前三个字节<code>EF BB BF</code>表示这是 UTF-8 编码，后三个<code>E4B8A5</code>就是<code>严</code>的具体编码，它的存储顺序与编码顺序是一致的。</p>
<h1 id="Unicode-与-JavaScript-详解"><a href="#Unicode-与-JavaScript-详解" class="headerlink" title="Unicode 与 JavaScript 详解"></a>Unicode 与 JavaScript 详解</h1><h2 id="一、Unicode-是什么？"><a href="#一、Unicode-是什么？" class="headerlink" title="一、Unicode 是什么？"></a>一、Unicode 是什么？</h2><p>Unicode 源于一个很简单的想法：将全世界所有的字符包含在一个集合里，计算机只要支持这一个字符集，就能显示所有的字符，再也不会有乱码了。</p>
<p><img data-src="/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%AC%94%E8%AE%B0%EF%BC%9AASCII%EF%BC%8CUnicode%20%E5%92%8C%20UTF-8/bg2014121103-1607839343682.jpg" alt="img"></p>
<p><strong>它从 0 开始，为每个符号指定一个编号，这叫做”码点”（code point）。</strong>比如，码点 0 的符号就是 null（表示所有二进制位都是 0）。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">U+<span class="number">0000</span> = <span class="literal">null</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>上式中，U+表示紧跟在后面的十六进制数是 Unicode 的码点。</p>
<p><img data-src="/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%AC%94%E8%AE%B0%EF%BC%9AASCII%EF%BC%8CUnicode%20%E5%92%8C%20UTF-8/bg2014121115-1607839347082.png" alt="img"></p>
<p>目前，Unicode 的最新版本是 7.0 版，一共收入了 109449 个符号，其中的中日韩文字为 74500 个。可以近似认为，全世界现有的符号当中，三分之二以上来自东亚文字。比如，中文”好”的码点是十六进制的 597D。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">U+597D = 好</span><br></pre></td></tr></table></figure>
</blockquote>
<p>这么多符号，Unicode 不是一次性定义的，而是分区定义。每个区可以存放 65536 个（216）字符，称为一个平面（plane）。目前，一共有 17 个（25）平面，也就是说，整个 Unicode 字符集的大小现在是 221。</p>
<p>最前面的 65536 个字符位，称为基本平面（缩写 BMP），它的码点范围是从 0 一直到 216-1，写成 16 进制就是从 U+0000 到 U+FFFF。所有最常见的字符都放在这个平面，这是 Unicode 最先定义和公布的一个平面。</p>
<p>剩下的字符都放在辅助平面（缩写 SMP），码点范围从 U+010000 一直到 U+10FFFF。</p>
<p><img data-src="/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%AC%94%E8%AE%B0%EF%BC%9AASCII%EF%BC%8CUnicode%20%E5%92%8C%20UTF-8/bg2014121104-1607839349198.png" alt="img"></p>
<h2 id="二、UTF-32-与-UTF-8"><a href="#二、UTF-32-与-UTF-8" class="headerlink" title="二、UTF-32 与 UTF-8"></a>二、UTF-32 与 UTF-8</h2><p>Unicode 只规定了每个字符的码点，到底用什么样的字节序表示这个码点，就涉及到编码方法。</p>
<p><strong>最直观的编码方法是，每个码点使用四个字节表示，字节内容一一对应码点。这种编码方法就叫做 UTF-32。</strong>比如，码点 0 就用四个字节的 0 表示，码点 597D 就在前面加两个字节的 0。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">U+<span class="number">0000</span> = <span class="number">0x0000</span> <span class="number">0000</span></span><br><span class="line"></span><br><span class="line">U+597D = <span class="number">0x0000</span> 597D</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img data-src="/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%AC%94%E8%AE%B0%EF%BC%9AASCII%EF%BC%8CUnicode%20%E5%92%8C%20UTF-8/bg2014121116-1607839351292.png" alt="img"></p>
<p>UTF-32 的优点在于，转换规则简单直观，查找效率高。缺点在于浪费空间，同样内容的英语文本，它会比 ASCII 编码大四倍。这个缺点很致命，导致实际上没有人使用这种编码方法，HTML 5 标准就明文规定，网页不得编码成 UTF-32。</p>
<p><img data-src="/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%AC%94%E8%AE%B0%EF%BC%9AASCII%EF%BC%8CUnicode%20%E5%92%8C%20UTF-8/bg2014121105-1607839353048.png" alt="img"></p>
<p>人们真正需要的是一种节省空间的编码方法，这导致了 UTF-8 的诞生。<strong>UTF-8 是一种变长的编码方法，字符长度从 1 个字节到 4 个字节不等。</strong>越是常用的字符，字节越短，最前面的 128 个字符，只使用 1 个字节表示，与 ASCII 码完全相同。</p>
<table>
<thead>
<tr>
<th>编号范围</th>
<th>字节</th>
</tr>
</thead>
<tbody><tr>
<td>0x0000 - 0x007F</td>
<td>1</td>
</tr>
<tr>
<td>0x0080 - 0x07FF</td>
<td>2</td>
</tr>
<tr>
<td>0x0800 - 0xFFFF</td>
<td>3</td>
</tr>
<tr>
<td>0x010000 - 0x10FFFF</td>
<td>4</td>
</tr>
</tbody></table>
<p>由于 UTF-8 这种节省空间的特性，导致它成为互联网上最常见的网页编码。不过，它跟今天的主题关系不大，我就不深入了，具体的转码方法，可以参考我多年前写的<a href="http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html">《字符编码笔记》</a>。</p>
<h2 id="三、UTF-16-简介"><a href="#三、UTF-16-简介" class="headerlink" title="三、UTF-16 简介"></a>三、UTF-16 简介</h2><p>UTF-16 编码介于 UTF-32 与 UTF-8 之间，同时结合了定长和变长两种编码方法的特点。</p>
<p>它的编码规则很简单：基本平面的字符占用 2 个字节，辅助平面的字符占用 4 个字节。<strong>也就是说，UTF-16 的编码长度要么是 2 个字节（U+0000 到 U+FFFF），要么是 4 个字节（U+010000 到 U+10FFFF）。</strong></p>
<p><img data-src="/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%AC%94%E8%AE%B0%EF%BC%9AASCII%EF%BC%8CUnicode%20%E5%92%8C%20UTF-8/bg2014121106-1607839355304.png" alt="img"></p>
<p>于是就有一个问题，当我们遇到两个字节，怎么看出它本身是一个字符，还是需要跟其他两个字节放在一起解读？</p>
<p>说来很巧妙，我也不知道是不是故意的设计，在基本平面内，从 U+D800 到 U+DFFF 是一个空段，即这些码点不对应任何字符。因此，这个空段可以用来映射辅助平面的字符。</p>
<p>具体来说，辅助平面的字符位共有 220 个，也就是说，对应这些字符至少需要 20 个二进制位。UTF-16 将这 20 位拆成两半，前 10 位映射在 U+D800 到 U+DBFF（空间大小 210），称为高位（H），后 10 位映射在 U+DC00 到 U+DFFF（空间大小 210），称为低位（L）。这意味着，一个辅助平面的字符，被拆成两个基本平面的字符表示。</p>
<p><img data-src="/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%AC%94%E8%AE%B0%EF%BC%9AASCII%EF%BC%8CUnicode%20%E5%92%8C%20UTF-8/bg2014121117-1607839357568.png" alt="img"></p>
<p><strong>所以，当我们遇到两个字节，发现它的码点在 U+D800 到 U+DBFF 之间，就可以断定，紧跟在后面的两个字节的码点，应该在 U+DC00 到 U+DFFF 之间，这四个字节必须放在一起解读。</strong></p>
<h2 id="四、UTF-16-的转码公式"><a href="#四、UTF-16-的转码公式" class="headerlink" title="四、UTF-16 的转码公式"></a>四、UTF-16 的转码公式</h2><p>Unicode 码点转成 UTF-16 的时候，首先区分这是基本平面字符，还是辅助平面字符。如果是前者，直接将码点转为对应的十六进制形式，长度为两字节。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">U+597D = <span class="number">0x597D</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>如果是辅助平面字符，Unicode 3.0 版给出了转码公式。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">H = <span class="title class_">Math</span>.<span class="title function_">floor</span>((c - <span class="number">0x10000</span>) / <span class="number">0x400</span>) + <span class="number">0xd800</span>;</span><br><span class="line"></span><br><span class="line">L = ((c - <span class="number">0x10000</span>) % <span class="number">0x400</span>) + <span class="number">0xdc00</span>;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img data-src="/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%AC%94%E8%AE%B0%EF%BC%9AASCII%EF%BC%8CUnicode%20%E5%92%8C%20UTF-8/bg2014121107-1607839359685.png" alt="img"></p>
<p>以字符![img](C:\Users\WX03\Desktop\张博文记录\字符编码笔记：ASCII，Unicode 和 UTF-8\bg2014121121-1.png)为例，它是一个辅助平面字符，码点为 U+1D306，将其转为 UTF-16 的计算过程如下。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">H = <span class="title class_">Math</span>.<span class="title function_">floor</span>((<span class="number">0x1D306</span>-<span class="number">0x10000</span>)/<span class="number">0x400</span>)+<span class="number">0xD800</span> = <span class="number">0xD834</span></span><br><span class="line"></span><br><span class="line">L = (<span class="number">0x1D306</span>-<span class="number">0x10000</span>) % <span class="number">0x400</span>+<span class="number">0xDC00</span> = <span class="number">0xDF06</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>所以，字符![img](C:\Users\WX03\Desktop\张博文记录\字符编码笔记：ASCII，Unicode 和 UTF-8\bg2014121121-1.png)的 UTF-16 编码就是 0xD834 DF06，长度为四个字节。</p>
<p><img data-src="/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%AC%94%E8%AE%B0%EF%BC%9AASCII%EF%BC%8CUnicode%20%E5%92%8C%20UTF-8/bg2014121118-1607839361287.png" alt="img"></p>
<h2 id="五、JavaScript-使用哪一种编码？"><a href="#五、JavaScript-使用哪一种编码？" class="headerlink" title="五、JavaScript 使用哪一种编码？"></a>五、JavaScript 使用哪一种编码？</h2><p><img data-src="/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%AC%94%E8%AE%B0%EF%BC%9AASCII%EF%BC%8CUnicode%20%E5%92%8C%20UTF-8/bg2014121108-1607839362726.png" alt="img"></p>
<p>JavaScript 语言采用 Unicode 字符集，但是只支持一种编码方法。</p>
<p>这种编码既不是 UTF-16，也不是 UTF-8，更不是 UTF-32。上面那些编码方法，JavaScript 都不用。</p>
<p><strong>JavaScript 用的是 UCS-2！</strong></p>
<p><img data-src="/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%AC%94%E8%AE%B0%EF%BC%9AASCII%EF%BC%8CUnicode%20%E5%92%8C%20UTF-8/bg2014121109-1607839364889.png" alt="img"></p>
<h2 id="六、UCS-2-编码"><a href="#六、UCS-2-编码" class="headerlink" title="六、UCS-2 编码"></a>六、UCS-2 编码</h2><p>怎么突然杀出一个 UCS-2？这就需要讲一点历史。</p>
<p>互联网还没出现的年代，曾经有两个团队，不约而同想搞统一字符集。一个是 1988 年成立的 Unicode 团队，另一个是 1989 年成立的 UCS 团队。等到他们发现了对方的存在，很快就达成一致：世界上不需要两套统一字符集。</p>
<p>1991 年 10 月，两个团队决定合并字符集。也就是说，从今以后只发布一套字符集，就是 Unicode，并且修订此前发布的字符集，UCS 的码点将与 Unicode 完全一致。</p>
<p><img data-src="/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%AC%94%E8%AE%B0%EF%BC%9AASCII%EF%BC%8CUnicode%20%E5%92%8C%20UTF-8/bg2014121119-1607839366617.jpg" alt="img"></p>
<p>UCS 的开发进度快于 Unicode，1990 年就公布了第一套编码方法 UCS-2，使用 2 个字节表示已经有码点的字符。（那个时候只有一个平面，就是基本平面，所以 2 个字节就够用了。）UTF-16 编码迟至 1996 年 7 月才公布，明确宣布是 UCS-2 的超集，即基本平面字符沿用 UCS-2 编码，辅助平面字符定义了 4 个字节的表示方法。</p>
<p><strong>两者的关系简单说，就是 UTF-16 取代了 UCS-2，或者说 UCS-2 整合进了 UTF-16。</strong>所以，现在只有 UTF-16，没有 UCS-2。</p>
<h2 id="七、JavaScript-的诞生背景"><a href="#七、JavaScript-的诞生背景" class="headerlink" title="七、JavaScript 的诞生背景"></a>七、JavaScript 的诞生背景</h2><p>那么，为什么 JavaScript 不选择更高级的 UTF-16，而用了已经被淘汰的 UCS-2 呢？</p>
<p>答案很简单：非不想也，是不能也。<strong>因为在 JavaScript 语言出现的时候，还没有 UTF-16 编码。</strong></p>
<p>1995 年 5 月，Brendan Eich 用了 10 天设计了 JavaScript 语言；10 月，第一个解释引擎问世；次年 11 月，Netscape 正式向 ECMA 提交语言标准（整个过程详见<a href="http://www.ruanyifeng.com/blog/2011/06/birth_of_javascript.html">《JavaScript 诞生记》</a>）。对比 UTF-16 的发布时间（1996 年 7 月），就会明白 Netscape 公司那时没有其他选择，只有 UCS-2 一种编码方法可用！</p>
<p><img data-src="/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%AC%94%E8%AE%B0%EF%BC%9AASCII%EF%BC%8CUnicode%20%E5%92%8C%20UTF-8/bg2014121120-1607839368619.png" alt="img"></p>
<h2 id="八、JavaScript-字符函数的局限"><a href="#八、JavaScript-字符函数的局限" class="headerlink" title="八、JavaScript 字符函数的局限"></a>八、JavaScript 字符函数的局限</h2><p><strong>由于 JavaScript 只能处理 UCS-2 编码，造成所有字符在这门语言中都是 2 个字节，如果是 4 个字节的字符，会当作两个双字节的字符处理。</strong>JavaScript 的字符函数都受到这一点的影响，无法返回正确结果。</p>
<p><img data-src="/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%AC%94%E8%AE%B0%EF%BC%9AASCII%EF%BC%8CUnicode%20%E5%92%8C%20UTF-8/bg2014121110-1607839370495.png" alt="img"></p>
<p>还是以字符![img](C:\Users\WX03\Desktop\张博文记录\字符编码笔记：ASCII，Unicode 和 UTF-8\bg2014121121-1.png)为例，它的 UTF-16 编码是 4 个字节的 0xD834 DF06。问题就来了，4 个字节的编码不属于 UCS-2，JavaScript 不认识，只会把它看作单独的两个字符 U+D834 和 U+DF06。前面说过，这两个码点是空的，所以 JavaScript 会认为<img data-src="http://www.ruanyifeng.com/blogimg/asset/2014/bg2014121121-1.png" alt="img">是两个空字符组成的字符串！</p>
<p><img data-src="/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%AC%94%E8%AE%B0%EF%BC%9AASCII%EF%BC%8CUnicode%20%E5%92%8C%20UTF-8/bg2014121122-1607839372478.png" alt="img"></p>
<p>上面代码表示，JavaScript 认为字符<img data-src="http://www.ruanyifeng.com/blogimg/asset/2014/bg2014121121-1.png" alt="img">的长度是 2，取到的第一个字符是空字符，取到的第一个字符的码点是 0xDB34。这些结果都不正确！</p>
<p><img data-src="/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%AC%94%E8%AE%B0%EF%BC%9AASCII%EF%BC%8CUnicode%20%E5%92%8C%20UTF-8/bg2014121111-1607839471993.png" alt="img"></p>
<p>解决这个问题，必须对码点做一个判断，然后手动调整。下面是正确的遍历字符串的写法。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> (++index &lt; length) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">if</span> (charCode &gt;= <span class="number">0xd800</span> &amp;&amp; charCode &lt;= <span class="number">0xdbff</span>) &#123;</span><br><span class="line">    output.<span class="title function_">push</span>(character + string.<span class="title function_">charAt</span>(++index));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    output.<span class="title function_">push</span>(character);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面代码表示，遍历字符串的时候，必须对码点做一个判断，只要落在 0xD800 到 0xDBFF 的区间，就要连同后面 2 个字节一起读取。</p>
<p>类似的问题存在于所有的 JavaScript 字符操作函数。</p>
<blockquote>
<ul>
<li>String.prototype.replace()</li>
<li>String.prototype.substring()</li>
<li>String.prototype.slice()</li>
<li>…</li>
</ul>
</blockquote>
<p>上面的函数都只对 2 字节的码点有效。要正确处理 4 字节的码点，就必须逐一部署自己的版本，判断一下当前字符的码点范围。</p>
<h2 id="九、ECMAScript-6"><a href="#九、ECMAScript-6" class="headerlink" title="九、ECMAScript 6"></a>九、ECMAScript 6</h2><p><img data-src="/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%AC%94%E8%AE%B0%EF%BC%9AASCII%EF%BC%8CUnicode%20%E5%92%8C%20UTF-8/bg2014121112-1607839311267.png" alt="img"></p>
<p>JavaScript 的下一个版本 ECMAScript 6（简称 ES6），大幅增强了 Unicode 支持，基本上解决了这个问题。</p>
<p><strong>（1）正确识别字符</strong></p>
<p>ES6 可以自动识别 4 字节的码点。因此，遍历字符串就简单多了。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> s <span class="keyword">of</span> string) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>但是，为了保持兼容，length 属性还是原来的行为方式。为了得到字符串的正确长度，可以用下面的方式。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="title function_">from</span>(string).<span class="property">length</span>;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>（2）码点表示法</strong></p>
<p>JavaScript 允许直接用码点表示 Unicode 字符，写法是”反斜杠+u+码点”。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;好&quot;</span> === <span class="string">&quot;\u597D&quot;</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>但是，这种表示法对 4 字节的码点无效。ES6 修正了这个问题，只要将码点放在大括号内，就能正确识别。</p>
<p><img data-src="/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%AC%94%E8%AE%B0%EF%BC%9AASCII%EF%BC%8CUnicode%20%E5%92%8C%20UTF-8/bg2014121123-1607839063327-1607839074632-1607839299600.png" alt="img"></p>
<p><strong>（3）字符串处理函数</strong></p>
<p>ES6 新增了几个专门处理 4 字节码点的函数。</p>
<blockquote>
<ul>
<li>**String.fromCodePoint()**：从 Unicode 码点返回对应字符</li>
<li>**String.prototype.codePointAt()**：从字符返回对应的码点</li>
<li>**String.prototype.at()**：返回字符串给定位置的字符</li>
</ul>
</blockquote>
<p><strong>（4）正则表达式</strong></p>
<p>ES6 提供了 u 修饰符，对正则表达式添加 4 字节码点的支持。</p>
<p><img data-src="/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%AC%94%E8%AE%B0%EF%BC%9AASCII%EF%BC%8CUnicode%20%E5%92%8C%20UTF-8/bg2014121124-1607839303650.png" alt="img"></p>
<p><strong>（5）Unicode 正规化</strong></p>
<p>有些字符除了字母以外，还有<a href="http://zh.wikipedia.org/wiki/%E9%99%84%E5%8A%A0%E7%AC%A6%E5%8F%B7">附加符号</a>。比如，汉语拼音的 Ǒ，字母上面的声调就是附加符号。对于许多欧洲语言来说，声调符号是非常重要的。</p>
<p><img data-src="/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%AC%94%E8%AE%B0%EF%BC%9AASCII%EF%BC%8CUnicode%20%E5%92%8C%20UTF-8/bg2014121113-1607839306035.png" alt="img"></p>
<p>Unicode 提供了两种表示方法。一种是带附加符号的单个字符，即一个码点表示一个字符，比如 Ǒ 的码点是 U+01D1；另一种是将附加符号单独作为一个码点，与主体字符复合显示，即两个码点表示一个字符，比如 Ǒ 可以写成 O（U+004F） + ˇ（U+030C）。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 方法一</span></span><br><span class="line"><span class="string">&quot;\u01D1&quot;</span>;</span><br><span class="line"><span class="comment">// &#x27;Ǒ&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法二</span></span><br><span class="line"><span class="string">&quot;\u004F\u030C&quot;</span>;</span><br><span class="line"><span class="comment">// &#x27;Ǒ&#x27;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>这两种表示方法，视觉和语义都完全一样，理应作为等同情况处理。但是，JavaScript 无法辨别。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;\u01D1&quot;</span> === <span class="string">&quot;\u004F\u030C&quot;</span>;</span><br><span class="line"><span class="comment">//false</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>ES6 提供了 normalize 方法，允许<a href="http://zh.wikipedia.org/wiki/Unicode%E6%AD%A3%E8%A6%8F%E5%8C%96">“Unicode 正规化”</a>，即将两种方法转为同样的序列。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;\u01D1&quot;</span>.<span class="title function_">normalize</span>() === <span class="string">&quot;\u004F\u030C&quot;</span>.<span class="title function_">normalize</span>();</span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure>
</blockquote>
]]></content>
      <categories>
        <category>计算机通用知识</category>
      </categories>
      <tags>
        <tag>js</tag>
        <tag>计算机通用知识</tag>
      </tags>
  </entry>
  <entry>
    <title>布局容器布局下的左右托拽指令</title>
    <url>/2019/07/21/Vue/%E5%B8%83%E5%B1%80%E5%AE%B9%E5%99%A8%E5%B8%83%E5%B1%80%E4%B8%8B%E7%9A%84%E5%B7%A6%E5%8F%B3%E6%89%98%E6%8B%BD%E6%8C%87%E4%BB%A4/</url>
    <content><![CDATA[<h1 id="vue-elementUI-项目-实现-Container-布局容器布局下的左右托拽指令"><a href="#vue-elementUI-项目-实现-Container-布局容器布局下的左右托拽指令" class="headerlink" title="vue+elementUI 项目 实现 Container 布局容器布局下的左右托拽指令"></a>vue+elementUI 项目 实现 Container 布局容器布局下的左右托拽指令</h1><p>话不多说上代码</p>
<span id="more"></span>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> resize = &#123;</span><br><span class="line">  <span class="comment">//被绑定元素插入父节点时调用 (仅保证父节点存在，但不一定已被插入文档中)。</span></span><br><span class="line">  <span class="title function_">inserted</span>(<span class="params">el, binding, vnode, oldVnode</span>) &#123;</span><br><span class="line">    <span class="comment">//创建一个定位的节点定位到要托拽的节点上</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">resize</span>: <span class="title class_">HTMLElement</span> = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">    resize.<span class="property">innerText</span> = <span class="string">&quot;✌&quot;</span>;</span><br><span class="line">    <span class="keyword">const</span> style = &#123;</span><br><span class="line">      <span class="attr">position</span>: <span class="string">&quot;absolute&quot;</span>,</span><br><span class="line">      <span class="attr">top</span>: <span class="string">&quot;0%&quot;</span>,</span><br><span class="line">      <span class="attr">right</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">      <span class="attr">display</span>: <span class="string">&quot;flex&quot;</span>,</span><br><span class="line">      <span class="attr">flexDirection</span>: <span class="string">&quot;column&quot;</span>,</span><br><span class="line">      <span class="attr">alignItems</span>: <span class="string">&quot;center&quot;</span>,</span><br><span class="line">      <span class="attr">justifyContent</span>: <span class="string">&quot;center&quot;</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="string">&quot;10px&quot;</span>,</span><br><span class="line">      <span class="attr">height</span>: <span class="string">&quot;100%&quot;</span>,</span><br><span class="line">      <span class="attr">overflow</span>: <span class="string">&quot;hidden&quot;</span>,</span><br><span class="line">      <span class="attr">cursor</span>: <span class="string">&quot;e-resize&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> style) &#123;</span><br><span class="line">      <span class="keyword">if</span> (resize.<span class="property">style</span>.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">        resize.<span class="property">style</span>[key] = style[key];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    el.<span class="title function_">appendChild</span>(resize);</span><br><span class="line">    <span class="comment">//获取binding参数</span></span><br><span class="line">    <span class="keyword">const</span> &#123; container = <span class="literal">false</span>, percent = <span class="number">0.5</span> &#125; = binding.<span class="property">value</span>;</span><br><span class="line">    <span class="comment">//容器</span></span><br><span class="line">    <span class="keyword">let</span> containerNode = container</span><br><span class="line">      ? <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(container)</span><br><span class="line">      : el.<span class="property">parentElement</span>;</span><br><span class="line">    <span class="comment">//容器宽度</span></span><br><span class="line">    <span class="keyword">let</span> clientWidth = containerNode.<span class="property">clientWidth</span>;</span><br><span class="line">    <span class="comment">//要托拽节点的位置参数</span></span><br><span class="line">    <span class="keyword">let</span> targetPosition = el.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line">    <span class="comment">//最大可托拽宽度</span></span><br><span class="line">    <span class="keyword">let</span> maxWidth = clientWidth * percent;</span><br><span class="line">    <span class="comment">//托拽事件</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleMove</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">let</span> targetWidth = e.<span class="property">clientX</span> - targetPosition.<span class="property">right</span> + targetPosition.<span class="property">width</span>;</span><br><span class="line">      targetWidth &gt; maxWidth ? (targetWidth = maxWidth) : <span class="literal">null</span>;</span><br><span class="line">      el.<span class="property">style</span>.<span class="property">flex</span> = <span class="string">`0 0 <span class="subst">$&#123;targetWidth&#125;</span>px`</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//鼠标按下触发托拽</span></span><br><span class="line">    resize.<span class="title function_">addEventListener</span>(<span class="string">&quot;mousedown&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      containerNode.<span class="title function_">addEventListener</span>(<span class="string">&quot;mousemove&quot;</span>, handleMove);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//鼠标抬起清除事件</span></span><br><span class="line">    containerNode.<span class="title function_">addEventListener</span>(<span class="string">&quot;mouseup&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      containerNode.<span class="title function_">removeEventListener</span>(<span class="string">&quot;mousemove&quot;</span>, handleMove);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&quot;resize&quot;</span>, resize);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>常见面试题汇总</title>
    <url>/2021/11/14/%E9%9D%A2%E8%AF%95/%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h2 id="js-函数的防抖-debounce-与节流-throttle"><a href="#js-函数的防抖-debounce-与节流-throttle" class="headerlink" title="js 函数的防抖(debounce)与节流(throttle)"></a>js 函数的防抖(debounce)与节流(throttle)</h2><p>原文：<a href="https://juejin.im/post/5b651dc15188251aa30c8669##heading-1">函数防抖和节流；</a></p>
<h2 id="序言："><a href="#序言：" class="headerlink" title="序言："></a>序言：</h2><p>我们在平时开发的时候，会有很多场景会频繁触发事件，比如说搜索框实时发请求，onmousemove, resize, onscroll 等等，有些时候，我们并不能或者不想频繁触发事件，咋办呢？这时候就应该用到函数防抖和函数节流了！</p>
<h4 id="准备材料："><a href="#准备材料：" class="headerlink" title="准备材料："></a>准备材料：</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">  <span class="attr">id</span>=<span class="string">&quot;content&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">style</span>=<span class="string">&quot;height:150px;line-height:150px;text-align:center; color: #fff;background-color:#ccc;font-size:80px;&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> num = <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> content = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;content&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">count</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    content.<span class="property">innerHTML</span> = num++;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  content.<span class="property">onmousemove</span> = count;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这段代码， 在灰色区域内鼠标随便移动，就会持续触发 count() 函数，导致的效果如下：</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/1230971-20190507185520397-1412613733.png" alt="img"></p>
<p>接下来我们通过防抖和节流限制频繁操作。</p>
<h4 id="函数防抖（debounce）"><a href="#函数防抖（debounce）" class="headerlink" title="函数防抖（debounce）"></a>函数防抖（debounce）</h4><p>短时间内多次触发同一事件，只执行最后一次，或者只执行最开始的一次，中间的不执行。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 非立即执行版</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">func, wait</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timer;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> context = <span class="variable language_">this</span>; <span class="comment">// 注意 this 指向</span></span><br><span class="line">    <span class="keyword">let</span> args = <span class="variable language_">arguments</span>; <span class="comment">// arguments中存着e</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (timer) <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line"></span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      func.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args);</span><br><span class="line">    &#125;, wait);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们是这样使用的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">content.<span class="property">onmousemove</span> = <span class="title function_">debounce</span>(count, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<p>非立即执行版的意思是触发事件后函数不会立即执行，而是在 n 秒后执行，如果在 n 秒内又触发了事件，则会重新计算函数执行时间。效果如下：<img data-src="https://bitbw.top/public/img/my_gallery/20211114161011.png" alt="img"></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 立即执行版</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">func, wait</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timer;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> context = <span class="variable language_">this</span>; <span class="comment">// 这边的 this 指向谁?</span></span><br><span class="line">    <span class="keyword">let</span> args = <span class="variable language_">arguments</span>; <span class="comment">// arguments中存着e</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (timer) <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> callNow = !timer;</span><br><span class="line"></span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      timer = <span class="literal">null</span>;</span><br><span class="line">    &#125;, wait);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (callNow) func.<span class="title function_">apply</span>(context, args);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>立即执行版的意思是触发事件后函数会立即执行，然后 n 秒内不触发事件才能继续执行函数的效果。用法同上，效果如下：</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/1230971-20190507190345433-818771737.png" alt="img"></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 合成版</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desc</span> 函数防抖</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> func 目标函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> wait 延迟执行毫秒数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> immediate true - 立即执行， false - 延迟执行</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">func, wait, immediate</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timer;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> context = <span class="variable language_">this</span>,</span><br><span class="line">      args = <span class="variable language_">arguments</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (timer) <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">    <span class="keyword">if</span> (immediate) &#123;</span><br><span class="line">      <span class="keyword">let</span> callNow = !timer;</span><br><span class="line">      timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        timer = <span class="literal">null</span>;</span><br><span class="line">      &#125;, wait);</span><br><span class="line">      <span class="keyword">if</span> (callNow) func.<span class="title function_">apply</span>(context, args);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        func.<span class="title function_">apply</span>(context, args);</span><br><span class="line">      &#125;, wait);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="节流-throttle"><a href="#节流-throttle" class="headerlink" title="节流(throttle)"></a>节流(throttle)</h4><p>指连续触发事件但是在 n 秒中只执行一次函数。即 2n 秒内执行 2 次… 。节流如字面意思，会稀释函数的执行频率。</p>
<p>同样有两个版本，时间戳和定时器版。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 时间戳版</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">func, wait</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> previous = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> now = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">    <span class="keyword">let</span> context = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">let</span> args = <span class="variable language_">arguments</span>;</span><br><span class="line">    <span class="keyword">if</span> (now - previous &gt; wait) &#123;</span><br><span class="line">      func.<span class="title function_">apply</span>(context, args);</span><br><span class="line">      previous = now;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用方式如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">content.<span class="property">onmousemove</span> = <span class="title function_">throttle</span>(count, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/20211114161112.png" alt="img"></p>
<p>可以看到，在持续触发事件的过程中，函数会立即执行，并且每 1s 执行一次。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定时器版</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">func, wait</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timeout;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> context = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">let</span> args = <span class="variable language_">arguments</span>;</span><br><span class="line">    <span class="keyword">if</span> (!timeout) &#123;</span><br><span class="line">      timeout = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        timeout = <span class="literal">null</span>;</span><br><span class="line">        func.<span class="title function_">apply</span>(context, args);</span><br><span class="line">      &#125;, wait);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用法同上，效果如下：</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/20211114161116.png" alt="img"></p>
<p>可以看到，在持续触发事件的过程中，函数不会立即执行，并且每 1s 执行一次，在停止触发事件后，函数还会再执行一次。</p>
<p>我们应该可以很容易的发现，其实时间戳版和定时器版的节流函数的区别就是，时间戳版的函数触发是在时间段内开始的时候，而定时器版的函数触发是在时间段内结束的时候。</p>
<p>同样地，我们也可以将时间戳版和定时器版的节流函数结合起来，实现双剑合璧版的节流函数。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desc</span> 函数节流</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> func 函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> wait 延迟执行毫秒数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> type 1 表时间戳版，2 表定时器版</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">func, wait, type</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (type === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> previous = <span class="number">0</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> timeout;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> context = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">let</span> args = <span class="variable language_">arguments</span>;</span><br><span class="line">    <span class="keyword">if</span> (type === <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> now = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (now - previous &gt; wait) &#123;</span><br><span class="line">        func.<span class="title function_">apply</span>(context, args);</span><br><span class="line">        previous = now;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="number">2</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!timeout) &#123;</span><br><span class="line">        timeout = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          timeout = <span class="literal">null</span>;</span><br><span class="line">          func.<span class="title function_">apply</span>(context, args);</span><br><span class="line">        &#125;, wait);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="附录："><a href="#附录：" class="headerlink" title="附录："></a>附录：</h4><h6 id="关于节流-x2F-防抖函数中-context（this）-的指向解析："><a href="#关于节流-x2F-防抖函数中-context（this）-的指向解析：" class="headerlink" title="关于节流&#x2F;防抖函数中 context（this） 的指向解析："></a>关于节流&#x2F;防抖函数中 context（this） 的指向解析：</h6><p>首先，在执行 throttle(count, 1000) 这行代码的时候，会有一个返回值，这个返回值是一个新的匿名函数，因此 content.onmousemove &#x3D; throttle(count,1000); 这句话最终可以这样理解：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">content.<span class="property">onmousemove</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> now = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">    <span class="keyword">let</span> context = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">let</span> args = <span class="variable language_">arguments</span>;</span><br><span class="line">    ...</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>到这边为止，只是绑定了事件函数，还没有真正执行，而 this 的具体指向需要到真正运行时才能够确定下来。所以这个时候如果我们把前面的 content.onmousemove 替换成 var fn 并执行 fn fn() ，此时内部的 this 打印出来就会是 window 对象。</p>
<p>其次，当我们触发 onmousemove 事件的时候，才真正执行了上述的匿名函数，即 content.onmousemove() 。此时，上述的匿名函数的执行是通过 对象.函数名() 来完成的，那么函数内部的 this 自然指向 对象。</p>
<p>最后，匿名函数内部的 func 的调用方式如果是最普通的直接执行 func() ，那么 func 内部的 this 必然指向 window ，虽然在代码简单的情况下看不出什么异常（结果表现和正常一样），但是这将会是一个隐藏 bug，不得不注意啊！所以，我们通过匿名函数捕获 this，然后通过 func.apply() 的方式，来达到 content.onmousemove &#x3D; func 这样的效果。</p>
<p>可以说，高阶函数内部都要注意 this 的绑定。</p>
<h2 id="输入防抖节流"><a href="#输入防抖节流" class="headerlink" title="输入防抖节流"></a>输入防抖节流</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">document</span></span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">querySelector</span>(<span class="string">&quot;.input&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">addEventListener</span>(<span class="string">&quot;input&quot;</span>, <span class="title function_">throttle</span>(handleFn, <span class="number">500</span>, <span class="literal">true</span>));</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> index = <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">function</span> <span class="title function_">handleFn</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;index&quot;</span>, index);</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;handleFn&quot;</span>, e, <span class="variable language_">this</span>.<span class="property">value</span>);</span></span><br><span class="line"><span class="language-javascript">        index++;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 防抖 间隔delay时间内多次触发，只执行第一次，或最后一次</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">fn, delay, triggerNow = <span class="literal">false</span></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> timer = <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...arg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> context = <span class="variable language_">this</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// clearTimeout 保证只能首次 或者最后一次被执行，否则在规定delay的时间内都会被清理掉</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (timer) <span class="built_in">clearTimeout</span>(timer);</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 立即执行版 一段delay时间内多次触发只有第一次被执行</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (triggerNow) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> first = !timer;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (first) fn.<span class="title function_">call</span>(context, ...arg);</span></span><br><span class="line"><span class="language-javascript">            timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="comment">// 恢复 timer 以便首次执行</span></span></span><br><span class="line"><span class="language-javascript">              timer = <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;, delay);</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 最后一次执行版 一段delay时间内多次触发只有最后一次被执行</span></span></span><br><span class="line"><span class="language-javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">              fn.<span class="title function_">call</span>(context, ...arg);</span></span><br><span class="line"><span class="language-javascript">            &#125;, delay);</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 节流 一段delay时间出发多次，只执行一次 ,fristTrigger 第一次执行  最后一次执行</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">fn, delay, fristTrigger = <span class="literal">false</span></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> timer = <span class="literal">null</span>; <span class="comment">// 定时器默认为null</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> last = <span class="number">0</span>; <span class="comment">// 最后一次时间戳默认为0</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...arg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> context = <span class="variable language_">this</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (fristTrigger) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 一定时间内执行第一次</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 当前时间戳 - 之前时间戳 &gt; delay 再执行</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> cur = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (cur - last &gt; delay) &#123;</span></span><br><span class="line"><span class="language-javascript">              fn.<span class="title function_">call</span>(context, ...arg);</span></span><br><span class="line"><span class="language-javascript">              last = cur;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 没有定时器再执行 执行清空定时器 ，一定时间内执行最后一次</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (!timer) &#123;</span></span><br><span class="line"><span class="language-javascript">              timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                timer = <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">                fn.<span class="title function_">call</span>(context, ...arg);</span></span><br><span class="line"><span class="language-javascript">              &#125;, delay);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>面试</category>
      </categories>
      <tags>
        <tag>面试</tag>
      </tags>
  </entry>
  <entry>
    <title>微信小程序</title>
    <url>/2021/03/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/</url>
    <content><![CDATA[<p>1.注册登录 微信公众平台 <a href="https://mp.weixin.qq.com/">https://mp.weixin.qq.com/</a> 设置小程序信息</p>
<p>2.下载微信开发者工具 ：稳定版 Stable Build <a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/stable.html">https://developers.weixin.qq.com/miniprogram/dev/devtools/stable.html</a></p>
<p>3.登录注册好的微信号</p>
<p>4.新建项目 选择对应 AppID</p>
<p>5.使用组件库</p>
<p>使用 weui 首先需要登录微信、设置 app.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;useExtendedLib&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;weui&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>使用 vant 需要设置 project.config.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;packNpmManually&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;packNpmRelationList&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;packageJsonPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./package.json&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;miniprogramNpmDistDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>6.微信开发者代码管理<a href="https://git.weixin.qq.com/">https://git.weixin.qq.com/</a></p>
]]></content>
      <categories>
        <category>小程序</category>
      </categories>
      <tags>
        <tag>微信小程序</tag>
      </tags>
  </entry>
  <entry>
    <title>小程序中的订阅消息与推送消息</title>
    <url>/2022/03/24/%E5%B0%8F%E7%A8%8B%E5%BA%8F/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E4%B8%AD%E7%9A%84%E8%AE%A2%E9%98%85%E6%B6%88%E6%81%AF%E4%B8%8E%E6%8E%A8%E9%80%81%E6%B6%88%E6%81%AF/</url>
    <content><![CDATA[<h3 id="步骤一：获取模板-ID（创建模板）"><a href="#步骤一：获取模板-ID（创建模板）" class="headerlink" title="步骤一：获取模板 ID（创建模板）"></a>步骤一：获取模板 ID（创建模板）</h3><p>在微信公众平台手动配置获取模板 ID：<br>登录 <a href="https://mp.weixin.qq.com/">https://mp.weixin.qq.com</a> 获取模板，如果没有合适的模板，可以申请添加新模板，审核通过后可使用。</p>
<h3 id="步骤二：获取下发权限（提示用户订阅）"><a href="#步骤二：获取下发权限（提示用户订阅）" class="headerlink" title="步骤二：获取下发权限（提示用户订阅）"></a>步骤二：获取下发权限（提示用户订阅）</h3><p>一次性订阅消息、长期订阅消息，详见接口 <a href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/subscribe-message/wx.requestSubscribeMessage.html">wx.requestSubscribeMessage</a></p>
<p>设备订阅消息，详见接口 <a href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/subscribe-message/wx.requestSubscribeDeviceMessage.html">wx.requestSubscribeDeviceMessage</a></p>
<h4 id="订阅消息事件推送"><a href="#订阅消息事件推送" class="headerlink" title="订阅消息事件推送"></a>订阅消息事件推送</h4><p>用户在点击确定订阅后， 可以由微信自动推送给后台<br>需要在后台[开发管理] -&gt; [开发设置] -&gt; [消息推送] 中配置</p>
<p>数据：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;CreateTime&quot;</span><span class="punctuation">:</span><span class="number">1648111936</span><span class="punctuation">,</span><span class="attr">&quot;Event&quot;</span><span class="punctuation">:</span><span class="string">&quot;subscribe_msg_popup_event&quot;</span><span class="punctuation">,</span><span class="attr">&quot;FromUserName&quot;</span><span class="punctuation">:</span><span class="string">&quot;xxx&quot;</span><span class="punctuation">,</span><span class="attr">&quot;List&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;PopupScene&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span><span class="attr">&quot;SubscribeStatusString&quot;</span><span class="punctuation">:</span><span class="string">&quot;accept&quot;</span><span class="punctuation">,</span><span class="attr">&quot;TemplateId&quot;</span><span class="punctuation">:</span><span class="string">&quot;xxx-vmXRthIj1sccsdd8XN-0kTQSj2U&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;MsgType&quot;</span><span class="punctuation">:</span><span class="string">&quot;event&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ToUserName&quot;</span><span class="punctuation">:</span><span class="string">&quot;xxx&quot;</span><span class="punctuation">,</span><span class="attr">&quot;userInfo&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;appId&quot;</span><span class="punctuation">:</span><span class="string">&quot;xxx&quot;</span><span class="punctuation">,</span><span class="attr">&quot;openId&quot;</span><span class="punctuation">:</span><span class="string">&quot;xxx&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="步骤三：调用接口下发订阅消息（推送消息）"><a href="#步骤三：调用接口下发订阅消息（推送消息）" class="headerlink" title="步骤三：调用接口下发订阅消息（推送消息）"></a>步骤三：调用接口下发订阅消息（推送消息）</h3><p>一次性订阅消息、长期订阅消息，详见服务端接口 <a href="https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/subscribe-message/subscribeMessage.send.html">subscribeMessage.send</a></p>
<p>设备订阅消息，详见服务端接口 <a href="https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/hardware-device/hardwareDevice.send.html">hardwareDevice.send</a></p>
<h3 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h3><p>小程序一次订阅只能推送一次</p>
]]></content>
      <categories>
        <category>小程序</category>
      </categories>
      <tags>
        <tag>微信小程序</tag>
      </tags>
  </entry>
  <entry>
    <title>小程序vant组件库使用注意事项</title>
    <url>/2021/11/04/%E5%B0%8F%E7%A8%8B%E5%BA%8F/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%B0%8F%E7%A8%8B%E5%BA%8Fvant%E7%BB%84%E4%BB%B6%E5%BA%93%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/</url>
    <content><![CDATA[<h2 id="在-page-中修改组件内部样式"><a href="#在-page-中修改组件内部样式" class="headerlink" title="在 page 中修改组件内部样式"></a>在 page 中修改组件内部样式</h2><p>wxml <code>custom-class=&quot;van-search-custom-class&quot;</code></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-search</span></span></span><br><span class="line"><span class="tag">  <span class="attr">custom-class</span>=<span class="string">&quot;van-search-custom-class&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; value &#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">input-align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">placeholder</span>=<span class="string">&quot;请输入搜索关键词&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

<p>wxss</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.van-search-custom-class</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f6f6f6</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="selector-class">.van-search__content</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#fff</span> <span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="IndexBar-索引栏"><a href="#IndexBar-索引栏" class="headerlink" title="IndexBar 索引栏"></a>IndexBar 索引栏</h2><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>在一个 page 中通过 if 或 hidden 显示 IndexBar 索引栏组件会导致组件显示有问题</p>
<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>将组件放在单独 page 中通过 nav 跳转</p>
<h2 id="tab-标签页"><a href="#tab-标签页" class="headerlink" title="tab 标签页"></a>tab 标签页</h2><h3 id="组件从隐藏状态切换到显示状态时，底部条位置错误？"><a href="#组件从隐藏状态切换到显示状态时，底部条位置错误？" class="headerlink" title="组件从隐藏状态切换到显示状态时，底部条位置错误？"></a>组件从隐藏状态切换到显示状态时，底部条位置错误？</h3><p>Tabs 组件在挂载时，会获取自身的宽度，并计算出底部条的位置。如果组件一开始处于隐藏状态，则获取到的宽度永远为 0，因此无法展示底部条位置</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>方法一，使用 wx:if 来控制组件展示，使组件重新初始化。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-tabs</span> <span class="attr">wx:if</span>=<span class="string">&quot;show&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>方法二，调用组件的 resize 方法来主动触发重绘。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-tabs</span> <span class="attr">id</span>=<span class="string">&quot;tabs&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="title function_">selectComponent</span>(<span class="string">&#x27;#tabs&#x27;</span>).<span class="title function_">resize</span>();</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>小程序</category>
      </categories>
      <tags>
        <tag>小程序</tag>
        <tag>vant</tag>
      </tags>
  </entry>
  <entry>
    <title>微信小程序常见问题汇总</title>
    <url>/2021/03/09/%E5%B0%8F%E7%A8%8B%E5%BA%8F/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h2 id="自定义-tabbar-字体图标不显示问题"><a href="#自定义-tabbar-字体图标不显示问题" class="headerlink" title="自定义 tabbar 字体图标不显示问题"></a>自定义 tabbar 字体图标不显示问题</h2><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>在 app.wxss 引入了阿里图标导入的样式 iconfont.wxss，但是在自定义 custom-tab-bar 中不显示</p>
<h4 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h4><p>在 custom-tab-bar 的 index.wxss 中导入字体图标样式@import “..&#x2F;styles&#x2F;iconfont.wxss”;</p>
<p>自定义 tabbar 字体图标不显示问题</p>
<h2 id="真机调试-2-0-中无法显示-storage-中的数据"><a href="#真机调试-2-0-中无法显示-storage-中的数据" class="headerlink" title="真机调试 2.0 中无法显示 storage 中的数据"></a>真机调试 2.0 中无法显示 storage 中的数据</h2><h3 id="解决-1"><a href="#解决-1" class="headerlink" title="解决"></a>解决</h3><p>改为真机调试 1.0</p>
<h2 id="小程序-中动态设置-tabbar"><a href="#小程序-中动态设置-tabbar" class="headerlink" title="小程序 中动态设置 tabbar"></a>小程序 中动态设置 tabbar</h2><h4 id="问题-1"><a href="#问题-1" class="headerlink" title="问题"></a>问题</h4><p>项目需求根据权限动态设置 tabbar 中的菜单<br>在自定义 tabbar 中的生命周期中动态设置生命周期中根据权限设置 tabbar 中 data<br>(按 vue 习惯一般都是在 create 中) 但是实际修改中发现怎么 this.setData 都不生效</p>
<h4 id="解决-2"><a href="#解决-2" class="headerlink" title="解决"></a>解决</h4><p>根据这篇文章发现 <a href="https://www.cnblogs.com/hanzhe/p/14709918.html">微信小程序底部实现自定义动态Tabbar</a><br>需要在 tabbar 对应页面中调用 <code>this.getTabBar().setData(tabData)</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// page</span></span><br><span class="line"> <span class="attr">onShow</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getTabBar</span>().<span class="title function_">init</span>();</span><br><span class="line">    <span class="title function_">createDynamicTabBar</span>(<span class="variable language_">this</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 创建动态 TabBar</span></span><br><span class="line"> <span class="keyword">function</span> <span class="title function_">createDynamicTabBar</span>(<span class="params">view</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> newList = [];</span><br><span class="line">  <span class="comment">// ... 权限判断</span></span><br><span class="line">  view.<span class="title function_">getTabBar</span>().<span class="title function_">setData</span>(&#123;</span><br><span class="line">    <span class="attr">list</span>: newList,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="小程序中使用分包"><a href="#小程序中使用分包" class="headerlink" title="小程序中使用分包"></a>小程序中使用分包</h2><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages/basic.html">官方文档</a></p>
<p>app.json</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;subpackages&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;root&quot;</span><span class="punctuation">:</span> <span class="string">&quot;分包名&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pages&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;pages/xxx/xxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>主包或其他分包跳转分包页面</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">wx.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;分包名/pages/xxx/xxx&#x27;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="小程序中使用echarts"><a href="#小程序中使用echarts" class="headerlink" title="小程序中使用echarts"></a>小程序中使用echarts</h2><p><a href="https://github.com/ecomfe/echarts-for-weixin">官方文档</a></p>
<h2 id="Component-构造器构造页面"><a href="#Component-构造器构造页面" class="headerlink" title="Component 构造器构造页面"></a>Component 构造器构造页面</h2><p><a href="https://blog.csdn.net/ssdate/article/details/107034606">参考文档</a><br><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/component.html">官方文档</a></p>
<p>Page 构造器适用于简单的页面。但对于复杂的页面， Page 构造器可能并不好用。</p>
<p>此时，可以使用 Component 构造器来构造页面。 Component 构造器的主要区别是：方法需要放在 methods: { } 里面。</p>
<p>page 的生命周期都放到 methods: { } 里面</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Component</span>(&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="attr">behaviors</span>: [],</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 属性定义 </span></span><br><span class="line">  <span class="attr">properties</span>: &#123;</span><br><span class="line">    <span class="attr">myProperty</span>: &#123; <span class="comment">// 属性名</span></span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">      <span class="attr">value</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">myProperty2</span>: <span class="title class_">String</span> <span class="comment">// 简化的定义方式</span></span><br><span class="line">  &#125;,</span><br><span class="line"> </span><br><span class="line">  <span class="attr">data</span>: &#123;&#125;, <span class="comment">// 私有数据，可用于模板渲染</span></span><br><span class="line"> </span><br><span class="line">  <span class="attr">lifetimes</span>: &#123;</span><br><span class="line">    <span class="comment">// 生命周期函数，可以为函数，或一个在methods段中定义的方法名</span></span><br><span class="line">    <span class="attr">attached</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;,</span><br><span class="line">    <span class="attr">moved</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;,</span><br><span class="line">    <span class="attr">detached</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 生命周期函数，可以为函数，或一个在methods段中定义的方法名</span></span><br><span class="line">  <span class="attr">attached</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;, <span class="comment">// 此处attached的声明会被lifetimes字段中的声明覆盖</span></span><br><span class="line">  <span class="attr">ready</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; &#125;,</span><br><span class="line"> </span><br><span class="line">  <span class="attr">pageLifetimes</span>: &#123;</span><br><span class="line">    <span class="comment">// 组件所在页面的生命周期函数</span></span><br><span class="line">    <span class="attr">show</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;,</span><br><span class="line">    <span class="attr">hide</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;,</span><br><span class="line">    <span class="attr">resize</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"> </span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="attr">onLoad</span>: <span class="keyword">function</span>(<span class="params">options</span>) &#123;</span><br><span class="line">      <span class="comment">// 页面创建时执行</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onPullDownRefresh</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// 下拉刷新时执行</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 事件响应函数</span></span><br><span class="line">    <span class="attr">viewTap</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onMyButtonTap</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">        <span class="comment">// 更新属性和数据的方法与更新页面数据的方法类似</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 内部方法建议以下划线开头</span></span><br><span class="line">    <span class="attr">_myPrivateMethod</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="comment">// 这里将 data.A[0].B 设为 &#x27;myPrivateData&#x27;</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">        <span class="string">&#x27;A[0].B&#x27;</span>: <span class="string">&#x27;myPrivateData&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">_propertyChange</span>: <span class="keyword">function</span>(<span class="params">newVal, oldVal</span>) &#123;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="常见网络错误提示"><a href="#常见网络错误提示" class="headerlink" title="常见网络错误提示"></a>常见网络错误提示</h2><p>请求超时</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;errno&quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">,</span><span class="attr">&quot;errMsg&quot;</span><span class="punctuation">:</span><span class="string">&quot;request:fail timeout&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;errno&quot;</span><span class="punctuation">:</span><span class="number">600001</span><span class="punctuation">,</span><span class="attr">&quot;errMsg&quot;</span><span class="punctuation">:</span><span class="string">&quot;request:fail errcode:-118 cronet_error_code:-118 error_msg:net::ERR_CONNECTION_TIMED_OUT&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>小程序</category>
      </categories>
      <tags>
        <tag>微信小程序</tag>
      </tags>
  </entry>
  <entry>
    <title>排序算法</title>
    <url>/2021/03/04/%E7%AE%97%E6%B3%95/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<h2 id="所有排序方法对比"><a href="#所有排序方法对比" class="headerlink" title="所有排序方法对比"></a>所有排序方法对比</h2><p>十大经典算法排序总结对比：<a href="https://www.cnblogs.com/AlbertP/p/10847627.html">https://www.cnblogs.com/AlbertP/p/10847627.html</a></p>
<p>js 常用的比较排序算法总结： <a href="https://www.cnblogs.com/scode2/p/8809049.html">https://www.cnblogs.com/scode2/p/8809049.html</a></p>
<p>js 常用的比较排序算法总结图示：<a href="https://www.cnblogs.com/eniac12/p/5329396.html#s32">https://www.cnblogs.com/eniac12/p/5329396.html#s32</a></p>
<h2 id="牛客网刷题"><a href="#牛客网刷题" class="headerlink" title="牛客网刷题"></a>牛客网刷题</h2><table>
<thead>
<tr>
<th>名称</th>
<th>运行时间</th>
<th>占用内存</th>
</tr>
</thead>
<tbody><tr>
<td>快速排序</td>
<td>1335ms</td>
<td>60404KB</td>
</tr>
<tr>
<td>冒泡排序</td>
<td>2001ms</td>
<td>7716KB</td>
</tr>
<tr>
<td>插入排序</td>
<td>2001ms</td>
<td>8080KB</td>
</tr>
<tr>
<td>sort 方法</td>
<td>677ms</td>
<td>36724KB</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>算法</category>
      </categories>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>最好用的内网穿透工具合集</title>
    <url>/2021/05/28/%E7%BD%91%E7%BB%9C%E5%BA%94%E7%94%A8/%E6%9C%80%E5%A5%BD%E7%94%A8%E7%9A%84%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E5%90%88%E9%9B%86/</url>
    <content><![CDATA[<h2 id="1、ngrok"><a href="#1、ngrok" class="headerlink" title="1、ngrok"></a><strong>1、ngrok</strong></h2><p>ngrok 是一个反向代理，通过在公共的端点和本地运行的 Web 服务器之间建立一个安全的通道。</p>
<p>官网地址：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//</span>ngrok.com</span><br></pre></td></tr></table></figure>

<p>使用步骤：</p>
<p>（1）进入 ngrok 官网注册账号，并下载 ngrok。</p>
<p>（2）在目标机器上，填写授权码，运行 ngrok。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./ngrok authtoken 授权码</span><br></pre></td></tr></table></figure>

<p>（3）将 HTTP 隧道转发到本地端口 80，如下图，通过外网域名即可访问到本地 80 端口。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./ngrok http 80</span><br></pre></td></tr></table></figure>

<p><img data-src="https://bitbw.top/public/img/my_gallery/f13010897045010bae8241e305d0ce03.png" alt="img"></p>
<h2 id="2、frp"><a href="#2、frp" class="headerlink" title="2、frp"></a><strong>2、frp</strong></h2><p>frp 是一个高性能的反向代理应用，可以帮助您轻松地进行内网穿透，对外网提供服务，支持 tcp, http, https 等协议类型，并且 web 服务支持根据域名进行路由转发。</p>
<p>git 项目地址：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/fatedier/</span>frp</span><br></pre></td></tr></table></figure>

<p>使用步骤：</p>
<p>（1）将 frps 及 frps.ini 放到有公网 IP 的机器上，修改 frps.ini 文件，配置一个名为 ssh 的反向代理：</p>
<figure class="highlight elm"><table><tr><td class="code"><pre><span class="line"># frps.ini[common]bind_<span class="keyword">port</span> = 7000</span><br><span class="line">[ssh]listen_<span class="keyword">port</span>=6000auth_token=123</span><br></pre></td></tr></table></figure>

<p>（2）启动 frps：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">.<span class="regexp">/frps -c ./</span>frps.ini</span><br></pre></td></tr></table></figure>

<p>（3）将 frpc 及 frpc.ini 放到处于内网环境的机器上，修改 frpc.ini 文件，设置 frps 所在服务器的 IP 为 x.x.x.x：</p>
<figure class="highlight elm"><table><tr><td class="code"><pre><span class="line"># frpc.ini[common]server_addr = <span class="number">192.168</span><span class="number">.172</span><span class="number">.131</span>server_<span class="keyword">port</span> = 7000auth_token =123</span><br><span class="line">[ssh]<span class="keyword">type</span> = tcplocal_ip = 127.0.0.1local_port = 22remote_port = 6000</span><br></pre></td></tr></table></figure>

<p>（4）启动 frpc：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">.<span class="regexp">/frpc -c ./</span>frpc.ini</span><br></pre></td></tr></table></figure>

<p>（5）通过 ssh 访问内网服务器，假设用户名为 test：</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">ssh -<span class="selector-tag">p</span> <span class="number">6000</span> test@x<span class="selector-class">.x</span><span class="selector-class">.x</span>.x</span><br></pre></td></tr></table></figure>

<h2 id="3、Sunny-Ngrok"><a href="#3、Sunny-Ngrok" class="headerlink" title="3、Sunny-Ngrok"></a><strong>3、Sunny-Ngrok</strong></h2><p>一条命令解决的外网访问内网问题，无需任何配置，一条命令让外网访问您的内网不再是距离。Ngrok 客户端，支持 Windows、Linux、Mac，提供 python、PHP 等版本。</p>
<p>官网地址：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//</span>www.ngrok.cc</span><br></pre></td></tr></table></figure>

<p>使用步骤：</p>
<p>(1) 开通 http 隧道，设置隧道协议、本地端口等信息。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/ec482ca12b228da6abaff1c73b97f7f1.png" alt="img"></p>
<p>（2）通过隧道 id 启动隧道。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/094a510cb3634d077eba2bb00b0d7b93.png" alt="img"></p>
<p>（3）在公网上访问域名，即可访问到内网的网站。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/ab33b6cb60e1c72327f158a71fe05bc8.png" alt="img"></p>
<h2 id="4、Natapp"><a href="#4、Natapp" class="headerlink" title="4、Natapp"></a><strong>4、Natapp</strong></h2><p>基于 ngrok 的内网映射工具，免费版本提供 http,tcp,udp 全隧道穿透、随机域名&#x2F;随机 TCP,UDP 端口、不定时强制更换域名&#x2F;端口和自定义本地端口。</p>
<p>下载地址：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//</span>natapp.cn</span><br></pre></td></tr></table></figure>

<p>（1）购买隧道，设置隧道协议和本地端口。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/8e5db4e1349fe4ec13ff9d0e3465f4ba.png" alt="img"></p>
<p>（2）下载客户端，到目标主机，运行 natapp。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/4b995772ba9e08262c9a08d4366a5f8c.png" alt="img"></p>
<p>（3）将 natapp 分配的网址复制下来，在浏览器中访问，可以看到内网穿透成功了!</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/5d8e62ea2c422619d66e75b9d6b8265a.png" alt="img"></p>
<h2 id="5、Earthworm-内网穿透"><a href="#5、Earthworm-内网穿透" class="headerlink" title="5、Earthworm 内网穿透"></a><strong>5、Earthworm 内网穿透</strong></h2><p>EW 是一套便携式的网络穿透工具，具有 SOCKS v5 服务架设和端口转发两大核心功能，可在复杂网络环境下完成网络穿透。</p>
<p>支持 Windows、Linux、MacOS、Arm-Linux。</p>
<p>项目地址：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>rootkiter.com/EarthWorm</span><br></pre></td></tr></table></figure>

<p>使用方法：</p>
<p>（1）正向 SOCKS v5 服务器，适用于目标网络边界存在公网 IP 且可任意开监听端口。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./ew -s ssocksd -l 1080</span><br></pre></td></tr></table></figure>

<p>（2）反弹 SOCKS v5 服务器，适用于目标网络边界不存在公网 IP，需要通过反弹方式创建 socks 代理</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">a</span>) 先在一台具有公网 ip 的主机A上运行以下命令： ./ew -s rcsocks -l <span class="number">1080</span> -e <span class="number">8888</span></span><br><span class="line"><span class="attribute">b</span>) 在目标主机B上启动 SOCKS v5 服务 并反弹到公网主机的 <span class="number">8888</span>端口  ./ew -s rssocks -d <span class="number">1.1.1.1</span> -e <span class="number">8888</span></span><br></pre></td></tr></table></figure>

<p>（3）多级级联，适用于多层级的复杂网络环境，将内网深层的服务转发到外网。</p>
<p><img data-src="https://img-blog.csdnimg.cn/img_convert/48304ba5e6f9fe08f3fa1abda7d326ab.png" alt="复制代码"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 二级级联测试用例</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">方式一：利用lcx_tran $ ./ew -s ssocksd  -l 9999 $ ./ew -s lcx_tran -l 1080 -f 127.0.0.1 -g 9999</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">方式二： $ ./ew -s lcx_listen -l 1080 -e 8888 $ ./ew -s ssocksd    -l 9999 $ ./ew -s lcx_slave  -d 127.0.0.1 -e 8888 -f 127.0.0.1 -g 9999</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 三级级联测试用例</span></span></span><br><span class="line"><span class="meta prompt_">  $ </span><span class="language-bash">./ew -s rcsocks -l 1080 -e 8888  $ ./ew -s lcx_slave -d 127.0.0.1 -e 8888 -f 127.0.0.1 -g 9999  $ ./ew -s lcx_listen -l 9999 -e 7777  $ ./ew -s rssocks -d 127.0.0.1 -e 7777</span></span><br></pre></td></tr></table></figure>

<p><img data-src="https://img-blog.csdnimg.cn/img_convert/48304ba5e6f9fe08f3fa1abda7d326ab.png" alt="复制代码"></p>
<h2 id="6、reDuh"><a href="#6、reDuh" class="headerlink" title="6、reDuh"></a><strong>6、reDuh</strong></h2><p>ReDuh 是一个通过 HTTP 协议建立隧道传输各种其他数据的工具，通过在服务器上传 JSP&#x2F;PHP&#x2F;ASP 脚本，就可以轻易地连接到服务器后面的主机。</p>
<p>github 项目地址：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/sensepost/</span>reDuh</span><br></pre></td></tr></table></figure>

<p>（1）上传服务端 jsp 脚本到目标机器</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/dfc158effb2e8b274d87cb0b7c330667.png" alt="img"></p>
<p>（2）使用 reDuh 客户端连接服务端脚本上传后的地址。</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">java -jar reDuhClient.jar http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">172.1</span>/reDuh.jsp</span><br></pre></td></tr></table></figure>

<p><img data-src="https://bitbw.top/public/img/my_gallery/c226988f3c7ec7dcfa8f24e64aefb5c4.png" alt="img"></p>
<h2 id="7、reGeorg"><a href="#7、reGeorg" class="headerlink" title="7、reGeorg"></a><strong>7、reGeorg</strong></h2><p>reGeorg 是 reDuh 的继承者,利用了会话层的 socks5 协议,结合 Proxifier 使用效率会更高。</p>
<p>下载地址：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/sensepost/</span>reGeorg</span><br></pre></td></tr></table></figure>

<p>使用方法：</p>
<p>（1）将 tunnel 脚本（aspx | ashx | jsp | php）上传到 Web 服务器，访问显示“Georg says, ‘All seems fine’“，表示脚本运行正常。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/422517009f797cd1579225320a5700d5.png" alt="img"></p>
<p>（2）在攻击者机器上，启动 reGeorgSocksProxy.py，监听 9999 端口，看到 Checking if Georg is ready，确认正常运行。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/d5f591dfsdeb9c8f9ac427b0d641b42f5a13.png" alt="img"></p>
<h2 id="8、Tunna"><a href="#8、Tunna" class="headerlink" title="8、Tunna"></a><strong>8、Tunna</strong></h2><p>Tunna 是一款神奇的工具，它可以通过 HTTP 封装隧道通信任何 TCP，以及用于绕过防火墙环境中的网络限制。</p>
<p>github 项目地址：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/SECFORCE/</span>Tunna</span><br></pre></td></tr></table></figure>

<p><img data-src="https://bitbw.top/public/img/my_gallery/Tunna6976179aa16eaa0b6cda3dd0fe40e17b.png" alt="img"></p>
<h2 id="9、sSocks"><a href="#9、sSocks" class="headerlink" title="9、sSocks"></a><strong>9、sSocks</strong></h2><p>sSocks 是一个 socks 代理工具套装，可用来开启 socks 代理服务，支持 socks5 验证，支持 IPV6 和 UDP，并提供反向 socks 代理服务，即将远程计算机作为 socks 代理服务端，反弹回本地，极大方便内网的渗透测试。</p>
<p>下载地址：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span>sourceforge.net<span class="regexp">/projects/</span>ssocks/</span><br></pre></td></tr></table></figure>

<p>使用方法：</p>
<p>（1）正向代理</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="string">./ssocksd</span> <span class="params">--bind</span> 192.168.172.131 <span class="params">--port</span> 1234</span><br></pre></td></tr></table></figure>

<p>（2）反向代理</p>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">## 监听<span class="number">6020</span>端口转发到<span class="number">6010.</span>/rcsocks -l <span class="number">6020</span> -p <span class="number">6010</span> -vv</span><br><span class="line">## 反向连接代理主机<span class="number">6010</span>端口./rssocks -s <span class="number">192.168</span><span class="number">.172</span><span class="number">.131</span>:<span class="number">6010</span> -vv</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>网络应用</category>
      </categories>
      <tags>
        <tag>工具使用</tag>
        <tag>网络应用</tag>
      </tags>
  </entry>
  <entry>
    <title>模拟一个MVVM框架-Vue实现思路</title>
    <url>/2019/12/14/Vue/%E6%A8%A1%E6%8B%9F%E4%B8%80%E4%B8%AAMVVM%E6%A1%86%E6%9E%B6-Vue%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF/</url>
    <content><![CDATA[<h2 id="MVVM-框架介绍"><a href="#MVVM-框架介绍" class="headerlink" title="MVVM 框架介绍"></a>MVVM 框架介绍</h2><p>M（Model，模型层 ），<br>V（View，视图层），<br>VM（ViewModel，视图模型，V 与 M 连接的桥梁）</p>
<p>MVVM 框架实现了数据双向绑定<br>当 M 层数据进行修改时，VM 层会监测到变化，并且通知 V 层进行相应的修改<br>修改 V 层则会通知 M 层数据进行修改<br>MVVM 框架实现了视图与模型层的相互解耦<br><img data-src="https://bitbw.top/public/img/my_gallery/Vue%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A%E5%8E%9F%E7%90%86MVVM.png" alt="Vue双向绑定原理MVVM"></p>
<span id="more"></span>

<h2 id="几种双向数据绑定的方式"><a href="#几种双向数据绑定的方式" class="headerlink" title="几种双向数据绑定的方式"></a>几种双向数据绑定的方式</h2><ul>
<li><p>发布-订阅者模式（backbone.js）</p>
<ul>
<li>一般通过 pub、sub 的方式来实现数据和视图的绑定，但是使用起来比较麻烦</li>
</ul>
</li>
<li><p>脏值检查(angular.js)</p>
<ul>
<li>angular.js 是通过脏值检测的方式比对数据是否有变更，来决定是否更新视图。类似于通过定时器轮训检测数据是否发生了改变。</li>
</ul>
</li>
<li><p>数据劫持</p>
<ul>
<li>Vue.js 则是采用数据劫持结合发布者-订阅者模式的方式。通过 Object.defineProperty()来劫持各个属性的 setter，getter，在数据变动时发布消息给订阅者，触发相应的监听回调。<br>注意：vuejs 不兼容 IE8 以以下的版本</li>
</ul>
</li>
</ul>
<p><img data-src="https://bitbw.top/public/img/my_gallery/1576331348832.png" alt="1576331348832"></p>
<h2 id="Vue-实现思路"><a href="#Vue-实现思路" class="headerlink" title="Vue 实现思路"></a>Vue 实现思路</h2><ul>
<li>实现一个 Compiler 模板解析器，能够对模版中的指令和插值表达式进行解析,并且赋予不同的操作</li>
<li>实现一个 Observer 数据监听器，能够对数据对象的所有属性进行监听</li>
<li>实现一个 Watcher 观察者，将 Compile 的解析结果，与 Observer 所观察的对象连接起来，建立关系，在 Observer 观察到对象数据变化时，接收通知，同时更新 DOM</li>
<li>创建一个公共的入口对象，接收初始化的配置并且协调上面三个模块，也就是 vue</li>
</ul>
<p><img data-src="https://bitbw.top/public/img/my_gallery/1576329836998.png" alt="1576329836998"></p>
<h2 id="Complier"><a href="#Complier" class="headerlink" title="Complier"></a>Complier</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Compile(解析器) 专门负责解析模板内容</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Compile</span> &#123;</span><br><span class="line">  <span class="comment">// 接收vue中传进来的el 和 vue实例</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">el, vm</span>) &#123;</span><br><span class="line">    <span class="comment">//判断传入的是dom对象还是选择器</span></span><br><span class="line">    <span class="comment">//根节点对象</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">el</span> = <span class="keyword">typeof</span> el === <span class="string">&quot;string&quot;</span> ? <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(el) : el;</span><br><span class="line">    <span class="comment">//vm实例</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">vm</span> = vm;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">el</span>) &#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 文档碎片化</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="comment">// 1. 把el中所有的子节点都放到内存中</span></span><br><span class="line">      <span class="keyword">let</span> fragement = <span class="variable language_">this</span>.<span class="title function_">nodeFragement</span>(<span class="variable language_">this</span>.<span class="property">el</span>);</span><br><span class="line">      <span class="comment">// console.dir(fragement);</span></span><br><span class="line">      <span class="comment">// 2. 在内存中编译文档碎片</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">compile</span>(fragement);</span><br><span class="line">      <span class="comment">// 3. 把fragement 添加到dom中</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">el</span>.<span class="title function_">appendChild</span>(fragement);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 核心方法</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// 把el中所有的子节点都放到内存中</span></span><br><span class="line">  <span class="title function_">nodeFragement</span>(<span class="params">node</span>) &#123;</span><br><span class="line">    <span class="comment">// 创建一个fragement  fragement 相当于预编译将渲染dom放在内存中进行</span></span><br><span class="line">    <span class="keyword">let</span> fragement = <span class="variable language_">document</span>.<span class="title function_">createDocumentFragment</span>();</span><br><span class="line">    <span class="comment">// 把el的子节点挨个添加到文档碎片中</span></span><br><span class="line">    <span class="keyword">let</span> childNodes = node.<span class="property">childNodes</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">toArray</span>(childNodes).<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 已经将所有节点都添加到文档碎片中</span></span><br><span class="line">      fragement.<span class="title function_">appendChild</span>(item);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> fragement;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 在内存中编译文档碎片</span></span><br><span class="line">  <span class="title function_">compile</span>(<span class="params">fragement</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> childNodes = fragement.<span class="property">childNodes</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">toArray</span>(childNodes).<span class="title function_">forEach</span>(<span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 判断节点是文本节点还是元素节点</span></span><br><span class="line">      <span class="comment">// console.dir(node)</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isElementNode</span>(node)) &#123;</span><br><span class="line">        <span class="comment">// 如果是元素节点</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">compileElementNode</span>(node);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isTextNode</span>(node)) &#123;</span><br><span class="line">        <span class="comment">// 如果是文本节点</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">compileTextNode</span>(node);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 判断节点内是否还有子节点 如果还有就递归排查</span></span><br><span class="line">      <span class="keyword">if</span> (node.<span class="property">childNodes</span> &amp;&amp; node.<span class="property">childNodes</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">compile</span>(node);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 编译元素节点</span></span><br><span class="line">  <span class="title function_">compileElementNode</span>(<span class="params">node</span>) &#123;</span><br><span class="line">    <span class="comment">// console.log(&#x27;编译元素节点&#x27;);</span></span><br><span class="line">    <span class="comment">// console.dir(node);</span></span><br><span class="line">    <span class="comment">// 获取所有属性集合转化数组</span></span><br><span class="line">    <span class="keyword">let</span> attributes = node.<span class="property">attributes</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">toArray</span>(attributes).<span class="title function_">forEach</span>(<span class="function">(<span class="params">attribute</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// console.dir(attribute)</span></span><br><span class="line">      <span class="comment">// 属性名</span></span><br><span class="line">      <span class="keyword">let</span> attributeName = attribute.<span class="property">name</span>;</span><br><span class="line">      <span class="comment">// console.log(attributeName);</span></span><br><span class="line">      <span class="comment">// 属性值</span></span><br><span class="line">      <span class="keyword">let</span> attributeValue = attribute.<span class="property">value</span>;</span><br><span class="line">      <span class="comment">// 判断是否是指令</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isDirective</span>(attributeName)) &#123;</span><br><span class="line">        <span class="keyword">let</span> type = attributeName.<span class="title function_">slice</span>(<span class="number">2</span>);</span><br><span class="line">        <span class="comment">//  判断是否是v-on指令</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isEventDirective</span>(type)) &#123;</span><br><span class="line">          <span class="comment">//使用解析工具 使用解析工具能够更好的解耦</span></span><br><span class="line">          conpileUtils.<span class="title function_">eventConpile</span>(node, <span class="variable language_">this</span>.<span class="property">vm</span>, attributeValue, type);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">//使用解析工具能够更好的解耦</span></span><br><span class="line">          conpileUtils[type](node, <span class="variable language_">this</span>.<span class="property">vm</span>, attributeValue);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 编译文本节点</span></span><br><span class="line">  <span class="title function_">compileTextNode</span>(<span class="params">node</span>) &#123;</span><br><span class="line">    <span class="comment">// console.log(&#x27;编译文本节点&#x27;);</span></span><br><span class="line">    <span class="comment">// 调用conpileUtils插值表达式解析器</span></span><br><span class="line">    conpileUtils.<span class="title function_">mustache</span>(node, <span class="variable language_">this</span>.<span class="property">vm</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 工具方法</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// 转化数组</span></span><br><span class="line">  <span class="title function_">toArray</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">    <span class="comment">// 将伪数组转化为数组</span></span><br><span class="line">    <span class="keyword">return</span> [].<span class="property">slice</span>.<span class="title function_">call</span>(arr);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 判断是否元素节点</span></span><br><span class="line">  <span class="title function_">isElementNode</span>(<span class="params">node</span>) &#123;</span><br><span class="line">    <span class="comment">// nodetype 属性 1元素节点 3文本节点</span></span><br><span class="line">    <span class="keyword">return</span> node.<span class="property">nodeType</span> === <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 判断是否文本节点</span></span><br><span class="line">  <span class="title function_">isTextNode</span>(<span class="params">node</span>) &#123;</span><br><span class="line">    <span class="comment">// nodetype 属性 1元素节点 3文本节点</span></span><br><span class="line">    <span class="keyword">return</span> node.<span class="property">nodeType</span> === <span class="number">3</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//判断是不是v-开头</span></span><br><span class="line">  <span class="title function_">isDirective</span>(<span class="params">attributeName</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> attributeName.<span class="title function_">startsWith</span>(<span class="string">&quot;v-&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 判断是不是on指令事件指令</span></span><br><span class="line">  <span class="title function_">isEventDirective</span>(<span class="params">type</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> type.<span class="title function_">split</span>(<span class="string">&quot;:&quot;</span>)[<span class="number">0</span>] === <span class="string">&quot;on&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * conpile解析工具 能够更好的解耦方便后期维护</span></span><br><span class="line"><span class="comment"> * 把所有跟解析有关的工具就放到这里</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> conpileUtils = &#123;</span><br><span class="line">  <span class="comment">// 把下面的一坨分配到这个工具里</span></span><br><span class="line">  <span class="comment">//   if (type ===&#x27;text&#x27;) &#123;</span></span><br><span class="line">  <span class="comment">//     // document.body.textContent</span></span><br><span class="line">  <span class="comment">//     node.textContent = this.vm.$data[attributeValue]</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">//   if (type ===&#x27;html&#x27;) &#123;</span></span><br><span class="line">  <span class="comment">//     // document.body.innerHTML</span></span><br><span class="line">  <span class="comment">//     node.innerHTML = this.vm.$data[attributeValue]</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">//   if (type ===&#x27;model&#x27;) &#123;</span></span><br><span class="line">  <span class="comment">//     // document.body.innerHTML</span></span><br><span class="line">  <span class="comment">//     node.value = this.vm.$data[attributeValue]</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">// 解析普通指令</span></span><br><span class="line">  <span class="comment">// text</span></span><br><span class="line">  <span class="comment">// expr 就是data中绑定的属性名，也就是v-xxx=的值</span></span><br><span class="line">  <span class="title function_">text</span>(<span class="params">node, vm, expr</span>) &#123;</span><br><span class="line">    node.<span class="property">textContent</span> = <span class="variable language_">this</span>.<span class="title function_">getVmValue</span>(vm, expr);</span><br><span class="line">    <span class="comment">//当值改变时会调用watcher中的updata，updata会调用回调函数并把新旧值作为实参传入</span></span><br><span class="line">    <span class="comment">//使用了订阅者模式每次new Watcher的时候都会讲实例存到Dep.subs中 当值发生改变会统一调用实例的updata方法</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Watcher</span>(vm, expr, <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 拿到新值更新视图</span></span><br><span class="line">      node.<span class="property">textContent</span> = newValue;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// hmtl</span></span><br><span class="line">  <span class="title function_">html</span>(<span class="params">node, vm, expr</span>) &#123;</span><br><span class="line">    node.<span class="property">innerHTML</span> = <span class="variable language_">this</span>.<span class="title function_">getVmValue</span>(vm, expr);</span><br><span class="line">    <span class="comment">//当值改变时会调用watcher中的updata，updata会调用回调函数并把新旧值作为实参传入</span></span><br><span class="line">    <span class="comment">//使用了订阅者模式每次new Watcher的时候都会讲实例存到Dep.subs中 当值发生改变会统一调用实例的updata方法</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Watcher</span>(vm, expr, <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 拿到新值更新视图</span></span><br><span class="line">      node.<span class="property">innerHTML</span> = newValue;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// model</span></span><br><span class="line">  <span class="title function_">model</span>(<span class="params">node, vm, expr</span>) &#123;</span><br><span class="line">    node.<span class="property">value</span> = <span class="variable language_">this</span>.<span class="title function_">getVmValue</span>(vm, expr);</span><br><span class="line">    <span class="keyword">let</span> that = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="comment">// 监听输入框的input事件 当发生改变时就让 vm.$data[expr] = 输入值</span></span><br><span class="line">    node.<span class="title function_">addEventListener</span>(<span class="string">&quot;input&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// 调用setVmValue 方法,对象类型也能设置</span></span><br><span class="line">      that.<span class="title function_">setVmValue</span>(vm, expr, <span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//当值改变时会调用watcher中的updata，updata会调用回调函数并把新旧值作为实参传入</span></span><br><span class="line">    <span class="comment">//使用了订阅者模式每次new Watcher的时候都会讲实例存到Dep.subs中 当值发生改变会统一调用实例的updata方法</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Watcher</span>(vm, expr, <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 拿到新值更新视图</span></span><br><span class="line">      node.<span class="property">value</span> = newValue;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 解析事件指令</span></span><br><span class="line">  <span class="title function_">eventConpile</span>(<span class="params">node, vm, expr, type</span>) &#123;</span><br><span class="line">    <span class="comment">// 分割事件名</span></span><br><span class="line">    <span class="keyword">let</span> eventName = type.<span class="title function_">split</span>(<span class="string">&quot;:&quot;</span>)[<span class="number">1</span>];</span><br><span class="line">    <span class="comment">// 判断是否有methods并且有内部处理的方法</span></span><br><span class="line">    <span class="keyword">let</span> mothod = vm.<span class="property">$methods</span> &amp;&amp; vm.<span class="property">$methods</span>[expr];</span><br><span class="line">    <span class="comment">// 如果有事件名，并且在methods中声明的处理方法再执行下面的操作</span></span><br><span class="line">    <span class="comment">// 要不然bind就会报错 bind只能给函数调用</span></span><br><span class="line">    <span class="keyword">if</span> (eventName &amp;&amp; mothod) &#123;</span><br><span class="line">      <span class="comment">// 给当前节点注册事件，使用vue实例的事件，并且将this指向vue实例</span></span><br><span class="line">      node.<span class="title function_">addEventListener</span>(eventName, vm.<span class="property">$methods</span>[expr].<span class="title function_">bind</span>(vm));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 解析文本节点插值表达式，小胡子语法</span></span><br><span class="line">  <span class="title function_">mustache</span>(<span class="params">node, vm</span>) &#123;</span><br><span class="line">    <span class="comment">// 获取节点的文本内容</span></span><br><span class="line">    <span class="keyword">let</span> text = node.<span class="property">textContent</span>;</span><br><span class="line">    <span class="comment">// console.log(text);</span></span><br><span class="line">    <span class="comment">// 创建一个正则验证 并且将匹配正则的内容分组</span></span><br><span class="line">    <span class="keyword">let</span> reg = <span class="regexp">/\&#123;\&#123;(.+)\&#125;\&#125;/</span>;</span><br><span class="line">    <span class="keyword">if</span> (reg.<span class="title function_">test</span>(text)) &#123;</span><br><span class="line">      <span class="comment">// RegExp.$1可以获取分组的第一组内容</span></span><br><span class="line">      <span class="keyword">let</span> key = <span class="title class_">RegExp</span>.<span class="property">$1</span>;</span><br><span class="line">      <span class="comment">// 配备正则的内容替换为data中的数据</span></span><br><span class="line">      <span class="comment">// 在插值表达式中的数据就是data中的属性名所以紫瑶把key传入getVmValue即可</span></span><br><span class="line">      node.<span class="property">textContent</span> = text.<span class="title function_">replace</span>(reg, <span class="variable language_">this</span>.<span class="title function_">getVmValue</span>(vm, key));</span><br><span class="line">      <span class="comment">//当值改变时会调用watcher中的updata，updata会调用回调函数并把新旧值作为实参传入</span></span><br><span class="line">      <span class="comment">//使用了订阅者模式每次new Watcher的时候都会讲实例存到Dep.subs中 当值发生改变会统一调用实例的updata方法</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">Watcher</span>(vm, key, <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 拿到新值更新视图</span></span><br><span class="line">        node.<span class="property">textContent</span> = text.<span class="title function_">replace</span>(reg, newValue);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 设计一个方法用于解析data中的普通数据类型和复杂数据类型</span></span><br><span class="line">  <span class="title function_">getVmValue</span>(<span class="params">vm, expr</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> data = vm.<span class="property">$data</span>;</span><br><span class="line">    expr.<span class="title function_">split</span>(<span class="string">&quot;.&quot;</span>).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 在这里如果是单纯字符串就只会遍历一次</span></span><br><span class="line">      <span class="comment">// 如果是对象就会遍历两次第一次data会变成key</span></span><br><span class="line">      <span class="comment">// 第二次data就会等于每一项的值</span></span><br><span class="line">      data = data[key];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">setVmValue</span>(<span class="params">vm, expr, value</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> data = vm.<span class="property">$data</span>;</span><br><span class="line">    <span class="keyword">let</span> arr = expr.<span class="title function_">split</span>(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    arr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">key, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 当item不是arr中最后一个的时候</span></span><br><span class="line">      <span class="comment">// debugger</span></span><br><span class="line">      <span class="keyword">if</span> (index &lt; arr.<span class="property">length</span> - <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// 让data变成最后需要设置的对象</span></span><br><span class="line">        data = data[key];</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 是最后一个的时候就是需要设置的属性了</span></span><br><span class="line">        data[key] = value;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Observer"><a href="#Observer" class="headerlink" title="Observer"></a>Observer</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span> = data;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">walk</span>(data);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 核心方法</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="comment">// 遍历data把每个属性或属性中的属性都添加劫持</span></span><br><span class="line">  <span class="title function_">walk</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="comment">// 如果没有data或者data不是一个对象就return， 不需要劫持</span></span><br><span class="line">    <span class="keyword">if</span> (!data || <span class="keyword">typeof</span> data !== <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 遍历属性</span></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(data).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">defineReactive</span>(data, key, data[key]);</span><br><span class="line">      <span class="comment">// 优化:如果data中的数据时对象那就直接用自己在递归劫持一遍</span></span><br><span class="line">      <span class="comment">// 如果就是简单数据类型,进来后会直接return掉</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">walk</span>(data[key]);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 用来劫持的方法</span></span><br><span class="line">  <span class="title function_">defineReactive</span>(<span class="params">data, key, value</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> that = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="comment">// 在每个属性中创建一个dep用来监听数据改变</span></span><br><span class="line">    <span class="keyword">let</span> dep = <span class="keyword">new</span> <span class="title class_">Dep</span>();</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(data, key, &#123;</span><br><span class="line">      <span class="attr">configurable</span>: <span class="literal">true</span>, <span class="comment">//当且仅当该属性为 true 时，该属性描述符才能够被改变</span></span><br><span class="line">      <span class="attr">enumerable</span>: <span class="literal">true</span>, <span class="comment">//当且仅当该属性的为true时，该属性才才能够被遍历（就是被枚举）</span></span><br><span class="line">      <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 如果有Dep.target中不是null</span></span><br><span class="line">        <span class="comment">// 就把Dep.target(watcher)添加到当前的Dep实例的订阅者列表中</span></span><br><span class="line">        <span class="title class_">Dep</span>.<span class="property">target</span> &amp;&amp; dep.<span class="title function_">addSub</span>(<span class="title class_">Dep</span>.<span class="property">target</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;key&#125;</span>属性被访问了`</span>, value);</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">set</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;key&#125;</span>属性被设置了`</span>, newValue);</span><br><span class="line">        value = newValue;</span><br><span class="line">        <span class="comment">//优化:如果新值是个对象就用walk在劫持一遍</span></span><br><span class="line">        <span class="comment">//不是那也不用担心，方法就直接被return了</span></span><br><span class="line">        that.<span class="title function_">walk</span>(newValue);</span><br><span class="line">        <span class="comment">//当值发生改变调用watcher的updata方法,催动视图更新</span></span><br><span class="line">        <span class="comment">//这里使用Dep的通知方法，通知每个订阅者（每个watcher实例）调用自己的updata方法</span></span><br><span class="line">        dep.<span class="title function_">notify</span>();</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Watcher"><a href="#Watcher" class="headerlink" title="Watcher"></a>Watcher</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建一个Watcher 用于关联Observer和Compile</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Watcher</span> &#123;</span><br><span class="line">  <span class="comment">// vm就是vue实例，expr是data中的key，cd是需要执行的回调函数</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">vm, expr, cd</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">vm</span> = vm;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">expr</span> = expr;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cd</span> = cd;</span><br><span class="line">    <span class="comment">// 把当前的watcher 实例存到 Dep.target中</span></span><br><span class="line">    <span class="title class_">Dep</span>.<span class="property">target</span> = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="comment">// getVmValue 会进到observe中的get中 所以在get中就可以访问到 Dep.target</span></span><br><span class="line">    <span class="comment">// 把旧值(初始值)存起来, 在updata中用来对比</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">oldValue</span> = <span class="variable language_">this</span>.<span class="title function_">getVmValue</span>(vm, expr);</span><br><span class="line">    <span class="comment">// 进到get中存储完当前watcher实例后，清空Dep.target方便下次存储</span></span><br><span class="line">    <span class="title class_">Dep</span>.<span class="property">target</span> = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 数据更新调用updata方法</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">upData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> oldValue = <span class="variable language_">this</span>.<span class="property">oldValue</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关于这里为什么是新值,因为调用这个方法就说明数据已经更新了</span></span><br><span class="line"><span class="comment">     * 这里传进来的vm就是更新后的vm了,所以调用getVmValue就拿到新值了</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">let</span> newValue = <span class="variable language_">this</span>.<span class="title function_">getVmValue</span>(<span class="variable language_">this</span>.<span class="property">vm</span>, <span class="variable language_">this</span>.<span class="property">expr</span>);</span><br><span class="line">    <span class="comment">// 如果新值和旧值不相对，就调用cd 回调函数将newValue和oldValue传进去</span></span><br><span class="line">    <span class="keyword">if</span> (newValue !== oldValue) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">cd</span>(newValue, oldValue);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 设计一个方法用于解析data中的普通数据类型和复杂数据类型</span></span><br><span class="line">  <span class="comment">// 将complie中的方法复制过来用</span></span><br><span class="line">  <span class="title function_">getVmValue</span>(<span class="params">vm, expr</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> data = vm.<span class="property">$data</span>;</span><br><span class="line">    expr.<span class="title function_">split</span>(<span class="string">&quot;.&quot;</span>).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 在这里如果是单纯字符串就只会遍历一次</span></span><br><span class="line">      <span class="comment">// 如果是对象就会遍历两次第一次data会变成key</span></span><br><span class="line">      <span class="comment">// 第二次data就会等于每一项的值</span></span><br><span class="line">      data = data[key];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 订阅者、发布者模式</span></span><br><span class="line"><span class="comment"> * 创建一个Dep对象用于管理这个订阅者也就是每个watcher实例</span></span><br><span class="line"><span class="comment"> * 并且在改变后通知每个订阅者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dep</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 用于储存所有订阅者</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">subs</span> = [];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 新增订阅者方法</span></span><br><span class="line">  <span class="title function_">addSub</span>(<span class="params">watcher</span>) &#123;</span><br><span class="line">    <span class="comment">// 新增订阅者放到数组中</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">subs</span>.<span class="title function_">push</span>(watcher);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 通知所有的订阅者更新</span></span><br><span class="line">  <span class="title function_">notify</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">subs</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">sub</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 调用upData方法</span></span><br><span class="line">      sub.<span class="title function_">upData</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="发布-订阅者模式"><a href="#发布-订阅者模式" class="headerlink" title="发布-订阅者模式"></a>发布-订阅者模式</h2><ul>
<li>发布-订阅者模式，也叫观察者模式</li>
<li>它定义了一种一对多的依赖关系，即当一个对象的状态发生改变的时候，所有依赖于它的对象都会得到通知并自动更新，解决了主体对象与观察者之间功能的耦合。</li>
<li>例子：微信公众号<ul>
<li>订阅者：只需要要订阅微信公众号</li>
<li>发布者(公众号):发布新文章的时候，推送给所有订阅者</li>
<li>优点：<ul>
<li>解耦合</li>
<li>订阅者不用每次去查看公众号是否有新的文章</li>
<li>发布者不用关心谁订阅了它，只要给所有订阅者推送即可</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>Dep 中使用的就是发布-订阅者模式</p>
</blockquote>
<h2 id="Vue"><a href="#Vue" class="headerlink" title="Vue"></a>Vue</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建一个类用于 new Vue的实例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Vue</span> &#123;</span><br><span class="line">  <span class="comment">// 构造函数内部接收new实例传过来的对象vm</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">vm</span>) &#123;</span><br><span class="line">    <span class="comment">// 将内部属性通过$属性名挂载</span></span><br><span class="line">    (<span class="variable language_">this</span>.<span class="property">$el</span> = vm.<span class="property">el</span>), (<span class="variable language_">this</span>.<span class="property">$data</span> = vm.<span class="property">data</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$methods</span> = vm.<span class="property">methods</span>;</span><br><span class="line">    <span class="comment">// 调用代理方法</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">agency</span>(<span class="variable language_">this</span>.<span class="property">$data</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">agency</span>(<span class="variable language_">this</span>.<span class="property">$methods</span>);</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Observer</span>(<span class="variable language_">this</span>.<span class="property">$data</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$el</span>) &#123;</span><br><span class="line">      <span class="comment">// new Compile 实例用于解析模板内容</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">Compile</span>(<span class="variable language_">this</span>.<span class="property">$el</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 实现将data，methods中的属性方法代理到vue实例上</span></span><br><span class="line">  <span class="title function_">agency</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(data).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="variable language_">this</span>, key, &#123;</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="comment">// 实际上还是访问data中的数据</span></span><br><span class="line">          <span class="keyword">return</span> data[key];</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">set</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (newValue === data[key]) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 实际上还是修改data中的数据调用observer</span></span><br><span class="line">            data[key] = newValue;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="html"><a href="#html" class="headerlink" title="html"></a>html</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-text</span>=<span class="string">&quot;msg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;car.brand&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-html</span>=<span class="string">&quot;msg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;msg&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;clickFn&quot;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./src/watcher.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./src/observe.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./src/compile.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./src/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">msg</span>: <span class="string">&quot;hello vue111&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">car</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">brand</span>: <span class="string">&quot;宝马&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">          &#125;,</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">clickFn</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 在vue的methods中this应该指向当前实例</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">msg</span> = <span class="string">&quot;哈哈&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">car</span>.<span class="property">brand</span> = <span class="string">&quot;奔驰&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">          &#125;,</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>1.Compile 解析模板时, 模板中挂载的 data 中的数据 ,用到的地方就 注册一个 Watcher （new Watcher）</p>
<p>2.new Watcher 时将自身挂到 Dep.target 上同时将触发 Observer 的一次 get, Observer 的 get 会将判断 Dep 上有无 Watcher 实例，有的话就添加到订阅者 subs 中，然后清空 Dep.target</p>
<p>3.Observer set 方法一但被调用就会触发 dep.notify 方法 发布，notify 方法依次调用 subs（Watcher）的 update 方法 ，更新视图</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/20211019130057.png" alt="image-20211019130049831"></p>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>正则学习笔记</title>
    <url>/2019/05/22/%E6%AD%A3%E5%88%99/%E6%AD%A3%E5%88%99%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="正则学习笔记"><a href="#正则学习笔记" class="headerlink" title="正则学习笔记"></a>正则学习笔记</h1><h2 id="书写规则"><a href="#书写规则" class="headerlink" title="书写规则"></a>书写规则</h2><p>参考：<a href="https://www.w3school.com.cn/jsref/jsref_obj_regexp.asp">https://www.w3school.com.cn/jsref/jsref_obj_regexp.asp</a></p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20200709190842389.png" alt="image-20200708184136181"></p>
<h2 id="元字符"><a href="#元字符" class="headerlink" title="元字符"></a>元字符</h2><p>元字符（Metacharacter）是拥有特殊含义的字符：</p>
<table>
<thead>
<tr>
<th align="left">元字符</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_dot.asp">.</a></td>
<td align="left">查找单个字符，除了换行和行结束符。</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_wordchar.asp">\w</a></td>
<td align="left">查找单词字符。</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_wordchar_non.asp">\W</a></td>
<td align="left">查找非单词字符。</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_digit.asp">\d</a></td>
<td align="left">查找数字。</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_digit_non.asp">\D</a></td>
<td align="left">查找非数字字符。</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_whitespace.asp">\s</a></td>
<td align="left">查找空白字符。</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_whitespace_non.asp">\S</a></td>
<td align="left">查找非空白字符。</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_begin.asp">\b</a></td>
<td align="left">匹配单词边界。</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_begin_not.asp">\B</a></td>
<td align="left">匹配非单词边界。</td>
</tr>
<tr>
<td align="left">\0</td>
<td align="left">查找 NUL 字符。</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_newline.asp">\n</a></td>
<td align="left">查找换行符。</td>
</tr>
<tr>
<td align="left">\f</td>
<td align="left">查找换页符。</td>
</tr>
<tr>
<td align="left">\r</td>
<td align="left">查找回车符。</td>
</tr>
<tr>
<td align="left">\t</td>
<td align="left">查找制表符。</td>
</tr>
<tr>
<td align="left">\v</td>
<td align="left">查找垂直制表符。</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_octal.asp">\xxx</a></td>
<td align="left">查找以八进制数 xxx 规定的字符。</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_hex.asp">\xdd</a></td>
<td align="left">查找以十六进制数 dd 规定的字符。</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_unicode_hex.asp">\uxxxx</a></td>
<td align="left">查找以十六进制数 xxxx 规定的 Unicode 字符。</td>
</tr>
</tbody></table>
<h2 id="量词"><a href="#量词" class="headerlink" title="量词"></a>量词</h2><table>
<thead>
<tr>
<th align="left">量词</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_onemore.asp">n+</a></td>
<td align="left">匹配任何包含至少一个 n 的字符串。</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_zeromore.asp">n*</a></td>
<td align="left">匹配任何包含零个或多个 n 的字符串。</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_zeroone.asp">n?</a></td>
<td align="left">匹配任何包含零个或一个 n 的字符串。</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_nx.asp">n{X}</a></td>
<td align="left">匹配包含 X 个 n 的序列的字符串。</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_nxy.asp">n{X,Y}</a></td>
<td align="left">匹配包含 X 至 Y 个 n 的序列的字符串。</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_nxcomma.asp">n{X,}</a></td>
<td align="left">匹配包含至少 X 个 n 的序列的字符串。</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_ndollar.asp">n$</a></td>
<td align="left">匹配任何结尾为 n 的字符串。</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_ncaret.asp">^n</a></td>
<td align="left">匹配任何开头为 n 的字符串。</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_nfollow.asp">?&#x3D;n</a></td>
<td align="left">匹配任何其后紧接指定字符串 n 的字符串。</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_nfollow_not.asp">?!n</a></td>
<td align="left">匹配任何其后没有紧接指定字符串 n 的字符串。</td>
</tr>
</tbody></table>
<blockquote>
<p>量词的影响范围：量词只能默认影响前面一个字符或一个（）中的内容 要影响多个可以配置分组使用</p>
</blockquote>
<h2 id="修饰符"><a href="#修饰符" class="headerlink" title="修饰符"></a>修饰符</h2><table>
<thead>
<tr>
<th align="left">修饰符</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_i.asp">i</a></td>
<td align="left">执行对大小写不敏感的匹配。</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_g.asp">g</a></td>
<td align="left">执行全局匹配（查找所有匹配而非在找到第一个匹配后停止）。</td>
</tr>
<tr>
<td align="left">m</td>
<td align="left">执行多行匹配。</td>
</tr>
</tbody></table>
<h2 id="范围匹配"><a href="#范围匹配" class="headerlink" title="范围匹配"></a>范围匹配</h2><p>方括号用于查找某个范围内的字符：</p>
<table>
<thead>
<tr>
<th align="left">表达式</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">[<a href="https://www.w3school.com.cn/jsref/jsref_regexp_charset.asp">abc]</a></td>
<td align="left">查找方括号之间的任何字符。</td>
</tr>
<tr>
<td align="left">[<a href="https://www.w3school.com.cn/jsref/jsref_regexp_charset_not.asp">^abc]</a></td>
<td align="left">查找任何不在方括号之间的字符。</td>
</tr>
<tr>
<td align="left">[0-9]</td>
<td align="left">查找任何从 0 至 9 的数字。</td>
</tr>
<tr>
<td align="left">[a-z]</td>
<td align="left">查找任何从小写 a 到小写 z 的字符。</td>
</tr>
<tr>
<td align="left">[A-Z]</td>
<td align="left">查找任何从大写 A 到大写 Z 的字符。</td>
</tr>
<tr>
<td align="left">[A-z]</td>
<td align="left">查找任何从大写 A 到小写 z 的字符。</td>
</tr>
<tr>
<td align="left">[adgk]</td>
<td align="left">查找给定集合内的任何字符。</td>
</tr>
<tr>
<td align="left">[^adgk]</td>
<td align="left">查找给定集合外的任何字符。</td>
</tr>
<tr>
<td align="left">(red|blue|green)</td>
<td align="left">查找任何指定的选项。</td>
</tr>
</tbody></table>
<h2 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h2><p>&#x2F;([A-z]\d)+&#x2F;</p>
<h2 id="位置限制"><a href="#位置限制" class="headerlink" title="位置限制"></a>位置限制</h2><p>^ $</p>
<h2 id="范围排除"><a href="#范围排除" class="headerlink" title="范围排除"></a>范围排除</h2><p><img data-src="https://bitbw.top/public/img/my_gallery/image-20200708184136181.png" alt="image-20200709190842389"></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;afcabcaccadc&#x27;</span>.<span class="title function_">match</span>(<span class="regexp">/a[^bfac]c/g</span>) 表示a c 之间排除bfac</span><br><span class="line"><span class="comment">//[&quot;adc&quot;]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>[ ^ ] ^在中括号开始位置时表示排除[ ] 内的字符 注意：在中间就只代表^符号</p>
</blockquote>
<h2 id="多选匹配"><a href="#多选匹配" class="headerlink" title="多选匹配"></a>多选匹配</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">/[a-z]|[A-Z]+/g 匹配小写或大写字母</span><br><span class="line"><span class="string">&#x27;AFAFsdfDsdfDFASDdsfDSFsdfFD&#x27;</span>.<span class="title function_">match</span>(<span class="regexp">/[a-z]|[A-Z]+/g</span>)</span><br><span class="line"><span class="comment">//[&quot;AFAF&quot;, &quot;s&quot;, &quot;d&quot;, &quot;f&quot;, &quot;D&quot;, &quot;s&quot;, &quot;d&quot;, &quot;f&quot;, &quot;DFASD&quot;, &quot;d&quot;, &quot;s&quot;, &quot;f&quot;, &quot;DSF&quot;, &quot;s&quot;, &quot;d&quot;, &quot;f&quot;, &quot;FD&quot;]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>多选匹配分别配置各自的结果 并都返回</p>
</blockquote>
<h2 id="正则方法"><a href="#正则方法" class="headerlink" title="正则方法"></a>正则方法</h2><h3 id="1-test-方法"><a href="#1-test-方法" class="headerlink" title="1. test 方法"></a>1. test 方法</h3><p>返回 true 或 false 验证字符串中有没有符合要求</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">/^<span class="number">1</span>[<span class="number">3</span>-<span class="number">9</span>]\d&#123;<span class="number">9</span>&#125;$/.<span class="title function_">test</span>(<span class="string">&quot;12333333&quot;</span>); <span class="comment">//验证手机号码 false</span></span><br></pre></td></tr></table></figure>

<h3 id="2-exec-提取正则中符合要求的值"><a href="#2-exec-提取正则中符合要求的值" class="headerlink" title="2. exec 提取正则中符合要求的值"></a>2. exec 提取正则中符合要求的值</h3><p>跟<code>str</code>的 match 方法相似 只返回第一次配备的结果 并额外返回两个参数</p>
<p>index:当前匹配结果出现的位置</p>
<p>input：匹配的整个字符串本身</p>
<p><code>RegExp</code>对象属性<code>lastIndex</code>用来标记 exec 方法下次匹配的开始位置</p>
<h4 id="没有全局修饰符-g"><a href="#没有全局修饰符-g" class="headerlink" title="没有全局修饰符 g"></a>没有全局修饰符 g</h4><p><code>lastIndex</code>始终为 0，不会改变</p>
<h4 id="使用全局修饰符-g"><a href="#使用全局修饰符-g" class="headerlink" title="使用全局修饰符 g"></a>使用全局修饰符 g</h4><p>每次匹配之后，会将当前匹配结果后面的字符的所在位置作为<code>lastIndex</code>的值</p>
<p>如果匹配不到结果，<code>lastIndex</code>的值将重置为 0，并且返回结果为 null</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">&quot;afcabcaccadc&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> re = <span class="regexp">/a[^bac]c/g</span>; <span class="comment">//有g的情况</span></span><br><span class="line">re.<span class="property">lastIndex</span>; <span class="comment">//0</span></span><br><span class="line">re.<span class="title function_">exec</span>(str); <span class="comment">// [&quot;afc&quot;, index: 9, input: &quot;afcabcaccadc&quot;, groups: undefined]</span></span><br><span class="line">re.<span class="property">lastIndex</span>; <span class="comment">//3</span></span><br><span class="line">re.<span class="title function_">exec</span>(str); <span class="comment">//[&quot;adc&quot;, index: 9, input: &quot;afcabcaccadc&quot;, groups: undefined]</span></span><br><span class="line">re.<span class="property">lastIndex</span>; <span class="comment">//12</span></span><br><span class="line">re.<span class="title function_">exec</span>(str); <span class="comment">//null</span></span><br><span class="line">re.<span class="property">lastIndex</span>; <span class="comment">//0</span></span><br><span class="line"><span class="keyword">let</span> re1 = <span class="regexp">/a[^bac]c/</span>; <span class="comment">//没有g的情况</span></span><br><span class="line">re1.<span class="property">lastIndex</span>; <span class="comment">//0</span></span><br><span class="line">re1.<span class="title function_">exec</span>(str); <span class="comment">// [&quot;afc&quot;, index: 9, input: &quot;afcabcaccadc&quot;, groups: undefined]</span></span><br><span class="line">re1.<span class="property">lastIndex</span>; <span class="comment">//0</span></span><br><span class="line">re1.<span class="title function_">exec</span>(str); <span class="comment">// [&quot;afc&quot;, index: 9, input: &quot;afcabcaccadc&quot;, groups: undefined]</span></span><br></pre></td></tr></table></figure>

<h2 id="字符串方法"><a href="#字符串方法" class="headerlink" title="字符串方法"></a>字符串方法</h2><h4 id="1-search"><a href="#1-search" class="headerlink" title="1. search"></a>1. search</h4><p>方法用于检索字符串中指定的子字符串，或检索与正则表达式相匹配的子字符串。<br>与 indexOf 方法类似，如果没有找到任何匹配的子串，则返回 -1。</p>
<h4 id="2-match"><a href="#2-match" class="headerlink" title="2. match"></a>2. match</h4><p>match() 方法可在字符串内检索指定的值，或找到一个或多个正则表达式的匹配。</p>
<p>该方法类似 indexOf() 和 lastIndexOf()，但是它返回指定的值，而不是字符串的位置。</p>
<p>语法</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">string</span>Object.match(searchvalue)</span><br><span class="line"><span class="built_in">string</span>Object.match(regexp)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">searchvalue</td>
<td align="left">必需。规定要检索的字符串值。</td>
</tr>
<tr>
<td align="left">regexp</td>
<td align="left">必需。规定要匹配的模式的 RegExp 对象。如果该参数不是 RegExp 对象，则需要首先把它传递给 RegExp 构造函数，将其转换为 RegExp 对象。</td>
</tr>
</tbody></table>
<p>返回值</p>
<p>存放匹配结果的数组。该数组的内容依赖于 regexp 是否具有全局标志 g。</p>
<p>说明</p>
<p>match() 方法将检索字符串 stringObject，以找到一个或多个与 regexp 匹配的文本。这个方法的行为在很大程度上有赖于 regexp 是否具有标志 g。</p>
<p>如果 regexp 没有标志 g，那么 match() 方法就只能在 stringObject 中执行一次匹配。如果没有找到任何匹配的文本， match() 将返回 null。否则，它将返回一个数组，其中存放了与它找到的匹配文本有关的信息。该数组的第 0 个元素存放的是匹配文本，而其余的元素存放的是与正则表达式的子表达式匹配的文本。除了这些常规的数组元素之外，返回的数组还含有两个对象属性。index 属性声明的是匹配文本的起始字符在 stringObject 中的位置，input 属性声明的是对 stringObject 的引用。</p>
<p>如果 regexp 具有标志 g，则 match() 方法将执行全局检索，找到 stringObject 中的所有匹配子字符串。若没有找到任何匹配的子串，则返回 null。如果找到了一个或多个匹配子串，则返回一个数组。不过全局匹配返回的数组的内容与前者大不相同，它的数组元素中存放的是 stringObject 中所有的匹配子串，而且也没有 index 属性或 input 属性。</p>
<p><strong>注意：</strong>在全局检索模式下，match() 即不提供与子表达式匹配的文本的信息，也不声明每个匹配子串的位置。如果您需要这些全局检索的信息，可以使用 RegExp.exec()。</p>
<h4 id="3-replace"><a href="#3-replace" class="headerlink" title="3. replace"></a>3. replace</h4><blockquote>
<ol>
<li>replace <code>stringObject.replace(regexp/substr,replacement)</code> replacement 可以直接写替代字符 也可以时一个函数，函数有四个参数, 函数的第一个参数是匹配到的字符串，如果有分组，接下来的参数就是匹配到的分组。然后是匹配到的字符串的位置，最后是被匹配的字符串。</li>
</ol>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="string">&#x27;&quot;a&quot;, &quot;b&quot;&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">fn</span>: any = <span class="function">(<span class="params">a, b, c, d</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fn:any -&gt; a,b,c,d&quot;</span>, a, b, c, d);</span><br><span class="line">  <span class="comment">//第一次 fn:any -&gt; a,b,c,d &quot;a&quot; a 0 &quot;a&quot;, &quot;b&quot; 第二次fn:any -&gt; a,b,c,d &quot;b&quot; b 5 &quot;a&quot;, &quot;b&quot;</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;&#x27;&quot;</span> + b + <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> a = <span class="string">&#x27;&quot;&#x27;</span> + name.<span class="title function_">replace</span>(<span class="regexp">/&quot;([^&quot;]*)&quot;/g</span>, fn) + <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;created -&gt; a&quot;</span>, a); <span class="comment">//created -&gt; a &quot;&#x27;a&#x27;, &#x27;b&#x27;&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>replacement 中的 $ 字符具有特定的含义。如下表所示，它说明从模式匹配得到的字符串将用于替换。</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">字符</th>
<th align="left">替换文本</th>
</tr>
</thead>
<tbody><tr>
<td align="left">$1、$2、…、$99</td>
<td align="left">与 <code>regexp</code> 中的第 1 到第 99 个子表达式相匹配的文本。</td>
</tr>
<tr>
<td align="left">$&amp;</td>
<td align="left">与 <code>regexp</code> 相匹配的子串。</td>
</tr>
<tr>
<td align="left">$&#96;</td>
<td align="left">位于匹配子串左侧的文本。</td>
</tr>
<tr>
<td align="left">$‘</td>
<td align="left">位于匹配子串右侧的文本。</td>
</tr>
<tr>
<td align="left">$$</td>
<td align="left">直接量符号。</td>
</tr>
</tbody></table>
<h4 id="4-split"><a href="#4-split" class="headerlink" title="4. split"></a>4. split</h4><p>split() 方法用于把一个字符串分割成字符串数组。</p>
<p>语法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">stringObject.<span class="title function_">split</span>(separator, howmany);</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">separator</td>
<td align="left">必需。字符串或正则表达式，从该参数指定的地方分割 stringObject。</td>
</tr>
<tr>
<td align="left">howmany</td>
<td align="left">可选。该参数可指定返回的数组的最大长度。如果设置了该参数，返回的子串不会多于这个参数指定的数组。如果没有设置该参数，整个字符串都会被分割，不考虑它的长度。</td>
</tr>
</tbody></table>
<p><em>separator</em> 是包含子表达式的正则表达式，那么返回的数组中包括与这些子表达式匹配的字串（但不包括与整个正则表达式匹配的文本）</p>
<h2 id="单词边界和空白字符"><a href="#单词边界和空白字符" class="headerlink" title="单词边界和空白字符"></a>单词边界和空白字符</h2><h2 id="RegExp-对象属性"><a href="#RegExp-对象属性" class="headerlink" title="RegExp 对象属性"></a>RegExp 对象属性</h2><table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">描述</th>
<th align="left">FF</th>
<th align="left">IE</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_global.asp">global</a></td>
<td align="left">RegExp 对象是否具有标志 g。</td>
<td align="left">1</td>
<td align="left">4</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_regexp_ignorecase.asp">ignoreCase</a></td>
<td align="left">RegExp 对象是否具有标志 i。</td>
<td align="left">1</td>
<td align="left">4</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_lastindex_regexp.asp">lastIndex</a></td>
<td align="left">一个整数，标示开始下一次匹配的字符位置。</td>
<td align="left">1</td>
<td align="left">4</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_multiline_regexp.asp">multiline</a></td>
<td align="left">RegExp 对象是否具有标志 m。</td>
<td align="left">1</td>
<td align="left">4</td>
</tr>
<tr>
<td align="left"><a href="https://www.w3school.com.cn/jsref/jsref_source_regexp.asp">source</a></td>
<td align="left">正则表达式的源文本。</td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody></table>
<h2 id="应用练习"><a href="#应用练习" class="headerlink" title="应用练习"></a>应用练习</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;sClass b&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;sClass a&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;sClass&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;sClass w&quot;</span>&gt;</span>4<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;sClass&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;sClass&quot;</span>&gt;</span>6<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * <span class="doctag">@description</span>: 根据类名获取元素</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * <span class="doctag">@param</span> &#123;<span class="type">type</span>&#125; sClass 类名</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * <span class="doctag">@param</span> &#123;<span class="type">type</span>&#125; container  查找范围</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * <span class="doctag">@return</span>: 查到的元素 没有返回null</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * <span class="doctag">@author</span>: Seven</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       */</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> <span class="title function_">getByClass</span> = (<span class="params">sClass, container</span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> nodes = (container || <span class="variable language_">document</span>).<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;*&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> node = [].<span class="property">find</span>.<span class="title function_">call</span>(nodes, <span class="keyword">function</span> (<span class="params">el</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">dir</span>(el);</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">let</span> re = <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">`\\b<span class="subst">$&#123;sClass&#125;</span>\\b`</span>);</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (el.<span class="property">className</span>.<span class="title function_">search</span>(re) != -<span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> el;</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> node || <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;classnode&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">dir</span>(<span class="title function_">getByClass</span>(<span class="string">&quot;sClass&quot;</span>));</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> data = [</span></span><br><span class="line"><span class="language-javascript">        &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">title</span>: <span class="string">&quot;国内专利、商标申请双增长&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">content</span>:</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;国家知识产权局新闻发言人胡文辉介绍，今年上半年，我国国内三种类型专利申请219.5万件、商标申请417万件。国内专利&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">title</span>: <span class="string">&quot;国内专利、商标申请双增长&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">content</span>:</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;国家知识产权局新闻发言人胡文辉介绍，今年上半年，我国国内三种类型专利申请219.5万件、商标申请417万件。国内专利&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">title</span>: <span class="string">&quot;国内专利、商标申请双增长&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">content</span>:</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;国家知识产权局新闻发言人胡文辉介绍，今年上半年，我国国内三种类型专利申请219.5万件、商标申请417万件。国内专利&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">title</span>: <span class="string">&quot;国内专利、商标申请双增长&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">content</span>:</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;国家知识产权局新闻发言人胡文辉介绍，今年上半年，我国国内三种类型专利申请219.5万件、商标申请417万件。国内专利&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">      ];</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * <span class="doctag">@description</span>: 模板编译方法</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * <span class="doctag">@param</span> &#123;<span class="type">type</span>&#125; temp 模板dom</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * <span class="doctag">@param</span> &#123;<span class="type">type</span>&#125; data 模板json</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * <span class="doctag">@return</span>: 编译好的模板HTML</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * <span class="doctag">@author</span>: Seven</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       */</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> <span class="title function_">handleTemplate</span> = (<span class="params">temp, datas</span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;handleTemplate -&gt; temp&quot;</span>, temp);</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">dir</span>(temp);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> html = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">        datas.<span class="title function_">forEach</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">let</span> innerHTML = temp.<span class="property">innerHTML</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> data) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (data.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="keyword">let</span> reg = <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">`&#123;&#123;<span class="subst">$&#123;key&#125;</span>&#125;&#125;`</span>);</span></span><br><span class="line"><span class="language-javascript">              innerHTML = innerHTML.<span class="title function_">replace</span>(reg, data[key]);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          html += innerHTML;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;handleTemplate -&gt; html&quot;</span>, html);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> html;</span></span><br><span class="line"><span class="language-javascript">      &#125;;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> tempNode = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;temp&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">getByClass</span>(<span class="string">&quot;container&quot;</span>).<span class="property">innerHTML</span> = <span class="title function_">handleTemplate</span>(tempNode, data);</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/template&quot;</span> <span class="attr">id</span>=<span class="string">&quot;temp&quot;</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><span class="template-variable">&#123;&#123;<span class="name">title</span>&#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="template-variable">&#123;&#123;<span class="name">content</span>&#125;&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">P</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">  </span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="常用的正则"><a href="#常用的正则" class="headerlink" title="常用的正则"></a>常用的正则</h2><blockquote>
<p>vscode 匹配对： 后面的字符进行匹配</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">/:([^]+)$/  <span class="comment">//最少一次</span></span><br><span class="line"><span class="regexp">/:([^]*)$/</span>  <span class="comment">//不限次数</span></span><br><span class="line"><span class="regexp">/:([^]?)*/</span>  <span class="comment">//后面没有字符的请求</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>正则</category>
      </categories>
      <tags>
        <tag>js</tag>
        <tag>正则</tag>
      </tags>
  </entry>
  <entry>
    <title>盘点前端跨平台框架</title>
    <url>/2021/11/15/%E6%A1%86%E6%9E%B6/%E7%9B%98%E7%82%B9%E5%89%8D%E7%AB%AF%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%A1%86%E6%9E%B6/</url>
    <content><![CDATA[<p>暂时引用一下别人总结的 回头自己整理下</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/20211115160328.png" alt="image-20211115160328337"></p>
]]></content>
      <categories>
        <category>框架</category>
      </categories>
      <tags>
        <tag>框架</tag>
      </tags>
  </entry>
  <entry>
    <title>算法学习</title>
    <url>/2021/04/14/%E7%AE%97%E6%B3%95/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<p>b 站教学视频：<a href="https://www.bilibili.com/video/BV1Ry4y1L7CR?p=2">https://www.bilibili.com/video/BV1Ry4y1L7CR?p=2</a></p>
<h2 id="1-认识复杂度和简单排序"><a href="#1-认识复杂度和简单排序" class="headerlink" title="1.认识复杂度和简单排序"></a>1.认识复杂度和简单排序</h2><h3 id="常数"><a href="#常数" class="headerlink" title="常数"></a>常数</h3><p>常数操作<code>+ - * / &gt;&gt; &lt;&lt;</code> 数组的寻址：<code>int a = arr[i]</code> 都属于常数<br>非常数操作：链表的寻址：<code>int b = list.get(i)</code></p>
<h3 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h3><p>选择排序： 从 0 的位置循环对比 将最小的放到 0 的位置， 然后从 1 的位置循环对比 将最小的放到 1 的位置，… 一直到第 N 项</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">selectSort</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> mianIndex = i;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = i + <span class="number">1</span>; j &lt; arr.<span class="property">length</span>; j++) &#123;</span><br><span class="line">      mianIndex = arr[mianIndex] &lt; arr[j] ? mianIndex : j;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">swap</span>(arr, i, mianIndex);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">swap</span>(<span class="params">arr, i, j</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> temp = arr[i];</span><br><span class="line">  arr[i] = arr[j];</span><br><span class="line">  arr[j] = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>时间复杂度 O(N^2)</p>
<p>首先估计 需要进行的常数操作<br>写出常数操作的公式</p>
<figure class="highlight excel"><table><tr><td class="code"><pre><span class="line"> 看： <span class="built_in">N</span>-<span class="number">1</span> + <span class="built_in">N</span>-<span class="number">2</span> + <span class="built_in">N</span>-<span class="number">3</span> ...</span><br><span class="line"> 比较：<span class="built_in">N</span>-<span class="number">1</span> + <span class="built_in">N</span>-<span class="number">2</span> + <span class="built_in">N</span>-<span class="number">3</span> ...</span><br><span class="line"> 交换：<span class="built_in">N</span></span><br><span class="line">= aN^<span class="number">2</span> + bN + c</span><br></pre></td></tr></table></figure>

<p>取最复杂的情况就是<code>aN^2</code>,去掉常数系数<code>a</code>, 使用<code>O()</code>包上就是时间复杂度 <code>O(N^2)</code></p>
<p><code>O(N)</code>优与<code>O(N^2)</code></p>
<p>分析一个算法的好坏、先对比时间复杂度指标、指标相同的情况对比实际运行时间（常数操作时间）</p>
<h4 id="分类："><a href="#分类：" class="headerlink" title="分类："></a>分类：</h4><p>O():代表最差情况的常数操作</p>
<p>θ():代表平均情况</p>
<p>Ω():代表最好情况</p>
<h3 id="冒泡排序："><a href="#冒泡排序：" class="headerlink" title="冒泡排序："></a>冒泡排序：</h3><p>从 0 的位置对比 1 的位置，如果 0 的位置&gt;1 的位置，两个数做交换、继续从 1 的位置对比 2 的位置，…一直到第 N -1 项</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">bubbleSort</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> e = arr.<span class="property">length</span> - <span class="number">1</span>; e &gt; <span class="number">0</span>; e--) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; e; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (arr[i] &gt; arr[i + <span class="number">1</span>]) &#123;</span><br><span class="line">        <span class="title function_">swap</span>(arr, i, i + <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">swap</span>(<span class="params">arr, i, j</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> temp = arr[i];</span><br><span class="line">  arr[i] = arr[j];</span><br><span class="line">  arr[j] = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>时间复杂度 O(N^2)</p>
<h3 id="异或运算"><a href="#异或运算" class="headerlink" title="异或运算"></a>异或运算</h3><table>
<thead>
<tr>
<th>性质</th>
<th>值</th>
</tr>
</thead>
<tbody><tr>
<td>性质 1</td>
<td>0^a &#x3D;&#x3D;&#x3D;a ; a^a&#x3D;&#x3D;&#x3D;0;</td>
</tr>
<tr>
<td>性质 2</td>
<td>a^b &#x3D;&#x3D;&#x3D; b^a; (a^b)^c &#x3D;&#x3D;&#x3D; a^(b^c);</td>
</tr>
<tr>
<td>性质 3</td>
<td>同一组数异或，结果不受先后影响， 一堆数怎么先后异或结果都相同</td>
</tr>
</tbody></table>
<p>使用异或实现 swap 方法(互换两个变量的值)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">swap</span>(<span class="params">arr, i, j</span>) &#123;</span><br><span class="line">  arr[i] = arr[i] ^ arr[i];</span><br><span class="line">  arr[j] = arr[i] ^ arr[i];</span><br><span class="line">  arr[i] = arr[i] ^ arr[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意：这种方式操作的前提要保证 a 和 b 在为内存中两个独立的区域,如果 a 和 b 相同 a 和 b 都会变成 0，为了程序的严谨性不要使用这种方式进行两个变量的交换</strong></p>
<p>实现原理：</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">int <span class="keyword">a</span>=甲；</span><br><span class="line">int b=乙；</span><br><span class="line"><span class="keyword">a</span>=<span class="keyword">a</span>^b;   <span class="comment"> //a=甲^乙           b=乙</span></span><br><span class="line">b=<span class="keyword">a</span>^b;   <span class="comment"> //a=甲^乙           b=乙^甲^乙=0^甲=甲</span></span><br><span class="line"><span class="keyword">a</span>=<span class="keyword">a</span>^b;   <span class="comment"> //a=甲^乙^甲=0^乙=乙 b=甲</span></span><br></pre></td></tr></table></figure>

<h3 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h3><p>给出一个数组，该数组全部为 int 型数据，<br>( 时间复杂度为 O(N),空间复杂度为 O(1) )<br>（1）数组中有一种数为奇数次，其他数为偶数次,求奇数次的数字</p>
<p>思路：把所有数异或 ，最后剩下的肯定是奇数次的数</p>
<p>（2）数组中有两种数为奇数次，其他数为偶数次，求奇数次的数字分别是什么<br>思路：<br>在整型数的 32 位中，他们必然有 1 位不一样，而这位就是它们异或<br>后结果为 1 的那位，我们通过这一位将整个数组分成两份，使其中一份<br>异或就可以得到，两个数其中一个数。再异或它俩的异或结果就可以得<br>到另一个数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 有两个奇数次的变量 a 和 b</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">diffTwo</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> eor = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> arr) &#123;</span><br><span class="line">    eor ^= item;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// eor = a ^ b</span></span><br><span class="line">  <span class="comment">// eor != 0</span></span><br><span class="line">  <span class="comment">// eor 必然有一个位置为1</span></span><br><span class="line">  <span class="keyword">let</span> rightOne = eor &amp; (~eor + <span class="number">1</span>); <span class="comment">// 取出最右侧的1   比如：00000000001</span></span><br><span class="line">  <span class="keyword">let</span> onlyOne = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> arr) &#123;</span><br><span class="line">    <span class="comment">// item  与 00000000001 &amp; 出来的肯定 是最后一位为1的 否则是0</span></span><br><span class="line">    <span class="keyword">if</span> ((item &amp; rightOne) == <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">// onlyOne 不是 a 就是 b</span></span><br><span class="line">      onlyOne ^= item;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// a,b 或者 b,a</span></span><br><span class="line">  <span class="keyword">return</span> [onlyOne, eor ^ onlyOne];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="插入排序"><a href="#插入排序" class="headerlink" title="插入排序"></a>插入排序</h3><p>类似捋牌，从左边第 2 张牌开始，从右往左划到合适的位置插入进去</p>
<p>1-2 是否正确排序：1 的位置和 2 的位置对比是否需要换位，</p>
<ul>
<li>需要换位那就换，然后从 1 向左比较看是否需要换位（因为 1 左没有了所以进入 next）<ul>
<li>需要换位就换位继续向左比较</li>
<li>否者 next</li>
</ul>
</li>
<li>否者 nex</li>
</ul>
<p>2-3 是否正确排序：那从 2 对比 3 的位置，是否需要换位，</p>
<ul>
<li>需要换位那就换，然后从 2 向左比较看是否需要换位<ul>
<li>需要换位就换位继续向左比较</li>
<li>否者 next</li>
</ul>
</li>
<li>否者 next</li>
</ul>
<p>重复操作直到数组最后一位</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 原始代码</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">insertSort</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="comment">// 0 不用管，i负责将指针往右挪</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// j负责将指针往左挪进行对比替换， 一旦i-1的位置大于i位置就替换，并且j-- 继续往左比</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = i - <span class="number">1</span>; j &gt;= <span class="number">0</span> &amp;&amp; arr[j] &gt; arr[j + <span class="number">1</span>]; j--) &#123;</span><br><span class="line">      <span class="title function_">swap</span>(arr, j, j + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 好理解的</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">insertSort</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="comment">// 0 不用管，i负责将指针往右挪</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// j负责将指针往左挪进行对比替换， 一旦j - 1的位置大于j位置就替换，并且j-- 继续往左比</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = i; j &gt; <span class="number">0</span> &amp;&amp; arr[j - <span class="number">1</span>] &gt; arr[j]; j--) &#123;</span><br><span class="line">      <span class="title function_">swap</span>(arr, j, j - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>时间复杂度 O(N^2)，但在数比较顺的情况，性能优于 冒泡和选择</p>
<h3 id="2-分法"><a href="#2-分法" class="headerlink" title="2 分法"></a>2 分法</h3><h4 id="在一个有序数组中看某个数是否存在，"><a href="#在一个有序数组中看某个数是否存在，" class="headerlink" title="在一个有序数组中看某个数是否存在，"></a>在一个有序数组中看某个数是否存在，</h4><p>正常遍历：时间复杂度 O(N)</p>
<p>2 分法: 时间复杂度 O(log2N)</p>
<p>从数组中知道中间位置的数字 与 目标数对比，</p>
<p>小于就在左侧数组中继续使用中间数对比</p>
<p>大于就在右侧数组中继续使用中间数对比</p>
<p>等于就直接返回</p>
<p>log2N 代表 N 的对数： N &#x3D; 8 2^3&#x3D;N log2N &#x3D; 3 相当于只有 3 次常数操作 比 O(N) 更小</p>
<h4 id="在一个有序数组中看某个数的最左侧的位置"><a href="#在一个有序数组中看某个数的最左侧的位置" class="headerlink" title="在一个有序数组中看某个数的最左侧的位置"></a>在一个有序数组中看某个数的最左侧的位置</h4><p>2 分法：</p>
<p>使用中间位置对比目标数</p>
<p>大于或等于都往左找同时使用变量记录下标</p>
<p>小于就回到上回定位的下标的位置往右中间数继续对比</p>
<p>最后剩下两个数后取左边的</p>
<h4 id="局部最小值"><a href="#局部最小值" class="headerlink" title="局部最小值"></a>局部最小值</h4><p>一个无序数组、相邻两数肯定不相等、求 局部最小值，也就是是 i - 1 , i , i + 1 这三个位置上的最小值</p>
<p>2 分法：直接用 2 分一直往左找一定能找到最小值</p>
<p>2 分法判断场景：存在左右两侧可以甩掉一边的场景就可以用 2 分</p>
<h3 id="对数器"><a href="#对数器" class="headerlink" title="对数器"></a>对数器</h3><p>将已有成熟算法跟自己的算法进行 50 万次结果对比看是否都对</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">randomArray</span>(<span class="params">maxSize, maxValue</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> arr = <span class="title class_">Array</span>.<span class="title function_">from</span>(&#123; <span class="attr">length</span>: <span class="built_in">parseInt</span>((maxSize + <span class="number">1</span>) * <span class="title class_">Math</span>.<span class="title function_">random</span>()) &#125;);</span><br><span class="line">  arr.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> (maxValue + <span class="number">1</span>) * <span class="title class_">Math</span>.<span class="title function_">random</span>() - maxValue * <span class="title class_">Math</span>.<span class="title function_">random</span>());</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">comparison</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> testTime = <span class="number">50000</span>;</span><br><span class="line">  <span class="keyword">let</span> maxSize = <span class="number">100</span>;</span><br><span class="line">  <span class="keyword">let</span> maxValue = <span class="number">100</span>;</span><br><span class="line">  <span class="keyword">let</span> flag = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; testTime; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> arr1 = <span class="title function_">randomArray</span>(maxSize, maxValue);</span><br><span class="line">    <span class="keyword">let</span> arr2 = arr1.<span class="title function_">slice</span>();</span><br><span class="line">    <span class="keyword">if</span> (arr1.<span class="title function_">toString</span>() !== arr2.<span class="title function_">toString</span>()) &#123;</span><br><span class="line">      flag = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;comparison OK!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;comparison error!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>算法</category>
      </categories>
      <tags>
        <tag>-算法</tag>
      </tags>
  </entry>
  <entry>
    <title>规范化Git提交日志（Commitizen + husky + Git hooks ）</title>
    <url>/2022/01/14/Git/%E8%A7%84%E8%8C%83%E5%8C%96Git%E6%8F%90%E4%BA%A4%E6%97%A5%E5%BF%97/</url>
    <content><![CDATA[<p>转载自：<a href="https://juejin.cn/post/7038550916106027044">https://juejin.cn/post/7038550916106027044</a></p>
<p>commit message 应该清晰明了，说明本次提交的目的，但是很多人在提交 git 信息的时候，为了图方便，大多都会简单的写一下，开发一时爽，维护火葬场。 清晰且统一的提交风格，有利于团队的协作和后期的维护，本文分享了我们如何通过限制代码提交的规范。</p>
<h1 id="一、配置自己的提交规范"><a href="#一、配置自己的提交规范" class="headerlink" title="一、配置自己的提交规范"></a>一、配置自己的提交规范</h1><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 安装commitizen</span></span><br><span class="line">npm install -g commitizen</span><br><span class="line"></span><br><span class="line"><span class="comment">// commitizen根据不同的`adapter`配置commit message</span></span><br><span class="line">npm install -g cz-conventional-changelog</span><br><span class="line">echo <span class="string">&#x27;&#123; &quot;path&quot;: &quot;cz-conventional-changelog&quot; &#125;&#x27;</span> &gt; ~/.<span class="property">czrc</span></span><br></pre></td></tr></table></figure>

<p>配置完成后，在你本地进入任何的 git repository， 使用 <code>git cz</code> 代替 <code>git commit</code> 都会出现选项，用来生成符合格式的 Commit message，如下图：</p>
<p><img data-src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/88224b4fdeee491faf7beeb3a60a079b~tplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<h1 id="二、自定义提交规范"><a href="#二、自定义提交规范" class="headerlink" title="二、自定义提交规范"></a>二、自定义提交规范</h1><blockquote>
<p>以下讲的式项目中的自定义提交规范，全局配置参考<a href="https://link.juejin.cn/?target=https://blog.csdn.net/weixin_34249367/article/details/88817593">：这篇大佬的文章</a></p>
</blockquote>
<p>自定义提交规范，我们需要用到 <code>cz-customizable</code>。</p>
<blockquote>
<p><code>cz-customizable</code> 和 <code>cz-conventional-changelog</code> 一样，都是 commitize n 的 adapter，但是 <code>cz-customizable</code> 支持一定程度上的自定义</p>
</blockquote>
<ol>
<li><p>安装 <code>npm i cz-customizable --save-dev</code></p>
</li>
<li><p>将以下配置添加到 <code>package.json</code>中</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;config&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;commitizen&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">     <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;node_modules/cz-customizable&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>项目根目录下创建 <code>.cz-config.js</code> 自定义提示文件</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 可选类型</span></span><br><span class="line">  <span class="attr">types</span>:[</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="string">&#x27;feat&#x27;</span>,     <span class="attr">name</span>: <span class="string">&#x27;feat:      新功能&#x27;</span>&#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="string">&#x27;fix&#x27;</span>,      <span class="attr">name</span>: <span class="string">&#x27;fix:       修复&#x27;</span>&#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="string">&#x27;docs&#x27;</span>,     <span class="attr">name</span>: <span class="string">&#x27;docs:      文档变更&#x27;</span>&#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="string">&#x27;style&#x27;</span>,    <span class="attr">name</span>: <span class="string">&#x27;style:     代码格式（不影响代码运行的变动）&#x27;</span>&#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="string">&#x27;refactor&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;refactor:  重构（既不是增加feature）,也不是修复bug&#x27;</span>&#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="string">&#x27;pref&#x27;</span>,     <span class="attr">name</span>: <span class="string">&#x27;pref:      性能优化&#x27;</span>&#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="string">&#x27;test&#x27;</span>,     <span class="attr">name</span>: <span class="string">&#x27;test:      增加测试&#x27;</span>&#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="string">&#x27;chore&#x27;</span>,    <span class="attr">name</span>: <span class="string">&#x27;chore:     构建过程或辅助工具的变动&#x27;</span>&#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="string">&#x27;revert&#x27;</span>,   <span class="attr">name</span>: <span class="string">&#x27;revert:    回退&#x27;</span>&#125;,</span><br><span class="line">    &#123; <span class="attr">value</span>: <span class="string">&#x27;build&#x27;</span>,    <span class="attr">name</span>: <span class="string">&#x27;build:     打包&#x27;</span>&#125;</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 步骤</span></span><br><span class="line">  <span class="attr">messages</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;请选择提交的类型；&#x27;</span>,</span><br><span class="line">    <span class="attr">customScope</span>: <span class="string">&#x27;请输入修改的范围（可选）&#x27;</span>,</span><br><span class="line">    <span class="attr">subject</span>: <span class="string">&#x27;请简要描述提交（必填）&#x27;</span>,</span><br><span class="line">    <span class="attr">body</span>: <span class="string">&#x27;请输入详细描述（可选）&#x27;</span>,</span><br><span class="line">    <span class="attr">footer</span>: <span class="string">&#x27;请选择要关闭的issue（可选）&#x27;</span>,</span><br><span class="line">    <span class="attr">confirmCommit</span>: <span class="string">&#x27;确认要使用以上信息提交？（y/n）&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 跳过步骤</span></span><br><span class="line">  <span class="attr">skip</span>: [<span class="string">&#x27;body&#x27;</span>, <span class="string">&#x27;footer&#x27;</span>],</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 默认长度</span></span><br><span class="line">  <span class="attr">subjectLimit</span>: <span class="number">72</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>此时，我们执行 <code>git cz</code> 的时候即可按照自己配置的规范，进行选项信息的填写，如下图</p>
<p><img data-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b6295ba68b744044b6f25df980c1fc2b~tplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
</li>
</ol>
<h1 id="三、husky-Git-hooks-配置提交校验"><a href="#三、husky-Git-hooks-配置提交校验" class="headerlink" title="三、husky + Git hooks 配置提交校验"></a>三、husky + Git hooks 配置提交校验</h1><ol>
<li>Git Hooks</li>
</ol>
<blockquote>
<p>整体的 hooks 非常多,但是我们用的比较多的其实只有两个</p>
<ol>
<li><code>commit-msg</code><ul>
<li>由 <code>git commit</code> 和 <code>git merge</code> 调用</li>
<li>可以使用 <code>git commit --no-verify</code> 绕过</li>
</ul>
</li>
<li><code>pre-commit</code><ul>
<li>由 <code>git commit</code> 调用</li>
<li>可以使用 <code>git commit --no-verify</code> 绕过</li>
<li>在获取建议的提交日志消息和进行提交之前被调用</li>
</ul>
</li>
</ol>
</blockquote>
<ol>
<li>husky</li>
</ol>
<blockquote>
<p>husky 是一个 Git Hook 工具 husky 的具体使用可以参考<a href="https://link.juejin.cn/?target=https://zhuanlan.zhihu.com/p/366786798">：这篇大佬文章</a></p>
</blockquote>
<h2 id="1、使用-husky-commitlint-检查提交-message-是否符合规范"><a href="#1、使用-husky-commitlint-检查提交-message-是否符合规范" class="headerlink" title="1、使用 husky + commitlint 检查提交 message 是否符合规范"></a>1、使用 <code>husky + commitlint</code> 检查提交 message 是否符合规范</h2><blockquote>
<p>在前面的配置中，我们已经可以实现使用 <code>git cz</code> 调出规范选项，进行规范的 message 的编辑；</p>
<p>但是如果我们忘记使用 <code>git cz</code>, 直接使用了 <code>git commit -m &quot;my commit&quot;</code>, message 信息依然会被提交上去，项目中会出现不规范的提交 message</p>
<p>因此我们需要 husky + commit-msg + commitlint 校验我们的提交信息是否规范。</p>
</blockquote>
<h4 id="安装配置-commitlint"><a href="#安装配置-commitlint" class="headerlink" title="安装配置 commitlint"></a>安装配置 commitlint</h4><ol>
<li><p>安装依赖 <code>npm install --save-dev @commitlint/config-conventional @commitlint/cli</code></p>
</li>
<li><p>创建 <code>commitlint.config.js</code> 文件</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">extends</span>: [<span class="string">&#x27;@commitlint/config-conventional&#x27;</span>],</span><br><span class="line">  <span class="comment">// 定义规则类型</span></span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">    <span class="comment">// type 类型定义，表示 git 提交的 type 必须在以下类型范围内</span></span><br><span class="line">    <span class="string">&#x27;type-enum&#x27;</span>: [</span><br><span class="line">      <span class="number">2</span>,</span><br><span class="line">      <span class="string">&#x27;always&#x27;</span>,</span><br><span class="line">      [</span><br><span class="line">        <span class="string">&#x27;feat&#x27;</span>, <span class="comment">// 新功能</span></span><br><span class="line">        <span class="string">&#x27;fix&#x27;</span>, <span class="comment">//  修复</span></span><br><span class="line">        <span class="string">&#x27;docs&#x27;</span>, <span class="comment">// 文档变更</span></span><br><span class="line">        <span class="string">&#x27;style&#x27;</span>, <span class="comment">// 代码格式（不影响代码运行的变动）</span></span><br><span class="line">        <span class="string">&#x27;refactor&#x27;</span>, <span class="comment">// 重构（既不是增加feature）,也不是修复bug</span></span><br><span class="line">        <span class="string">&#x27;pref&#x27;</span>, <span class="comment">// 性能优化</span></span><br><span class="line">        <span class="string">&#x27;test&#x27;</span>, <span class="comment">// 增加测试</span></span><br><span class="line">        <span class="string">&#x27;chore&#x27;</span>, <span class="comment">// 构建过程或辅助工具的变动</span></span><br><span class="line">        <span class="string">&#x27;revert&#x27;</span>, <span class="comment">// 回退</span></span><br><span class="line">        <span class="string">&#x27;build&#x27;</span> <span class="comment">// 打包</span></span><br><span class="line">      ]</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// subject 大小写不做校验</span></span><br><span class="line">    <span class="string">&#x27;subject-case&#x27;</span>: [<span class="number">0</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：这里这个文件需要保存为 utf-8 的格式，否则可能出现错误</p>
<p><img data-src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6f66c138924240bf815b72ec1501dfa9~tplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
</blockquote>
</li>
</ol>
<h4 id="安装配置-husky"><a href="#安装配置-husky" class="headerlink" title="安装配置 husky"></a>安装配置 husky</h4><ol>
<li><p>安装依赖 <code>npm install husky --save-dev</code></p>
</li>
<li><p>启动 hooks, 生成 .husky 文件夹 <code>npx husky install</code></p>
<p><img data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/10702def9941474795f38e713b964baa~tplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
</li>
<li><p>在 package.json 中生成 prepare 指令 <code>npm set-script prepare &quot;husky install&quot;</code></p>
<blockquote>
<p>注意：这个需要 npm &gt; 7.0 版本 可以使用 <code>npm install -g npm</code> 升版本</p>
</blockquote>
<p><img data-src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e558cf1d6dbb4fd294dc6c8339a75723~tplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
</li>
<li><p>执行 prepare 指令 <code>npm run prepare</code></p>
<p><img data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6cad34a2c7ec4b35b584389b2c28bde3~tplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
</li>
<li><p>添加 commitlint 的 hook 到 husky 中，<code>commit-msg</code> 时进行校验</p>
<p><code>npx husky add .husky/commit-msg &#39;npx --no-install commitlint --edit &quot;$1&quot;&#39;</code></p>
<p>添加完成后： <img data-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6d97921ab22b44f3b17f112ea54a5ae6~tplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
</li>
<li><p>此时，不符合规范的 commit 将不会被允许提交，我们的任务也完成啦！测试如下图：</p>
<p><img data-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9202f5299b1f44ca8f2df2d1a3f9a09c~tplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
</li>
</ol>
<h2 id="2、pre-commit-检验当前代码是否有-ESLint-错误"><a href="#2、pre-commit-检验当前代码是否有-ESLint-错误" class="headerlink" title="2、pre-commit 检验当前代码是否有 ESLint 错误"></a>2、pre-commit 检验当前代码是否有 ESLint 错误</h2><p>我们期望在代码被提交之前，可以执行 <code>npx eslint --ext .js,.ts,.vue src</code> 指令来检测代码是否规范</p>
<h4 id="pre-commit-检测"><a href="#pre-commit-检测" class="headerlink" title="pre-commit 检测"></a>pre-commit 检测</h4><ol>
<li><p>添加 commit 时的 hook，<code>pre-commit</code> 时运行 npx eslint –ext .js,.ts,.vue src</p>
<p><code>npx husky add .husky/pre-commit &quot;npx eslint --ext .js,.ts,.vue src&quot;</code></p>
<p>结果如下图：</p>
<p><img data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/15d3db83d48344d79a847f8f5ebe4818~tplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
</li>
<li><p>此时提交代码，如果项目中有错误，无法提交，想要提交代码，必须解决所有的错误信息</p>
<p><img data-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5524af2ef569450aa04b933a35291bbf~tplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
</li>
</ol>
<h4 id="lint-staged-自动修复格式错误"><a href="#lint-staged-自动修复格式错误" class="headerlink" title="lint-staged 自动修复格式错误"></a>lint-staged 自动修复格式错误</h4><blockquote>
<p><code>lint-staged</code> 可以让你当前的代码检查<strong>只检查本次修改更新的代码，并在出现错误的时候，自动修复并推送</strong></p>
<p><code>lint-staged</code> 无需安装，生成项目时，vue-cli 已经帮我们安装了</p>
</blockquote>
<ol>
<li>修改 <code>package.json</code> 配置</li>
</ol>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="attr">&quot;lint-staged&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;src/**/*.&#123;js,ts,vue&#125;&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="string">&quot;eslint --fix&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;git add .&quot;</span></span><br><span class="line"><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>如上配置，每次它在你本地 commit 之前，校验你所提的内容是否符合你本地配置的 eslint 规则</p>
<ol>
<li>符合规则，提交成功</li>
<li>不符合规则，他会自动执行 <code>eslint --fix</code> 尝试帮你自动修复 2.1 修复成功，则会自动帮你把修复好的代码提交； 2.2 修复失败，提示你错误，让你修复好才可以提交代码；</li>
</ol>
</li>
<li><p>配置 <code>.husky/pre-commit</code> 文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line">. &quot;$(dirname &quot;$0&quot;)/_/husky.sh&quot;</span><br><span class="line"></span><br><span class="line">npx lint-staged</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="commitlint-不支持-emoji-表情怎么办"><a href="#commitlint-不支持-emoji-表情怎么办" class="headerlink" title="commitlint 不支持 emoji 表情怎么办"></a>commitlint 不支持 emoji 表情怎么办</h3><p>不是很完美的解决 可以借鉴下</p>
<p>.cz-config.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">types</span>: [</span><br><span class="line">  &#123; <span class="attr">value</span>: <span class="string">&quot;✨feat&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;feat:      新功能&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">value</span>: <span class="string">&quot;🐛fix&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;fix:       修复&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">value</span>: <span class="string">&quot;📚docs&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;docs:      文档变更&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">value</span>: <span class="string">&quot;💎style&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;style:     代码格式（不影响代码运行的变动）&quot;</span> &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="string">&quot;📦refactor&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;refactor:  重构（既不是增加feature）,也不是修复bug&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">value</span>: <span class="string">&quot;🚀pref&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;pref:      性能优化&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">value</span>: <span class="string">&quot;🚨test&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;test:      增加测试&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">value</span>: <span class="string">&quot;🛠chore&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;chore:     构建过程或辅助工具的变动&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">value</span>: <span class="string">&quot;⚙️revert&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;revert:    回退&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">value</span>: <span class="string">&quot;♻️build&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;build:     打包&quot;</span> &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>commitlint.config.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// extends: [&quot;@commitlint/config-conventional&quot;], 去除基本设置</span></span><br><span class="line">  <span class="comment">// 定义规则类型</span></span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">    <span class="comment">// type 类型定义，表示 git 提交的 type 必须在以下类型范围内</span></span><br><span class="line">    <span class="string">&quot;type-enum&quot;</span>: [</span><br><span class="line">      <span class="number">2</span>,</span><br><span class="line">      <span class="string">&quot;always&quot;</span>,</span><br><span class="line">      [</span><br><span class="line">        <span class="string">&quot;✨feat&quot;</span>, <span class="comment">// 新功能</span></span><br><span class="line">        <span class="string">&quot;🐛fix&quot;</span>, <span class="comment">//  修复</span></span><br><span class="line">        <span class="string">&quot;📚docs&quot;</span>, <span class="comment">// 文档变更</span></span><br><span class="line">        <span class="string">&quot;💎style&quot;</span>, <span class="comment">// 代码格式（不影响代码运行的变动）</span></span><br><span class="line">        <span class="string">&quot;📦refactor&quot;</span>, <span class="comment">// 重构（既不是增加feature）,也不是修复bug</span></span><br><span class="line">        <span class="string">&quot;🚀pref&quot;</span>, <span class="comment">// 性能优化</span></span><br><span class="line">        <span class="string">&quot;🚨test&quot;</span>, <span class="comment">// 增加测试</span></span><br><span class="line">        <span class="string">&quot;🛠chore&quot;</span>, <span class="comment">// 构建过程或辅助工具的变动</span></span><br><span class="line">        <span class="string">&quot;⚙️revert&quot;</span>, <span class="comment">// 回退</span></span><br><span class="line">        <span class="string">&quot;♻️build&quot;</span>, <span class="comment">// 打包</span></span><br><span class="line">      ],</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// subject 大小写不做校验</span></span><br><span class="line">    <span class="string">&quot;subject-case&quot;</span>: [<span class="number">0</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="使用-husky-在-git-commit-时直接使用-commitizen"><a href="#使用-husky-在-git-commit-时直接使用-commitizen" class="headerlink" title="使用 husky 在 git commit 时直接使用 commitizen"></a>使用 husky 在 git commit 时直接使用 commitizen</h3><ol>
<li>安装项目依赖 commitizen</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn add -D commitizen</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>添加 githook</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npx husky add .husky/prepare-commit-msg <span class="string">&quot;exec &lt; /dev/tty &amp;&amp;  node_modules/.bin/cz --hook || true&quot;</span></span><br></pre></td></tr></table></figure>

<p>效果不是很好 不如直接 <code>npx cz</code><br>commitizen 官方： <a href="https://github.com/commitizen/cz-cli#optional-install-and-run-commitizen-locally">https://github.com/commitizen/cz-cli#optional-install-and-run-commitizen-locally</a></p>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>前端工程化</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript的执行上下文，理解JavaScript的作用域链，JavaScript中的this</title>
    <url>/2020/01/15/js/%E8%BD%AC-JavaScript%E7%9A%84%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87/</url>
    <content><![CDATA[<blockquote>
<p>学习了一篇 js 偏底层基础 的文章：JavaScript 的执行上下文 Execution context</p>
<p>我将三篇文章放在一起 最后加了一些自己的总结 和 函数表达式的理解</p>
<p>原文地址：</p>
<p><a href="https://www.cnblogs.com/wilber2013/p/4909430.html#_nav_0">JavaScript 的执行上下文</a></p>
<p><a href="https://www.cnblogs.com/wilber2013/p/4909459.html">理解 JavaScript 的作用域链</a></p>
<p><a href="https://www.cnblogs.com/wilber2013/p/4909505.html#_nav_3">JavaScript 中的 this</a></p>
</blockquote>
<h1 id="JavaScript-的执行上下文"><a href="#JavaScript-的执行上下文" class="headerlink" title="JavaScript 的执行上下文"></a>JavaScript 的执行上下文</h1><p>在 JavaScript 的运行过程中，经常会遇到一些”奇怪”的行为，不理解为什么 JavaScript 会这么工作。</p>
<p>这时候可能就需要了解一下 JavaScript 执行过程中的相关内容了。</p>
<h2 id="执行上下文"><a href="#执行上下文" class="headerlink" title="执行上下文"></a>执行上下文</h2><p>在 JavaScript 中有三种代码运行环境：</p>
<ul>
<li>Global Code<ul>
<li>JavaScript 代码开始运行的默认环境</li>
</ul>
</li>
<li>Function Code<ul>
<li>代码进入一个 JavaScript 函数</li>
</ul>
</li>
<li>Eval Code<ul>
<li>使用 eval()执行代码</li>
</ul>
</li>
</ul>
<p>为了表示不同的运行环境，JavaScript 中有一个<strong>执行上下文（Execution context，EC）</strong>的概念。也就是说，当 JavaScript 代码执行的时候，会进入不同的执行上下文，这些执行上下文就构成了一个<strong>执行上下文栈（Execution context stack，ECS）</strong>。</p>
<p>例如对如下面的 JavaScript 代码：</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">&quot;global var&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="built_in">console</span>.<span class="built_in">log</span>(a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">outerFunc</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> b = <span class="string">&quot;var in outerFunc&quot;</span>;</span><br><span class="line">    <span class="built_in">console</span>.<span class="built_in">log</span>(b);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">innerFunc</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> c = <span class="string">&quot;var in innerFunc&quot;</span>;</span><br><span class="line">        <span class="built_in">console</span>.<span class="built_in">log</span>(c);</span><br><span class="line">        foo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    innerFunc();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">outerFunc()</span><br></pre></td></tr></table></figure>

<p>代码首先进入 Global Execution Context，然后依次进入 outerFunc，innerFunc 和 foo 的执行上下文，执行上下文栈就可以表示为：</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/593627-20151025201151427-127726802.png" alt="img"></p>
<p>当 JavaScript 代码执行的时候，第一个进入的总是默认的 Global Execution Context，所以说它总是在 ECS 的最底部。</p>
<p>对于每个 Execution Context 都有三个重要的属性，变量对象（Variable object，VO），作用域链（Scope chain）和 this。这三个属性跟代码运行的行为有很重要的关系，下面会一一介绍。</p>
<p>当然，除了这三个属性之外，根据实现的需要，Execution Context 还可以有一些附加属性。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/593627-20151025201152849-1821016303.png" alt="img"></p>
<h2 id="VO-和-AO"><a href="#VO-和-AO" class="headerlink" title="VO 和 AO"></a>VO 和 AO</h2><p>从上面看到，在 Execution Context 中，会保存变量对象（Variable object，VO），下面就看看变量对象是什么。</p>
<h3 id="变量对象（Variable-object）"><a href="#变量对象（Variable-object）" class="headerlink" title="变量对象（Variable object）"></a>变量对象（Variable object）</h3><p>变量对象是与执行上下文相关的数据作用域。它是一个与上下文相关的特殊对象，其中存储了在上下文中定义的变量和函数声明。也就是说，一般 VO 中会包含以下信息：</p>
<ul>
<li>变量 (var, Variable Declaration);</li>
<li>函数声明 (Function Declaration, FD);</li>
<li>函数的形参</li>
</ul>
<p>当 JavaScript 代码运行中，如果试图寻找一个变量的时候，就会首先查找 VO。对于前面例子中的代码，Global Execution Context 中的 VO 就可以表示如下：</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/593627-20151025201154239-918576092.png" alt="img"></p>
<p><strong>注意，</strong>假如上面的例子代码中有下面两个语句，Global VO 仍将不变。</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">function</span> bar()&#123;&#125;) <span class="regexp">//</span> <span class="keyword">function</span> expression, FE</span><br><span class="line">baz = <span class="string">&quot;property of global object&quot;</span></span><br></pre></td></tr></table></figure>

<p>也就是说，对于 VO，是有下面两种特殊情况的：</p>
<ul>
<li>函数表达式（与函数声明相对）不包含在 VO 之中</li>
<li>没有使用 var 声明的变量（这种变量是，”全局”的声明方式，只是给 Global 添加了一个属性，并不在 VO 中）</li>
</ul>
<h3 id="活动对象（Activation-object）"><a href="#活动对象（Activation-object）" class="headerlink" title="活动对象（Activation object）"></a>活动对象（Activation object）</h3><p>只有全局上下文的变量对象允许通过 VO 的属性名称间接访问；在函数执行上下文中，VO 是不能直接访问的，此时由激活对象(Activation Object,缩写为 AO)扮演 VO 的角色。激活对象 是在进入函数上下文时刻被创建的，它通过函数的 arguments 属性初始化。</p>
<p>Arguments Objects 是函数上下文里的激活对象 AO 中的内部对象，它包括下列属性：</p>
<ol>
<li>callee：指向当前函数的引用</li>
<li>length： 真正传递的参数的个数</li>
<li>properties-indexes：就是函数的参数值(按参数列表从左到右排列)</li>
</ol>
<p>对于 VO 和 AO 的关系可以理解为，VO 在不同的 Execution Context 中会有不同的表现：当在 Global Execution Context 中，可以直接使用 VO；但是，在函数 Execution Context 中，AO 就会被创建。</p>
<p><img data-src="https://images2015.cnblogs.com/blog/593627/201510/593627-20151025201155177-724394618.png" alt="img"></p>
<p>当上面的例子开始执行 outerFunc 的时候，就会有一个 outerFunc 的 AO 被创建：</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/593627-20151025201156317-195051519.png" alt="img"></p>
<p>通过上面的介绍，我们现在了解了 VO 和 AO 是什么，以及他们之间的关系了。下面就需要看看 JavaScript 解释器是怎么执行一段代码，以及设置 VO 和 AO 了。</p>
<h2 id="细看-Execution-Context"><a href="#细看-Execution-Context" class="headerlink" title="细看 Execution Context"></a>细看 Execution Context</h2><p>当一段 JavaScript 代码执行的时候，JavaScript 解释器会创建 Execution Context，其实这里会有两个阶段：</p>
<ul>
<li>创建阶段（当函数被调用，但是开始执行函数内部代码之前）<ul>
<li>创建 Scope chain</li>
<li>创建 VO&#x2F;AO（variables, functions and arguments）</li>
<li>设置 this 的值</li>
</ul>
</li>
<li>激活&#x2F;代码执行阶段<ul>
<li>设置变量的值、函数的引用，然后解释&#x2F;执行代码</li>
</ul>
</li>
</ul>
<p>这里想要详细介绍一下”创建 VO&#x2F;AO”中的一些细节，因为这些内容将直接影响代码运行的行为。</p>
<p>对于”创建 VO&#x2F;AO”这一步，JavaScript 解释器主要做了下面的事情：</p>
<ul>
<li>根据函数的参数，创建并初始化 arguments object</li>
<li>扫描函数内部代码，查找函数声明（Function declaration）<ul>
<li>对于所有找到的函数声明，将函数名和函数引用存入 VO&#x2F;AO 中</li>
<li><strong>如果 VO&#x2F;AO 中已经有同名的函数，那么就进行覆盖</strong></li>
</ul>
</li>
<li>扫描函数内部代码，查找变量声明（Variable declaration）<ul>
<li>对于所有找到的变量声明，将变量名存入 VO&#x2F;AO 中，并初始化为”undefined”</li>
<li>如果变量名称跟已经声明的形式参数或函数相同，则变量声明不会干扰已经存在的这类属性</li>
</ul>
</li>
</ul>
<p>看下面的例子：</p>
<figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span><span class="params">(i)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line">    <span class="keyword">var</span> b = <span class="keyword">function</span> <span class="title function_">privateB</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">c</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo(<span class="number">22</span>);</span><br></pre></td></tr></table></figure>

<p>对于上面的代码，在”创建阶段”，可以得到下面的 Execution Context object：</p>
<figure class="highlight nestedtext"><table><tr><td class="code"><pre><span class="line"><span class="attribute">fooExecutionContext = &#123;</span></span><br><span class="line"><span class="attribute">    scopeChain</span><span class="punctuation">:</span> <span class="string">&#123; ... &#125;,</span></span><br><span class="line">    <span class="attribute">variableObject</span><span class="punctuation">:</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="attribute">arguments</span><span class="punctuation">:</span> <span class="string">&#123;</span></span><br><span class="line">            <span class="attribute">0</span><span class="punctuation">:</span> <span class="string">22,</span></span><br><span class="line">            <span class="attribute">length</span><span class="punctuation">:</span> <span class="string">1</span></span><br><span class="line">        <span class="attribute">&#125;,</span></span><br><span class="line"><span class="attribute">        i</span><span class="punctuation">:</span> <span class="string">22,</span></span><br><span class="line">        <span class="attribute">c</span><span class="punctuation">:</span> <span class="string">pointer to function c()</span></span><br><span class="line">        <span class="attribute">a</span><span class="punctuation">:</span> <span class="string">undefined,</span></span><br><span class="line">        <span class="attribute">b</span><span class="punctuation">:</span> <span class="string">undefined</span></span><br><span class="line">    <span class="attribute">&#125;,</span></span><br><span class="line"><span class="attribute">    this</span><span class="punctuation">:</span> <span class="string">&#123; ... &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在”激活&#x2F;代码执行阶段”，Execution Context object 就被更新为：</p>
<figure class="highlight nestedtext"><table><tr><td class="code"><pre><span class="line"><span class="attribute">fooExecutionContext = &#123;</span></span><br><span class="line"><span class="attribute">    scopeChain</span><span class="punctuation">:</span> <span class="string">&#123; ... &#125;,</span></span><br><span class="line">    <span class="attribute">variableObject</span><span class="punctuation">:</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="attribute">arguments</span><span class="punctuation">:</span> <span class="string">&#123;</span></span><br><span class="line">            <span class="attribute">0</span><span class="punctuation">:</span> <span class="string">22,</span></span><br><span class="line">            <span class="attribute">length</span><span class="punctuation">:</span> <span class="string">1</span></span><br><span class="line">        <span class="attribute">&#125;,</span></span><br><span class="line"><span class="attribute">        i</span><span class="punctuation">:</span> <span class="string">22,</span></span><br><span class="line">        <span class="attribute">c</span><span class="punctuation">:</span> <span class="string">pointer to function c()</span></span><br><span class="line">        <span class="attribute">a</span><span class="punctuation">:</span> <span class="string">&#x27;hello&#x27;,</span></span><br><span class="line">        <span class="attribute">b</span><span class="punctuation">:</span> <span class="string">pointer to function privateB()</span></span><br><span class="line">    <span class="attribute">&#125;,</span></span><br><span class="line"><span class="attribute">    this</span><span class="punctuation">:</span> <span class="string">&#123; ... &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="例子分析"><a href="#例子分析" class="headerlink" title="例子分析"></a>例子分析</h2><p>前面介绍了 Execution Context，VO&#x2F;AO 等这么多的理论知识，当然是为了方便我们去分析代码中的一些行为。这里，就通过几个简单的例子，结合上面的概念来分析结果。</p>
<h3 id="Example-1"><a href="#Example-1" class="headerlink" title="Example 1"></a>Example 1</h3><p>首先看第一个例子：</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="built_in">console</span>.<span class="built_in">log</span>(bar);</span><br><span class="line">    <span class="built_in">console</span>.<span class="built_in">log</span>(baz);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> bar = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">baz</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="built_in">console</span>.<span class="built_in">log</span>(<span class="string">&quot;baz&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<p>在 Chrome 中运行代码运行后将输出：</p>
<p><img data-src="https://images2015.cnblogs.com/blog/593627/201510/593627-20151025201157161-1227329780.png" alt="img"></p>
<p>代码解释：匿名函数会首先进入”创建结果”，JavaScript 解释器会创建一个”Function Execution Context”，然后创建 Scope chain，VO&#x2F;AO 和 this。根据前面的介绍，解释器会扫描函数和变量声明，如下的 AO 会被创建：</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/593627-20151025201158208-1634029739.png" alt="img"></p>
<p>所以，对于 bar，我们会得到”undefined”这个输出，表现的行为就是，我们在声明一个变量之前就访问了这个变量。这个就是 JavaScript 中”Hoisting”。</p>
<h3 id="Example-2"><a href="#Example-2" class="headerlink" title="Example 2"></a>Example 2</h3><p>接着上面的例子，进行一些修改：</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="built_in">console</span>.<span class="built_in">log</span>(bar);</span><br><span class="line">    <span class="built_in">console</span>.<span class="built_in">log</span>(baz);</span><br><span class="line"></span><br><span class="line">    bar = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">console</span>.<span class="built_in">log</span>(window.bar);</span><br><span class="line">    <span class="built_in">console</span>.<span class="built_in">log</span>(bar);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">baz</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="built_in">console</span>.<span class="built_in">log</span>(<span class="string">&quot;baz&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<p>运行这段代码会得到”bar is not defined(…)”错误。当代码执行到”console.log(bar);”的时候，会去 AO 中查找”bar”。但是，根据前面的解释，函数中的”bar”并没有通过 var 关键字声明，所有不会被存放在 AO 中，也就有了这个错误。</p>
<p>注释掉”console.log(bar);”，再次运行代码，可以得到下面结果。”bar”在”激活&#x2F;代码执行阶段”被创建。</p>
<p><img data-src="https://images2015.cnblogs.com/blog/593627/201510/593627-20151025201158911-154792588.png" alt="img"></p>
<h3 id="Example-3"><a href="#Example-3" class="headerlink" title="Example 3"></a>Example 3</h3><p>现在来看最后一个例子：</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="built_in">console</span>.<span class="built_in">log</span>(foo);</span><br><span class="line">    <span class="built_in">console</span>.<span class="built_in">log</span>(bar);</span><br><span class="line">    <span class="built_in">console</span>.<span class="built_in">log</span>(baz);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> foo = <span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="built_in">console</span>.<span class="built_in">log</span>(<span class="string">&quot;bar&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> bar = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">console</span>.<span class="built_in">log</span>(bar);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">baz</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="built_in">console</span>.<span class="built_in">log</span>(<span class="string">&quot;baz&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<p>代码的运行结果为：</p>
<p><img data-src="/%E8%BD%AC-JavaScript%E7%9A%84%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87/593627-20151025201159786-722939845.png" alt="img"></p>
<p>代码中，最”奇怪”的地方应该就是”bar”的输出了，第一次是一个函数，第二次是”20”。</p>
<p>其实也很好解释，回到前面对”创建 VO&#x2F;AO”的介绍，在创建 VO&#x2F;AO 过程中，解释器会先扫描函数声明，然后”foo: <function>“就被保存在了 AO 中；但解释器扫描变量声明的时候，虽然发现”var bar &#x3D; 20;”，但是因为”foo”在 AO 中已经存在，所以就没有任何操作了。</p>
<p>但是，当代码执行到第二句”console.log(bar);”的时候，”激活&#x2F;代码执行阶段”已经把 AO 中的”bar”重新设置了。</p>
<blockquote>
<p>下面是自己理解的 函数内部上下文执行流程图</p>
</blockquote>
<p>![JavaScript的执行上下文（函数内部的执行流程Execution Context）](<a href="https://bitbw.top/public/img/my_gallery/JavaScript%E7%9A%84%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%EF%BC%88%E5%87%BD%E6%95%B0%E5%86%85%E9%83%A8%E7%9A%84%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8BExecution">https://bitbw.top/public/img/my_gallery/JavaScript的执行上下文（函数内部的执行流程Execution</a> Context）.png)</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文介绍了 JavaScript 中的执行上下文（Execution Context），以及 VO&#x2F;AO 等概念，最后通过几个例子展示了这几个概念对我们了解 JavaScript 代码运行的重要性。</p>
<p>通过对 VO&#x2F;AO 在”创建阶段”的具体细节，如何扫描函数声明和变量声明，就可以对 JavaScript 中的”Hoisting”有清晰的认识。所以说，了解 JavaScript 解释器的行为，以及相关的概念，对理解 JavaScript 代码的行为是很有帮助的。</p>
<p>后面会对 Execution Context 中的 Scope chain 和 this 进行介绍。</p>
<h1 id="理解-JavaScript-的作用域链"><a href="#理解-JavaScript-的作用域链" class="headerlink" title="理解 JavaScript 的作用域链"></a>理解 JavaScript 的作用域链</h1><p>上一篇文章中介绍了 Execution Context 中的三个重要部分：VO&#x2F;AO，scope chain 和 this，并详细的介绍了 VO&#x2F;AO 在 JavaScript 代码执行中的表现。</p>
<p>本文就看看 Execution Context 中的 scope chain。</p>
<h2 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h2><p>开始介绍作用域链之前，先看看 JavaScript 中的作用域（scope）。在很多语言中（C++，C#，Java），作用域都是通过代码块（由{}包起来的代码）来决定的，<strong>但是，在 JavaScript 作用域是跟函数相关的，也可以说成是 function-based。</strong></p>
<p>例如，当 for 循环这个代码块结束后，依然可以访问变量”i”。</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)&#123;</span><br><span class="line">    <span class="built_in">console</span>.<span class="built_in">log</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.<span class="built_in">log</span>(i); <span class="comment">//3</span></span><br></pre></td></tr></table></figure>

<p>对于作用域，又可以分为全局作用域（Global scope）和局部作用域（Local scpoe）。</p>
<p><strong>全局作用域</strong>中的对象可以在代码的任何地方访问，一般来说，下面情况的对象会在全局作用域中：</p>
<ul>
<li>最外层函数和在最外层函数外面定义的变量</li>
<li>没有通过关键字”var”声明的变量</li>
<li>浏览器中，window 对象的属性</li>
</ul>
<p><strong>局部作用域</strong>又被称为函数作用域（Function scope），所有的变量和函数只能在作用域内部使用。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="number">1</span>;</span><br><span class="line"><span class="variable language_">window</span>.<span class="property">bar</span> = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">baz</span>(<span class="params"></span>)&#123;</span><br><span class="line">    a = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">var</span> b = <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Global scope: foo, bar, baz, a</span></span><br><span class="line"><span class="comment">// Local scope: b</span></span><br></pre></td></tr></table></figure>

<h2 id="作用域链"><a href="#作用域链" class="headerlink" title="作用域链"></a>作用域链</h2><p>通过前面一篇文章了解到，每一个 Execution Context 中都有一个 VO，用来存放变量，函数和参数等信息。</p>
<p>在 JavaScript 代码运行中，所有用到的变量都需要去当前 AO&#x2F;VO 中查找，当找不到的时候，就会继续查找上层 Execution Context 中的 AO&#x2F;VO。这样一级级向上查找的过程，就是所有 Execution Context 中的 AO&#x2F;VO 组成了一个作用域链。</p>
<p>所以说，<strong>作用域链</strong>与一个执行上下文相关，是内部上下文所有变量对象（包括父变量对象）的列表，用于变量查询。</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">Scope = VO<span class="regexp">/AO + All Parent VO/</span>AOs</span><br></pre></td></tr></table></figure>

<p>看一个例子：</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> y = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> z = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.<span class="built_in">log</span>(x + y + z);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    bar()</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">foo();</span><br></pre></td></tr></table></figure>

<p>上面代码的输出结果为”60”，函数 bar 可以直接访问”z”，然后通过作用域链访问上层的”x”和”y”。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/593627-20151025202341552-94941711.png" alt="img"></p>
<ul>
<li>绿色箭头指向 VO&#x2F;AO</li>
<li>蓝色箭头指向 scope chain（VO&#x2F;AO + All Parent VO&#x2F;AOs）</li>
</ul>
<p>再看一个比较典型的例子：</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="title">var</span> <span class="class"><span class="keyword">data</span> = [];</span></span><br><span class="line"><span class="title">for</span>(var i = <span class="number">0</span> ; i &lt; <span class="number">3</span>; i++)&#123;</span><br><span class="line">    <span class="class"><span class="keyword">data</span>[i]=function() &#123;</span></span><br><span class="line"><span class="class">        <span class="title">console</span>.<span class="title">log</span>(<span class="title">i</span>);</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">data</span>[0]();// 3</span></span><br><span class="line"><span class="class"><span class="keyword">data</span>[1]();// 3</span></span><br><span class="line"><span class="class"><span class="keyword">data</span>[2]();// 3</span></span><br></pre></td></tr></table></figure>

<p>第一感觉（错觉）这段代码会输出”0，1，2”。但是根据前面的介绍，变量”i”是存放在”Global VO”中的变量，循环结束后”i”的值就被设置为 3，所以代码最后的三次函数调用访问的是相同的”Global VO”中已经被更新的”i”。</p>
<h2 id="结合作用域链看闭包"><a href="#结合作用域链看闭包" class="headerlink" title="结合作用域链看闭包"></a>结合作用域链看闭包</h2><p>在 JavaScript 中，闭包跟作用域链有紧密的关系。相信大家对下面的闭包例子一定非常熟悉，代码中通过闭包实现了一个简单的计数器。</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title">counter</span>() &#123;</span><br><span class="line">    var x = 0;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="type">&#123;</span></span><br><span class="line">        increase: <span class="keyword">function</span> <span class="title">increase</span>() &#123; <span class="keyword">return</span> <span class="type">++x</span>; &#125;,</span><br><span class="line">        decrease: <span class="keyword">function</span> <span class="title">decrease</span>() &#123; <span class="keyword">return</span> <span class="type">--x</span>; &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var ctor = counter();</span><br><span class="line"></span><br><span class="line">console.log(ctor.increase());</span><br><span class="line">console.log(ctor.decrease());</span><br></pre></td></tr></table></figure>

<p>下面我们就通过 Execution Context 和 scope chain 来看看在上面闭包代码执行中到底做了哪些事情。</p>
<p>\1. 当代码进入 Global Context 后，会创建 Global VO</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/593627-20151025202343192-1736899039.png" alt="img"></p>
<ul>
<li>绿色箭头指向 VO&#x2F;AO</li>
<li>蓝色箭头指向 scope chain（VO&#x2F;AO + All Parent VO&#x2F;AOs）</li>
</ul>
<p>\2. 当代码执行到”var cter &#x3D; counter();”语句的时候，进入 counter Execution Context；根据上一篇文章的介绍，这里会创建 counter AO，并设置 counter Execution Context 的 scope chain</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/593627-20151025202345224-1059314508.png" alt="img"></p>
<p>\3. 当 counter 函数执行的最后，并退出的时候，Global VO 中的 ctor 就会被设置；这里需要注意的是，虽然 counter Execution Context 退出了执行上下文栈，但是因为 ctor 中的成员仍然引用 counter AO（因为 counter AO 是 increase 和 decrease 函数的 parent scope），所以 counter AO 依然在 Scope 中。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/593627-20151025202347208-254025968.png" alt="img"></p>
<p>\4. 当执行”ctor.increase()”代码的时候，代码将进入 ctor.increase Execution Context，并为该执行上下文创建 VO&#x2F;AO，scope chain 和设置 this；这时，ctor.increase AO 将指向 counter AO。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/593627-20151025202349224-1554337822.png" alt="img"></p>
<ul>
<li>绿色箭头指向 VO&#x2F;AO</li>
<li>蓝色箭头指向 scope chain（VO&#x2F;AO + All Parent VO&#x2F;AOs）</li>
<li>红色箭头指向 this</li>
<li>黑色箭头指向 parent VO&#x2F;AO</li>
</ul>
<p>相信看到这些，一定会对 JavaScript 闭包有了比较清晰的认识，也了解为什么 counter Execution Context 退出了执行上下文栈，但是 counter AO 没有销毁，可以继续访问。</p>
<h2 id="二维作用域链查找"><a href="#二维作用域链查找" class="headerlink" title="二维作用域链查找"></a>二维作用域链查找</h2><p>通过上面了解到，作用域链（scope chain）的主要作用就是用来进行变量查找。但是，在 JavaScript 中还有原型链（prototype chain）的概念。</p>
<p>由于作用域链和原型链的相互作用，这样就形成了一个二维的查找。</p>
<p>对于这个二维查找可以总结为：<strong>当代码需要查找一个属性（property）或者描述符（identifier）的时候，首先会通过作用域链（scope chain）来查找相关的对象；一旦对象被找到，就会根据对象的原型链（prototype chain）来查找属性（property）</strong>。</p>
<p>下面通过一个例子来看看这个二维查找：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">baz</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">a</span> = <span class="string">&#x27;Set foo.a from prototype&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">inner</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(foo.<span class="property">a</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">baz</span>()();</span><br><span class="line"><span class="comment">// Set bar.a from prototype</span></span><br></pre></td></tr></table></figure>

<p>对于这个例子，可以通过下图进行解释，代码首先通过作用域链（scope chain）查找”foo”，最终在 Global context 中找到；然后因为”foo”中没有找到属性”a”，将继续沿着原型链（prototype chain）查找属性”a”。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/593627-20151025202351395-1888858218.png" alt="img"></p>
<ul>
<li>蓝色箭头表示作用域链查找</li>
<li>橘色箭头表示原型链查找</li>
</ul>
<h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><p>本文介绍了 JavaScript 中的作用域以及作用域链，通过作用域链分析了闭包的执行过程，进一步认识了 JavaScript 的闭包。</p>
<p>同时，结合原型链，演示了 JavaScript 中的描述符和属性的查找。</p>
<p>下一篇我们就看看 Execution Context 中的 this 属性。</p>
<h1 id="JavaScript-中的-this"><a href="#JavaScript-中的-this" class="headerlink" title="JavaScript 中的 this"></a>JavaScript 中的 this</h1><p>前面两篇文章介绍了 JavaScript 执行上下文中两个重要属性：VO&#x2F;AO 和 scope chain。本文就来看看执行上下文中的 this。</p>
<p>首先看看下面两个对 this 的概括：</p>
<ul>
<li><strong>this 是执行上下文（Execution Context）的一个重要属性</strong>，是一个与执行上下文相关的特殊对象。因此，它可以叫作上下文对象（也就是用来指明执行上下文是在哪个上下文中被触发的对象）。</li>
<li><strong>this 不是变量对象（Variable Object）的一个属性</strong>，所以跟变量不同，this 从不会参与到标识符解析过程。也就是说，在代码中当访问 this 的时候，它的值是直接从执行上下文中获取的，并不需要任何作用域链查找。this 的值只在进入上下文的时候进行一次确定。</li>
</ul>
<p>关于 this 最困惑的应该是，同一个函数，当在不同的上下文进行调用的时候，this 的值就可能会不同。也就是说，this 的值是通过函数调用表达式（也就是函数被调用的方式）的 caller 所提供的。</p>
<p>下面就看看在不同场景中，this 的值。</p>
<h2 id="全局上下文"><a href="#全局上下文" class="headerlink" title="全局上下文"></a>全局上下文</h2><p>在全局上下文（Global Context）中，this 总是 global object，在浏览器中就是 window 对象。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span> === <span class="variable language_">window</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;Will&quot;</span>;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">age</span> = <span class="number">28</span>;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">getInfo</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot; is &quot;</span> + <span class="variable language_">this</span>.<span class="property">age</span> + <span class="string">&quot; years old&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">getInfo</span>();</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line"><span class="comment">// Will is 28 years old</span></span><br></pre></td></tr></table></figure>

<h2 id="函数上下文"><a href="#函数上下文" class="headerlink" title="函数上下文"></a>函数上下文</h2><p>在一个函数中，this 的情况就比较多了，this 的值直接受函数调用方式的影响。</p>
<h3 id="Invoke-function-as-Function"><a href="#Invoke-function-as-Function" class="headerlink" title="Invoke function as Function"></a>Invoke function as Function</h3><p>当通过正常的方式调用一个函数的时候，this 的值就会被设置为 global object（浏览器中的 window 对象）。</p>
<p>但是，当使用”strict mode”执行下面代码的时候，this 就会被设置为”undefined”。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">gFunc</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">gFunc</span>());</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span> === <span class="variable language_">window</span>.<span class="title function_">gFunc</span>());</span><br><span class="line"><span class="comment">// window</span></span><br><span class="line"><span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h3 id="Invoke-function-as-Method"><a href="#Invoke-function-as-Method" class="headerlink" title="Invoke function as Method"></a>Invoke function as Method</h3><p>当函数作为一个对象方法来执行的时候，this 的值就是该方法所属的对象。</p>
<p>在下面的例子中，创建了一个 obj 对象，并设置 name 属性的值为”obj”。所以但调用该对象的 func 方法的时候，方法中的 this 就表示 obj 这个对象。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;obj&quot;</span>,</span><br><span class="line">    <span class="attr">func</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span> + <span class="string">&quot;:&quot;</span> + <span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj.<span class="title function_">func</span>();</span><br><span class="line"><span class="comment">// [object Object]:obj</span></span><br></pre></td></tr></table></figure>

<p>为了验证”方法中的 this 代表方法所属的对象”这句话，再看下面一个例子。</p>
<p>在对象 obj 中，创建了一个内嵌对象 nestedObj，当调用内嵌对象的方法的时候，方法中的 this 就代表 nestedObj。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;obj&quot;</span>,</span><br><span class="line">    <span class="attr">nestedObj</span>: &#123;</span><br><span class="line">        <span class="attr">name</span>:<span class="string">&quot;nestedObj&quot;</span>,</span><br><span class="line">        <span class="attr">func</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span> + <span class="string">&quot;:&quot;</span> + <span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.<span class="property">nestedObj</span>.<span class="title function_">func</span>();</span><br><span class="line"><span class="comment">// [object Object]:nestedObj</span></span><br></pre></td></tr></table></figure>

<p>对于上面例子中的方法，通常称为绑定方法，也就是说这些方法都是个特定的对象关联的。</p>
<p>但是，当我们进行下面操作的时候，temp 将是一个全局作用里面的函数，并没有绑定到 obj 对象上。所以，temp 中的 this 表示的是 window 对象。</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">var <span class="type">name</span> = &quot;Will&quot;;</span><br><span class="line">var obj = &#123;</span><br><span class="line">    <span class="type">name</span>: &quot;obj&quot;,</span><br><span class="line">    func: <span class="keyword">function</span> () &#123;</span><br><span class="line">        console.log(this + &quot;:&quot; + this.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">temp</span> = obj.func;</span><br><span class="line"><span class="keyword">temp</span>();</span><br><span class="line">//  [<span class="keyword">object</span> <span class="keyword">Window</span>]:Will</span><br></pre></td></tr></table></figure>

<h3 id="Invoke-function-as-Constructor"><a href="#Invoke-function-as-Constructor" class="headerlink" title="Invoke function as Constructor"></a>Invoke function as Constructor</h3><p>在 JavaScript 中，函数可以作为构造器来直接创建对象，在这种情况下，this 就代表了新建的对象。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Staff</span>(<span class="params">name, age</span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">getInfo</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot; is &quot;</span> + <span class="variable language_">this</span>.<span class="property">age</span> + <span class="string">&quot; years old&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> will = <span class="keyword">new</span> <span class="title class_">Staff</span>(<span class="string">&quot;Will&quot;</span>, <span class="number">28</span>);</span><br><span class="line">will.<span class="title function_">getInfo</span>();</span><br><span class="line"><span class="comment">// Will is 28 years old</span></span><br></pre></td></tr></table></figure>

<h3 id="Invoke-context-less-function"><a href="#Invoke-context-less-function" class="headerlink" title="Invoke context-less function"></a>Invoke context-less function</h3><p>对于有些没有上下文的函数，也就是说这些函数没有绑定到特定的对象上，那么这些上下文无关的函数将会被默认的绑定到 global object 上。</p>
<p>在这个例子中，函数 f 和匿名函数表达式在被调用的过程中并没有被关联到任何对象，所以他们的 this 都代表 global object。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> context = <span class="string">&quot;global&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    <span class="attr">context</span>: <span class="string">&quot;object&quot;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span> + <span class="string">&quot;:&quot;</span> +<span class="variable language_">this</span>.<span class="property">context</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">f</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> context = <span class="string">&quot;function&quot;</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span> + <span class="string">&quot;:&quot;</span> +<span class="variable language_">this</span>.<span class="property">context</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="title function_">f</span>();</span><br><span class="line"></span><br><span class="line">        (<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> context = <span class="string">&quot;function&quot;</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span> + <span class="string">&quot;:&quot;</span> +<span class="variable language_">this</span>.<span class="property">context</span>);</span><br><span class="line">        &#125;)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj.<span class="title function_">method</span>();</span><br><span class="line"><span class="comment">// [object Object]:object</span></span><br><span class="line"><span class="comment">// [object Window]:global</span></span><br><span class="line"><span class="comment">// [object Window]:global</span></span><br></pre></td></tr></table></figure>

<h2 id="call-x2F-apply-x2F-bind-改变-this"><a href="#call-x2F-apply-x2F-bind-改变-this" class="headerlink" title="call&#x2F;apply&#x2F;bind 改变 this"></a>call&#x2F;apply&#x2F;bind 改变 this</h2><p>this 本身是不可变的，但是 JavaScript 中提供了 call&#x2F;apply&#x2F;bind 三个函数来在函数调用时设置 this 的值。</p>
<p>这三个函数的原型如下：</p>
<ul>
<li>fun.apply(obj1 [, argsArray])<ul>
<li>Sets obj1 as the value of this inside fun() and calls fun() passing elements of argsArray as its arguments.</li>
</ul>
</li>
<li>fun.call(obj1 [, arg1 [, arg2 [,arg3 [, …]]]])<ul>
<li>Sets obj1 as the value of this inside fun() and calls fun() passing arg1, arg2, arg3, … as its arguments.</li>
</ul>
</li>
<li>fun.bind(obj1 [, arg1 [, arg2 [,arg3 [, …]]]])<ul>
<li>Returns the reference to the function fun with this inside fun() bound to obj1 and parameters of fun bound to the parameters specified arg1, arg2, arg3, ….</li>
</ul>
</li>
</ul>
<p>下面看一个简单的例子：</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function">function <span class="title">add</span>(<span class="params">numA, numB</span>)</span>&#123;</span><br><span class="line">    console.log( <span class="keyword">this</span>.original + numA + numB);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">add</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;original: <span class="number">10</span>&#125;;</span><br><span class="line"><span class="keyword">add</span>.apply(obj, [<span class="number">1</span>, <span class="number">2</span>]);</span><br><span class="line"><span class="keyword">add</span>.call(obj, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f1 = <span class="keyword">add</span>.bind(obj);</span><br><span class="line">f1(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f2 = <span class="keyword">add</span>.bind(obj, <span class="number">2</span>);</span><br><span class="line">f2(<span class="number">3</span>);</span><br><span class="line"><span class="comment">// NaN</span></span><br><span class="line"><span class="comment">// 13</span></span><br><span class="line"><span class="comment">// 13</span></span><br><span class="line"><span class="comment">// 15</span></span><br><span class="line"><span class="comment">// 15</span></span><br></pre></td></tr></table></figure>

<p>当直接调用 add 函数的时候，this 将代表 window，当执行”this.original”的时候，由于 window 对象并没有”original”属性，所以会得到”undefined”。</p>
<p>通过 call&#x2F;apply&#x2F;bind，达到的效果就是把 add 函数绑定到了 obj 对象上，当调用 add 的时候，this 就代表了 obj 这个对象。</p>
<h2 id="DOM-event-handler"><a href="#DOM-event-handler" class="headerlink" title="DOM event handler"></a>DOM event handler</h2><p>当一个函数被当作 event handler 的时候，this 会被设置为触发事件的页面元素（element）。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> body = <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;body&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">body.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// &lt;body&gt;…&lt;/body&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="In-line-event-handler"><a href="#In-line-event-handler" class="headerlink" title="In-line event handler"></a>In-line event handler</h3><p>当代码通过 in-line handler 执行的时候，this 同样指向拥有该 handler 的页面元素。</p>
<p>看下面的代码：</p>
<figure class="highlight scilab"><table><tr><td class="code"><pre><span class="line">document.write(<span class="string">&#x27;&lt;button onclick=&quot;</span>console.<span class="built_in">log</span>(this)<span class="string">&quot;&gt;Show this&lt;/button&gt;&#x27;</span>);</span><br><span class="line"><span class="comment">// &lt;button onclick=&quot;console.log(this)&quot;&gt;Show this&lt;/button&gt;</span></span><br><span class="line">document.write(<span class="string">&#x27;&lt;button onclick=&quot;</span>(<span class="function"><span class="keyword">function</span><span class="params">()</span>&#123;<span class="title">console</span>.<span class="title">log</span><span class="params">(this)</span>;&#125;)<span class="params">()</span>&quot;&gt;<span class="title">Show</span> <span class="title">this</span>&lt;/<span class="title">button</span>&gt;&#x27;);</span></span><br><span class="line"><span class="comment">// window</span></span><br></pre></td></tr></table></figure>

<p>在第一行代码中，正如上面 in-line handler 所描述的，this 将指向”button”这个 element。但是，对于第二行代码中的匿名函数，是一个上下文无关（context-less）的函数，所以 this 会被默认的设置为 window。</p>
<p>前面我们已经介绍过了 bind 函数，所以，通过下面的修改就能改变上面例子中第二行代码的行为：</p>
<figure class="highlight scilab"><table><tr><td class="code"><pre><span class="line">document.write(<span class="string">&#x27;&lt;button onclick=&quot;</span>((<span class="function"><span class="keyword">function</span><span class="params">()</span>&#123;<span class="title">console</span>.<span class="title">log</span><span class="params">(this)</span>;&#125;).<span class="title">bind</span><span class="params">(this)</span>)<span class="params">()</span>&quot;&gt;<span class="title">Show</span> <span class="title">this</span>&lt;/<span class="title">button</span>&gt;&#x27;);</span></span><br><span class="line"><span class="comment">// &lt;button onclick=&quot;((function()&#123;console.log(this);&#125;).bind(this))()&quot;&gt;Show this&lt;/button&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="保存-this"><a href="#保存-this" class="headerlink" title="保存 this"></a>保存 this</h2><p>在 JavaScript 代码中，同一个上下文中可能会出现多个 this，为了使用外层的 this，就需要对 this 进行暂存了。</p>
<p>看下面的例子，根据前面的介绍，在 body 元素的 click handler 中，this 肯定是指向 body 这个元素，所以为了使用”greeting”这个方法，就是要对指向 bar 对象的 this 进行暂存，这里用了一个 self 变量。</p>
<p>有了 self，我们就可以在 click handler 中使用 bar 对象的”greeting”方法了。</p>
<p>当阅读一些 JavaScript 库代码的时候，如果遇到类似 self，me，that 的时候，他们可能就是对 this 的暂存。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> bar = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;bar&quot;</span>,</span><br><span class="line">    <span class="attr">body</span>: <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;body&quot;</span>)[<span class="number">0</span>],</span><br><span class="line"></span><br><span class="line">    <span class="attr">greeting</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hi there, I&#x27;m &quot;</span> + <span class="variable language_">this</span> + <span class="string">&quot;:&quot;</span> + <span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">anotherMethod</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> self = <span class="variable language_">this</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">body</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            self.<span class="title function_">greeting</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">bar.<span class="title function_">anotherMethod</span>();</span><br><span class="line"><span class="comment">// Hi there, I&#x27;m [object Object]:bar</span></span><br></pre></td></tr></table></figure>

<p>同样，对于上面的例子，也可以使用 bind 来设置 this 达到相同的效果。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> bar = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;bar&quot;</span>,</span><br><span class="line">    <span class="attr">body</span>: <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;body&quot;</span>)[<span class="number">0</span>],</span><br><span class="line"></span><br><span class="line">    <span class="attr">greeting</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hi there, I&#x27;m &quot;</span> + <span class="variable language_">this</span> + <span class="string">&quot;:&quot;</span> + <span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">anotherMethod</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">body</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, (<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">greeting</span>();</span><br><span class="line">        &#125;).<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">bar.<span class="title function_">anotherMethod</span>();</span><br><span class="line"><span class="comment">// Hi there, I&#x27;m [object Object]:bar</span></span><br></pre></td></tr></table></figure>

<h2 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h2><p>本文介绍了执行上下文中的 this 属性，this 的值直接影响着代码的运行结果。</p>
<p>在函数调用中，this 是由激活上下文代码的调用者（caller）来提供的，即调用函数的父上下文(parent context )，也就是说 this 取决于调用函数的方式，指向调用时所在函数所绑定的对象。</p>
<p>通过上面的介绍，相信对 this 有了一定的认识。</p>
<h2 id="自己的话总体总结"><a href="#自己的话总体总结" class="headerlink" title="自己的话总体总结"></a>自己的话总体总结</h2><ul>
<li><p>执行上下文 Execution context 自己的理解就是作用域对象 ：全局作用域 和 局部作用域</p>
<ul>
<li>包含的重要属性：<ul>
<li>变量对象（Variable object，VO）</li>
<li>作用域链（Scope chain）</li>
<li>this</li>
</ul>
</li>
<li>创建阶段（当函数被调用，但是开始执行函数内部代码之前）<ul>
<li>创建 Scope chain</li>
<li>创建 VO&#x2F;AO（variables, functions and arguments）<ul>
<li>扫描函数内部代码，查找函数声明（Function declaration）</li>
<li>扫描函数内部代码，查找变量声明（Variable declaration）包含 函数的形参</li>
</ul>
</li>
<li>设置 this 的值</li>
</ul>
</li>
<li>激活&#x2F;代码执行阶段<ul>
<li>设置变量的值、函数的引用，然后解释&#x2F;执行代码</li>
</ul>
</li>
</ul>
</li>
<li><p>作用域链 scope chain 就是当前作用域的 VO&#x2F;AO 没有的变量，就向上查找 VO&#x2F;AO 一直到全局作用域 Global scope 的 VO</p>
</li>
<li><p>闭包 是作用域链的应用 ：当有下级作用域使用当前作用域内的变量 ，当前作用域执行结束后变量不会被销毁</p>
</li>
<li><p>this 是 当前执行上下文被哪个执行上下文调用 谁调用就指向谁</p>
<ul>
<li>函数直接调用 fn() 指向 全局对象 global 浏览器中是 window</li>
<li>对象调用 obj.fn() 哪个对象调用指向就指向谁</li>
<li>dom 事件 onclick &#x3D; fn 指向对应的 dom</li>
<li>构造函数 new Fn() 指向实例对象</li>
<li>call,bind,apply, fn.call(obj) 第一个参数是谁就指向谁</li>
</ul>
</li>
</ul>
<h1 id="JavaScript-中的函数表达式"><a href="#JavaScript-中的函数表达式" class="headerlink" title="JavaScript 中的函数表达式"></a>JavaScript 中的函数表达式</h1>]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>[转载]node-pre-gyp以及node-gyp的源码简单解析（以安装sqlite3为例）</title>
    <url>/2020/12/13/Nodejs/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/</url>
    <content><![CDATA[<p><a href="https://zhuanlan.zhihu.com/p/330468774">文章原地址</a></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>简单来说，node 是跨平台的，那么对于任何的 node 模块理论也是应该是跨平台的。然而，有些 node 模块直接或间接使用原生 C&#x2F;C++代码，这些东西要跨平台，就需要使用源码根据实际的操作平台环境进行原生模块编译。SQLite3 就是一个经典的原生模块，让我们以安装该模块为例，探索一下安装原生模块的流程。</p>
<h2 id="项目建立"><a href="#项目建立" class="headerlink" title="项目建立"></a>项目建立</h2><p>建立一个简单的 node 项目，我们开始安装<code>SQLite3</code></p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">$ mkdir sqlite3-install-demo</span><br><span class="line">$ cd sqlite3-install-demo</span><br><span class="line">$ npm init</span><br><span class="line"># 初始化项目</span><br><span class="line">Press ^C at any time to quit.</span><br><span class="line">package name: (projects) sqlite3-install-demo</span><br><span class="line">version: (1.0.0)</span><br><span class="line">description:</span><br><span class="line">entry point: (index.js)</span><br><span class="line">test command:</span><br><span class="line">git repository:</span><br><span class="line">keywords:</span><br><span class="line">author:</span><br><span class="line">license: (ISC) MIT</span><br><span class="line">About to write to D:\Projects\package.json:</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;sqlite3-install-demo&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class="line">  &quot;description&quot;: &quot;&quot;,</span><br><span class="line">  &quot;main&quot;: &quot;index.js&quot;,</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;author&quot;: &quot;&quot;,</span><br><span class="line">  &quot;license&quot;: &quot;MIT&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="安装SQLite3"><a href="#安装SQLite3" class="headerlink" title="安装SQLite3"></a>安装<code>SQLite3</code></h2><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">$ npm install -S sqlite3</span><br></pre></td></tr></table></figure>

<p>完成命令执行后，你会看到命令行界面出现了如下的几行<strong>重要</strong>的输出：</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">&gt; sqlite3@5.0.0 install D:\Projects\sqlite3-install-demo\node_modules\sqlite3</span><br><span class="line">&gt; node-pre-gyp install --fallback-to-build</span><br><span class="line"></span><br><span class="line">node-pre-gyp WARN Using request for node-pre-gyp https download</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>啪一下，很快啊！我们就迎来了第一个东西<code>node-pre-gyp</code>，但是提到了<code>node-pre-gyp</code>，我们不得不提及<code>node-gyp</code>，然后又不得不提及<code>gyp</code>。</p>
<h2 id="gyp-与-node-gyp-与-node-pre-gyp"><a href="#gyp-与-node-gyp-与-node-pre-gyp" class="headerlink" title="gyp 与 node-gyp 与 node-pre-gyp"></a>gyp 与 node-gyp 与 node-pre-gyp</h2><h2 id="什么是-gyp？"><a href="#什么是-gyp？" class="headerlink" title="什么是 gyp？"></a>什么是 gyp？</h2><p>gyp 全称<code>Generate Your Projects</code>（构建你的项目）。wiki 的解释如下，自行翻译：</p>
<blockquote>
<p>GYP (generate your projects) is a build automation tool. GYP was created by Google to generate native IDE project files (such as Visual Studio Code and Xcode) for building the Chromium web browser and is licensed as open source software using the BSD software license.</p>
</blockquote>
<p>重点在于，它是一套用于生成原生 IDE 项目文件的自动化构建工具，处理 C&#x2F;C++项目，同类型的有 CMake、ninja 等自动构建工具。</p>
<h2 id="什么是-node-gyp？"><a href="#什么是-node-gyp？" class="headerlink" title="什么是 node-gyp？"></a>什么是 node-gyp？</h2><p>直接给出<code>stackoverflow</code>高票回答：</p>
<blockquote>
<p><code>node-gyp</code> is a tool which compiles Node.js Addons. Node.js Addons are native Node.js Modules, written in C or C++, which therefore need to be compiled on your machine. After they are compiled with tools like node-gyp, their functionality can be accessed via <code>require()</code>, just as any other Node.js Module.</p>
</blockquote>
<p>简单来说，node 是跨平台的，那么对于任何的 node 模块理论也是应该是跨平台的。然而，有些 node 模块直接或间接使用原生 C&#x2F;C++代码，这些东西要跨平台，就需要使用源码根据实际的操作平台环境进行原生模块编译。那么我们需要下载源码文件，通过 node-gyp 生成一定结构的代码项目让我们能够<code>require</code>引入（譬如，Windows 下会生成<code>vcxproj</code>，再调用<code>MSBuild</code>进行编译，以生成 Windows 下的动态链接库，最后打包为一个原生 node 模块）。这个知乎回答的每一条可以看看：<a href="https://www.zhihu.com/question/36291768">传送门</a>。</p>
<h2 id="什么是-node-pre-gyp？"><a href="#什么是-node-pre-gyp？" class="headerlink" title="什么是 node-pre-gyp？"></a>什么是 node-pre-gyp？</h2><p>上面<code>node-gyp</code>固然相当方便了，但是每一次安装 node 原生模块的时候，都需要根据平台（Windows、Linux、macOS 以及对应的 x86、x64、arm64 等等）进行源码编译，这样做费时费力。为什么不一开始就针对这些平台编译好了做成二进制制品发布呢？反正一般来说主流的平台架构就那么一些（Windows、Linux、macOS）。所以<code>node-pre--gyp</code>就帮我们做了这件事。原生模块开发者将代码编译生成各个平台架构的二进制包直接发布到<code>node-pre-gyp</code>上，当我们的 node 项目安装原生模块时候。处理流程就是首先去<code>node-pre-gyp</code>上找有没有当前平台的组件包，有的话直接拉取使用，如果没有则进行原生编译。</p>
<p><code>node-pre-gyp</code>一些<strong>重要参数</strong>（不全）：</p>
<ul>
<li><code>-C/--directory</code>: run the command in this directory</li>
<li><code>--build-from-source</code>: build from source instead of using pre-built binary</li>
<li><code>--fallback-to-build</code>: fallback to building from source if pre-built binary is not available</li>
<li><code>--target=0.4.0</code>: Pass the target node or node-webkit version to compile against</li>
<li><code>--target_arch=ia32</code>: Pass the target arch and override the host <code>arch</code>. Valid values are ‘ia32’,’x64’, or <code>arm</code>.</li>
<li><code>--target_platform=win32</code>: Pass the target platform and override the host <code>platform</code>. Valid values are <code>linux</code>, <code>darwin</code>, <code>win32</code>, <code>sunos</code>, <code>freebsd</code>, <code>openbsd</code>, and <code>aix</code>.</li>
</ul>
<p>对于<code>--fallback-to-build</code>这个参数：如果二进制不可获取则直接从源码编译，即从<code>node-pre-gyp</code>又回到<code>node-gyp</code>。所以你才会在上文看到安装 sqlite3 的时候，会有<code>--fallback-to-build</code>。</p>
<p>于是乎，当我们进行 node 原生模块安装的时候，一般会有如下的流程：</p>
<ol>
<li>针对当前平台架构优先考虑<code>node-pre-gyp</code>方式进行安装，但是为了防止无法获取针对对应平台编译好的二进制包（网络原因、暂时没有对应平台的二进制包），进入第 2 步；</li>
<li>下载原生模块源码，然后使用<code>node-gyp</code>进行项目构建，得到与平台相关的源码项目文件（Windows 则生成<code>vcxproj</code>项目，Linux 下是<code>Makefile</code>）；在这个过程，<code>node-gyp</code>会使用<code>Python</code>进行自动化构建操作，这也是为什么有些朋友安装 node 原生模块的时候，会报错找不到<code>Python</code>。</li>
<li>调用平台对应的编译工具进行编译。在 Windows 的环境下，<code>node-gyp</code>会查找本地的<code>MSBuild/CL</code>等编译工具，而这些编译工具又一般在<code>Visual Studio</code>安装的时候，也一并安装在了机器上。这就是为什么有些朋友没有安装<code>Visual Studio</code>的时候，会报错。</li>
</ol>
<h2 id="探索-SQLite3-的安装流程"><a href="#探索-SQLite3-的安装流程" class="headerlink" title="探索 SQLite3 的安装流程"></a>探索 SQLite3 的安装流程</h2><h2 id="npm-install"><a href="#npm-install" class="headerlink" title="npm install"></a><code>npm install</code></h2><p>为什么我们安装<code>sqlite3</code>的时候，会调用<code>node-pre-gyp</code>命令呢？进入<code>项目目录/node_modules/sqlite3/</code>文件夹，让我们查看一下<code>package.json</code>中的<code>scripts</code>部分：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">&quot;repository&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;git&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;git://github.com/mapbox/node-sqlite3.git&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;install&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node-pre-gyp install --fallback-to-build&quot;</span><span class="punctuation">,</span> <span class="comment">// install</span></span><br><span class="line">    <span class="attr">&quot;pack&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node-pre-gyp package&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pretest&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node test/support/createdb.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mocha -R spec --timeout 480000&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5.0.0&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>答案显而易见了，<code>install</code>脚本中执行了<code>node-pre-gyp install --fallback-to-build</code>命令。</p>
<p>这就不得不提到<code>npm</code>的安装流程是。当我们进行<code>npm install xxx</code>的时候，<code>npm</code>首先下载<code>xxx</code>的包。下载完成后，若<code>package.json</code>中的 scripts 中存在<code>install</code>属性，则会立刻调用。至于<code>scripts</code>中的其他固定脚本：<code>test</code>、<code>preinstall</code>、<code>postinstall</code>等等作用以及<code>scripts</code>的高级用法，请直接查阅<a href="https://link.zhihu.com/?target=https://docs.npmjs.com/cli/v6/using-npm/scripts">scripts | npm Docs (npmjs.com)</a>。</p>
<p>所以本此<code>sqlite3</code><strong>前期</strong>安装的过程为：</p>
<ol>
<li><code>npm</code>下载在仓库中的<code>sqlite3</code>npm 包；</li>
<li>执行<code>$&#123;your_projects&#125;/node_modules/sqlite3/package.json</code>中的<code>install</code>脚本，即<code>node-pre-gyp install --fallback-to-build</code></li>
</ol>
<p>于是乎，安装进入到了一个新的环节：<code>node-pre-gyp install</code>。当然，若你没有全局安装<code>node-pre-gyp</code>，它会由<code>npm</code>帮你安装到<code>$&#123;your_projects&#125;/node_modules/</code>中，并且通过<code>node-pre-gyp/package.json</code>中的<code>bin</code>元素，建立软连接到<code>$&#123;your_projects&#125;/node_modules/.bin</code>中。这样，<code>node\npm</code>环境中就有了<code>node-pre-gyp</code>命令可以使用。至于<code>package.json#bin</code>的作用，详细参考官方文档<a href="https://link.zhihu.com/?target=https://docs.npmjs.com/cli/v6/configuring-npm/package-json%23bin">package.json | npm Docs (npmjs.com)</a>。</p>
<h2 id="node-pre-gyp-install"><a href="#node-pre-gyp-install" class="headerlink" title="node-pre-gyp install"></a><code>node-pre-gyp install</code></h2><p><code>node-pre-gyp</code>在上述的安装流程中，已经能够被我们在 CLI 中所使用。查看<code>node_modules/node-pre-gyp/bin/node-pre-gyp</code>文件（下文都将省略<code>$&#123;your_projects&#125;/</code>），用文本的形式打开。就是<code>node-pre-gyp</code>CLI 的执行过程，脚本中的主要内容为最后一行：</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">// start running the given commands!</span><br><span class="line">run();</span><br></pre></td></tr></table></figure>

<p>检查该函数的定义：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">run</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> command = prog.<span class="property">todo</span>.<span class="title function_">shift</span>();</span><br><span class="line">  <span class="keyword">if</span> (!command) &#123;</span><br><span class="line">    <span class="comment">// done!</span></span><br><span class="line">    completed = <span class="literal">true</span>;</span><br><span class="line">    log.<span class="title function_">info</span>(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  prog.<span class="property">commands</span>[command.<span class="property">name</span>](command.<span class="property">args</span>, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      log.<span class="title function_">error</span>(command.<span class="property">name</span> + <span class="string">&quot; error&quot;</span>);</span><br><span class="line">      log.<span class="title function_">error</span>(<span class="string">&quot;stack&quot;</span>, err.<span class="property">stack</span>);</span><br><span class="line">      <span class="title function_">errorMessage</span>();</span><br><span class="line">      log.<span class="title function_">error</span>(<span class="string">&quot;not ok&quot;</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>);</span><br><span class="line">      <span class="keyword">return</span> process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> args_array = [].<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (args_array.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="property">log</span>.<span class="title function_">apply</span>(<span class="variable language_">console</span>, args_array);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// now run the next command in the queue</span></span><br><span class="line">    process.<span class="title function_">nextTick</span>(run);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>prog</code>是什么？该文件往上查看定义，原来是：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> node_pre_gyp = <span class="built_in">require</span>(<span class="string">&quot;../&quot;</span>); <span class="comment">// 上一个目录作为模块引入</span></span><br><span class="line"><span class="keyword">var</span> log = <span class="built_in">require</span>(<span class="string">&quot;npmlog&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Process and execute the selected commands.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> prog = <span class="keyword">new</span> node_pre_gyp.<span class="title class_">Run</span>(); <span class="comment">// 来自于node_pre_gyp中的Run，而node_pre_gyp在上方</span></span><br></pre></td></tr></table></figure>

<p>继续检查上一个目录，发现并没又<code>indes.js</code>文件，熟悉<code>npm</code>的朋友应该知道要去看<code>package.json</code>中的<code>main</code>元素了：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">    <span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;BSD-3-Clause&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./lib/node-pre-gyp.js&quot;</span><span class="punctuation">,</span> <span class="comment">// 模块是这个文件</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node-pre-gyp&quot;</span><span class="punctuation">,</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>查阅<code>lib/node-pre-gyp.js</code>代码中的 Run：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Run</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> self = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">commands</span> = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  commands.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">command</span>) &#123;</span><br><span class="line">    self.<span class="property">commands</span>[command] = <span class="keyword">function</span> (<span class="params">argv, callback</span>) &#123;</span><br><span class="line">      log.<span class="title function_">verbose</span>(<span class="string">&quot;command&quot;</span>, command, argv);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">&quot;./&quot;</span> + command)(self, argv, callback); <span class="comment">// 这里是核心</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>核心功能就是引入当前所在目录下的模块进行执行。例如，本次调用的是<code>node-pre-gyp install</code>，则会<code>require(./install)</code>，检查一下<code>node-pre-gyp.js</code>目录下，果然存在该<code>js</code>文件。继续阅读<code>install.js</code>源码。里面有几个函数的定义。咱们先不看内容，把函数名列举出来，猜测一下作用：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 去下载平台编译好的二进制？</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">download</span>(<span class="params">uri,opts,callback</span>) &#123;...&#125;</span><br><span class="line"><span class="comment">// 把下载好的二进制放到对应目录？</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">place_binary</span>(<span class="params"><span class="keyword">from</span>,to,opts,callback</span>) &#123;...&#125;</span><br><span class="line"><span class="comment">// 进行构建。难道是没有下载，就调用node-gyp源码编译？</span></span><br><span class="line"><span class="comment">// 还有，node-pre-gyp又--fallback-to-build参数，也会调用这个？</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">do_build</span>(<span class="params">gyp,argv,callback</span>) &#123;...&#125;</span><br><span class="line"><span class="comment">// 打印回退出现的异常</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">print_fallback_error</span>(<span class="params">err,opts,package_json</span>) &#123;...&#125;</span><br><span class="line"><span class="comment">// 安装，核心没跑了</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">install</span>(<span class="params">gyp, argv, callback</span>) &#123;...&#125;</span><br></pre></td></tr></table></figure>

<p>首先看<code>download</code>的调用点是在<code>place_binary</code>中：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">place_binary</span>(<span class="params"><span class="keyword">from</span>,to,opts,callback</span>) &#123; <span class="comment">// place_binary函数</span></span><br><span class="line">    <span class="title function_">download</span>(<span class="keyword">from</span>,opts,<span class="keyword">function</span>(<span class="params">err,req</span>) &#123; <span class="comment">// 调用了download</span></span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="title function_">callback</span>(err);</span><br><span class="line">        <span class="keyword">if</span> (!req) <span class="keyword">return</span> <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;empty req&quot;</span>));</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">        ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再看<code>place_binary</code>调用点是在<code>install</code>中：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">install</span>(<span class="params">gyp, argv, callback</span>) &#123;</span><br><span class="line">  <span class="comment">// 省略部分...</span></span><br><span class="line">  <span class="keyword">var</span> should_do_source_build =</span><br><span class="line">    source_build === package_json.<span class="property">name</span> ||</span><br><span class="line">    source_build === <span class="literal">true</span> ||</span><br><span class="line">    source_build === <span class="string">&quot;true&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (should_do_source_build) &#123;</span><br><span class="line">    <span class="comment">// 源码编译</span></span><br><span class="line">    log.<span class="title function_">info</span>(<span class="string">&quot;build&quot;</span>, <span class="string">&quot;requesting source compile&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">do_build</span>(gyp, argv, callback);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 省略部分...</span></span><br><span class="line">    <span class="title function_">mkdirp</span>(to, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="title function_">after_place</span>(err);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">place_binary</span>(<span class="keyword">from</span>, to, opts, after_place); <span class="comment">// 调用点</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 省略部分...</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 省略部分...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过上述分析，整个大的处理流程如下：</p>
<ol>
<li>进入<code>install</code>函数</li>
<li>检查是否需要<code>build-from-source</code>。是则进，入<code>do_build</code>分支，进行源码编译；否则进入步骤 3。</li>
<li>检查是否启用<code>--fallback-to-build</code>参数，设定是否启用标志位。</li>
<li>解析编译好的二进制文件的选项配置，譬如二进制文件存放地址，也就是通过请求下载对应二进制包的地址，以及各种各样参数。所以说，为什么下载很慢，我们后文会重点关注下载地址。</li>
</ol>
<h3 id="下载二进制包"><a href="#下载二进制包" class="headerlink" title="下载二进制包"></a>下载二进制包</h3><p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-42de3994e7c42468d24506ef1dbdbe49_720w-1607839552207.jpg" alt="img"></p>
<p>根据流程，接下来我们进一步检查<code>versioning.js</code>文件，找到其中的<code>evaluate</code>函数，分析最后的<code>hosted_tarball</code>路径：</p>
<p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-1e4a760a3783229810e2a437e1330f37_720w-1607839554321.png" alt="img"></p>
<p><code>hosted_tarball</code>路径主要分为两个部分：1、<code>hosted_path</code>；2、<code>package_name</code>。</p>
<h3 id="hosted-path"><a href="#hosted-path" class="headerlink" title="hosted_path"></a>hosted_path</h3><p>经过源码分析来源路径为：</p>
<p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-9e93a984b0f0aeac5d8154f0aa1b387c_720w-1607839785926.jpg" alt="img"></p>
<p>我们自底向上分析。</p>
<p><code>host</code>变量取决于从环境变量中检查名称为<code>&#39;npm_config_&#39; + opts.module_name + &#39;_binary_host_mirror&#39;</code>的环境变量。如果不存在，则使用<code>package_json.binary.host</code>。正常使用的时候，我们并不会设定环境变量，所以这里就进入<code>package_json.binary</code>进行获取。这个<code>package_json</code>是<code>evaluate</code>函数被调用时候传入的，在<code>node-pre-gyp/install.js</code>中能够看到：</p>
<p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-2f28af0a80578001c17e86077832bc52_720w-1607839556588.jpg" alt="img"></p>
<p>一开始分析的时候，看到这里，本人以为<code>package_json</code>就是<code>node-pre-gyp/package.json</code>，于是本人去检查该<code>json</code>发现很奇怪，并没有 binary 属性，更别提 host 了。一番思考才明白，<code>node-pre-gyp install</code>的运行时调用者是谁呀？不是应该是<code>sqlite3</code>吗？所以这个地方的<code>require(&#39;./package.json&#39;)</code>实际上是指代的是<code>sqlite3/package.json</code>。查看<code>sqlite3/package.json</code>，果然发现了对应的元素：</p>
<p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-9123803894e4e7ba0df2b7eebc3be8f9_720w-1607839558202.jpg" alt="img"></p>
<p>在<code>binary</code>属性中，我们还能看到<code>remote_path</code>也在其中。</p>
<p>至此，<code>hosted_path</code>我们完成了简单的分析，我们可以得出一个结论：</p>
<p><strong><code>node-pre-gyp</code>下载二进制文件的路径，优先来源于对应模块的镜像地址，该镜像地址通过配置<code>&#39;npm_config_&#39; + 模块名 + &#39;_binary_host_mirror&#39;</code>来实现自定义；在没有定义镜像地址的情况下，读取模块<code>package.json</code>中的 binary 属性信息。</strong></p>
<p>当然，读者可以根据具体情况再进一步分析源码。</p>
<h3 id="package-name"><a href="#package-name" class="headerlink" title="package_name"></a>package_name</h3><p>其实，对于<code>hosted_path</code>的分析，我们也容易分析<code>package_name</code>了。</p>
<p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-66d92db546da24a98f6459e09d28611a_720w-1607839560356.jpg" alt="img"></p>
<p>自底向上分析，来自于<code>sqlite3/package.json</code>中<code>binary</code>属性中的<code>package_name</code>，内容见上图分析<code>host</code>。</p>
<h3 id="失败处理"><a href="#失败处理" class="headerlink" title="失败处理"></a>失败处理</h3><p><code>--fallback-to-build</code>参数表明了是否进行失败后下载源码进行编译，源码不再分析。</p>
<h3 id="从源码构建"><a href="#从源码构建" class="headerlink" title="从源码构建"></a>从源码构建</h3><h3 id="build-js"><a href="#build-js" class="headerlink" title="build.js"></a>build.js</h3><p>当我们提供了参数<code>--build-from-source</code>或是在下载编译好的二进制到本地出错的时提供了参数<code>--fallback-to-build</code>。node-pre-gyp 将进入<code>do_build</code>模块，进行源码编译。</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">function do_build(gyp,argv,callback) &#123;</span><br><span class="line">  var args = [&#x27;rebuild&#x27;].concat(argv);</span><br><span class="line">  gyp.todo.push( &#123; name: &#x27;build&#x27;, args: args &#125; );</span><br><span class="line">  process.nextTick(callback);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码中，<code>gyp</code>由调用 install 的时候，传入：</p>
<p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-62190c9f9976e3b3a7d7633d33129e85_720w-1607839562977.jpg" alt="img"></p>
<p>那么我们又将回到调用 install 的地方。实际上，gyp 就是 node-pre-gyp.js 导出的模块：</p>
<p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-e940f9f30e0b68edeb98aa34709263e0_720w-1607839564901.jpg" alt="img"></p>
<p>也就是说在<code>do_build</code>中进行操作就是，放置了一个<code>build</code>任务在队列中。所以我们按照先前的分析，直接去看<code>build.js</code></p>
<p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-c60cc43b95c212ee80dff2bb461597a2_720w-1607839566493.jpg" alt="img"></p>
<p>看源码调用了当前模块中的<code>do_build</code>，且其中最核心的就是<code>compile</code>模块：</p>
<p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-2f5857952a2e181a620ca9183fd5e76d_720w-1607839567958.jpg" alt="img"></p>
<h3 id="util-x2F-compile-js"><a href="#util-x2F-compile-js" class="headerlink" title="util&#x2F;compile.js"></a>util&#x2F;compile.js</h3><p>进入 compile 模块，直接找到对应的<code>run_gyp</code>函数，代码很短，不难看出进行构建调用了<code>node-gyp</code></p>
<p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-97c9d95fdb3ea2d7c9e55a7311377fc3_720w-1607839569753.jpg" alt="img"></p>
<p>上述代码，会先考略<code>node-webkit</code>构建。但是我们核心的还是使用<code>node-gyp</code>，所以 else 中，会进行<code>node-gyp</code>的工具的检查工作。最后调用命令行执行<code>node-gyp</code>。于是，node 原生模块的安装工作，进入了新的阶段：<code>node-gyp</code>。</p>
<h2 id="node-gyp-build"><a href="#node-gyp-build" class="headerlink" title="node-gyp build"></a><code>node-gyp build</code></h2><p>上文提到我们已经进入了<code>node-gyp</code>的范畴，会调用<code>node-gyp build</code>操作。当然，这个命令同样是在安装<code>node-gyp</code>依赖的时候已经完成了安装，并且进行<code>node_modules/.bin/</code>软连接操作。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">  <span class="string">&quot;bin&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;node-gyp&quot;</span>: <span class="string">&quot;bin/node-gyp.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<p>我们进入该<code>js</code>进行分析</p>
<p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-8b31e792c069648f4518bd2bf4de384c_720w-1607839571435.jpg" alt="img"></p>
<p>实际上，<code>node-gyp</code>这段的命令行代码，和<code>node-pre-gyp</code>非常相似！所以我们也不去深入分析调用命令行了。直接在 lib 文件夹下面的<code>build.js</code>。在该<code>js</code>中，核心的方法为：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">build</span> (gyp, argv, callback) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在该方法中，还编写了几个<strong>内部函数</strong>，作为了功能的划分：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// function build (gyp, argv, callback) 内部函数</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Load the &quot;config.gypi&quot; file that was generated during &quot;configure&quot;.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">loadConfigGypi</span> () &#123;...&#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * On Windows, find the first build/*.sln file.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">findSolutionFile</span> () &#123;...&#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Uses node-which to locate the msbuild / make executable.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">doWhich</span> () &#123;...&#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Search for the location of &quot;msbuild.exe&quot; file on Windows.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">findMsbuild</span> () &#123;...&#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Actually spawn the process and compile the module.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">doBuild</span> () &#123;...&#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Invoked after the make/msbuild command exits.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">onExit</span> (code, signal) &#123;...&#125;</span><br></pre></td></tr></table></figure>

<p>不得不说，<code>build</code>写的真心不错，看起来很舒服。这里为了方便读者快速阅读，我整理这些函数的调用图：</p>
<p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-bf94b9960c86eaf29b542f860b3d4ab1_720w-1607839573628.jpg" alt="img"></p>
<p>整个调用流程图个人认为足够进行安装的时候的一场分析了。至于每个内部函数的功能，有空继续更新本文吧。</p>
]]></content>
      <categories>
        <category>Nodejs</category>
      </categories>
      <tags>
        <tag>Nodejs</tag>
      </tags>
  </entry>
  <entry>
    <title>阿里云常见问题汇总</title>
    <url>/2021/12/07/Linux/%E9%98%BF%E9%87%8C%E4%BA%91%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h2 id="nginx-老是自动停止"><a href="#nginx-老是自动停止" class="headerlink" title="nginx 老是自动停止"></a>nginx 老是自动停止</h2><p>nginx 在通过 Certbot 安装 证书后 发现每隔一段时间 nginx 都会自动停止</p>
<p>找了我 n 久 ，一开始以为是 shell 的问题 ，以为 shell 端口服务就停，试了几回发现不是</p>
<p>查看定时任务 cat &#x2F;etc&#x2F;crontab</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">0 </span><span class="number">1</span> * * * root sh /etc/newinit.sh &gt;/dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>💢 &#x2F;etc&#x2F;newinit.sh 是 TMD 什么脚本<br>在百度上一查居然是挖矿脚本攻击！！！！</p>
<p>原文连接：<a href="https://blog.csdn.net/HoneyYHQ9988/article/details/113705159">阿里云服务器糟挖矿程序攻击</a></p>
<p>脚本中有段这个</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">netstat -anp | grep :443 | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> | awk -F<span class="string">&#x27;[/]&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | grep -v <span class="string">&quot;-&quot;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">netstat -anp | grep :23 | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> | awk -F<span class="string">&#x27;[/]&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | grep -v <span class="string">&quot;-&quot;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br><span class="line">netstat -anp | grep :443 | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> | awk -F<span class="string">&#x27;[/]&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | grep -v <span class="string">&quot;-&quot;</span> | xargs -I % <span class="built_in">kill</span> -9 %</span><br></pre></td></tr></table></figure>

<p>居然 把我 443 端口对应的进程 kill 掉了 ，我*** !!!!💢</p>
<p>解决：一定要把脚本干掉 rm -rf &#x2F;etc&#x2F;newinit.sh 同时去除&#x2F;etc&#x2F;crontab 的定时任务<br>再次 netstat -tnlp ，世界清净了</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span><br><span class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      396237/nginx: worke</span><br><span class="line">tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      423/systemd-resolve</span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      545/sshd: /usr/sbin</span><br><span class="line">tcp        0      0 127.0.0.1:33305         0.0.0.0:*               LISTEN      665587/node</span><br><span class="line">tcp        0      0 0.0.0.0:443             0.0.0.0:*               LISTEN      396237/nginx: worke</span><br><span class="line">tcp6       0      0 :::3000                 :::*                    LISTEN      2300247/node /root/</span><br><span class="line">tcp6       0      0 :::3001                 :::*                    LISTEN      2365081/node /root/</span><br></pre></td></tr></table></figure>

<p>找了 我好长时间！！！一定要记录一下</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>阿里云</tag>
      </tags>
  </entry>
</search>
