<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/Bowen_favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/Bowen_favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/Bowen_favicon.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="g2sghe_aG2NDGFETaIqaIGhfZNoeS9wGBnugQAQXHMI">
  <meta name="baidu-site-verification" content="code-YK9weY9Iav">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.bitbw.top","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.14.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":{"gitalk":{"order":-2}},"activeClass":"gitalk"},"stickytabs":true,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.14.0/source/js/config.min.js"></script>

    <meta name="description" content="vue js javaScript ts typeScript HTML css Sass less webpack git hexo  Node.js 算法 前端 小程序 技术个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="张博文的个人博客">
<meta property="og:url" content="https://blog.bitbw.top/page/10/">
<meta property="og:site_name" content="张博文的个人博客">
<meta property="og:description" content="vue js javaScript ts typeScript HTML css Sass less webpack git hexo  Node.js 算法 前端 小程序 技术个人博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Bowen">
<meta property="article:tag" content="vue js javaScript ts typeScript HTML css Sass less webpack git hexo  Node.js 算法 前端 小程序 技术个人博客">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://blog.bitbw.top/page/10/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/10/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>张博文的个人博客 - Bowen's personal blog</title>
  

  <script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.14.0/source/js/third-party/analytics/baidu-analytics.min.js"></script>
  <script async src="https://hm.baidu.com/hm.js?aed4bbe397960f5436bd1a9633262fa1"></script>





  <script async defer data-website-id="" src=""></script>

  <script defer data-domain="" src=""></script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">张博文的个人博客</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Bowen's personal blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">87</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">29</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">138</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Bowen"
      src="/images/logo-header.jpg">
  <p class="site-author-name" itemprop="name">Bowen</p>
  <div class="site-description" itemprop="description">vue js javaScript ts typeScript HTML css Sass less webpack git hexo  Node.js 算法 前端 小程序 技术个人博客</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">138</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">87</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/bitbw" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;bitbw" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="http://weibo.com/" title="微博 → http:&#x2F;&#x2F;weibo.com" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>微博</a>
      </span>
      <span class="links-of-author-item">
        <a href="http://www.zhihu.com/" title="知乎 → http:&#x2F;&#x2F;www.zhihu.com" rel="noopener" target="_blank"><i class="fab fa-zhihu fa-fw"></i>知乎</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://mail.163.com/" title="E-Mail → https:&#x2F;&#x2F;mail.163.com&#x2F;" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/" title="Twitter → https:&#x2F;&#x2F;twitter.com" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://youtube.com/" title="YouTube → https:&#x2F;&#x2F;youtube.com" rel="noopener" target="_blank"><i class="fab fa-youtube fa-fw"></i>YouTube</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://theme-next.org/" title="https:&#x2F;&#x2F;theme-next.org&#x2F;" rel="noopener" target="_blank">Next主题</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://www.cnblogs.com/hanzeng1993/" title="https:&#x2F;&#x2F;www.cnblogs.com&#x2F;hanzeng1993&#x2F;" rel="noopener" target="_blank">Python学习</a>
            </li>
        </ul>
      </div>
    </div>
        <div class="pjax">
        </div>
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.bitbw.top/2021/01/02/Webpack/webpack%E6%95%99%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo-header.jpg">
      <meta itemprop="name" content="Bowen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张博文的个人博客">
      <meta itemprop="description" content="vue js javaScript ts typeScript HTML css Sass less webpack git hexo  Node.js 算法 前端 小程序 技术个人博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 张博文的个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/01/02/Webpack/webpack%E6%95%99%E7%A8%8B/" class="post-title-link" itemprop="url">webpack教程(5)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-01-02 16:24:55" itemprop="dateCreated datePublished" datetime="2021-01-02T16:24:55+00:00">2021-01-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-12-14 02:04:05" itemprop="dateModified" datetime="2022-12-14T02:04:05+00:00">2022-12-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Webpack/" itemprop="url" rel="index"><span itemprop="name">Webpack</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>9.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>8 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="webpack-入门"><a href="#webpack-入门" class="headerlink" title="webpack 入门"></a>webpack 入门</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>webpack 是一个模块打包器，它本身主要打包 JavaScript 模块，结合它的生态中的一些 loader 可以实现对很多其他资源的打包，例如 less、sass、图片、es6 转 es5、.vue 等等文件资源都可以。</p>
<p>使用 webpack，我们最终就能实现类似于 VueCLI 这个工具提供给我们的功能：</p>
<ul>
<li>打包 JavaScript</li>
<li>打包 css</li>
<li>打包 图片</li>
<li>打包 less</li>
<li>打包 .vue 资源</li>
<li>….</li>
<li>开发阶段的 Web 服务</li>
<li>代码热更新</li>
<li>打包部署命令</li>
<li>。。。。</li>
</ul>
<p>我们之所以能使用到 VueCLI 这么方便的工具，一切都归功于 webpack。</p>
<p>webpack 出来之前，还有一些别的构建工具：</p>
<ul>
<li><strong>grunt</strong></li>
<li><strong>gulp</strong></li>
<li>百度的 fis</li>
<li>PARCEL</li>
<li>rollup</li>
<li>……</li>
</ul>
<p>现在 webpack 已经被各大主流前端框架作为自己的脚手架工具的基层，例如：</p>
<ul>
<li>Vue：Vue CLI</li>
<li>React：crate-react-app</li>
<li>Angular：angular-cli</li>
<li>。。。。</li>
</ul>
<p>为什么要学习 webpack？</p>
<p>如果你需要定制这些脚手架工具，那么最好了解一点儿 webpack 相关的内容，例如对项目进行打包优化，配置开发工具模式，。。。。一些更高级的使用方式。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191122114402722.png" alt="image-20191122114402722"></p>
<p>打包 -&gt; 打包结果 -&gt; 浏览器就可以识别运行。</p>
<ul>
<li>官网：<a target="_blank" rel="noopener" href="https://webpack.js.org/">https://webpack.js.org/</a><ul>
<li>官方教程：<a target="_blank" rel="noopener" href="https://webpack.js.org/guides/">https://webpack.js.org/guides/</a></li>
<li>官方 API 参考文档：<a target="_blank" rel="noopener" href="https://webpack.js.org/api/">https://webpack.js.org/api/</a></li>
<li>官方的中文文档链接： <a target="_blank" rel="noopener" href="https://webpack.docschina.org/">https://webpack.docschina.org/</a></li>
</ul>
</li>
<li>GitHub：<a target="_blank" rel="noopener" href="https://github.com/webpack/webpack">https://github.com/webpack/webpack</a></li>
</ul>
<h2 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h2><blockquote>
<p>目标：体验 webpack 的使用</p>
</blockquote>
<p>一、准备</p>
<p>1、创建 <code>demo1</code> 练习项目</p>
<p>2、创建 <code>index.js</code></p>
<blockquote>
<p>现在必须叫 <code>index.js</code>，之后可以通过配置文件修改</p>
</blockquote>
<p>3、创建 <code>foo.js</code></p>
<p>4、创建 <code>index.html</code></p>
<p>二、安装并配置 webpack 到项目中</p>
<p>1、创建 <code>package.json</code> 文件（保存安装包的依赖信息）</p>
<p>2、安装 webpack 到项目的开发依赖中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yarn add --dev webpack webpack-cli 或者 yarn add -D webpack webpack-cli</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># npm install -D webpack webpack-cli</span></span><br><span class="line">npm install --save-dev webpack webpack-cli</span><br></pre></td></tr></table></figure>

<blockquote>
<p>建议把开发工具打包相关的包的依赖信息保存到 <code>devDependencies</code> 中，其实就是一个归类，都安装包到项目中，有利于阅读，更清晰。</p>
</blockquote>
<p>3、将 package.json 的 <code>scripts</code> 中新增</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191122121632366.png" alt="image-20191122121632366"></p>
<p>三、打包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>

<blockquote>
<p>npm 就会找到 package.json 中的 <code>build</code> 配置项，运行 webpak 构建打包。</p>
</blockquote>
<p>正确的话你应该可以看到：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ npm run build</span><br><span class="line"></span><br><span class="line">&gt; demo1@<span class="number">1.0</span><span class="number">.0</span> build C:\Users\LPZ\Desktop\FE88\webpack-demos\demo1</span><br><span class="line">&gt; webpack</span><br><span class="line"></span><br><span class="line">Hash: <span class="number">893</span>a9c400f1f92ab6974</span><br><span class="line"><span class="keyword">Version</span>: webpack <span class="number">4.41</span><span class="number">.2</span></span><br><span class="line"><span class="type">Time</span>: <span class="number">96</span>ms</span><br><span class="line">Built at: <span class="number">2019</span><span class="number">-11</span><span class="number">-22</span> <span class="number">12</span>:<span class="number">19</span>:<span class="number">00</span></span><br><span class="line">  Asset       Size  Chunks             Chunk Names</span><br><span class="line">main.js  <span class="number">976</span> bytes       <span class="number">0</span>  [emitted]  main</span><br><span class="line">Entrypoint main = main.js</span><br><span class="line">[<span class="number">0</span>] ./src/<span class="keyword">index</span>.js + <span class="number">1</span> modules <span class="number">95</span> bytes &#123;<span class="number">0</span>&#125; [built]</span><br><span class="line">    | ./src/<span class="keyword">index</span>.js <span class="number">34</span> bytes [built]</span><br><span class="line">    | ./src/foo.js <span class="number">61</span> bytes [built]</span><br><span class="line"></span><br><span class="line"><span class="built_in">WARNING</span> <span class="keyword">in</span> <span class="keyword">configuration</span></span><br><span class="line">The <span class="string">&#x27;mode&#x27;</span> <span class="keyword">option</span> has <span class="keyword">not</span> been <span class="keyword">set</span>, webpack will fallback <span class="keyword">to</span> <span class="string">&#x27;production&#x27;</span> <span class="keyword">for</span> this <span class="keyword">value</span>. <span class="keyword">Set</span> <span class="string">&#x27;mode&#x27;</span> <span class="keyword">option</span> <span class="keyword">to</span> <span class="string">&#x27;development&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;production&#x27;</span> <span class="keyword">to</span> <span class="keyword">enable</span> defaults <span class="keyword">for</span> <span class="keyword">each</span> environment.</span><br><span class="line">You can <span class="keyword">also</span> <span class="keyword">set</span> it <span class="keyword">to</span> <span class="string">&#x27;none&#x27;</span> <span class="keyword">to</span> <span class="keyword">disable</span> <span class="keyword">any</span> <span class="keyword">default</span> behavior. Learn more: https://webpack.js.org/<span class="keyword">configuration</span>/mode/</span><br></pre></td></tr></table></figure>

<p>webpack 默认会找到 <code>src/index.js</code> 作为打包的入口，然后从入口分析所有的依赖：</p>
<ul>
<li>a 依赖了 b</li>
<li>b 依赖了 c</li>
<li>c 依赖 d</li>
<li>。。。。</li>
<li>所有依赖的文件</li>
</ul>
<p>将它们编译构建处理，最终生成一个默认名字叫 <code>main.js</code> 文件写入 <code>dist</code> 目录。</p>
<p>四、加载执行</p>
<p>在你 HTML 文件中加载打包的结果 <code>dist/main.js</code>，访问测试。</p>
<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>webpack 打包的入口和出口具有默认规则，如果想要自定义，或者其他一些更高级功能配置，那么我们就需要使用它的配置文件了。</p>
<p>1、在项目根目录创建 <code>webpack.config.js</code> 并写入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * webpack 配置文件</span></span><br><span class="line"><span class="comment"> * 该文件必须导出一个对象</span></span><br><span class="line"><span class="comment"> * 对象中声明 webpack 的配置项</span></span><br><span class="line"><span class="comment"> * 注意：webpack 是基于 Node.js 开发运行的一个构件工具，它的打包运行的时候会来执行这个文件得到导出的配置对象</span></span><br><span class="line"><span class="comment"> * 所以你要知道：这里使用的都是 Node.js 中的代码相关语法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 入口配置</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 出口配置</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// __dirname 可以动态的获取当前文件所属目录的绝对路径</span></span><br><span class="line">    <span class="comment">// path 是 Node 中一个专门处理路径的一个模块</span></span><br><span class="line">    <span class="comment">// 它的 join 方法转么用来拼接路径，</span></span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;./dist&quot;</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">// path: &#x27;C:\\Users\\LPZ\\Desktop\\FE88\\webpack-demos\\demo1\\dist&#x27;, // 打包的结果目录，默认是 dist，必须是一个绝对路径</span></span><br><span class="line">    <span class="comment">// path: &#x27;./dist/&#x27;, // 打包的结果目录，默认是 dist，必须是一个绝对路径</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;bundle.js&quot;</span>, <span class="comment">// 打包的结果文件名，默认叫 main.js</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>2、然后修改 <code>package.json</code> 文件中的 <code>build</code> 配置项（非必须）</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191122124307295.png" alt="image-20191122124307295"></p>
<blockquote>
<p>webpack 会自动加载执行名字叫 <code>webpack.config.js</code> 的配置文件，如果你使用了别的名字，那么就在这里自定义.</p>
</blockquote>
<p>3、打包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>

<h2 id="关于-npm-scripts"><a href="#关于-npm-scripts" class="headerlink" title="关于 npm scripts"></a>关于 npm scripts</h2><p>推荐阅读：<a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2016/10/npm_scripts.html">阮一峰 - npm scripts 使用指南</a></p>
<p>我们安装到项目中的 webpack，手动的方式需要这样来使用：</p>
<h2 id="打包模式-mode"><a href="#打包模式-mode" class="headerlink" title="打包模式 mode"></a>打包模式 mode</h2><blockquote>
<p>官方文档： <a target="_blank" rel="noopener" href="https://webpack.js.org/configuration/mode/">https://webpack.js.org/configuration/mode/</a></p>
</blockquote>
<p>mode 用来配置打包模式，有两种模式可选：</p>
<ul>
<li>development 开发模式<ul>
<li>更快的编译速度</li>
</ul>
</li>
<li>production 生产模式<ul>
<li>相比开发模式构建速度慢，拥有更好的编译结果</li>
<li>例如代码压缩</li>
</ul>
</li>
</ul>
<p>建议开发过程使用开发模式，发布上线使用生产模式。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191122155129511.png" alt="image-20191122155129511"></p>
<h2 id="打包-CSS"><a href="#打包-CSS" class="headerlink" title="打包 CSS"></a>打包 CSS</h2><p>1、安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev style-loader css-loader</span><br></pre></td></tr></table></figure>

<p>2、修改打包配置文件</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191122152632937.png" alt="image-20191122152632937"></p>
<p>3、打包测试</p>
<h2 id="打包图片"><a href="#打包图片" class="headerlink" title="打包图片"></a>打包图片</h2><p>1、安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev file-loader</span><br></pre></td></tr></table></figure>

<p>2、配置</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191122153520233.png" alt="image-20191122153520233"></p>
<p>3、打包配置</p>
<h2 id="设置-HtmlWebpackPlugin"><a href="#设置-HtmlWebpackPlugin" class="headerlink" title="设置 HtmlWebpackPlugin"></a>设置 HtmlWebpackPlugin</h2><p>为了解决打包之后的路径问题，我们也必须把 HTML 文件也打包到 dist 目录中，然后运行 dist 中的 HTML 文件，这才是正确的方式。</p>
<p>1、安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev html-webpack-plugin</span><br></pre></td></tr></table></figure>

<p>2、配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">+ <span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    ...</span><br><span class="line">+   <span class="attr">plugins</span>: [</span><br><span class="line">+     <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">+       <span class="attr">title</span>: <span class="string">&#x27;管理输出&#x27;</span></span><br><span class="line">+     &#125;)</span><br><span class="line">+   ]</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>关于 HTMLwebpackplugin 更多内容，请参考： <a target="_blank" rel="noopener" href="https://github.com/jantimon/html-webpack-plugin">https://github.com/jantimon/html-webpack-plugin</a></p>
</blockquote>
<p>3、打包测试</p>
<h2 id="自动清除-dist-目录"><a href="#自动清除-dist-目录" class="headerlink" title="自动清除 dist 目录"></a>自动清除 dist 目录</h2><p>建议每次打包之前把 dist 目录删除，每次都生成最新的干干净净的内容。</p>
<p>1、安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev clean-webpack-plugin</span><br></pre></td></tr></table></figure>

<p>2、配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(),</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="打包字体文件"><a href="#打包字体文件" class="headerlink" title="打包字体文件"></a>打包字体文件</h2><p>还是使用 file-loader，只需要增加一个配置规则即可：</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191122162620802.png" alt="image-20191122162620802"></p>
<h2 id="打包-Less"><a href="#打包-Less" class="headerlink" title="打包 Less"></a>打包 Less</h2><p>1、安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装过的就不用重新安装了</span></span><br><span class="line">npm install less less-loader style-loader css-loader --save-dev</span><br></pre></td></tr></table></figure>

<p>2、配置</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191122163446652.png" alt="image-20191122163446652"></p>
<p>3、打包测试</p>
<h2 id="ES6-转-ES5"><a href="#ES6-转-ES5" class="headerlink" title="ES6 转 ES5"></a>ES6 转 ES5</h2><p>为了让代码中的 ES6 能运行在低版本浏览器，我们需要把 ES6 转为 ES5 向下兼容。</p>
<p>Babel 是一个专门将 ES6 转 ES5 的编译工具。</p>
<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><p>1、安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -D babel-loader @babel/core @babel/preset-env webpack</span><br></pre></td></tr></table></figure>

<p>2、配置</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191122165529066.png" alt="image-20191122165529066"></p>
<p>3、打包测试</p>
<p>它只能把基本的语法转换兼容处理，例如：</p>
<ul>
<li>const</li>
<li>let</li>
<li>箭头函数</li>
<li>解构赋值</li>
<li>。。。</li>
</ul>
<p>当时它不会处理一些 API 方法，例如：</p>
<ul>
<li>字符串的 includes 方法</li>
<li>数组的<ul>
<li>find</li>
<li>findIndex</li>
<li>includes</li>
<li>。。。。</li>
</ul>
</li>
</ul>
<h3 id="API-兼容处理"><a href="#API-兼容处理" class="headerlink" title="API 兼容处理"></a>API 兼容处理</h3><p>1、安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save @babel/polyfill</span><br></pre></td></tr></table></figure>

<p>2、配置</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191124090523101.png" alt="image-20191124090523101"></p>
<p>3、打包测试</p>
<h3 id="开启缓存"><a href="#开启缓存" class="headerlink" title="开启缓存"></a>开启缓存</h3><p>当代码文件比较多的时候，babel 打包非常耗时，我们建议开启缓存用以提高打包的效率。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191124091122427.png" alt="image-20191124091122427"></p>
<h2 id="增加-source-maps"><a href="#增加-source-maps" class="headerlink" title="增加 source maps"></a>增加 source maps</h2><blockquote>
<p>建议阅读：<a target="_blank" rel="noopener" href="https://blog.teamtreehouse.com/introduction-source-maps">An Introduction to Source Maps</a></p>
</blockquote>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191124093220937.png" alt="image-20191124093220937"></p>
<h2 id="使用-watch-监视模式"><a href="#使用-watch-监视模式" class="headerlink" title="使用 watch 监视模式"></a>使用 watch 监视模式</h2><p>在 package.json 文件中新增一个 scripts 脚本：</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191124095723565.png" alt="image-20191124095723565"></p>
<h2 id="使用-webpack-dev-server"><a href="#使用-webpack-dev-server" class="headerlink" title="使用 webpack-dev-server"></a>使用 webpack-dev-server</h2><ul>
<li>开启一个 Web 服务器</li>
<li>监视打包</li>
<li>自动刷新浏览器</li>
<li>。。。。</li>
</ul>
<p>1、安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev webpack-dev-server</span><br></pre></td></tr></table></figure>

<p>2、配置</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191124100620633.png" alt="image-20191124100620633"></p>
<blockquote>
<p>在 <code>webpack.config.js</code> 中新增的配置项</p>
</blockquote>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191124100646425.png" alt="image-20191124100646425"></p>
<blockquote>
<p>在 <code>package.json</code> 文件中新增 NPM Scripts 脚本</p>
</blockquote>
<p>3、打包测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run serve</span><br></pre></td></tr></table></figure>

<h2 id="热更新"><a href="#热更新" class="headerlink" title="热更新"></a>热更新</h2><p>webpack-dev-server 默认是刷新整个页面实现更新。我们有一种更好的方式：热更新，可以在不刷新页面的情况下更新内容变化，效率更高。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191124101715767.png" alt="image-20191124101715767"></p>
<blockquote>
<p>在 webpack 配置文件中</p>
</blockquote>
<blockquote>
<p>提示：如果修改了配置文件，必须重启打包才能生效。</p>
</blockquote>
<h2 id="打包-Vue"><a href="#打包-Vue" class="headerlink" title="打包 Vue"></a>打包 Vue</h2><p>1、安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -D vue-loader vue-template-compiler</span><br></pre></td></tr></table></figure>

<p>2、配置</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191124104029319.png" alt="image-20191124104029319"></p>
<p>3、打包测试</p>
<h2 id="配置可以省略的后缀名"><a href="#配置可以省略的后缀名" class="headerlink" title="配置可以省略的后缀名"></a>配置可以省略的后缀名</h2><p>webpack 默认只支持省略：</p>
<ul>
<li>.wasm</li>
<li>.mjs</li>
<li>.js</li>
<li>.json</li>
</ul>
<p>等文件的后缀名。</p>
<p>如果想要让其支持其它的可省略的后缀名，需要单独配置。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191124110450652.png" alt="image-20191124110450652"></p>
<h2 id="配置路径别名"><a href="#配置路径别名" class="headerlink" title="配置路径别名"></a>配置路径别名</h2><p>在 Vue CLI 项目中，使用过一个路径别名：<code>@</code>，它表示 <code>src</code> 的路径。</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191124111510567.png" alt="image-20191124111510567"></p>
<h2 id="使用-ESLint"><a href="#使用-ESLint" class="headerlink" title="使用 ESLint"></a>使用 ESLint</h2><p>ESLint 专门用于 JavaScript 代码格式校验工具。</p>
<ul>
<li>作者：<ul>
<li>《JavaScript 高级程序设计》</li>
<li>《深入理解 ECMAScript 6》</li>
<li>ESLint</li>
<li>。。。</li>
</ul>
</li>
</ul>
<p>1、安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install eslint eslint-loader --save-dev</span><br></pre></td></tr></table></figure>

<p>2、配置 webpack 配置文件</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20191124115208034.png" alt="image-20191124115208034"></p>
<blockquote>
<p>在 webpack 配置文件的 module.rules 中新增</p>
</blockquote>
<p>3、配置生成 eslint 配置文件</p>
<p>在终端下执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果你是 macOS 后者 Linux 系统，则使用 ./node_modules/.bin/eslint.cmd --init</span></span><br><span class="line">.\node_modules\.bin\eslint.cmd --init</span><br></pre></td></tr></table></figure>

<p>然后就是在终端中根据向导完成配置：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ .\node_modules\.bin\eslint.cmd --init</span><br><span class="line">? How would you like to use ESLint?</span><br><span class="line">  To<span class="built_in"> check </span>syntax only</span><br><span class="line">  To<span class="built_in"> check </span>syntax<span class="built_in"> and </span>find problems</span><br><span class="line">&gt; To<span class="built_in"> check </span>syntax, find problems,<span class="built_in"> and </span>enforce code style</span><br></pre></td></tr></table></figure>

<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ .\node_modules\.bin\eslint.cmd --init</span><br><span class="line">? How would you like to use ESLint? To<span class="built_in"> check </span>syntax, find problems,<span class="built_in"> and </span>enforce code style</span><br><span class="line">? What type of modules does your project use?</span><br><span class="line">&gt; JavaScript modules (import/export)</span><br><span class="line">  CommonJS (require/exports)</span><br><span class="line">  None of these</span><br></pre></td></tr></table></figure>

<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ .\node_modules\.bin\eslint.cmd --init</span><br><span class="line">? How would you like to use ESLint? To<span class="built_in"> check </span>syntax, find problems,<span class="built_in"> and </span>enforce code style</span><br><span class="line">? What type of modules does your project use? JavaScript modules (import/export)</span><br><span class="line">? Which framework does your project use?</span><br><span class="line">  React</span><br><span class="line">&gt; Vue.js</span><br><span class="line">  None of these</span><br></pre></td></tr></table></figure>

<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ .\node_modules\.bin\eslint.cmd --init</span><br><span class="line">? How would you like to use ESLint? To<span class="built_in"> check </span>syntax, find problems,<span class="built_in"> and </span>enforce code style</span><br><span class="line">? What type of modules does your project use? JavaScript modules (import/export)</span><br><span class="line">? Which framework does your project use? Vue.js</span><br><span class="line">? Does your project use TypeScript? (y/N) n</span><br></pre></td></tr></table></figure>

<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ .\node_modules\.bin\eslint.cmd <span class="comment">--init</span></span><br><span class="line">? How would you like <span class="keyword">to</span> <span class="keyword">use</span> ESLint? <span class="keyword">To</span> check syntax, find problems, <span class="keyword">and</span> enforce code style</span><br><span class="line">? What <span class="keyword">type</span> <span class="keyword">of</span> modules does your project <span class="keyword">use</span>? JavaScript modules (import/export)</span><br><span class="line">? Which framework does your project <span class="keyword">use</span>? Vue.js</span><br><span class="line">? Does your project <span class="keyword">use</span> TypeScript? No</span><br><span class="line">? Where does your code run? (Press &lt;space&gt; <span class="keyword">to</span> <span class="keyword">select</span>, &lt;a&gt; <span class="keyword">to</span> toggle <span class="keyword">all</span>, &lt;i&gt; <span class="keyword">to</span> invert selection)</span><br><span class="line">&gt;(*) Browser</span><br><span class="line"> ( ) Node</span><br></pre></td></tr></table></figure>

<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ .\node_modules\.bin\eslint.cmd --init</span><br><span class="line">? How would you like to <span class="keyword">use</span> ESLint? To check <span class="keyword">syntax</span>, find problems, and enforce code style</span><br><span class="line">? What <span class="keyword">type</span> of modules does your project <span class="keyword">use</span>? JavaScript modules (import/export)</span><br><span class="line">? <span class="keyword">Which</span> framework does your project <span class="keyword">use</span>? Vue.js</span><br><span class="line">? Does your project <span class="keyword">use</span> TypeScript? <span class="keyword">No</span></span><br><span class="line">? Where does your code <span class="keyword">run</span>? Browser</span><br><span class="line">? How would you like to define a style <span class="keyword">for</span> your project?</span><br><span class="line">&gt; <span class="keyword">Use</span> a popular style guide</span><br><span class="line">  Answer questions <span class="keyword">about</span> your style</span><br><span class="line">  <span class="keyword">Inspect</span> your JavaScript <span class="keyword">file</span>(s)</span><br></pre></td></tr></table></figure>

<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ .\node_modules\.bin\eslint.cmd --init</span><br><span class="line">? How would you like to <span class="keyword">use</span> ESLint? To check <span class="keyword">syntax</span>, find problems, and enforce code style</span><br><span class="line">? What <span class="keyword">type</span> of modules does your project <span class="keyword">use</span>? JavaScript modules (import/export)</span><br><span class="line">? <span class="keyword">Which</span> framework does your project <span class="keyword">use</span>? Vue.js</span><br><span class="line">? Does your project <span class="keyword">use</span> TypeScript? <span class="keyword">No</span></span><br><span class="line">? Where does your code <span class="keyword">run</span>? Browser</span><br><span class="line">? How would you like to define a style <span class="keyword">for</span> your project? <span class="keyword">Use</span> a popular style guide</span><br><span class="line">? <span class="keyword">Which</span> style guide <span class="keyword">do</span> you want to follow?</span><br><span class="line">  Airbnb: https:<span class="comment">//github.com/airbnb/javascript</span></span><br><span class="line">&gt; Standard: https:<span class="comment">//github.com/standard/standard</span></span><br><span class="line">  Google: https:<span class="comment">//github.com/google/eslint-config-google</span></span><br></pre></td></tr></table></figure>

<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ .\node_modules\.bin\eslint.cmd <span class="comment">--init</span></span><br><span class="line">? How would you <span class="keyword">like</span> <span class="keyword">to</span> use ESLint? <span class="keyword">To</span> <span class="keyword">check</span> syntax, find problems, <span class="keyword">and</span> enforce code style</span><br><span class="line">? What <span class="keyword">type</span> <span class="keyword">of</span> modules does your project use? JavaScript modules (<span class="keyword">import</span>/export)</span><br><span class="line">? Which framework does your project use? Vue.js</span><br><span class="line">? Does your project use TypeScript? <span class="keyword">No</span></span><br><span class="line">? <span class="keyword">Where</span> does your code run? Browser</span><br><span class="line">? How would you <span class="keyword">like</span> <span class="keyword">to</span> define a style <span class="keyword">for</span> your project? Use a popular style guide</span><br><span class="line">? Which style guide <span class="keyword">do</span> you want <span class="keyword">to</span> follow? Standard: https://github.com/standard/standard</span><br><span class="line">? What <span class="keyword">format</span> <span class="keyword">do</span> you want your config file <span class="keyword">to</span> be <span class="keyword">in</span>?</span><br><span class="line">&gt; JavaScript</span><br><span class="line">  YAML</span><br><span class="line">  <span class="type">JSON</span></span><br></pre></td></tr></table></figure>

<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ .\node_modules\.bin\eslint.cmd --init</span><br><span class="line">? How would you like to <span class="keyword">use</span> ESLint? To check <span class="keyword">syntax</span>, find problems, and enforce code style</span><br><span class="line">? What <span class="keyword">type</span> of modules does your project <span class="keyword">use</span>? JavaScript modules (import/export)</span><br><span class="line">? <span class="keyword">Which</span> framework does your project <span class="keyword">use</span>? Vue.js</span><br><span class="line">? Does your project <span class="keyword">use</span> TypeScript? <span class="keyword">No</span></span><br><span class="line">? Where does your code <span class="keyword">run</span>? Browser</span><br><span class="line">? How would you like to define a style <span class="keyword">for</span> your project? <span class="keyword">Use</span> a popular style guide</span><br><span class="line">? <span class="keyword">Which</span> style guide <span class="keyword">do</span> you want to follow? Standard: https:<span class="comment">//github.com/standard/standard</span></span><br><span class="line">? What <span class="keyword">format</span> <span class="keyword">do</span> you want your config <span class="keyword">file</span> to be <span class="keyword">in</span>? JavaScript</span><br><span class="line">Checking peerDependencies of eslint-config-standard@latest</span><br><span class="line">The config that you&#x27;ve selected requires the following dependencies:</span><br><span class="line"></span><br><span class="line">eslint-<span class="keyword">plugin</span>-vue@latest eslint-config-standard@latest eslint@&gt;=6.2.2 eslint-<span class="keyword">plugin</span>-import@&gt;=2.18.0 eslint-<span class="keyword">plugin</span>-node@&gt;=9.1.0 eslint-<span class="keyword">plugin</span>-promise@&gt;=4.2.1 eslint-<span class="keyword">plugin</span>-standard@&gt;=4.0.0</span><br><span class="line">? Would you like to install them now with npm? (Y/<span class="keyword">n</span>) y</span><br></pre></td></tr></table></figure>

<h3 id="自定义配置校验规则"><a href="#自定义配置校验规则" class="headerlink" title="自定义配置校验规则"></a>自定义配置校验规则</h3><p>ESLint 附带有大量的规则。你可以使用注释或配置文件修改你项目中要使用的规则。要改变一个规则设置，你必须将规则 ID 设置为下列值之一：</p>
<ul>
<li><code>&quot;off&quot;</code> 或 <code>0</code> - 关闭规则</li>
<li><code>&quot;warn&quot;</code> 或 <code>1</code> - 开启规则，使用警告级别的错误：<code>warn</code> (不会导致程序退出)</li>
<li><code>&quot;error&quot;</code> 或 <code>2</code> - 开启规则，使用错误级别的错误：<code>error</code> (当被触发的时候，程序会退出)</li>
</ul>
<p>详细的规则说明请查阅： <a target="_blank" rel="noopener" href="https://eslint.bootcss.com/docs/rules/">https://eslint.bootcss.com/docs/rules/</a> 。</p>
<p>也可以在代码中使用注释临时控制代码格式校验：</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/* eslint eqeqeq: <span class="string">&quot;off&quot;</span>, curly: <span class="string">&quot;error&quot;</span> */</span><br></pre></td></tr></table></figure>

<p>在这个例子里，<a target="_blank" rel="noopener" href="https://eslint.bootcss.com/docs/user-guide/rules/eqeqeq"><code>eqeqeq</code></a> 规则被关闭，<a target="_blank" rel="noopener" href="https://eslint.bootcss.com/docs/user-guide/rules/curly"><code>curly</code></a> 规则被打开，定义为错误级别。你也可以使用对应的数字定义规则严重程度：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/* eslint eqeqeq: 0, curly: 2 */</span></span><br></pre></td></tr></table></figure>

<p>更多配置，建议参考： <a target="_blank" rel="noopener" href="https://eslint.bootcss.com/docs/user-guide/configuring/">https://eslint.bootcss.com/docs/user-guide/configuring/</a> 。</p>
<h2 id="在-Vue-CLI-创建的项目中配置-webpack"><a href="#在-Vue-CLI-创建的项目中配置-webpack" class="headerlink" title="在 Vue CLI 创建的项目中配置 webpack"></a>在 Vue CLI 创建的项目中配置 webpack</h2><p>优化。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.bitbw.top/2021/01/02/Webpack/webpack%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo-header.jpg">
      <meta itemprop="name" content="Bowen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张博文的个人博客">
      <meta itemprop="description" content="vue js javaScript ts typeScript HTML css Sass less webpack git hexo  Node.js 算法 前端 小程序 技术个人博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 张博文的个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/01/02/Webpack/webpack%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">webpack入门(webpak4)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-01-02 16:09:17" itemprop="dateCreated datePublished" datetime="2021-01-02T16:09:17+00:00">2021-01-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-12-14 02:04:05" itemprop="dateModified" datetime="2022-12-14T02:04:05+00:00">2022-12-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Webpack/" itemprop="url" rel="index"><span itemprop="name">Webpack</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>23k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>21 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="webpack-基础知识"><a href="#webpack-基础知识" class="headerlink" title="webpack 基础知识"></a>webpack 基础知识</h2><h3 id="需要用到的包介绍"><a href="#需要用到的包介绍" class="headerlink" title="需要用到的包介绍"></a>需要用到的包介绍</h3><ul>
<li>webpack - webpack 的核心包</li>
<li>webpack-cli - webpack 的命令行工具</li>
<li>webpack-dev-server - webpack 的开发服务器 （热更新）</li>
</ul>
<h3 id="webpack-cil-命令参考"><a href="#webpack-cil-命令参考" class="headerlink" title="webpack-cil 命令参考"></a>webpack-cil 命令参考</h3><p><a target="_blank" rel="noopener" href="https://webpack.js.org/api/cli/">https://webpack.js.org/api/cli/</a></p>
<h3 id="webpack-的打包过程"><a href="#webpack-的打包过程" class="headerlink" title="webpack 的打包过程"></a>webpack 的打包过程</h3><p><img data-src="https://bitbw.top/public/img/my_gallery/web%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png"></p>
<h3 id="webpack-初体验"><a href="#webpack-初体验" class="headerlink" title="webpack 初体验"></a>webpack 初体验</h3><ul>
<li>webpack 将 ES6 的模块化编译成浏览器能够识别的模块化</li>
<li>webpack 默认只能打包 js 和 json 文件</li>
<li>生产环境和开发环境的区别 ，开发环境是经过压缩的代码</li>
</ul>
<p>使用命令行设置打包入口出口和 mode</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">webpack --entry  ./src/index.js -o ./dist --mode=development <span class="comment">#开发模式</span></span><br><span class="line"></span><br><span class="line">webpack --entry  ./src/index.js -o ./dist --mode=production <span class="comment">#生产模式</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="webpack-config-js"><a href="#webpack-config-js" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h3><blockquote>
<p>指示 webpack 来干那些活 当运行 webpack 指令时 会加载里面的配置</p>
</blockquote>
<h2 id="打包样式资源"><a href="#打包样式资源" class="headerlink" title="打包样式资源"></a>打包样式资源</h2><h4 id="下载插件"><a href="#下载插件" class="headerlink" title="下载插件"></a>下载插件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i css-loader style-loader less-loader less -D</span><br></pre></td></tr></table></figure>

<h4 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h4><h5 id="普通-css-文件"><a href="#普通-css-文件" class="headerlink" title="普通 css 文件"></a>普通 css 文件</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">//入口</span></span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  <span class="comment">//出口</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;bundle.js&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//模式 development 、 production</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="comment">// loader</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// 执行顺序由右到左</span></span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// plugins 插件 （数组）</span></span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.js 中引入样式 webpack 会通过import加载css 再通过 css-loader -&gt;style-loader 转换为style标签放在head中</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./index.css&quot;</span>;</span><br></pre></td></tr></table></figure>

<h5 id="引入-less-或-sass-样式处理文件"><a href="#引入-less-或-sass-样式处理文件" class="headerlink" title="引入 less 或 sass 样式处理文件"></a>引入 less 或 sass 样式处理文件</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rules 中 添加 less  或 sass 的处理规则</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">test</span>:<span class="regexp">/\.less$/</span>,</span><br><span class="line">    <span class="attr">use</span>:[</span><br><span class="line">      <span class="comment">//转化为style</span></span><br><span class="line">      <span class="string">&quot;style-loader&quot;</span>,</span><br><span class="line">      <span class="comment">// 处理css</span></span><br><span class="line">      <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">      <span class="comment">// 转化为css</span></span><br><span class="line">      <span class="string">&quot;less-loader&quot;</span></span><br><span class="line">    ]</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><p>less 和 sass 不光要下对应的 loader 还需要 less 或 sass 包</p>
<p>ps：node-sass 安装起来比较麻烦 可以参照 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhishaofei/p/12712937.html">https://www.cnblogs.com/zhishaofei/p/12712937.html</a></p>
<h2 id="打包-HTML-资源"><a href="#打包-HTML-资源" class="headerlink" title="打包 HTML 资源"></a>打包 HTML 资源</h2><h4 id="下载插件-1"><a href="#下载插件-1" class="headerlink" title="下载插件"></a>下载插件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev html-webpack-plugin</span><br></pre></td></tr></table></figure>

<p>tip: html-webpack-plugin 和 html-loader 的不同</p>
<ul>
<li>html-loader 是用来解析入口文件中关联的 html 中的 image 图片的引入</li>
<li>html-webpack-plugin 是用来自动生成最后 dist 目录下的 index.html (并自动导入打包好的 js)</li>
</ul>
<p>html-webpack-plugin 插件的更多配置见官网 ：<a target="_blank" rel="noopener" href="https://github.com/jantimon/html-webpack-plugin">https://github.com/jantimon/html-webpack-plugin</a></p>
<h4 id="修改配置-1"><a href="#修改配置-1" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;bundle.js&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// HtmlWebpackPlugin 会自动在output目录下生成index.html</span></span><br><span class="line">    <span class="comment">// 并自动引入打包好的 bundle.js</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 以./src/index.html 为模板 生成最后打包好的html</span></span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./src/index.html&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="打包图片资源"><a href="#打包图片资源" class="headerlink" title="打包图片资源"></a>打包图片资源</h2><h4 id="下载插件-2"><a href="#下载插件-2" class="headerlink" title="下载插件"></a>下载插件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev html-loader url-loader file-loader</span><br></pre></td></tr></table></figure>

<h4 id="修改配置-2"><a href="#修改配置-2" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;bunle.js&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&quot;&quot;</span>, <span class="comment">// webpack5 中html中导入image需要设置publicPath （升级html-webpack-plugin 到 5.xx可以不用）</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;less-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 解析图标 将小图标直接转base64 url-loader 依赖 file-loader 需要一起下载</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(jpg|png|gif)$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&quot;url-loader&quot;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">              <span class="comment">// 小于8kb的以base64位插入 data:image/jpeg;base64,/9j</span></span><br><span class="line">              <span class="comment">// 大于8kb的以改为hash值为名称的原文件插入</span></span><br><span class="line">              <span class="attr">limit</span>: <span class="number">8</span> * <span class="number">1024</span>,</span><br><span class="line">              <span class="attr">esModule</span>: <span class="literal">false</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 处理html文件的img图片（负责引入img，从而能被url-loader进行处理）</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.html$/</span>,</span><br><span class="line">        <span class="attr">use</span>: <span class="string">&quot;html-loader&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./index.html&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="打包其他资源（字体等）"><a href="#打包其他资源（字体等）" class="headerlink" title="打包其他资源（字体等）"></a>打包其他资源（字体等）</h2><h4 id="修改配置-3"><a href="#修改配置-3" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 处理其他资源</span></span><br><span class="line">  <span class="attr">exclude</span>: <span class="regexp">/\.(html|js|css|less|jpg|png|gif)/</span>,</span><br><span class="line">  <span class="attr">loader</span>: <span class="string">&#x27;file-loader&#x27;</span>,</span><br><span class="line">  <span class="attr">options</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;[hash:10].[ext]&#x27;</span>,</span><br><span class="line">    <span class="attr">outputPath</span>: <span class="string">&#x27;font&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="devServer"><a href="#devServer" class="headerlink" title="devServer"></a>devServer</h2><h4 id="下载插件-3"><a href="#下载插件-3" class="headerlink" title="下载插件"></a>下载插件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i webpack-dev-server -D</span><br></pre></td></tr></table></figure>

<h4 id="修改配置-4"><a href="#修改配置-4" class="headerlink" title="修改配置"></a>修改配置</h4><p>webpack.config.js 中添加</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开发服务器 devServer：用来自动化（自动编译，自动打开浏览器，自动刷新浏览器~~）</span></span><br><span class="line"><span class="comment">// 特点：只会在内存中编译打包，不会有任何输出</span></span><br><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="comment">// 项目构建后路径</span></span><br><span class="line">    <span class="attr">contentBase</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;build&#x27;</span>),</span><br><span class="line">    <span class="comment">// 启动gzip压缩</span></span><br><span class="line">    <span class="attr">compress</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 端口号</span></span><br><span class="line">    <span class="attr">port</span>: <span class="number">3000</span>,</span><br><span class="line">    <span class="comment">// 自动打开浏览器</span></span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="webpack-5"><a href="#webpack-5" class="headerlink" title="webpack 5"></a>webpack 5</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">  <span class="comment">// 告诉服务器从哪个目录中提供内容。只有在你想要提供静态文件时才需要。。</span></span><br><span class="line">  <span class="attr">static</span>: &#123;</span><br><span class="line">    <span class="attr">directory</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;public&quot;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 压缩</span></span><br><span class="line">  <span class="attr">compress</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">port</span>: <span class="number">9000</span>,</span><br><span class="line">  <span class="attr">hot</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">devMiddleware</span>: &#123;</span><br><span class="line">    <span class="comment">// 虚拟路径 devServer.publicPath 将用于确定应该从哪里提供 bundle，并且此选项优先</span></span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&quot;/public/&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p><strong>调用服务使用命令</strong></p>
<p>如全局安装 wabpack 直接: <code>webpack serve</code></p>
<p>没有全局安装 webpack :<code>npx webpack serve</code></p>
<p>启动服务后不会生成固定文件 devserver 会在内存中进行编译</p>
<h4 id="使用-express-作为开发服务器配置"><a href="#使用-express-作为开发服务器配置" class="headerlink" title="使用 express 作为开发服务器配置"></a>使用 express 作为开发服务器配置</h4><p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/guides/development/#using-webpack-dev-middleware">https://webpack.docschina.org/guides/development/#using-webpack-dev-middleware</a></p>
<h2 id="提取-css-文件为单独资源"><a href="#提取-css-文件为单独资源" class="headerlink" title="提取 css 文件为单独资源"></a>提取 css 文件为单独资源</h2><blockquote>
<p>用上面的方法打包出来的 css 都在 js 文件中 感觉加载时会闪一下 所以单独提炼出 css (使用 link 标签)</p>
</blockquote>
<h4 id="下载插件-4"><a href="#下载插件-4" class="headerlink" title="下载插件"></a>下载插件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev mini-css-extract-plugin</span><br></pre></td></tr></table></figure>

<h4 id="修改配置-5"><a href="#修改配置-5" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">   <span class="attr">rules</span>: [</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">       <span class="attr">use</span>: [</span><br><span class="line">         <span class="comment">// 这个loader取代style-loader。作用：提取js中的css成单独文件</span></span><br><span class="line">         <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">         <span class="string">&quot;css-loader&quot;</span></span><br><span class="line">       ]</span><br><span class="line">     &#125;</span><br><span class="line">   ]</span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">plugins</span>: [</span><br><span class="line">   <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">     <span class="attr">template</span>: <span class="string">&quot;./src/index.html&quot;</span></span><br><span class="line">   &#125;),</span><br><span class="line">   <span class="comment">// 对输出的css文件进行重命名</span></span><br><span class="line">   <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">     <span class="attr">filename</span>: <span class="string">&quot;css/index.css&quot;</span></span><br><span class="line">   &#125;),</span><br><span class="line"> ]</span><br></pre></td></tr></table></figure>

<h2 id="css-兼容性处理"><a href="#css-兼容性处理" class="headerlink" title="css 兼容性处理"></a>css 兼容性处理</h2><p>基于：<a target="_blank" rel="noopener" href="https://www.postcss.com.cn/">postcss</a></p>
<p>postcss 相当于一个启动器，里面可以装各种 插件 如 postcss-preset-env（预设环境） 和 autoprefixer(自动前缀)</p>
<h4 id="下载插件-5"><a href="#下载插件-5" class="headerlink" title="下载插件"></a>下载插件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev postcss-loader postcss-preset-env</span><br></pre></td></tr></table></figure>

<ul>
<li>postcss-loader ：</li>
</ul>
<blockquote>
<p>在所有 css | sass | less loader 前使用 作用： 使用 postcss 来解析 css</p>
</blockquote>
<ul>
<li>postcss-preset-env :</li>
</ul>
<blockquote>
<p>帮你将最新的 CSS 语法转换成大多数浏览器都能理解的语法，并根据你的目标浏览器或运行时环境来确定你需要的 polyfillss （postcss-preset-env 为 postcss 的 预设环境）</p>
</blockquote>
<h4 id="修改配置-6"><a href="#修改配置-6" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules</span>: [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">    <span class="attr">use</span>: [</span><br><span class="line">      <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">      <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">            css兼容性处理：postcss --&gt; postcss-loader -postcsspreset-env</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            帮postcss找到package.json中browserslist里面的配置，通过配置加载指定的css兼容性样式</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            &quot;browserslist&quot;: &#123;</span></span><br><span class="line"><span class="comment">              // 开发环境 --&gt; 设置node环境变量：process.env.NODE_ENV = development</span></span><br><span class="line"><span class="comment">              &quot;development&quot;: [</span></span><br><span class="line"><span class="comment">                &quot;last 1 chrome version&quot;,</span></span><br><span class="line"><span class="comment">                &quot;last 1 firefox version&quot;,</span></span><br><span class="line"><span class="comment">                &quot;last 1 safari version&quot;</span></span><br><span class="line"><span class="comment">              ],</span></span><br><span class="line"><span class="comment">              // 生产环境：默认是看生产环境</span></span><br><span class="line"><span class="comment">              &quot;production&quot;: [</span></span><br><span class="line"><span class="comment">                &quot;&gt;0.2%&quot;,</span></span><br><span class="line"><span class="comment">                &quot;not dead&quot;,</span></span><br><span class="line"><span class="comment">                &quot;not op_mini all&quot;</span></span><br><span class="line"><span class="comment">              ]</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">          */</span></span><br><span class="line">      <span class="comment">// 使用loader的默认配置</span></span><br><span class="line">      <span class="comment">// &#x27;postcss-loader&#x27;,</span></span><br><span class="line">      <span class="comment">// 修改loader的配置</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">          <span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">            <span class="attr">plugins</span>: [</span><br><span class="line">              [</span><br><span class="line">                <span class="string">&quot;postcss-preset-env&quot;</span>,</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="comment">// Options</span></span><br><span class="line">                &#125;,</span><br><span class="line">              ],</span><br><span class="line">              <span class="comment">// 或者 require(&quot;postcss-preset-env&quot;)()</span></span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h4 id="browserslist"><a href="#browserslist" class="headerlink" title="browserslist"></a>browserslist</h4><p>具体配置说明 <a target="_blank" rel="noopener" href="https://github.com/browserslist/browserslist">https://github.com/browserslist/browserslist</a></p>
<p>在 package.json 中配置 browserslist 或添加 .browserslistrc 文件</p>
<p>具体的环境是根据 process.env.NODE_ENV 确定， 所以需要设置 process.env.NODE_ENV ，只设置 mode: ‘production’ 不好使</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;browserslist&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;development&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;last 1 chrome version&quot;</span><span class="punctuation">,</span><span class="comment">//兼容最近的谷歌浏览器</span></span><br><span class="line">      <span class="string">&quot;last 1 firefox version&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;last 1 safari version&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;production&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;&gt;0.01%&quot;</span><span class="punctuation">,</span><span class="comment">//兼容&gt;0.01%</span></span><br><span class="line">      <span class="string">&quot;not dead&quot;</span><span class="punctuation">,</span><span class="comment">//不用管弃用的浏览器</span></span><br><span class="line">      <span class="string">&quot;not op_mini all&quot;</span><span class="comment">//不用op</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="压缩-css"><a href="#压缩-css" class="headerlink" title="压缩 css"></a>压缩 css</h2><p>webpack v4 使用 optimize-css-assets-webpack-plugin</p>
<p>对于 webpack v5 或更高版本，请改用 css-minimizer-webpack-plugin。</p>
<h4 id="下载插件-6"><a href="#下载插件-6" class="headerlink" title="下载插件"></a>下载插件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev css-minimizer-webpack-plugin</span><br></pre></td></tr></table></figure>

<h4 id="修改配置-7"><a href="#修改配置-7" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">CssMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;css-minimizer-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span> :...,</span><br><span class="line"><span class="attr">plugins</span>:...,</span><br><span class="line"><span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimize</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="comment">// For webpack@5 you can use the `...` syntax to extend existing minimizers (i.e. `terser-webpack-plugin`), uncomment the next line</span></span><br><span class="line">      <span class="comment">// `...`,</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">CssMinimizerPlugin</span>(),</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h2 id="js-语法检查"><a href="#js-语法检查" class="headerlink" title="js 语法检查"></a>js 语法检查</h2><h4 id="下载插件-7"><a href="#下载插件-7" class="headerlink" title="下载插件"></a>下载插件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev eslint-loader eslint eslint-config-airbnb-base eslint-plugin-import</span><br></pre></td></tr></table></figure>

<ul>
<li><p>eslint-loader 已经弃用 请使用 eslint-webpack-plugin</p>
</li>
<li><p>eslint-config-airbnb-base ：airbnb 标准的所以规则 需要<code>eslint</code>和<code>eslint-plugin-import</code>。</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev eslint-webpack-plugin</span><br></pre></td></tr></table></figure>

<h4 id="修改配置-8"><a href="#修改配置-8" class="headerlink" title="修改配置"></a>修改配置</h4><h5 id="eslint-loader-（已经弃用）"><a href="#eslint-loader-（已经弃用）" class="headerlink" title="eslint-loader （已经弃用）"></a>eslint-loader （已经弃用）</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        语法检查： eslint-loader  eslint</span></span><br><span class="line"><span class="comment">          注意：只检查自己写的源代码，第三方的库是不用检查的</span></span><br><span class="line"><span class="comment">          设置检查规则：</span></span><br><span class="line"><span class="comment">            package.json中eslintConfig中设置~</span></span><br><span class="line"><span class="comment">              &quot;eslintConfig&quot;: &#123;</span></span><br><span class="line"><span class="comment">                &quot;extends&quot;: &quot;airbnb-base&quot;</span></span><br><span class="line"><span class="comment">              &#125;</span></span><br><span class="line"><span class="comment">            airbnb --&gt; eslint-config-airbnb-base  eslint-plugin-import eslint</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&#x27;eslint-loader&#x27;</span>,</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">          <span class="comment">// 自动修复eslint的错误</span></span><br><span class="line">          <span class="attr">fix</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h5 id="eslint-webpack-plugin"><a href="#eslint-webpack-plugin" class="headerlink" title="eslint-webpack-plugin"></a>eslint-webpack-plugin</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">ESLintPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">plugins</span>: [<span class="keyword">new</span> <span class="title class_">ESLintPlugin</span>(options)],</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="eslint-的配置"><a href="#eslint-的配置" class="headerlink" title="eslint 的配置"></a>eslint 的配置</h5><p>在 package.json 中的<code>&quot;eslintConfig&quot;</code> 或者 <code>.eslintrc.js</code> 中修改 eslint 的配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">extends</span>: <span class="string">&quot;airbnb-base&quot;</span>,</span><br><span class="line"><span class="attr">env</span>: &#123;</span><br><span class="line">  <span class="attr">browser</span>: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">rules</span>: &#123;</span><br><span class="line">  <span class="string">&quot;no-console&quot;</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&quot;development&quot;</span> ? <span class="string">&quot;off&quot;</span> : <span class="string">&quot;warn&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>eslint 全配置：<a target="_blank" rel="noopener" href="https://eslint.bootcss.com/docs/user-guide/configuring#extending-configuration-files">https://eslint.bootcss.com/docs/user-guide/configuring#extending-configuration-files</a></p>
</blockquote>
<h2 id="js-兼容性处理"><a href="#js-兼容性处理" class="headerlink" title="js 兼容性处理"></a>js 兼容性处理</h2><h4 id="下载插件-8"><a href="#下载插件-8" class="headerlink" title="下载插件"></a>下载插件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev  babel babel-loader @babel/core @babel/preset-env @babel/polyfill core-js</span><br></pre></td></tr></table></figure>

<ul>
<li><p>@babel&#x2F;preset-env babel 预设环境</p>
</li>
<li><p>@babel&#x2F;polyfill 所有的转换包集合 Babel 7.4.0 开始，不赞成使用此软件包</p>
</li>
<li><p>core-js 是 babel-polyfill 的底层依赖 可以配合 useBuiltIns 选项实现按需加载</p>
</li>
</ul>
<h4 id="修改配置-9"><a href="#修改配置-9" class="headerlink" title="修改配置"></a>修改配置</h4><p>有两种方式配置 babel</p>
<ul>
<li>在 webpack.config.js 中配置</li>
<li>在 babel.config.js 中配置</li>
</ul>
<h5 id="在-webpack-config-js-中配置"><a href="#在-webpack-config-js-中配置" class="headerlink" title="在 webpack.config.js 中配置"></a>在 webpack.config.js 中配置</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">          <span class="attr">rootMode</span>: <span class="string">&quot;upward&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">          <span class="comment">// 预设：指示babel做怎么样的兼容性处理</span></span><br><span class="line">          <span class="attr">presets</span>: [</span><br><span class="line">            [</span><br><span class="line">              <span class="string">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="comment">// 按需加载</span></span><br><span class="line">                <span class="attr">useBuiltIns</span>: <span class="string">&#x27;usage&#x27;</span>,</span><br><span class="line">                <span class="comment">// 指定core-js版本</span></span><br><span class="line">                <span class="attr">corejs</span>: &#123;</span><br><span class="line">                  <span class="attr">version</span>: <span class="number">3</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="comment">// 指定兼容性做到哪个版本浏览器</span></span><br><span class="line">                <span class="attr">targets</span>: &#123;</span><br><span class="line">                  <span class="attr">chrome</span>: <span class="string">&#x27;60&#x27;</span>,</span><br><span class="line">                  <span class="attr">firefox</span>: <span class="string">&#x27;60&#x27;</span>,</span><br><span class="line">                  <span class="attr">ie</span>: <span class="string">&#x27;9&#x27;</span>,</span><br><span class="line">                  <span class="attr">safari</span>: <span class="string">&#x27;10&#x27;</span>,</span><br><span class="line">                  <span class="attr">edge</span>: <span class="string">&#x27;17&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h5 id="在-babel-config-js-中配置"><a href="#在-babel-config-js-中配置" class="headerlink" title="在 babel.config.js 中配置"></a>在 babel.config.js 中配置</h5><p>或者将配置放到项目根目录的 babel.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">  <span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">rootMode</span>: <span class="string">&quot;upward&quot;</span>,  <span class="comment">// 需要配置 rootMode: &quot;upward&quot; 意思是向上查找 找到 babel.config.[json | js]</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>babel.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 预设：指示 babel 做怎么样的兼容性处理</span></span><br><span class="line">  <span class="attr">presets</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">&quot;@babel/preset-env&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 按需加载</span></span><br><span class="line">        <span class="attr">useBuiltIns</span>: <span class="string">&quot;usage&quot;</span>,</span><br><span class="line">        <span class="comment">// 指定core-js版本</span></span><br><span class="line">        <span class="attr">corejs</span>: &#123;</span><br><span class="line">          <span class="attr">version</span>: <span class="number">3</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 指定兼容性做到哪个版本浏览器</span></span><br><span class="line">        <span class="attr">targets</span>: &#123;</span><br><span class="line">          <span class="attr">chrome</span>: <span class="string">&quot;60&quot;</span>,</span><br><span class="line">          <span class="attr">firefox</span>: <span class="string">&quot;60&quot;</span>,</span><br><span class="line">          <span class="attr">ie</span>: <span class="string">&quot;9&quot;</span>,</span><br><span class="line">          <span class="attr">safari</span>: <span class="string">&quot;10&quot;</span>,</span><br><span class="line">          <span class="attr">edge</span>: <span class="string">&quot;17&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="js-压缩和-html-压缩"><a href="#js-压缩和-html-压缩" class="headerlink" title="js 压缩和 html 压缩"></a>js 压缩和 html 压缩</h2><h4 id="修改配置-10"><a href="#修改配置-10" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">// 生产环境下会自动压缩js代码 和 html代码</span></span><br><span class="line"><span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span></span><br></pre></td></tr></table></figure>

<p>也可以自定义压缩配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">    <span class="attr">template</span>: <span class="string">&quot;./src/index.html&quot;</span>,</span><br><span class="line">    <span class="comment">// 当webpack的默认mode值为&#x27;production&#x27; 自动设置 minify: true</span></span><br><span class="line">    <span class="comment">// 全部配置查看：https://www.npmjs.com/package/html-webpack-plugin#minification</span></span><br><span class="line">    <span class="comment">// 压缩html代码</span></span><br><span class="line">    <span class="attr">minify</span>: &#123;</span><br><span class="line">      <span class="comment">// 移除空格</span></span><br><span class="line">      <span class="attr">collapseWhitespace</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// 移除注释</span></span><br><span class="line">      <span class="attr">removeComments</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;),</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h2 id="webpack-性能优化"><a href="#webpack-性能优化" class="headerlink" title="webpack 性能优化"></a>webpack 性能优化</h2><ul>
<li>开发环境性能优化</li>
<li>生产环境性能优化</li>
</ul>
<h3 id="开发环境性能优化"><a href="#开发环境性能优化" class="headerlink" title="开发环境性能优化"></a>开发环境性能优化</h3><ul>
<li>优化打包构建速度<ul>
<li>HMR</li>
</ul>
</li>
<li>优化代码调试<ul>
<li>source-map</li>
</ul>
</li>
</ul>
<h3 id="生产环境性能优化"><a href="#生产环境性能优化" class="headerlink" title="生产环境性能优化"></a>生产环境性能优化</h3><ul>
<li>优化打包构建速度<ul>
<li>oneOf</li>
<li>babel 缓存</li>
<li>多进程打包</li>
<li>externals</li>
<li>dll</li>
</ul>
</li>
<li>优化代码运行的性能<ul>
<li>缓存(hash-chunkhash-contenthash)</li>
<li>tree shaking</li>
<li>code split</li>
<li>懒加载&#x2F;预加载</li>
<li>pwa</li>
</ul>
</li>
</ul>
<h2 id="HMR"><a href="#HMR" class="headerlink" title="HMR"></a>HMR</h2><h3 id="tip"><a href="#tip" class="headerlink" title="tip"></a>tip</h3><p>webpack 5 需要使用 npm i <a href="mailto:&#x77;&#x65;&#x62;&#x70;&#97;&#x63;&#107;&#x2d;&#x64;&#101;&#118;&#45;&#115;&#x65;&#114;&#118;&#x65;&#x72;&#x40;&#x34;&#x2e;&#x30;&#x2e;&#x30;&#45;&#98;&#101;&#116;&#x61;&#46;&#48;">&#x77;&#x65;&#x62;&#x70;&#97;&#x63;&#107;&#x2d;&#x64;&#101;&#118;&#45;&#115;&#x65;&#114;&#118;&#x65;&#x72;&#x40;&#x34;&#x2e;&#x30;&#x2e;&#x30;&#45;&#98;&#101;&#116;&#x61;&#46;&#48;</a></p>
<p>但是目前 4.0.0-beta.0 还不完善 文档没有更新 热模块重载不好使</p>
<h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>hot module replacement 热模块替换 &#x2F; 模块热替换</p>
<h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>一个模块发生变化，只会重新打包这一个模块（而不是打包所有模块）<br>极大提升构建速度</p>
<ul>
<li><p>样式文件：可以使用 HMR 功能：因为 style-loader 内部实现了~</p>
<ul>
<li>js 文件：默认不能使用 HMR 功能 –&gt; 需要修改 js 代码，添加支持 HMR 功能的代码<br>注意：HMR 功能对 js 的处理，只能处理非入口 js 文件的其他文件。</li>
<li>html 文件: 默认不能使用 HMR 功能.同时会导致问题：html 文件不能热更新了~ （不用做 HMR 功能）<br>解决：修改 entry 入口，将 html 文件引入</li>
</ul>
</li>
</ul>
<h3 id="各大框架的-loader-内部支持了-HMR"><a href="#各大框架的-loader-内部支持了-HMR" class="headerlink" title="各大框架的 loader 内部支持了 HMR"></a>各大框架的 loader 内部支持了 HMR</h3><ul>
<li>React Hot Loader: 实时调整 react 组件。</li>
<li>Vue Loader: 此 loader 支持 vue 组件的 HMR，提供开箱即用体验。</li>
<li>Elm Hot webpack Loader: 支持 Elm 编程语言的 HMR。</li>
<li>Angular HMR: 没有必要使用 loader！直接修改 NgModule 主文件就够了</li>
</ul>
<h4 id="修改配置-11"><a href="#修改配置-11" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4.0 开启热更新</span></span><br><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">contentBase</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">    <span class="comment">// 开启HMR功能</span></span><br><span class="line">    <span class="comment">// 当修改了webpack配置，新配置要想生效，必须重新webpack服务</span></span><br><span class="line">    <span class="attr">hot</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">compress</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">3000</span>,</span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h2 id="source-map"><a href="#source-map" class="headerlink" title="source-map"></a>source-map</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">source-<span class="attr">map</span>: 一种 提供源代码到构建后代码映射 技术 （如果构建后代码出错了，通过映射可以追踪源代码错误）</span><br><span class="line"></span><br><span class="line">    [inline-|hidden-|<span class="built_in">eval</span>-][nosources-][cheap-[<span class="variable language_">module</span>-]]source-map</span><br><span class="line"></span><br><span class="line">    source-map：外部</span><br><span class="line">      错误代码准确信息 和 源代码的错误位置</span><br><span class="line">    inline-source-map：内联</span><br><span class="line">      只生成一个内联source-map</span><br><span class="line">      错误代码准确信息 和 源代码的错误位置</span><br><span class="line">    hidden-source-map：外部</span><br><span class="line">      错误代码错误原因，但是没有错误位置</span><br><span class="line">      不能追踪源代码错误，只能提示到构建后代码的错误位置</span><br><span class="line">    <span class="built_in">eval</span>-source-map：内联</span><br><span class="line">      每一个文件都生成对应的source-map，都在<span class="built_in">eval</span></span><br><span class="line">      错误代码准确信息 和 源代码的错误位置</span><br><span class="line">    nosources-source-map：外部</span><br><span class="line">      错误代码准确信息, 但是没有任何源代码信息</span><br><span class="line">    cheap-source-map：外部</span><br><span class="line">      错误代码准确信息 和 源代码的错误位置</span><br><span class="line">      只能精确的行</span><br><span class="line">    cheap-<span class="variable language_">module</span>-source-map：外部</span><br><span class="line">      错误代码准确信息 和 源代码的错误位置</span><br><span class="line">      <span class="variable language_">module</span>会将loader的source map加入</span><br><span class="line"></span><br><span class="line">    内联 和 外部的区别：<span class="number">1.</span> 外部生成了文件，内联没有 <span class="number">2.</span> 内联构建速度更快</span><br><span class="line"></span><br><span class="line">    开发环境：速度快，调试更友好</span><br><span class="line">      速度快(<span class="built_in">eval</span>&gt;inline&gt;cheap&gt;...)</span><br><span class="line">        <span class="built_in">eval</span>-cheap-souce-map</span><br><span class="line">        <span class="built_in">eval</span>-source-map</span><br><span class="line">      调试更友好</span><br><span class="line">        souce-map</span><br><span class="line">        cheap-<span class="variable language_">module</span>-souce-map</span><br><span class="line">        cheap-souce-map</span><br><span class="line"></span><br><span class="line">      --&gt; <span class="built_in">eval</span>-source-map  / <span class="built_in">eval</span>-cheap-<span class="variable language_">module</span>-souce-map</span><br><span class="line"></span><br><span class="line">    生产环境：源代码要不要隐藏? 调试要不要更友好</span><br><span class="line">      内联会让代码体积变大，所以在生产环境不用内联</span><br><span class="line">      nosources-source-map 全部隐藏</span><br><span class="line">      hidden-source-map 只隐藏源代码，会提示构建后代码错误信息</span><br><span class="line"></span><br><span class="line">      --&gt; source-map / cheap-<span class="variable language_">module</span>-souce-map</span><br></pre></td></tr></table></figure>

<h4 id="修改配置-12"><a href="#修改配置-12" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开发环境</span></span><br><span class="line"><span class="attr">devtool</span>: <span class="string">&quot;eval-source-map&quot;</span>;</span><br><span class="line"><span class="comment">// 生产环境</span></span><br><span class="line"><span class="attr">devtool</span>: <span class="string">&quot;source-map&quot;</span>; <span class="comment">// 根据需求进行选择</span></span><br></pre></td></tr></table></figure>

<h2 id="oneOf"><a href="#oneOf" class="headerlink" title="oneOf"></a>oneOf</h2><p>oneOf：让一个文件只有一个 loader 处理 ，找打对应的 loader 就不往下遍历了。</p>
<h4 id="修改配置-13"><a href="#修改配置-13" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">  <span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line"><span class="comment">// 需要每个类型的文件都处理的loader 单独在oneOf外面</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//  oneOf 内部 一个 rule 只处理一个类型 找到对应类型的 rule 就不再继续往下遍历</span></span><br><span class="line">      <span class="attr">oneOf</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">          <span class="attr">use</span>: styleCommonLodar</span><br><span class="line">        &#125;,</span><br><span class="line">      ...</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h4 id="优化效果"><a href="#优化效果" class="headerlink" title="优化效果"></a>优化效果</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#优化前</span></span><br><span class="line">webpack 5.22.0 compiled with 1 warning <span class="keyword">in</span> 12820 ms</span><br><span class="line"><span class="comment">#优化后</span></span><br><span class="line">webpack 5.22.0 compiled with 1 warning <span class="keyword">in</span> 9615 ms</span><br></pre></td></tr></table></figure>

<h2 id="babel-缓存"><a href="#babel-缓存" class="headerlink" title="babel 缓存"></a>babel 缓存</h2><p>缓存文件会放在 <code>node_modules\.cache\babel-loader</code>中，如果编译的不对删除这个文件再试</p>
<h4 id="修改配置-14"><a href="#修改配置-14" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">  <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">  <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">  <span class="attr">options</span>: &#123;</span><br><span class="line">    <span class="comment">// 开启babel缓存</span></span><br><span class="line">    <span class="comment">// 第二次构建时，会读取之前的缓存</span></span><br><span class="line">    <span class="comment">// 缓存文件会放在 node_modules\.cache\babel-loader中  如果编译的不对删除这个文件再试</span></span><br><span class="line">    <span class="attr">cacheDirectory</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">rootMode</span>: <span class="string">&quot;upward&quot;</span> <span class="comment">// 需要配置 rootMode: &quot;upward&quot; 意思是向上查找 找到 babel.config.[json | js]</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h4 id="优化效果-1"><a href="#优化效果-1" class="headerlink" title="优化效果"></a>优化效果</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#优化前</span></span><br><span class="line">webpack 5.22.0 compiled with 1 warning <span class="keyword">in</span> 11641 ms</span><br><span class="line"><span class="comment">#优化后 再次打包</span></span><br><span class="line">webpack 5.22.0 compiled with 1 warning <span class="keyword">in</span> 8476 ms</span><br></pre></td></tr></table></figure>

<h2 id="tree-shaking-树摇"><a href="#tree-shaking-树摇" class="headerlink" title="tree shaking 树摇"></a>tree shaking 树摇</h2><p>tree shaking：去除无用代码</p>
<h4 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h4><ol>
<li><p>必须使用 ES6 模块化</p>
</li>
<li><p>开启 production 环境</p>
</li>
</ol>
<h4 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h4><p>减少代码体积</p>
<h4 id="修改配置-15"><a href="#修改配置-15" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>;</span><br></pre></td></tr></table></figure>

<h5 id="sideEffects"><a href="#sideEffects" class="headerlink" title="sideEffects"></a>sideEffects</h5><p>在 package.json 中配置 sideEffects ：副作用 （导入了例如 css less 等样式 ，代码上是没用到的 ，但是需要保留的 ）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="string">&quot;sideEffects&quot;</span>: <span class="literal">false</span></span><br><span class="line"><span class="comment">//所有代码都没有副作用（都可以进行tree shaking） 问题：可能会把css / @babel/polyfill （副作用）文件干掉</span></span><br><span class="line"><span class="string">&quot;sideEffects&quot;</span>: [<span class="string">&quot;*.css&quot;</span>, <span class="string">&quot;*.less&quot;</span>,<span class="string">&quot;*iconfont.js&quot;</span> ] <span class="comment">//当需要保留的文件名放到数组中</span></span><br></pre></td></tr></table></figure>

<h4 id="官方结论"><a href="#官方结论" class="headerlink" title="官方结论"></a>官方结论</h4><p>因此，我们学到为了利用 <em>tree shaking</em> 的优势， 你必须…</p>
<ul>
<li>使用 ES2015 模块语法（即 <code>import</code> 和 <code>export</code>）。</li>
<li>确保没有编译器将您的 ES2015 模块语法转换为 CommonJS 的（顺带一提，这是现在常用的 @babel&#x2F;preset-env 的默认行为，详细信息请参阅<a target="_blank" rel="noopener" href="https://babeljs.io/docs/en/babel-preset-env#modules">文档</a>）。</li>
<li>在项目的 <code>package.json</code> 文件中，添加 <code>&quot;sideEffects&quot;</code> 属性。</li>
<li>使用 <code>mode</code> 为 <code>&quot;production&quot;</code> 的配置项以启用<a target="_blank" rel="noopener" href="https://webpack.docschina.org/concepts/mode/#usage">更多优化项</a>，包括压缩代码与 tree shaking。</li>
</ul>
<p>你可以将应用程序想象成一棵树。绿色表示实际用到的 source code(源码) 和 library(库)，是树上活的树叶。灰色表示未引用代码，是秋天树上枯萎的树叶。为了除去死去的树叶，你必须摇动这棵树，使它们落下。</p>
<h2 id="code-split-代码分割"><a href="#code-split-代码分割" class="headerlink" title="code split 代码分割"></a>code split 代码分割</h2><h4 id="修改配置-16"><a href="#修改配置-16" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="attr">output</span>: &#123;</span><br><span class="line">  <span class="comment">// 这里使用 chunk name  +  contenthash 进行命名</span></span><br><span class="line">  <span class="attr">filename</span>: <span class="string">&#x27;js/[name].[contenthash:10].js&#x27;</span>,</span><br><span class="line">  <span class="comment">//..</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">optimization</span>: &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="comment">// 代码块 切割</span></span><br><span class="line">  <span class="comment">// 可以将node_modules中代码单独打包一个chunk最终输出 如果想分割node_modules中的代码需要配合dll</span></span><br><span class="line">  <span class="comment">// 项目的中业务代码通过 import() 语法进行分割</span></span><br><span class="line">  <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">    <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="修改业务代码"><a href="#修改业务代码" class="headerlink" title="修改业务代码"></a>修改业务代码</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 需要进行切割的js需要使用 import() 异步引入使用</span></span><br><span class="line"><span class="comment">// /* webpackChunkName: &#x27;test01&#x27; */ test01 代表分割后 ChunkName, 比如以上配置会生成  test01.f20318151f.js</span></span><br><span class="line"><span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &#x27;test01&#x27; */</span> <span class="string">&quot;./test&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; mul, count &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Bowen: mul&quot;</span>, mul);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="PWA"><a href="#PWA" class="headerlink" title="PWA"></a>PWA</h2><h3 id="下载插件-9"><a href="#下载插件-9" class="headerlink" title="下载插件"></a>下载插件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启 service worker</span></span><br><span class="line">npm install --save-dev workbox-webpack-plugin</span><br><span class="line"><span class="comment"># 生成清单文件 manifest.json</span></span><br><span class="line">npm install --save-dev webpack-pwa-manifest</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="修改配置-17"><a href="#修改配置-17" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pwa</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">WorkboxWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;workbox-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// 建议放到最下面  放到MiniCssExtractPlugin 会报错 Error: Cannot find module &#x27;optimize-css-assets-webpack-plugin</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">WorkboxWebpackPlugin</span>.<span class="title class_">GenerateSW</span>(&#123;</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        1. 帮助serviceworker快速启动</span></span><br><span class="line"><span class="comment">        2. 删除旧的 serviceworker</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        生成一个 serviceworker 配置文件~</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      <span class="attr">clientsClaim</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">skipWaiting</span>: <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 生成清单文件 manifest.json  的目的是将Web应用程序安装到设备的主屏幕 谷歌上会提示下载图标</span></span><br><span class="line">    <span class="comment">// https://developer.mozilla.org/zh-CN/docs/Web/Manifest</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">WebpackPwaManifest</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;My Progressive Web App&#x27;</span>,</span><br><span class="line">      <span class="attr">short_name</span>: <span class="string">&#x27;MyPWA&#x27;</span>,</span><br><span class="line">      <span class="attr">description</span>: <span class="string">&#x27;My awesome Progressive Web App!&#x27;</span>,</span><br><span class="line">      <span class="attr">background_color</span>: <span class="string">&#x27;#ffffff&#x27;</span>,</span><br><span class="line">      <span class="attr">crossorigin</span>: <span class="string">&#x27;use-credentials&#x27;</span>, <span class="comment">//can be null, use-credentials or anonymous</span></span><br><span class="line">      <span class="attr">icons</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">src</span>: <span class="title function_">resolve</span>(<span class="string">&#x27;src/assets/icon.png&#x27;</span>),</span><br><span class="line">          <span class="attr">sizes</span>: [<span class="number">96</span>, <span class="number">128</span>, <span class="number">192</span>, <span class="number">256</span>, <span class="number">384</span>, <span class="number">512</span>], <span class="comment">// multiple sizes</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">src</span>: <span class="title function_">resolve</span>(<span class="string">&#x27;src/assets/icon.png&#x27;</span>),</span><br><span class="line">          <span class="attr">size</span>: <span class="string">&#x27;1024x1024&#x27;</span>, <span class="comment">// you can also use the specifications pattern</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">src</span>: <span class="title function_">resolve</span>(<span class="string">&#x27;src/assets/icon.png&#x27;</span>),</span><br><span class="line">          <span class="attr">size</span>: <span class="string">&#x27;1024x1024&#x27;</span>,</span><br><span class="line">          <span class="attr">purpose</span>: <span class="string">&#x27;maskable&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;),</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="业务代码修改"><a href="#业务代码修改" class="headerlink" title="业务代码修改"></a>业务代码修改</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  1. eslint不认识 window、navigator全局变量</span></span><br><span class="line"><span class="comment">    解决：需要修改package.json中eslintConfig配置</span></span><br><span class="line"><span class="comment">      &quot;env&quot;: &#123;</span></span><br><span class="line"><span class="comment">        &quot;browser&quot;: true // 支持浏览器端全局变量</span></span><br><span class="line"><span class="comment">      &#125;</span></span><br><span class="line"><span class="comment">   2. sw代码必须运行在服务器上</span></span><br><span class="line"><span class="comment">      --&gt; nodejs</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line"><span class="comment">        npm i serve -g</span></span><br><span class="line"><span class="comment">        serve -s build 启动服务器，将build目录下所有资源作为静态资源暴露出去</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 注册serviceWorker</span></span><br><span class="line"><span class="comment">// 处理兼容性问题</span></span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;serviceWorker&quot;</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;load&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    navigator.<span class="property">serviceWorker</span></span><br><span class="line">      .<span class="title function_">register</span>(<span class="string">&quot;/service-worker.js&quot;</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;sw注册成功了~&quot;</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;sw注册失败了~&quot;</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="多进程打包"><a href="#多进程打包" class="headerlink" title="多进程打包"></a>多进程打包</h2><p>官方文档：<a target="_blank" rel="noopener" href="https://webpack.docschina.org/loaders/thread-loader/#root">https://webpack.docschina.org/loaders/thread-loader/#root</a></p>
<h3 id="下载依赖"><a href="#下载依赖" class="headerlink" title="下载依赖"></a>下载依赖</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev thread-loader</span><br></pre></td></tr></table></figure>

<h3 id="修改配置-18"><a href="#修改配置-18" class="headerlink" title="修改配置"></a>修改配置</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">include</span>: path.<span class="title function_">resolve</span>(<span class="string">&quot;src&quot;</span>),</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">          开启多进程打包</span></span><br><span class="line"><span class="comment">          进程启动大概为600ms，进程通信也有开销。</span></span><br><span class="line"><span class="comment">          只有工作消耗时间比较长，才需要多进程打包</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="string">&quot;thread-loader&quot;</span>,</span><br><span class="line">          <span class="comment">// 耗时的 loader （例如 babel-loader）</span></span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="externals-外部扩展-（排除无需打包的外部依赖）"><a href="#externals-外部扩展-（排除无需打包的外部依赖）" class="headerlink" title="externals 外部扩展 （排除无需打包的外部依赖）"></a>externals 外部扩展 （排除无需打包的外部依赖）</h2><p>官方文档：<a target="_blank" rel="noopener" href="https://webpack.docschina.org/configuration/externals/">https://webpack.docschina.org/configuration/externals/</a><br>防止将某些 import 的包(package)打包到 bundle 中，而是在运行时(runtime)再去从外部获取这些扩展依赖(external dependencies)。<br>例如，从 CDN 引入 react，而不是把它打包</p>
<h3 id="修改-html-模板"><a href="#修改-html-模板" class="headerlink" title="修改 html 模板"></a>修改 html 模板</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">  <span class="attr">crossorigin</span></span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/react@17/umd/react.production.min.js&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">  <span class="attr">crossorigin</span></span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/react-dom@17/umd/react-dom.production.min.js&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="修改配置-19"><a href="#修改配置-19" class="headerlink" title="修改配置"></a>修改配置</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="attr">externals</span>: &#123;</span><br><span class="line">    <span class="comment">// 拒绝react被打包进来</span></span><br><span class="line">    <span class="comment">// key -&gt; import react from &quot;react&quot; 中的 &quot;react&quot;</span></span><br><span class="line">    <span class="comment">// value -&gt; react 的命名空间 namespace React</span></span><br><span class="line">    <span class="attr">react</span>: <span class="string">&quot;React&quot;</span>,</span><br><span class="line">    <span class="string">&quot;react-dom&quot;</span>: <span class="string">&quot;ReactDOM&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="DllPlugin-（打包优化）"><a href="#DllPlugin-（打包优化）" class="headerlink" title="DllPlugin （打包优化）"></a>DllPlugin （打包优化）</h2><p>官方文档：<a target="_blank" rel="noopener" href="https://webpack.docschina.org/plugins/dll-plugin/">https://webpack.docschina.org/plugins/dll-plugin/</a><br>dll 主要用户用于将第三方依赖 或者公共依赖 进行打包， 目的与 externals 差不多都是为了加快构建速度</p>
<h2 id="添加-webpack-dll-js"><a href="#添加-webpack-dll-js" class="headerlink" title="添加 webpack.dll.js"></a>添加 webpack.dll.js</h2><p>webpack.dll.js 专门用于打包第三方依赖 或者公共依赖</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *    webpack.dll.js</span></span><br><span class="line"><span class="comment"> *   使用dll技术，对某些库（第三方库：jquery、react、vue...）进行单独打包</span></span><br><span class="line"><span class="comment"> *     当你运行 webpack 时，默认查找 webpack.config.js 配置文件</span></span><br><span class="line"><span class="comment"> *     需求：需要运行 webpack.dll.js 文件</span></span><br><span class="line"><span class="comment"> *       --&gt; webpack --config webpack.dll.js</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@format</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 清理上次的打包文件</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;clean-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="comment">// 最终打包生成的 vendor --&gt; MyDll.[name].js  name=vendor</span></span><br><span class="line">    <span class="comment">// [&#x27;react&#x27;,&#x27;&#x27;react-dom&#x27;] --&gt; 要打包的库是react  跟包名一致react</span></span><br><span class="line">    <span class="attr">vendor</span>: [<span class="string">&quot;react&quot;</span>, <span class="string">&quot;react-dom&quot;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// 生成文件名</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;[name].dll.js&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dll&quot;</span>),</span><br><span class="line">    <span class="comment">// 打包的库里面向外暴露出去的内容叫什么名字（全局变量名） 需要和 webpack.DllPlugin 中的 name 抱持一致</span></span><br><span class="line">    <span class="attr">library</span>: <span class="string">&quot;[name]_[fullhash]_library&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(),</span><br><span class="line">    <span class="comment">// 打包生成一个 manifest.json --&gt; 提供和react映射 manifest.json中映射library名称</span></span><br><span class="line">    <span class="keyword">new</span> webpack.<span class="title class_">DllPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;[name]_[fullhash]_library&quot;</span>, <span class="comment">// 映射库的暴露的内容名称 不用管叫什么 打包后的代码会使用 咱们构建前的代码还是该怎么使就怎么使</span></span><br><span class="line">      <span class="attr">path</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dll/manifest.json&quot;</span>), <span class="comment">// 生成的清单文件 包含了react 和 react-dom</span></span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>执行 <code>npx webpack --config webpack.dll.js</code><br>会在当前目录下生成 dll 目录</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dll</span><br><span class="line">├── manifest<span class="selector-class">.json</span> <span class="comment">// 清单</span></span><br><span class="line">├── vendor<span class="selector-class">.dll</span><span class="selector-class">.js</span> <span class="comment">// 第三方包的集合</span></span><br><span class="line">└── vendor<span class="selector-class">.dll</span><span class="selector-class">.js</span><span class="selector-class">.LICENSE</span>.txt</span><br></pre></td></tr></table></figure>

<p>manifest.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vendor_311590c415821fbaedf4_library&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;../node_modules/react/index.js&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">378</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;buildMeta&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;exportsType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dynamic&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;defaultObject&quot;</span><span class="punctuation">:</span> <span class="string">&quot;redirect&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;exports&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;Children&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;Component&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;Fragment&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;Profiler&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;PureComponent&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;StrictMode&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;Suspense&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;cloneElement&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;createContext&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;createElement&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;createFactory&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;createRef&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;forwardRef&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;isValidElement&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;lazy&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;memo&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;useCallback&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;useContext&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;useDebugValue&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;useEffect&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;useImperativeHandle&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;useLayoutEffect&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;useMemo&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;useReducer&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;useRef&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;useState&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;version&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;../node_modules/react-dom/index.js&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">542</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;buildMeta&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;exportsType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dynamic&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;defaultObject&quot;</span><span class="punctuation">:</span> <span class="string">&quot;redirect&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;exports&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;createPortal&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;findDOMNode&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;flushSync&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;hydrate&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;render&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;unmountComponentAtNode&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;unstable_batchedUpdates&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;unstable_createPortal&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;unstable_renderSubtreeIntoContainer&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;version&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="修改配置-20"><a href="#修改配置-20" class="headerlink" title="修改配置"></a>修改配置</h2><p>webpack.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"><span class="comment">// 自动在html中引入资源插件 (不用插件 手动在模板html中添加也可以)</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AddAssetHtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;add-asset-html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// 告诉webpack哪些库不参与打包</span></span><br><span class="line">    <span class="keyword">new</span> webpack.<span class="title class_">DllReferencePlugin</span>(&#123;</span><br><span class="line">      <span class="attr">manifest</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dll/manifest.json&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 将某个文件打包输出去，并在html中自动引入该资源</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">AddAssetHtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">filepath</span>: <span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dll/vendor.dll.js&quot;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>打包生成的结构</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dist</span><br><span class="line">├── assets</span><br><span class="line">├── css</span><br><span class="line">├── index<span class="selector-class">.html</span>  <span class="comment">// html中引入 vendor.dll.js &lt;script defer=&quot;defer&quot; src=&quot;./vendor.dll.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line">├── js</span><br><span class="line">├── vendor<span class="selector-class">.dll</span><span class="selector-class">.js</span> <span class="comment">// 将dll下的 vendor.dll.js  放到当前打包后的目录下</span></span><br><span class="line">└── vendor<span class="selector-class">.dll</span><span class="selector-class">.js</span><span class="selector-class">.LICENSE</span>.txt</span><br></pre></td></tr></table></figure>

<h2 id="DLL-和-externals-、code-split-的区别"><a href="#DLL-和-externals-、code-split-的区别" class="headerlink" title="DLL 和 externals 、code split 的区别"></a>DLL 和 externals 、code split 的区别</h2><h3 id="DLL"><a href="#DLL" class="headerlink" title="DLL"></a>DLL</h3><ul>
<li>用于将第三方依赖单独打包构建，跟项目一起放到同一个服务器下进行加载</li>
<li>优点：优化项目本地的构建速度</li>
</ul>
<h3 id="externals"><a href="#externals" class="headerlink" title="externals"></a>externals</h3><ul>
<li>不打包第三方依赖，第三方依赖使用 CDN</li>
<li>优点：优化项目本地的构建速度，因为使用 CDN 优化第三方依赖加载速度</li>
</ul>
<h3 id="code-split"><a href="#code-split" class="headerlink" title="code split"></a>code split</h3><ul>
<li>将项目中的进行模块代码分割成多个 js 文件</li>
<li>优点：优化项目本身加载速度，依靠代码分割可以实现模块的懒加载和预加载</li>
</ul>
<h2 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h2><h3 id="生产环境配置官方文档"><a href="#生产环境配置官方文档" class="headerlink" title="生产环境配置官方文档"></a>生产环境配置官方文档</h3><p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/guides/production/">https://webpack.docschina.org/guides/production/</a></p>
<h3 id="css-压缩、提取"><a href="#css-压缩、提取" class="headerlink" title="css 压缩、提取"></a>css 压缩、提取</h3><p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/plugins/mini-css-extract-plugin/#minimizing-for-production">https://webpack.docschina.org/plugins/mini-css-extract-plugin/#minimizing-for-production</a></p>
<h2 id="每次打包清除打包文件"><a href="#每次打包清除打包文件" class="headerlink" title="每次打包清除打包文件"></a>每次打包清除打包文件</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>);</span><br><span class="line">...</span><br><span class="line"><span class="attr">plugins</span>:[</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="报错"><a href="#报错" class="headerlink" title="报错"></a>报错</h2><p>Error: Automatic publicPath is not supported in this browser</p>
<p>设置 output 中 publicPath: ‘’ 为空字符串</p>
<h2 id="tip-：项目中的基础知识"><a href="#tip-：项目中的基础知识" class="headerlink" title="tip ：项目中的基础知识"></a>tip ：项目中的基础知识</h2><h3 id="node-模块的搜索流程"><a href="#node-模块的搜索流程" class="headerlink" title="node 模块的搜索流程"></a>node 模块的搜索流程</h3><blockquote>
<p>node 在使用模块名来引入模块时,会首先在当前目录的 node_modules 中寻找是否有该模块<br>如果有则直接使用,如果没有则会一直向上一级目录的 node_modules 中寻找，直到磁盘的根目录</p>
</blockquote>
<h3 id="browserslistrc"><a href="#browserslistrc" class="headerlink" title=".browserslistrc"></a>.browserslistrc</h3><p>对应 package.json 中的 browserslist</p>
<p>postcss-preset-env 会找到 browserslist 作为兼容的基础</p>
<p>browserslist 配置 <a target="_blank" rel="noopener" href="https://github.com/browserslist/browserslist">https://github.com/browserslist/browserslist</a></p>
<h3 id="eslintrc-js"><a href="#eslintrc-js" class="headerlink" title=".eslintrc.js"></a>.eslintrc.js</h3><p>对应 package.json 中的 eslintConfig</p>
<p>eslint 配置 <a target="_blank" rel="noopener" href="https://eslint.org/docs/developer-guide/nodejs-api#%E2%97%86-new-eslint-options">https://eslint.org/docs/developer-guide/nodejs-api#%E2%97%86-new-eslint-options</a></p>
<h3 id="babel-config-js"><a href="#babel-config-js" class="headerlink" title="babel.config.js"></a>babel.config.js</h3><p>bable 的配置文件 对应 webpack.config.js 中 babel-loader 的 options</p>
<p>babel.config.js 文件，可以使用不同的扩展名（<code>.js</code>，<code>.cjs</code>，<code>.mjs</code>)</p>
<p>bable 的配置文件分为两种：</p>
<ul>
<li>babel.config.js 整个项目都用这个 babel 配置（项目范围的配置）</li>
<li>.babelrc.js 配置文件是否仅适用于项目的某个部分 （相对文件配置）</li>
</ul>
<p>具体配置：<a target="_blank" rel="noopener" href="https://babeljs.io/docs/en/config-files">https://babeljs.io/docs/en/config-files</a></p>
<h3 id="prettierrc-js"><a href="#prettierrc-js" class="headerlink" title=".prettierrc.js"></a>.prettierrc.js</h3><p>vscode 中的 prettier 插件 会优先已这个文件作为格式化的配置</p>
<p>配置同 prettier 插件 <a target="_blank" rel="noopener" href="https://prettier.io/docs/en/options.html">https://prettier.io/docs/en/options.html</a></p>
<h2 id="核心模块"><a href="#核心模块" class="headerlink" title="核心模块"></a>核心模块</h2><h3 id="postcss"><a href="#postcss" class="headerlink" title="postcss"></a>postcss</h3><blockquote>
<p>css 兼容性插件</p>
</blockquote>
<p>配合 webpack 使用 ：postcss-loader <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/postcss-loader">https://www.npmjs.com/package/postcss-loader</a></p>
<h3 id="eslint"><a href="#eslint" class="headerlink" title="eslint"></a>eslint</h3><blockquote>
<p>语法检查校验插件</p>
</blockquote>
<p>配合 webpack 使用 ：eslint-webpack-plugin <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/eslint-webpack-plugin">https://www.npmjs.com/package/eslint-webpack-plugin</a></p>
<h3 id="babel"><a href="#babel" class="headerlink" title="babel"></a>babel</h3><blockquote>
<p>js 兼容性插件</p>
</blockquote>
<p>配合 webpack 使用 ： babel-loader <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/babel-loader">https://www.npmjs.com/package/babel-loader</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.bitbw.top/2020/12/31/HTML/Data-URI%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo-header.jpg">
      <meta itemprop="name" content="Bowen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张博文的个人博客">
      <meta itemprop="description" content="vue js javaScript ts typeScript HTML css Sass less webpack git hexo  Node.js 算法 前端 小程序 技术个人博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 张博文的个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/31/HTML/Data-URI%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/" class="post-title-link" itemprop="url">Data URI详细介绍</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-31 09:09:56" itemprop="dateCreated datePublished" datetime="2020-12-31T09:09:56+00:00">2020-12-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-12-14 02:04:05" itemprop="dateModified" datetime="2022-12-14T02:04:05+00:00">2022-12-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/HTML/" itemprop="url" rel="index"><span itemprop="name">HTML</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>最近学习 webpack 遇到了 Data URI 这种格式，觉得很有趣稍微学习一下，转载一篇别人写的比较好的文章；</p>
<p>原文地址：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38128179/article/details/100663085">https://blog.csdn.net/qq_38128179/article/details/100663085</a></p>
<h2 id="一、URI-介绍"><a href="#一、URI-介绍" class="headerlink" title="一、URI 介绍"></a>一、URI 介绍</h2><p>URI（统一资源标识符） 是 uniform resource identifier 的缩写，它定义了接受内容的协议以及附带的相关内容，如果附带的相关内容是一个地址，那么此时的 URI 也是一个 URL （uniform resource locator<code> </code>)。</p>
<h2 id="二、什么是-data-URI-scheme？"><a href="#二、什么是-data-URI-scheme？" class="headerlink" title="二、什么是 data URI scheme？"></a>二、什么是 data URI scheme？</h2><p>Data URI scheme 简称 Data URI，经常会被<strong>错误</strong>地写成 data URLs。即前缀为 data：协议的的 URL，其允许内容创建者向文档中嵌入小文件。</p>
<blockquote>
<p>假设我们有一个图片需要显示在网页上</p>
<p>1、通常我们会使用 http 链接，这种取得资料的方法称为 <strong>http URI scheme</strong>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 从外部请求一张图片</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://pic1.win4000.com/wallpaper/c/53cdd1f7c1f21.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、使用 <strong>data URI scheme</strong> 获取资料可以写成：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 在HTML中嵌入一个小红点的图片</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">alt</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过 data RUI scheme，我们把图像内容内置在 HTML 中，节省了一个 HTTP 请求。</p>
</blockquote>
<h2 id="三、Data-URI-scheme-的语法"><a href="#三、Data-URI-scheme-的语法" class="headerlink" title="三、Data URI scheme 的语法"></a>三、<strong>Data URI scheme 的语法</strong></h2><blockquote>
<p><strong>data:①[<mime type>]②[;charset&#x3D;<charset>]③[;<encoding>]④,<encoded data>⑤</strong></p>
</blockquote>
<p><strong>【1】第 ① 部分 data：</strong> 协议头，它标识这个内容为一个 data URI 资源。</p>
<p><strong>【2】第 ② 部分 MIME 类型（可选项）：</strong>浏览器通常使用 MIME 类型（而不是文件扩展名）来确定如何处理文档；因此服务器设置正确以将正确的 MIME 类型附加到响应对象的头部是非常重要的。MIME 类型对大小写不敏感，但是传统写法都是小写。</p>
<table>
<thead>
<tr>
<th><strong>类型</strong></th>
<th><strong>描述</strong></th>
<th>**示例（语法：type&#x2F;subtype 类型&#x2F;子类型****）**</th>
</tr>
</thead>
<tbody><tr>
<td>text</td>
<td>表明文件是普通文件，理论上是人类可读的</td>
<td><strong>text&#x2F;plain，text&#x2F;html，text&#x2F;css，text&#x2F;javascript</strong></td>
</tr>
<tr>
<td>image</td>
<td>表明文件某种是图像文件，gif 动态图也属于 image 类型</td>
<td><strong>image&#x2F;gif，image&#x2F;png，image&#x2F;jpeg，image&#x2F;bmp，image&#x2F;webp，image&#x2F;x-icon，image&#x2F;vnd.microsoft.icon</strong></td>
</tr>
<tr>
<td>audio</td>
<td>表明文件是某种音频文件</td>
<td><strong>audio&#x2F;midi，audio&#x2F;mpeg，audio&#x2F;webm，audio&#x2F;ogg，audio&#x2F;wav</strong></td>
</tr>
<tr>
<td>video</td>
<td>表明文件是某种视频文件</td>
<td><strong>video&#x2F;webm，video&#x2F;ogg</strong></td>
</tr>
<tr>
<td>application</td>
<td>表明文件是某种二进制数据</td>
<td><strong>application&#x2F;octet-stream，application&#x2F;pkcs12，application&#x2F;vnd.mspowerpoint，application&#x2F;xhtml+xml，application&#x2F;xml，application&#x2F;pdf</strong></td>
</tr>
</tbody></table>
<p><strong>【3】第 ③ 部分 <a href="%E5%8F%AF%E9%80%89%E9%A1%B9">;charset&#x3D;<charset></a>：</strong> 源文本的字符集编码方式，默认编码是 charset&#x3D;US-ASCII, 即数据部分的每个字符都会自动编码为 %xx</p>
<p><strong>【4】第 ④ 部分 [;<encoding>] ：</strong> 数据编码方式（默认 US-ASCII，BASE64 两种）</p>
<p><strong>【5】第 ⑤ 部分 ,<encoded data></strong> <strong>：</strong> 编码后的数据</p>
<blockquote>
<p>关于 base64 可以参考阮一峰写的文章：<a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2008/06/base64.html">http://www.ruanyifeng.com/blog/2008/06/base64.html</a></p>
</blockquote>
<h2 id="四、Data-URI-scheme-的利弊"><a href="#四、Data-URI-scheme-的利弊" class="headerlink" title="四、Data URI scheme 的利弊"></a>四、<strong>Data URI scheme 的利弊</strong></h2><blockquote>
<p><strong>利：</strong></p>
<ul>
<li>减少 HTTP 请求</li>
<li>当访问外部资源很麻烦或受限时（比如服务器 ip 被墙）</li>
<li>当图片是在服务器端用程序动态生成，每个访问用户显示的都不同时</li>
<li>当图片的体积太小，占用一个 HTTP 会话不值得时</li>
<li>没有图片更新要重新上传，还要清理缓存的问题</li>
</ul>
<p><strong>弊：</strong></p>
<ul>
<li>Base64 编码的数据体积通常是原数据的体积 4&#x2F;3，也就是 Data URL 形式的图片会比二进制格式的图片体积大 1&#x2F;3</li>
<li>Data URL 形式的图片不会被浏览器缓存，这意味着每次访问页面时都被下载一次。</li>
<li>增加了 CSS 文件的尺寸</li>
<li>IE678 兼容性</li>
<li>不适合 lazy loading</li>
<li>不利于维护</li>
<li>移动端不宜使用 Data URI 技术（解码耗 CPU）</li>
</ul>
</blockquote>
<h2 id="五、Data-URI-scheme-的应用实例"><a href="#五、Data-URI-scheme-的应用实例" class="headerlink" title="五、Data URI scheme 的应用实例"></a>五、<strong>Data URI scheme 的应用实例</strong></h2><p><strong>【1】在 Html 的 Img 对象中使用</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBQAAF...&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>【2】在 Css 的 background-image 属性中使用</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span><span class="selector-class">.image</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBQAAF...</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>【3】在 Html 的 css 链接处使用</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span></span></span><br><span class="line"><span class="tag">  <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">href</span>=<span class="string">&quot;data:text/css;base64,LyogKioqKiogVGVtcGxhdGUgKioq...&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>【4】在 Html 的 javaScript 链接处使用</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">&quot;data:text/javascript;base64,LyogKioqKiogVGVtcGxhdGUgKioq...&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>【5】data RUI scheme 也可以直接在浏览器的地址栏中输入进行访问</strong></p>
<p><strong>①</strong>在浏览器中输入以下的 Url，会得到一个加粗的”Hello, world!”。也就是说，data:后面的数据直接用做网页的内容，而不是网页的地址。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data</span>: text / html,</span><br><span class="line">  (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">b</span>&gt;</span>Hello, world!<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line">  );</span><br></pre></td></tr></table></figure>

<p><strong>②</strong>下面的例子会显示出 “你好，中文！”。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data</span>:text/plain;charset=<span class="variable constant_">UTF</span>-<span class="number">8</span>;base64,5L2g5aW977yM5Lit5paH77yB</span><br></pre></td></tr></table></figure>

<h2 id="六、兼容-IE678-MHTML"><a href="#六、兼容-IE678-MHTML" class="headerlink" title="六、兼容 IE678 - MHTML"></a>六、兼容 IE678 - MHTML</h2><p>MHTML 即 MIME HTML（Multipurpose Internet Mail Extensions HyperText Markup Language），就是将 Data URI 以附件的形式附加到页面页面上，具体示例如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** FilePath: http://example.com/test.css */</span></span><br><span class="line"><span class="comment">/*!@ignore</span></span><br><span class="line"><span class="comment">Content-Type: multipart/related; boundary=&quot;_ANY_SEPARATOR&quot;</span></span><br><span class="line"><span class="comment">--_ANY_SEPARATOR</span></span><br><span class="line"><span class="comment">Content-Location:myidBackground</span></span><br><span class="line"><span class="comment">Content-Transfer-Encoding:base64</span></span><br><span class="line"><span class="comment">iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==</span></span><br><span class="line"><span class="comment">--_ANY_SEPARATOR--</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="selector-class">.myid</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==&quot;</span>);</span><br><span class="line">  *<span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">mhtml:http://example.com/test.css!myidBackground</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面注释的部分就是一个附件， 这个附件的内容是一个名为 myidBackground 的 Base64 编码图片，然后在 class 为 myid 的 css 中使用。</p>
<p>注意：1、boundary 字段值可自定义；</p>
<p>​ 2、附件的末行必须为 boundary 字段值；</p>
<p>​ 3、附件内容不能被压缩工具擦写掉；</p>
<p>​ 4、由于高版本的 IE 在使用 IE8 兼容模式时能认识*这个 css hack 符号，但却不支持 mhtml，所以会导致背景图片失效。应该采用 IE 的条件注释更为稳妥。</p>
<h2 id="七、base64-转换工具"><a href="#七、base64-转换工具" class="headerlink" title="七、base64 转换工具"></a>七、base64 转换工具</h2><p><a target="_blank" rel="noopener" href="http://www.pjhome.net/web/html5/encodeDataUrl.htm">Encode Data URL </a></p>
<p><a target="_blank" rel="noopener" href="http://www.atool9.com/img2base64.php">aTool 在线工具</a></p>
<p><a target="_blank" rel="noopener" href="https://duri.me/">Duri.me</a></p>
<p><a target="_blank" rel="noopener" href="https://dataurl.sveinbjorn.org/#dataurlmaker">DATAURL</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.bitbw.top/2020/12/30/Nodejs/path-resolve-%E7%9A%84%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo-header.jpg">
      <meta itemprop="name" content="Bowen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张博文的个人博客">
      <meta itemprop="description" content="vue js javaScript ts typeScript HTML css Sass less webpack git hexo  Node.js 算法 前端 小程序 技术个人博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 张博文的个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/30/Nodejs/path-resolve-%E7%9A%84%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">path.resolve()的使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-30 13:34:08" itemprop="dateCreated datePublished" datetime="2020-12-30T13:34:08+00:00">2020-12-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-12-14 02:04:05" itemprop="dateModified" datetime="2022-12-14T02:04:05+00:00">2022-12-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Nodejs/" itemprop="url" rel="index"><span itemprop="name">Nodejs</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="路径解析：path-resolve-from-…-to"><a href="#路径解析：path-resolve-from-…-to" class="headerlink" title="路径解析：path.resolve([from …], to)"></a>路径解析：path.resolve([from …], to)</h2><p>学习 webpack 遇到 path.resolve 但文档读完一遍很懵圈；</p>
<p>网上搜到一篇比较有用的文章 <a target="_blank" rel="noopener" href="https://blog.csdn.net/kikyou_csdn/article/details/83150538">https://blog.csdn.net/kikyou_csdn/article/details/83150538</a></p>
<p>同时也给出了 join 连接路径和 resolve 路径解析的不同 ：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/moqiutao/p/8523955.html">https://www.cnblogs.com/moqiutao/p/8523955.html</a></p>
<p>这篇文章中有个比较好理解的观点就是 把 resolve 想象成 cd 命令。这样就容易理解了：</p>
<p>path.resolve()方法可以将多个路径解析为一个规范化的绝对路径。其处理方式类似于对这些路径逐一进行 cd 操作，与 cd 操作不同的是，这引起路径可以是文件，并且可不必实际存在（resolve()方法不会利用底层的文件系统判断路径是否存在，而只是进行路径字符串操作）。例如：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path.<span class="built_in">resolve</span>(<span class="string">&#x27;foo/bar&#x27;</span>, <span class="string">&#x27;/tmp/file/&#x27;</span>, <span class="string">&#x27;..&#x27;</span>, <span class="string">&#x27;a/../subfile&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>相当于</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> foo/bar</span><br><span class="line"><span class="built_in">cd</span> /tmp/file/</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">cd</span> a/../subfile</span><br><span class="line"><span class="built_in">pwd</span></span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">path.resolve(<span class="string">&#x27;/foo/bar&#x27;</span>, <span class="string">&#x27;./baz&#x27;</span>)</span><br><span class="line"><span class="regexp">//</span> 输出结果为</span><br><span class="line"><span class="string">&#x27;/foo/bar/baz&#x27;</span></span><br><span class="line">path.resolve(<span class="string">&#x27;/foo/bar&#x27;</span>, <span class="string">&#x27;/tmp/file/&#x27;</span>)</span><br><span class="line"><span class="regexp">//</span> 输出结果为</span><br><span class="line"><span class="string">&#x27;/tmp/file&#x27;</span></span><br><span class="line"></span><br><span class="line">path.resolve(<span class="string">&#x27;wwwroot&#x27;</span>, <span class="string">&#x27;static_files/png/&#x27;</span>, <span class="string">&#x27;../gif/image.gif&#x27;</span>)</span><br><span class="line"><span class="regexp">//</span> 当前的工作路径是 <span class="regexp">/home/i</span>tbilu/node，则输出结果为</span><br><span class="line"><span class="string">&#x27;/home/itbilu/node/wwwroot/static_files/gif/image.gif&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li><p>.&#x2F; 和目录名前面什么都不加代表当前目录下执行 cd</p>
</li>
<li><p>&#x2F; 表示根目录下执行 cd</p>
</li>
<li><p>所以要判断最后出来的是根目录还是当前工作目录看第一个参数的目录名前面是&#x2F; 还是 .&#x2F;和什么都没加</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.bitbw.top/2020/12/30/CSS/CSS%E9%87%8C%E7%9A%84pointer-events%E5%B1%9E%E6%80%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo-header.jpg">
      <meta itemprop="name" content="Bowen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张博文的个人博客">
      <meta itemprop="description" content="vue js javaScript ts typeScript HTML css Sass less webpack git hexo  Node.js 算法 前端 小程序 技术个人博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 张博文的个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/30/CSS/CSS%E9%87%8C%E7%9A%84pointer-events%E5%B1%9E%E6%80%A7/" class="post-title-link" itemprop="url">CSS里的pointer-events属性</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-30 09:57:22" itemprop="dateCreated datePublished" datetime="2020-12-30T09:57:22+00:00">2020-12-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-12-14 02:04:05" itemprop="dateModified" datetime="2022-12-14T02:04:05+00:00">2022-12-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CSS/" itemprop="url" rel="index"><span itemprop="name">CSS</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>990</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="因为-pointer-events-出现的问题"><a href="#因为-pointer-events-出现的问题" class="headerlink" title="因为 pointer-events 出现的问题"></a>因为 pointer-events 出现的问题</h2><p>在 Vuetify 项目中，因为在 input 中使用了 tooltip ，意愿是文字溢出隐藏显示… ,</p>
<p>但 input 在 disabled 的状态内部文字的 tooptip 居然不显示了</p>
<p>在控制台发现了这个样式</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.v-input--is-disabled</span><span class="selector-pseudo">:not</span>(<span class="selector-class">.v-input--is-readonly</span>) &#123;</span><br><span class="line">  <span class="attribute">pointer-events</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>pointer-events: none; 这个很不常用， 下面看下这个属性具体是干什么的 <a target="_blank" rel="noopener" href="https://www.webhek.com/post/pointer-events.html">原文</a></p>
<h2 id="pointer-events"><a href="#pointer-events" class="headerlink" title="pointer-events"></a>pointer-events</h2><p>现代浏览器里 CSS 的职责范围和 JavaScript 的越来越模糊分不清。比如 CSS 里<code>-webkit-touch-callout</code>属性在 iOS 里能禁止当用户点击时弹出气泡框。而本文要说的<code>pointer-events</code>的风格更像 JavaScript，它能够：</p>
<ul>
<li>阻止用户的点击动作产生任何效果</li>
<li>阻止缺省鼠标指针的显示</li>
<li>阻止 CSS 里的<code>hover</code>和<code>active</code>状态的变化触发事件</li>
<li>阻止 JavaScript 点击动作触发的事件</li>
</ul>
<p>一个 CSS 属性能做所有的这么多事情！</p>
<h3 id="The-CSS"><a href="#The-CSS" class="headerlink" title="The CSS"></a>The CSS</h3><p>这个<code>pointer-events</code>属性有很多可以使用的属性值，但大部分都是针对 SVG 的：<code>auto</code>, <code>none</code>, <code>visiblePainted*</code>, <code>visibleFill*</code>, <code>visibleStroke*</code>, <code>visible*</code>, <code>painted*</code>, <code>fill*</code>, <code>stroke*</code>, <code>all*</code>, 以及 <code>inherit</code>。其中<code>none</code>值能阻止点击、状态变化和鼠标指针变化：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.disabled</span> &#123;</span><br><span class="line">  <span class="attribute">pointer-events</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一些需要注意的关于<code>pointer-events</code>的事项：</p>
<ul>
<li>子元素可以声明<code>pointer-events</code>来解禁父元素的阻止鼠标事件限制。</li>
<li>如果你对一个元素设置了 click 事件监听器，然后你移除了<code>pointer-events</code>样式声明，或把它的值改变为<code>auto</code>，监听器会重新生效。基本上，监听器会遵守<code>pointer-events</code>的设定。</li>
</ul>
<h2 id="处理问题"><a href="#处理问题" class="headerlink" title="处理问题"></a>处理问题</h2><p>为了只让 tooltip 显示，而 input 的本身的禁用还在，可以直接在 tooltip 中的显示文字上添加 pointer-events: auto; 即可</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 内容部分</span></span><br><span class="line"><span class="selector-class">.tooltip-default-text</span> &#123;</span><br><span class="line">  <span class="attribute">pointer-events</span>: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.bitbw.top/2020/12/24/React/React%E5%AD%A6%E4%B9%A0%E7%90%86%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo-header.jpg">
      <meta itemprop="name" content="Bowen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张博文的个人博客">
      <meta itemprop="description" content="vue js javaScript ts typeScript HTML css Sass less webpack git hexo  Node.js 算法 前端 小程序 技术个人博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 张博文的个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/24/React/React%E5%AD%A6%E4%B9%A0%E7%90%86%E8%A7%A3/" class="post-title-link" itemprop="url">React学习理解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-24 14:35:01" itemprop="dateCreated datePublished" datetime="2020-12-24T14:35:01+00:00">2020-12-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-12-14 02:04:05" itemprop="dateModified" datetime="2022-12-14T02:04:05+00:00">2022-12-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>688</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="表单"><a href="#表单" class="headerlink" title="表单"></a>表单</h2><h3 id="受控组件"><a href="#受控组件" class="headerlink" title="受控组件"></a>受控组件</h3><p>官方定义</p>
<blockquote>
<p>在 HTML 中，表单元素（如<code>&lt;input&gt;</code>、 <code>&lt;textarea&gt;</code> 和 <code>&lt;select&gt;</code>）通常自己维护 state，并根据用户输入进行更新。而在 React 中，可变&gt; 状态（mutable state）通常保存在组件的 state 属性中，并且只能通过使用 setState()来更新。</p>
<p>我们可以把两者结合起来，使 React 的 state 成为“唯一数据源”。渲染表单的 React 组件还控制着用户输入过程中表单发生的操作。被 React 以这种方式控制取值的表单输入元素就叫做“受控组件”。</p>
</blockquote>
<p>总结： 受控组件就相当与 Vue 中的 v-model</p>
<p>注意点：在受控组件上指定 value 的 prop 会阻止用户更改输入 ，value 设置为 undefined 或 null 了 用户可以自行输入</p>
<p>正确的方式是：</p>
<ul>
<li>有 value 的绑定，就得有对应的 onChange 或者 onInupt 通过 setState 修改 value</li>
<li>如果让用户自行输入数据值，而无需对变化做处理 ，可以使用<strong>非受控组件</strong></li>
</ul>
<h3 id="react-router-dom"><a href="#react-router-dom" class="headerlink" title="react-router-dom"></a>react-router-dom</h3><p>Route 放入 children 和 component 中的区别</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// children 中 home 通过 props 获取不到路由数据</span></span><br><span class="line">&lt;<span class="title class_">Route</span> path=<span class="string">&quot;/home&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Home</span> /&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">Route</span>&gt;</span><br><span class="line"><span class="comment">// component 中 home 通过 props 可以获取到路由数据</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/home&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Home&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.bitbw.top/2020/12/24/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%90%86%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo-header.jpg">
      <meta itemprop="name" content="Bowen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张博文的个人博客">
      <meta itemprop="description" content="vue js javaScript ts typeScript HTML css Sass less webpack git hexo  Node.js 算法 前端 小程序 技术个人博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 张博文的个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/24/Vue/Vue3%E5%AD%A6%E4%B9%A0%E7%90%86%E8%A7%A3/" class="post-title-link" itemprop="url">Vue3学习理解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-24 14:35:01" itemprop="dateCreated datePublished" datetime="2020-12-24T14:35:01+00:00">2020-12-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-12-14 02:04:05" itemprop="dateModified" datetime="2022-12-14T02:04:05+00:00">2022-12-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Vue/" itemprop="url" rel="index"><span itemprop="name">Vue</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>14k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>12 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="vue3-新特性"><a href="#vue3-新特性" class="headerlink" title="vue3 新特性"></a>vue3 新特性</h1><blockquote>
<p>整理的比较好的文档：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/1fd73091e2e4">https://www.jianshu.com/p/1fd73091e2e4</a></p>
</blockquote>
<p>直接看代码可以直接看 <a href="#demo" title=" Vue3 + TypeScript ">实践 demo</a></p>
<h2 id="组合式-API"><a href="#组合式-API" class="headerlink" title="组合式 API"></a>组合式 API</h2><p>vue3 中加入了组合式 ，这个功能的作用是将单个 vue 组件的，逻辑部分也能自由拆分组合，更深层次的实现解耦和高复用性</p>
<p>vue2 如果单个 vue 文件逻辑部分过大 ，我们往往 需要单独用一个 js 文件或 ts 文件存放 逻辑（函数）并且为了使用 vue 组件上的响应式属性不得不将 vue 实例传进这个函数中，总有一种怪怪的感觉；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue2  单独存放逻辑的文件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">handle</span>(<span class="params">vue,xx</span>)&#123;</span><br><span class="line">    vue.<span class="property">yy</span> = xx ;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="响应式的改变"><a href="#响应式的改变" class="headerlink" title="响应式的改变"></a>响应式的改变</h2><blockquote>
<p>响应式转换是“深层”的——它影响所有嵌套 property。在基于 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy">ES2015 Proxy</a> 的实现中，返回的 proxy 是<strong>不</strong>等于原始对象的。建议只使用响应式 proxy，避免依赖原始对象。</p>
</blockquote>
<ul>
<li>ref 可以用于创建所有数据类型的响应式数据 需要.value 访问 （对象类型数据配合 reactive 使用）</li>
<li>reactive 只能用于创建对象数据类型的相应式数据 不需要.value 就直接可以访问 深度响应</li>
<li>toRefs 用于给 prop 添加响应数据，需要.value 访问</li>
</ul>
<h3 id="基础-api"><a href="#基础-api" class="headerlink" title="基础 api"></a>基础 api</h3><h4 id="reactive"><a href="#reactive" class="headerlink" title="reactive"></a>reactive</h4><p>返回对象的响应式副本</p>
<p>使用:</p>
<blockquote>
<p>可以直接给对象添加任何属性都是响应式的 ，但不能直接赋值对象</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;zhangshan&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 有效</span></span><br><span class="line">person.<span class="property">sex</span> = <span class="string">&quot;男&quot;</span>;</span><br><span class="line"><span class="comment">// 无效</span></span><br><span class="line">person = &#123; ...person, ...&#123; <span class="attr">sex</span>: <span class="string">&quot;男&quot;</span> &#125; &#125;;</span><br></pre></td></tr></table></figure>

<h4 id="isReactive"><a href="#isReactive" class="headerlink" title="isReactive"></a>isReactive</h4><p>检查对象是否是 reactive 创建的响应式 proxy。</p>
<h4 id="readonly"><a href="#readonly" class="headerlink" title="readonly"></a>readonly</h4><p>除了只读以外跟 reactive 一样，但只读也代表了响应式没有意义了</p>
<h4 id="isReadonly"><a href="#isReadonly" class="headerlink" title="isReadonly"></a>isReadonly</h4><p>检查对象是否是由 readonly 创建的只读 prox</p>
<h4 id="shallowReactive-和-shallowReadonly"><a href="#shallowReactive-和-shallowReadonly" class="headerlink" title="shallowReactive 和 shallowReadonly"></a>shallowReactive 和 shallowReadonly</h4><p>与上面的差别就是指对第一层属性响应，再深度的则不响应</p>
<h4 id="isProxy"><a href="#isProxy" class="headerlink" title="isProxy"></a>isProxy</h4><p>检查对象是否是由 reactive 或 readonly 创建的 proxy。</p>
<h3 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h3><h4 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h4><blockquote>
<p>接受一个内部值并返回一个响应式且可变的 ref 对象。ref 对象具有指向内部值的单个 property <code>.value</code>。</p>
<p>也就是相当于解决了 reactive 只能作用对象类型，和只能添加属性不能直接修改对象的不足</p>
<p>对象类型数据配合 reactive 使用</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(count.<span class="property">value</span>); <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line">count.<span class="property">value</span>++;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(count.<span class="property">value</span>); <span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 对象类型</span></span><br><span class="line"><span class="keyword">let</span> person = <span class="title function_">ref</span>(</span><br><span class="line">  <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;zhangshan&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line">person.<span class="property">value</span> = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;lisi&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">28</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="unref"><a href="#unref" class="headerlink" title="unref"></a>unref</h4><p>返回使用 ref 响应数据的 value （不是原始数据）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> flag = <span class="title function_">ref</span>(</span><br><span class="line">  <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">number</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;flag&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line">flag.<span class="property">value</span>.<span class="property">number</span>++;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">  <span class="title function_">unref</span>(flag),</span><br><span class="line">  <span class="string">&quot;unref(flag) === flag.value&quot;</span>,</span><br><span class="line">  <span class="title function_">unref</span>(flag) === flag.<span class="property">value</span></span><br><span class="line">); <span class="comment">// 1 true</span></span><br></pre></td></tr></table></figure>

<h3 id="setup（组合式的核心）"><a href="#setup（组合式的核心）" class="headerlink" title="setup（组合式的核心）"></a>setup（组合式的核心）</h3><h4 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h4><blockquote>
<p>个人理解 :setup 相当于一个盒子 （组合式的核心） ，将<code>methods</code>、<code>watch</code>、<code>computed</code>、<code>data</code>的数据都在这里进行组合</p>
<p>而<code>methods</code>、<code>watch</code>、<code>computed</code>、<code>data</code> 的数据，可以分别用不同的 js 文件生成，再导入到 vue 当文件组件中，或 setup 所在文件中</p>
</blockquote>
<blockquote>
<p>在 Vue3 中，定义 <code>methods</code>、<code>watch</code>、<code>computed</code>、<code>data</code>数据 等都放在了 <code>setup()</code> 函数中 ，(实现了逻辑的拆分)</p>
<p><a target="_blank" rel="noopener" href="https://v3.cn.vuejs.org/guide/composition-api-introduction.html#setup-%E7%BB%84%E4%BB%B6%E9%80%89%E9%A1%B9">官网地址</a></p>
</blockquote>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p>setup 方法接收两个参数 ：</p>
<ul>
<li>prop</li>
<li>context 上下文对象也就是 this （当前 vue 实例）</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, onMounted, watch, toRefs, computed &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">components</span>: &#123; <span class="title class_">RepositoriesFilters</span>, <span class="title class_">RepositoriesSortBy</span>, <span class="title class_">RepositoriesList</span> &#125;,</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">user</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="comment">// 使用 `toRefs` 创建对 props 中的 `user` property 的响应式引用</span></span><br><span class="line">    <span class="keyword">const</span> &#123; user &#125; = <span class="title function_">toRefs</span>(props);</span><br><span class="line">    <span class="keyword">const</span> repositories = <span class="title function_">ref</span>([]);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(props); <span class="comment">// &#123; user: &#x27;&#x27; &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;; <span class="comment">// 这里返回的任何内容都可以用于组件的其余部分</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 组件的“其余部分”</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>更多用法详见：<a href="###setup.ts">setup.ts</a></p>
<h3 id="setup-语法糖-lt-scritp-setup-gt"><a href="#setup-语法糖-lt-scritp-setup-gt" class="headerlink" title="setup 语法糖 &lt;scritp setup&gt;"></a>setup 语法糖<code> &lt;scritp setup&gt;</code></h3><p>可以使用<code>&lt;script setup&gt;</code> 标签 代替 setup（）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">inc</span> = (<span class="params"></span>) =&gt; count.<span class="property">value</span>++;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      count,</span><br><span class="line">      inc,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>以上代码可以写成下面的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;button @click=&quot;inc&quot;&gt;&#123;&#123; count &#125;&#125;&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &quot;vue&quot;;</span><br><span class="line"></span><br><span class="line">export const count = ref(0);</span><br><span class="line">export const inc = () =&gt; count.value++;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="使用限制："><a href="#使用限制：" class="headerlink" title="使用限制："></a>使用限制：</h4><blockquote>
<p>由于模块执行语义的不同，内部代码<code>&lt;script setup&gt;</code>依赖于 SFC 的上下文。当移至外部<code>.js</code>或<code>.ts</code>文件中时，可能会给开发人员和工具带来混乱。因此，**<code>&lt;script setup&gt;</code>**不能与该<code>src</code>属性一起使用。</p>
</blockquote>
<p><strong>个人感觉比较麻烦 还不如正常的使用 setup</strong></p>
<h2 id="Global-API-全局-API"><a href="#Global-API-全局-API" class="headerlink" title="Global API 全局 API"></a>Global API 全局 API</h2><h3 id="createApp-创建整个应用的实例"><a href="#createApp-创建整个应用的实例" class="headerlink" title="createApp 创建整个应用的实例"></a><code>createApp</code> 创建整个应用的实例</h3><blockquote>
<p>3.x 添加<code>createApp</code> 方法用来创建应用的根 防止数据间的相互污染 <a target="_blank" rel="noopener" href="https://v3.cn.vuejs.org/guide/migration/global-api.html#%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E5%85%A8%E5%B1%80-api-createapp">官方文档地址</a></p>
</blockquote>
<p>应用实例暴露当前全局 API 的子集，经验法则是，任何全局改变 Vue 行为的 API 现在都会移动到应用实例上，以下是当前全局 API 及其相应实例 API 的表：</p>
<table>
<thead>
<tr>
<th>2.x 全局 API</th>
<th>3.x 实例 API (<code>app</code>)</th>
</tr>
</thead>
<tbody><tr>
<td>Vue.config</td>
<td>app.config</td>
</tr>
<tr>
<td>Vue.config.productionTip</td>
<td><em>removed</em> (<a target="_blank" rel="noopener" href="https://v3.cn.vuejs.org/guide/migration/global-api.html#config-productiontip-removed">见下方</a>)</td>
</tr>
<tr>
<td>Vue.config.ignoredElements</td>
<td>app.config.isCustomElement (<a target="_blank" rel="noopener" href="https://v3.cn.vuejs.org/guide/migration/global-api.html#config-ignoredelements-is-now-config-iscustomelement">见下方</a>)</td>
</tr>
<tr>
<td>Vue.component</td>
<td>app.component</td>
</tr>
<tr>
<td>Vue.directive</td>
<td>app.directive</td>
</tr>
<tr>
<td>Vue.mixin</td>
<td>app.mixin</td>
</tr>
<tr>
<td>Vue.use</td>
<td>app.use (<a target="_blank" rel="noopener" href="https://v3.cn.vuejs.org/guide/migration/global-api.html#a-note-for-plugin-authors">见下方</a>)</td>
</tr>
<tr>
<td>Vue.prototype</td>
<td>app.config.globalProperties (<a target="_blank" rel="noopener" href="https://v3.cn.vuejs.org/guide/migration/global-api.html#vue-prototype-replaced-by-config-globalproperties">见下方</a>)</td>
</tr>
</tbody></table>
<p>所有其他不全局改变行为的全局 API 现在被命名为 exports，文档见<a target="_blank" rel="noopener" href="https://v3.cn.vuejs.org/guide/migration/global-api-treeshaking.html">全局 API Treeshaking</a>。</p>
<h3 id="全局-API-Treeshaking-将一部分-xxx-和-指令-按需导入使用"><a href="#全局-API-Treeshaking-将一部分-xxx-和-指令-按需导入使用" class="headerlink" title="全局 API Treeshaking 将一部分$xxx 和 指令 按需导入使用"></a>全局 API Treeshaking 将一部分$xxx 和 指令 按需导入使用</h3><blockquote>
<p>Vue.nextTick() 将废弃 使用 导入方式如下</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; nextTick &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 一些和DOM有关的东西</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>使用 render 语法中 可以使用如下 api 按需导入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; h, <span class="title class_">Transition</span>, withDirectives, vShow &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">h</span>(<span class="title class_">Transition</span>, [<span class="title function_">withDirectives</span>(<span class="title function_">h</span>(<span class="string">&quot;div&quot;</span>, <span class="string">&quot;hello&quot;</span>), [[vShow, <span class="variable language_">this</span>.<span class="property">ok</span>]])]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="teleport-指定标签父节点"><a href="#teleport-指定标签父节点" class="headerlink" title="teleport 指定标签父节点"></a>teleport 指定标签父节点</h2><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><blockquote>
<p>teleport 可以将组件生成的 dom 节点 ，转移到其他 dom 下作为其子节点</p>
<p>让我们修改 <code>modal-button</code> 以使用 <code>&lt;teleport&gt;</code>，并告诉 Vue “<strong>Teleport</strong> 这个 HTML <strong>到</strong>该‘<strong>body</strong>’标签”。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">app.component(&#x27;modal-button&#x27;, &#123; template: `</span><br><span class="line">&lt;button @click=&quot;modalOpen = true&quot;&gt;</span><br><span class="line">        Open full screen modal! (With teleport!)</span><br><span class="line">    &lt;/button&gt;</span><br><span class="line"></span><br><span class="line">&lt;teleport to=&quot;body&quot;&gt;								// teleport 的 to属性就是作为哪个dom的字节的</span><br><span class="line">      &lt;div v-if=&quot;modalOpen&quot; class=&quot;modal&quot;&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          I&#x27;m a teleported modal! </span><br><span class="line">          (My parent is &quot;body&quot;)</span><br><span class="line">          &lt;button @click=&quot;modalOpen = false&quot;&gt;</span><br><span class="line">            Close</span><br><span class="line">          &lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/teleport&gt;</span><br><span class="line">`, data() &#123; return &#123; modalOpen: false &#125; &#125; &#125;)</span><br></pre></td></tr></table></figure>

<h4 id="Props："><a href="#Props：" class="headerlink" title="Props："></a>Props：</h4><ul>
<li><code>to</code> - <code>string</code>。需要 prop，必须是有效的查询选择器（独一无二的类名或 id 或属性）或 <code>HTMLElement</code> (如果在浏览器环境中使用)。指定将在其中移动 <code>&lt;teleport&gt;</code> 内容的目标元素</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 正确 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">teleport</span> <span class="attr">to</span>=<span class="string">&quot;#some-id&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">teleport</span> <span class="attr">to</span>=<span class="string">&quot;.some-class&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">teleport</span> <span class="attr">to</span>=<span class="string">&quot;[data-teleport]&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 错误 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">teleport</span> <span class="attr">to</span>=<span class="string">&quot;h1&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">teleport</span> <span class="attr">to</span>=<span class="string">&quot;some-string&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>disabled</code> - <code>boolean</code>。此可选属性可用于禁用 <code>&lt;teleport&gt;</code> 的功能，这意味着其插槽内容将不会移动到任何位置，而是在您在周围父组件中指定了 <code>&lt;teleport&gt;</code> 的位置渲染。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">teleport</span> <span class="attr">to</span>=<span class="string">&quot;#popup&quot;</span> <span class="attr">:disabled</span>=<span class="string">&quot;displayVideoInline&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">video</span> <span class="attr">src</span>=<span class="string">&quot;./my-movie.mp4&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">teleport</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>请注意，这将移动实际的 DOM 节点，而不是被销毁和重新创建，并且它还将保持任何组件实例的活动状态。所有有状态的 HTML 元素 (即播放的视频) 都将保持其状态。</p>
<h2 id="片段（支持多根节点）"><a href="#片段（支持多根节点）" class="headerlink" title="片段（支持多根节点）"></a>片段（支持多根节点）</h2><p>Vue 3 现在正式支持了多根节点的组件，也就是片段！</p>
<p>在 3.x 中，组件可以包含多个根节点！但是，这要求开发者显式定义 attribute 应该分布在哪里。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Layout.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">header</span>&gt;</span>...<span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">main</span> <span class="attr">v-bind</span>=<span class="string">&quot;$attrs&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">footer</span>&gt;</span>...<span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>因为 2.x 只有一个根节点 $attrs 就会绑定到根节点上，现在3.x会有多个根节点，所以需要定义$attrs 需要绑定到到哪个节点上</p>
</blockquote>
<h2 id="v-model-的改变"><a href="#v-model-的改变" class="headerlink" title="v-model 的改变"></a><code>v-model</code> 的改变</h2><p>2.x 使用 input + value 实现 v-model , 3.x 里使用使用 <code>modelValue</code>（ 自己定义字段名与 update:后面的字段一致即可 ，默认值是<code>modelValue</code>） 作为 prop 和 <code>update:modelValue</code> 作为事件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">component</span>(<span class="string">&quot;my-component&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="title class_">String</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">emits</span>: [<span class="string">&quot;update:title&quot;</span>],</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`  &lt;input </span></span><br><span class="line"><span class="string">      type=&quot;text&quot;</span></span><br><span class="line"><span class="string">      :value=&quot;title&quot;</span></span><br><span class="line"><span class="string">      @input=&quot;$emit(&#x27;update:title&#x27;, $event.target.value)&quot;&gt;</span></span><br><span class="line"><span class="string">  `</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">my-component</span> <span class="attr">v-model:title</span>=<span class="string">&quot;bookTitle&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">my-component</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意点：v-model 后面需要加对应的 update 后的的字段名 习惯于 2.x 语法后 前几次会忘记加</p>
</blockquote>
<p>并且可以使用多个 v-model 只需要在 v-model 后面加上对应的 prop 字段名即可</p>
<h3 id="v-model-修饰符"><a href="#v-model-修饰符" class="headerlink" title="v-model 修饰符"></a><code>v-model</code> 修饰符</h3><p>在 2.x 中 v-model 的修饰符有.trim<code>、</code>.number<code>和</code>.lazy，</p>
<p>在 3.x 中我们可以自定义修饰符，比如 <code>v-model:title.capitalize=&quot;bar&quot;</code></p>
<p>在子组件中 prop 中 <code>titleModifiers</code>中可以接收到 <code>capitalize：ture </code> 再做对应处理后</p>
<p>prop 中修饰符的属性名为 ： <code>arg + &quot;Modifiers&quot;</code>：（绑定 value 字段名 + “Modifiers”）</p>
<p>父组件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">HelloWorld</span> <span class="attr">v-model:title.capitalize</span>=<span class="string">&quot;inputValue&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>子组件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;title&quot;</span> @<span class="attr">input</span>=<span class="string">&quot;handleCapitalize&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//prop</span></span><br><span class="line"> <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">titleModifiers</span>: &#123; <span class="comment">//使用title + Modifiers 获取修饰符对象 &#123; capitalize:ture &#125;</span></span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Object</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="function">() =&gt;</span> (&#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"><span class="comment">// mothods</span></span><br><span class="line"><span class="title function_">handleCapitalize</span>(<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> value = event.<span class="property">target</span>.<span class="property">value</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">titleModifiers</span>.<span class="property">capitalize</span>) &#123; <span class="comment">// capitalize:ture</span></span><br><span class="line">    value = value.<span class="title function_">toLocaleUpperCase</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">this</span>.$emit(<span class="string">&quot;update:title&quot;</span>, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果<code>v-modle </code>使用默认值 <code>modelValue</code> 时，prop 修饰符对象使用 <code>modelModifiers</code> 作为属性名</p>
</blockquote>
<h2 id="单文件组件-style-中使用-script-中变量-实验性"><a href="#单文件组件-style-中使用-script-中变量-实验性" class="headerlink" title="单文件组件 style 中使用 script 中变量(实验性)"></a>单文件组件 style 中使用 script 中变量(实验性)</h2><blockquote>
<p><code>3.x</code> 单文件组件中 style 中可是使用当前<code>vue</code>实例的 data 数据</p>
<p>最新提议 <a target="_blank" rel="noopener" href="https://github.com/vuejs/rfcs/pull/231">https://github.com/vuejs/rfcs/pull/231</a></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;text&quot;&gt;hello&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      color: &#x27;red&#x27;,						  // data中的变量在style中都可以使用 使用v-bind （11月10日最新提议）</span><br><span class="line">      font: &#123;								  // 之前的提议是 var(--变量名)</span><br><span class="line">        size: &#x27;2em&#x27;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.text &#123;</span><br><span class="line">  color: v-bind(color);</span><br><span class="line">  /* 使用对象.属性 包在&#x27;&#x27;引号中 */</span><br><span class="line">  font-size: v-bind(&quot;font.size&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="单文件组件样式作用域的变化"><a href="#单文件组件样式作用域的变化" class="headerlink" title="单文件组件样式作用域的变化"></a>单文件组件样式作用域的变化</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">/* deep (css选择器)  */</span><br><span class="line">::v-deep(.foo) &#123;&#125;</span><br><span class="line">/*可以在（）里写,  在sass less scss 等预编译器中可以写在 &#123;&#125; 中*/</span><br><span class="line">::v-deep() &#123;</span><br><span class="line">    .foo&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/* 简写 */</span><br><span class="line">:deep(.foo) &#123;&#125;</span><br><span class="line"></span><br><span class="line">/* 作用于插槽  给 slot 加对应 class=&quot;foo&quot; 就可以作用到插槽上*/</span><br><span class="line">::v-slotted(.foo) &#123;&#125;</span><br><span class="line">/* 简写 */</span><br><span class="line">:slotted(.foo) &#123;&#125;</span><br><span class="line"></span><br><span class="line">/* 在 scoped 中作用全局的样式 功能就 跟不加scoped一样 感觉有点脱裤子放屁的感觉 */</span><br><span class="line">::v-global(.foo) &#123;&#125;</span><br><span class="line">/* 简写 */</span><br><span class="line">:global(.foo) &#123;&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="tip-名词含义"><a href="#tip-名词含义" class="headerlink" title="tip 名词含义"></a>tip 名词含义</h2><ul>
<li><code>SFC</code> - 单文件组件</li>
</ul>
<h1 id="demo-Vue3-TypeScript"><a href="#demo-Vue3-TypeScript" class="headerlink" title="demo ( Vue3 + TypeScript )"></a>demo ( Vue3 + TypeScript )</h1><blockquote>
<p>直接使用 vue-cil 初始化 vue3 项目</p>
</blockquote>
<h3 id="Home-vue"><a href="#Home-vue" class="headerlink" title="Home.vue"></a>Home.vue</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;home&quot;&gt;</span><br><span class="line">    &lt;img alt=&quot;Vue logo&quot; src=&quot;../assets/logo.png&quot; /&gt;</span><br><span class="line">    &lt;HelloWorld v-model:title.capitalize=&quot;inputValue&quot;&gt;</span><br><span class="line">      &lt;p class=&quot;default-solt&quot;&gt;这里是默认插槽&lt;/p&gt;</span><br><span class="line">    &lt;/HelloWorld&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, defineComponent &#125; from &quot;vue&quot;; // 使用defineComponent创建vue实例</span><br><span class="line">import HelloWorld from &quot;@/components/HelloWorld.vue&quot;; // @ is an alias to /src</span><br><span class="line"></span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: &quot;Home&quot;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    HelloWorld,</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    console.log(&quot;created&quot;);</span><br><span class="line">  &#125;,</span><br><span class="line">  beforeCreate() &#123;</span><br><span class="line">    console.log(&quot;beforeCreate&quot;);</span><br><span class="line">  &#125;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    console.log(&quot;setup 在 created 之前&quot;);</span><br><span class="line">    const inputValue = ref(&quot;&quot;);</span><br><span class="line">    return &#123;</span><br><span class="line">      inputValue,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">// 等价于下面</span><br><span class="line">:deep(.skill) &#123;</span><br><span class="line">  color: skyblue;</span><br><span class="line">&#125;</span><br><span class="line">:deep() &#123;</span><br><span class="line">  .skill &#123;</span><br><span class="line">    color: skyblue;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 等价于不加 scoped</span><br><span class="line">:global(.modal) &#123;</span><br><span class="line">  &amp; &gt; div &#123;</span><br><span class="line">    color: skyblue !important;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="HelloWorld-vue"><a href="#HelloWorld-vue" class="headerlink" title="HelloWorld.vue"></a>HelloWorld.vue</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;hello&quot;&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;!-- 展示数据 --&gt;</span><br><span class="line">      &lt;div&gt;鼠标x轴:&#123;&#123; x &#125;&#125;&lt;/div&gt;</span><br><span class="line">      &lt;div&gt;鼠标y轴:&#123;&#123; y &#125;&#125;&lt;/div&gt;</span><br><span class="line">      &lt;span&gt;&#123;&#123; count &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;span&gt;双倍：&#123;&#123; doubelCount &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;button @click=&quot;count++&quot;&gt;Increment count&lt;/button&gt;</span><br><span class="line">      &lt;p&gt;</span><br><span class="line">        &lt;input type=&quot;text&quot; :value=&quot;title&quot; @input=&quot;handleCapitalize&quot; /&gt;</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">      &lt;p class=&quot;person&quot;&gt;</span><br><span class="line">        &lt;span&gt;姓名：&#123;&#123; person.name &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;span&gt;年龄：&#123;&#123; person.age &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">      &lt;p class=&quot;skill&quot;&gt;技能：敲代码&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 打开dialog按钮 --&gt;</span><br><span class="line">      &lt;button @click=&quot;modalOpen = true&quot;&gt;</span><br><span class="line">        Open full screen modal! (With teleport!)</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">      &lt;!-- dialog --&gt;</span><br><span class="line">      &lt;teleport to=&quot;body&quot;&gt;</span><br><span class="line">        &lt;div v-show=&quot;modalOpen&quot; class=&quot;modal&quot;&gt;</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            I&#x27;m a teleported modal! (My parent is &quot;body&quot;)</span><br><span class="line">            &lt;button @click=&quot;modalOpen = false&quot;&gt;Close&lt;/button&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/teleport&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- 默认插槽 --&gt;</span><br><span class="line">    &lt;slot class=&quot;default-solt&quot;&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; setup &#125; from &quot;@/components/setup&quot;; // 直接导入 setup</span><br><span class="line">import &#123; defineComponent &#125; from &quot;vue&quot;;</span><br><span class="line"></span><br><span class="line">export default defineComponent(&#123;</span><br><span class="line">  name: &quot;HelloWorld&quot;,</span><br><span class="line">  emits: [&quot;update:title&quot;], // 显式的定义使用了哪些emits</span><br><span class="line">  props: &#123;</span><br><span class="line">    title: String, // v-model绑定值</span><br><span class="line">    titleModifiers: &#123;</span><br><span class="line">      // v-model绑定值对应的修饰符对象</span><br><span class="line">      type: Object,</span><br><span class="line">      default: () =&gt; (&#123;&#125;),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  setup,</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped lang=&quot;scss&quot;&gt;</span><br><span class="line">// 使用script中的变量 color</span><br><span class="line">.person &#123;</span><br><span class="line">  color: v-bind(color);</span><br><span class="line">&#125;</span><br><span class="line">// 默认插槽加样式：无效</span><br><span class="line">.default-solt &#123;</span><br><span class="line">  color: slateblue !important;</span><br><span class="line">&#125;</span><br><span class="line">// 默认插槽加样式：有效</span><br><span class="line">:slotted(.default-solt) &#123;</span><br><span class="line">  color: slateblue !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// dialog的样式</span><br><span class="line">.modal &#123;</span><br><span class="line">  position: absolute;</span><br><span class="line">  top: 0;</span><br><span class="line">  right: 0;</span><br><span class="line">  bottom: 0;</span><br><span class="line">  left: 0;</span><br><span class="line">  background-color: rgba(0, 0, 0, 0.5);</span><br><span class="line">  display: flex;</span><br><span class="line">  flex-direction: column;</span><br><span class="line">  align-items: center;</span><br><span class="line">  justify-content: center;</span><br><span class="line">&#125;</span><br><span class="line">.modal div &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  flex-direction: column;</span><br><span class="line">  align-items: center;</span><br><span class="line">  justify-content: center;</span><br><span class="line">  background-color: white;</span><br><span class="line">  width: 300px;</span><br><span class="line">  height: 300px;</span><br><span class="line">  padding: 5px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="setup-ts"><a href="#setup-ts" class="headerlink" title="setup.ts"></a>setup.ts</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  ref, <span class="comment">// 用于简单数据类型  需要.value 访问</span></span><br><span class="line">  reactive, <span class="comment">// 用于复杂数据类型 不需要.value 就直接可以方法</span></span><br><span class="line">  toRefs, <span class="comment">// 用于给prop添加响应数据，需要.value 访问</span></span><br><span class="line">  watch,</span><br><span class="line">  computed,</span><br><span class="line">  onMounted,</span><br><span class="line">  onUnmounted,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">setup</span> = (<span class="params">props: <span class="built_in">any</span>, context: <span class="built_in">any</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Bowen: setup -&gt; props, context&quot;</span>, props, context);</span><br><span class="line">  <span class="comment">//============================================================================</span></span><br><span class="line">  <span class="comment">// prop</span></span><br><span class="line">  <span class="keyword">const</span> &#123; titleModifiers &#125; = <span class="title function_">toRefs</span>(props);</span><br><span class="line">  <span class="comment">//============================================================================</span></span><br><span class="line">  <span class="comment">// data</span></span><br><span class="line">  <span class="keyword">const</span> x = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> y = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> modalOpen = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> color = <span class="title function_">ref</span>(<span class="string">&quot;red&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> person = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;Bowen&quot;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//============================================================================</span></span><br><span class="line">  <span class="comment">// computed</span></span><br><span class="line">  <span class="keyword">const</span> doubelCount = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> count.<span class="property">value</span> * <span class="number">2</span>);</span><br><span class="line">  <span class="comment">//============================================================================</span></span><br><span class="line">  <span class="comment">// watch</span></span><br><span class="line">  <span class="title function_">watch</span>(count, <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Bowen: setup -&gt; val&quot;</span>, val);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//============================================================================</span></span><br><span class="line">  <span class="comment">// methods</span></span><br><span class="line">  <span class="comment">// 判断 v-model 是否有 capitalize 标识符  转换大写</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleCapitalize</span> = (<span class="params">event: InputEvent</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> value = (event.<span class="property">target</span> <span class="keyword">as</span> <span class="title class_">HTMLInputElement</span>).<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">if</span> (titleModifiers.<span class="property">value</span>.<span class="property">capitalize</span>) &#123;</span><br><span class="line">      value = value.<span class="title function_">toLocaleUpperCase</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    context.<span class="title function_">emit</span>(<span class="string">&quot;update:title&quot;</span>, value);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// 获取鼠标定位</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">getMousePosition</span> = (<span class="params">e: MouseEvent</span>) =&gt; &#123;</span><br><span class="line">    x.<span class="property">value</span> = e.<span class="property">pageX</span>;</span><br><span class="line">    y.<span class="property">value</span> = e.<span class="property">pageY</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//============================================================================</span></span><br><span class="line">  <span class="comment">// 生命周期</span></span><br><span class="line">  <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;mousemove&quot;</span>, getMousePosition);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">removeEventListener</span>(<span class="string">&quot;mousemove&quot;</span>, getMousePosition);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    x,</span><br><span class="line">    y,</span><br><span class="line">    modalOpen,</span><br><span class="line">    count,</span><br><span class="line">    color,</span><br><span class="line">    person,</span><br><span class="line">    doubelCount,</span><br><span class="line">    handleCapitalize,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> setup;</span><br></pre></td></tr></table></figure>

<h1 id="vue3-组件库"><a href="#vue3-组件库" class="headerlink" title="vue3 组件库"></a>vue3 组件库</h1><h2 id="element-puls"><a href="#element-puls" class="headerlink" title="element-puls"></a>element-puls</h2><p>elementUI 官方 bata 版 <a target="_blank" rel="noopener" href="https://github.com/element-plus/element-plus">https://github.com/element-plus/element-plus</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.bitbw.top/2020/12/24/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/vscode%E8%AE%BE%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%A5%E4%BD%95%E7%A7%8D%E6%96%B9%E5%BC%8F%E9%AB%98%E4%BA%AE%E8%A7%A3%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo-header.jpg">
      <meta itemprop="name" content="Bowen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张博文的个人博客">
      <meta itemprop="description" content="vue js javaScript ts typeScript HTML css Sass less webpack git hexo  Node.js 算法 前端 小程序 技术个人博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 张博文的个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/24/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/vscode%E8%AE%BE%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%A5%E4%BD%95%E7%A7%8D%E6%96%B9%E5%BC%8F%E9%AB%98%E4%BA%AE%E8%A7%A3%E6%9E%90/" class="post-title-link" itemprop="url">vscode设置文件以何种方式高亮解析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-24 09:43:58" itemprop="dateCreated datePublished" datetime="2020-12-24T09:43:58+00:00">2020-12-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-12-14 02:04:05" itemprop="dateModified" datetime="2022-12-14T02:04:05+00:00">2022-12-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/" itemprop="url" rel="index"><span itemprop="name">工具使用</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>312</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>在实际工作中有时需要用到只定义文件后缀 ， 我最近遇到的项目需要定义.rule 文件 ，但语法类似 javascript，文件编辑起来很费劲，因为不带高亮和语法提示，每次修改文件后缀也麻烦 ，我需要的是.rule 文件，以 jjavascript 的方式让 vscode 解析提示和高亮；</p>
</blockquote>
<h2 id="修改设置"><a href="#修改设置" class="headerlink" title="修改设置"></a>修改设置</h2><p>首选项 -&gt; 设置 -&gt;文本编辑器 -&gt;文件</p>
<p><img data-src="https://bitbw.top/public/img/my_gallery/image-20201224095242258.png" alt="image-20201224095242258"></p>
<p>修改保存即可 ，语言要写全名 像<code>javascript </code>不要写成<code>js</code></p>
<p>也可以直接编辑 setting</p>
<h2 id="setting-修改"><a href="#setting-修改" class="headerlink" title="setting 修改"></a>setting 修改</h2><p><img data-src="https://bitbw.top/public/img/my_gallery/image-20201224095505868.png" alt="image-20201224095505868"></p>
<p>json 中添加</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;files.associations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;*.rule&quot;</span><span class="punctuation">:</span> <span class="string">&quot;javascript&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.bitbw.top/2020/12/13/js%E6%8F%92%E4%BB%B6/%E4%BD%BF%E7%94%A8xlsx-js-%E5%AE%9E%E7%8E%B0%E9%9A%90%E8%97%8F%E5%B7%A5%E4%BD%9C%E7%B0%BF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo-header.jpg">
      <meta itemprop="name" content="Bowen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张博文的个人博客">
      <meta itemprop="description" content="vue js javaScript ts typeScript HTML css Sass less webpack git hexo  Node.js 算法 前端 小程序 技术个人博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 张博文的个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/13/js%E6%8F%92%E4%BB%B6/%E4%BD%BF%E7%94%A8xlsx-js-%E5%AE%9E%E7%8E%B0%E9%9A%90%E8%97%8F%E5%B7%A5%E4%BD%9C%E7%B0%BF/" class="post-title-link" itemprop="url">使用xlsx.js 实现隐藏工作簿</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-13 17:15:41" itemprop="dateCreated datePublished" datetime="2020-12-13T17:15:41+00:00">2020-12-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-12-14 02:04:05" itemprop="dateModified" datetime="2022-12-14T02:04:05+00:00">2022-12-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/js%E6%8F%92%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">js插件</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="http://sheetjs.com/">SheetJS js-xlsx</a> 中文文档： <a target="_blank" rel="noopener" href="https://github.com/rockboom/SheetJS-docs-zh-CN">https://github.com/rockboom/SheetJS-docs-zh-CN</a></p>
<p>下面是对工作簿能见度的描述文档</p>
<h2 id="数据表能见度"><a href="#数据表能见度" class="headerlink" title="数据表能见度"></a>数据表能见度</h2><p>Excel 支持将表格隐藏在更低的标签栏。表格数据存储文件内，但是 UI 不容易让它可以使用。标准的隐藏表格会被显示在”Unhide”菜单内。Excel 也有”very hidden”表格，这些表格不能被显示在菜单内。只可以通过 Vb 编辑器访问。</p>
<p>能见度的设置被存储在表格属性数组的<code>Hidden</code>属性当中。</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Definition</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>Visible</td>
</tr>
<tr>
<td>1</td>
<td>Hidden</td>
</tr>
<tr>
<td>2</td>
<td>Very Hidden</td>
</tr>
</tbody></table>
<p>更多详情请查看<a target="_blank" rel="noopener" href="https://rawgit.com/SheetJS/test_files/master/sheet_visibility.xlsx%EF%BC%9A">https://rawgit.com/SheetJS/test_files/master/sheet_visibility.xlsx：</a></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; wb<span class="selector-class">.Workbook</span><span class="selector-class">.Sheets</span><span class="selector-class">.map</span>(<span class="built_in">function</span>(x) &#123; return <span class="selector-attr">[x.name, x.Hidden]</span> &#125;)</span><br><span class="line"><span class="selector-attr">[ [ <span class="string">&#x27;Visible&#x27;</span>, 0 ]</span>, <span class="selector-attr">[ <span class="string">&#x27;Hidden&#x27;</span>, 1 ]</span>, <span class="selector-attr">[ <span class="string">&#x27;VeryHidden&#x27;</span>, 2 ]</span> ]</span><br></pre></td></tr></table></figure>

<p>非 Excel 格式不支持”Very Hidden”状态。测试一个数据比哦啊是否可见的最好方式是检查是否<code>Hidden</code>属性为逻辑 truth：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; wb<span class="selector-class">.Workbook</span><span class="selector-class">.Sheets</span><span class="selector-class">.map</span>(<span class="built_in">function</span>(x) &#123; return <span class="selector-attr">[x.name, !x.Hidden]</span> &#125;)</span><br><span class="line"><span class="selector-attr">[ [ <span class="string">&#x27;Visible&#x27;</span>, true ]</span>, <span class="selector-attr">[ <span class="string">&#x27;Hidden&#x27;</span>, false ]</span>, <span class="selector-attr">[ <span class="string">&#x27;VeryHidden&#x27;</span>, false ]</span> ]</span><br></pre></td></tr></table></figure>

<p>文档上对工作簿隐藏有说明，但是没有具体的隐藏方法，尝试直接修改工作簿的<code>Hidden</code>属性，没有任何效果， 但是皇天不负有心人， 通过查看 <a target="_blank" rel="noopener" href="https://github.com/SheetJS/sheetjs/blob/master/xlsx.js">源码</a> 发现了实现工作簿隐藏的方法</p>
<h2 id="XLSX-utils-book-set-sheet-visibility-方法"><a href="#XLSX-utils-book-set-sheet-visibility-方法" class="headerlink" title="XLSX.utils.book_set_sheet_visibility 方法"></a>XLSX.utils.book_set_sheet_visibility 方法</h2><p>下面是源码中方法的定义</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* set sheet visibility (visible/hidden/very hidden) */</span></span><br><span class="line">utils.<span class="property">book_set_sheet_visibility</span> = <span class="keyword">function</span> (<span class="params">wb, sh, vis</span>) &#123;</span><br><span class="line">  <span class="title function_">get_default</span>(wb, <span class="string">&quot;Workbook&quot;</span>, &#123;&#125;);</span><br><span class="line">  <span class="title function_">get_default</span>(wb.<span class="property">Workbook</span>, <span class="string">&quot;Sheets&quot;</span>, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> idx = <span class="title function_">wb_sheet_idx</span>(wb, sh);</span><br><span class="line">  <span class="comment">// $FlowIgnore</span></span><br><span class="line">  <span class="title function_">get_default</span>(wb.<span class="property">Workbook</span>.<span class="property">Sheets</span>, idx, &#123;&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (vis) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Bad sheet visibility setting &quot;</span> + vis);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// $FlowIgnore</span></span><br><span class="line">  wb.<span class="property">Workbook</span>.<span class="property">Sheets</span>[idx].<span class="property">Hidden</span> = vis;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>方法分别传入三个参数：</p>
<ul>
<li>工作表对象，</li>
<li>工作簿在工作簿数组中的下标，</li>
<li>需要设置的<code>Hidden</code>属性的值 （0，1，2）</li>
</ul>
<p>工作表对象生成方法见文档,下面用<code>workbook</code>表示，工作簿在工作簿数组中的下标，可以通过 workbook.SheetNames 找到对应的下标</p>
<h2 id="具体实现："><a href="#具体实现：" class="headerlink" title="具体实现："></a>具体实现：</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 隐藏采购员表   因为整个xlsx的使用是以class实现的这里截取隐藏工作表的方法</span></span><br><span class="line"><span class="title function_">hideBuyerSheet</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">let</span> indexs = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> [i,name] <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">workbook</span>.<span class="property">SheetNames</span>.<span class="title function_">entries</span>()) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="regexp">/采购员/</span>.<span class="title function_">test</span>(name))&#123; <span class="comment">//找到所有带采购员名称的表的下标</span></span><br><span class="line">      indexs.<span class="title function_">push</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">of</span> indexs) &#123;</span><br><span class="line">     <span class="comment">// 将对应下标的工作簿隐藏</span></span><br><span class="line">    <span class="variable constant_">XLSX</span>.<span class="property">utils</span>.<span class="title function_">book_set_sheet_visibility</span>(<span class="variable language_">this</span>.<span class="property">workbook</span>, i, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.bitbw.top/2020/12/13/Nodejs/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/logo-header.jpg">
      <meta itemprop="name" content="Bowen">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张博文的个人博客">
      <meta itemprop="description" content="vue js javaScript ts typeScript HTML css Sass less webpack git hexo  Node.js 算法 前端 小程序 技术个人博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 张博文的个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/13/Nodejs/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/" class="post-title-link" itemprop="url">[转载]node-pre-gyp以及node-gyp的源码简单解析（以安装sqlite3为例）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-13 13:05:13" itemprop="dateCreated datePublished" datetime="2020-12-13T13:05:13+00:00">2020-12-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-12-14 02:04:05" itemprop="dateModified" datetime="2022-12-14T02:04:05+00:00">2022-12-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Nodejs/" itemprop="url" rel="index"><span itemprop="name">Nodejs</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>11k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>10 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/330468774">文章原地址</a></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>简单来说，node 是跨平台的，那么对于任何的 node 模块理论也是应该是跨平台的。然而，有些 node 模块直接或间接使用原生 C&#x2F;C++代码，这些东西要跨平台，就需要使用源码根据实际的操作平台环境进行原生模块编译。SQLite3 就是一个经典的原生模块，让我们以安装该模块为例，探索一下安装原生模块的流程。</p>
<h2 id="项目建立"><a href="#项目建立" class="headerlink" title="项目建立"></a>项目建立</h2><p>建立一个简单的 node 项目，我们开始安装<code>SQLite3</code></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir sqlite3-install-demo</span><br><span class="line">$ cd sqlite3-install-demo</span><br><span class="line">$ npm init</span><br><span class="line"># 初始化项目</span><br><span class="line">Press ^C at any time to quit.</span><br><span class="line">package name: (projects) sqlite3-install-demo</span><br><span class="line">version: (1.0.0)</span><br><span class="line">description:</span><br><span class="line">entry point: (index.js)</span><br><span class="line">test command:</span><br><span class="line">git repository:</span><br><span class="line">keywords:</span><br><span class="line">author:</span><br><span class="line">license: (ISC) MIT</span><br><span class="line">About to write to D:\Projects\package.json:</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;sqlite3-install-demo&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class="line">  &quot;description&quot;: &quot;&quot;,</span><br><span class="line">  &quot;main&quot;: &quot;index.js&quot;,</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;author&quot;: &quot;&quot;,</span><br><span class="line">  &quot;license&quot;: &quot;MIT&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="安装SQLite3"><a href="#安装SQLite3" class="headerlink" title="安装SQLite3"></a>安装<code>SQLite3</code></h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -S sqlite3</span><br></pre></td></tr></table></figure>

<p>完成命令执行后，你会看到命令行界面出现了如下的几行<strong>重要</strong>的输出：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">&gt; sqlite3@5.0.0 install D:\Projects\sqlite3-install-demo\node_modules\sqlite3</span><br><span class="line">&gt; node-pre-gyp install --fallback-to-build</span><br><span class="line"></span><br><span class="line">node-pre-gyp WARN Using request for node-pre-gyp https download</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>啪一下，很快啊！我们就迎来了第一个东西<code>node-pre-gyp</code>，但是提到了<code>node-pre-gyp</code>，我们不得不提及<code>node-gyp</code>，然后又不得不提及<code>gyp</code>。</p>
<h2 id="gyp-与-node-gyp-与-node-pre-gyp"><a href="#gyp-与-node-gyp-与-node-pre-gyp" class="headerlink" title="gyp 与 node-gyp 与 node-pre-gyp"></a>gyp 与 node-gyp 与 node-pre-gyp</h2><h2 id="什么是-gyp？"><a href="#什么是-gyp？" class="headerlink" title="什么是 gyp？"></a>什么是 gyp？</h2><p>gyp 全称<code>Generate Your Projects</code>（构建你的项目）。wiki 的解释如下，自行翻译：</p>
<blockquote>
<p>GYP (generate your projects) is a build automation tool. GYP was created by Google to generate native IDE project files (such as Visual Studio Code and Xcode) for building the Chromium web browser and is licensed as open source software using the BSD software license.</p>
</blockquote>
<p>重点在于，它是一套用于生成原生 IDE 项目文件的自动化构建工具，处理 C&#x2F;C++项目，同类型的有 CMake、ninja 等自动构建工具。</p>
<h2 id="什么是-node-gyp？"><a href="#什么是-node-gyp？" class="headerlink" title="什么是 node-gyp？"></a>什么是 node-gyp？</h2><p>直接给出<code>stackoverflow</code>高票回答：</p>
<blockquote>
<p><code>node-gyp</code> is a tool which compiles Node.js Addons. Node.js Addons are native Node.js Modules, written in C or C++, which therefore need to be compiled on your machine. After they are compiled with tools like node-gyp, their functionality can be accessed via <code>require()</code>, just as any other Node.js Module.</p>
</blockquote>
<p>简单来说，node 是跨平台的，那么对于任何的 node 模块理论也是应该是跨平台的。然而，有些 node 模块直接或间接使用原生 C&#x2F;C++代码，这些东西要跨平台，就需要使用源码根据实际的操作平台环境进行原生模块编译。那么我们需要下载源码文件，通过 node-gyp 生成一定结构的代码项目让我们能够<code>require</code>引入（譬如，Windows 下会生成<code>vcxproj</code>，再调用<code>MSBuild</code>进行编译，以生成 Windows 下的动态链接库，最后打包为一个原生 node 模块）。这个知乎回答的每一条可以看看：<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/36291768">传送门</a>。</p>
<h2 id="什么是-node-pre-gyp？"><a href="#什么是-node-pre-gyp？" class="headerlink" title="什么是 node-pre-gyp？"></a>什么是 node-pre-gyp？</h2><p>上面<code>node-gyp</code>固然相当方便了，但是每一次安装 node 原生模块的时候，都需要根据平台（Windows、Linux、macOS 以及对应的 x86、x64、arm64 等等）进行源码编译，这样做费时费力。为什么不一开始就针对这些平台编译好了做成二进制制品发布呢？反正一般来说主流的平台架构就那么一些（Windows、Linux、macOS）。所以<code>node-pre--gyp</code>就帮我们做了这件事。原生模块开发者将代码编译生成各个平台架构的二进制包直接发布到<code>node-pre-gyp</code>上，当我们的 node 项目安装原生模块时候。处理流程就是首先去<code>node-pre-gyp</code>上找有没有当前平台的组件包，有的话直接拉取使用，如果没有则进行原生编译。</p>
<p><code>node-pre-gyp</code>一些<strong>重要参数</strong>（不全）：</p>
<ul>
<li><code>-C/--directory</code>: run the command in this directory</li>
<li><code>--build-from-source</code>: build from source instead of using pre-built binary</li>
<li><code>--fallback-to-build</code>: fallback to building from source if pre-built binary is not available</li>
<li><code>--target=0.4.0</code>: Pass the target node or node-webkit version to compile against</li>
<li><code>--target_arch=ia32</code>: Pass the target arch and override the host <code>arch</code>. Valid values are ‘ia32’,’x64’, or <code>arm</code>.</li>
<li><code>--target_platform=win32</code>: Pass the target platform and override the host <code>platform</code>. Valid values are <code>linux</code>, <code>darwin</code>, <code>win32</code>, <code>sunos</code>, <code>freebsd</code>, <code>openbsd</code>, and <code>aix</code>.</li>
</ul>
<p>对于<code>--fallback-to-build</code>这个参数：如果二进制不可获取则直接从源码编译，即从<code>node-pre-gyp</code>又回到<code>node-gyp</code>。所以你才会在上文看到安装 sqlite3 的时候，会有<code>--fallback-to-build</code>。</p>
<p>于是乎，当我们进行 node 原生模块安装的时候，一般会有如下的流程：</p>
<ol>
<li>针对当前平台架构优先考虑<code>node-pre-gyp</code>方式进行安装，但是为了防止无法获取针对对应平台编译好的二进制包（网络原因、暂时没有对应平台的二进制包），进入第 2 步；</li>
<li>下载原生模块源码，然后使用<code>node-gyp</code>进行项目构建，得到与平台相关的源码项目文件（Windows 则生成<code>vcxproj</code>项目，Linux 下是<code>Makefile</code>）；在这个过程，<code>node-gyp</code>会使用<code>Python</code>进行自动化构建操作，这也是为什么有些朋友安装 node 原生模块的时候，会报错找不到<code>Python</code>。</li>
<li>调用平台对应的编译工具进行编译。在 Windows 的环境下，<code>node-gyp</code>会查找本地的<code>MSBuild/CL</code>等编译工具，而这些编译工具又一般在<code>Visual Studio</code>安装的时候，也一并安装在了机器上。这就是为什么有些朋友没有安装<code>Visual Studio</code>的时候，会报错。</li>
</ol>
<h2 id="探索-SQLite3-的安装流程"><a href="#探索-SQLite3-的安装流程" class="headerlink" title="探索 SQLite3 的安装流程"></a>探索 SQLite3 的安装流程</h2><h2 id="npm-install"><a href="#npm-install" class="headerlink" title="npm install"></a><code>npm install</code></h2><p>为什么我们安装<code>sqlite3</code>的时候，会调用<code>node-pre-gyp</code>命令呢？进入<code>项目目录/node_modules/sqlite3/</code>文件夹，让我们查看一下<code>package.json</code>中的<code>scripts</code>部分：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="attr">&quot;repository&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;git&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;git://github.com/mapbox/node-sqlite3.git&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;install&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node-pre-gyp install --fallback-to-build&quot;</span><span class="punctuation">,</span> <span class="comment">// install</span></span><br><span class="line">    <span class="attr">&quot;pack&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node-pre-gyp package&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pretest&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node test/support/createdb.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mocha -R spec --timeout 480000&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5.0.0&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>答案显而易见了，<code>install</code>脚本中执行了<code>node-pre-gyp install --fallback-to-build</code>命令。</p>
<p>这就不得不提到<code>npm</code>的安装流程是。当我们进行<code>npm install xxx</code>的时候，<code>npm</code>首先下载<code>xxx</code>的包。下载完成后，若<code>package.json</code>中的 scripts 中存在<code>install</code>属性，则会立刻调用。至于<code>scripts</code>中的其他固定脚本：<code>test</code>、<code>preinstall</code>、<code>postinstall</code>等等作用以及<code>scripts</code>的高级用法，请直接查阅<a href="https://link.zhihu.com/?target=https://docs.npmjs.com/cli/v6/using-npm/scripts">scripts | npm Docs (npmjs.com)</a>。</p>
<p>所以本此<code>sqlite3</code><strong>前期</strong>安装的过程为：</p>
<ol>
<li><code>npm</code>下载在仓库中的<code>sqlite3</code>npm 包；</li>
<li>执行<code>$&#123;your_projects&#125;/node_modules/sqlite3/package.json</code>中的<code>install</code>脚本，即<code>node-pre-gyp install --fallback-to-build</code></li>
</ol>
<p>于是乎，安装进入到了一个新的环节：<code>node-pre-gyp install</code>。当然，若你没有全局安装<code>node-pre-gyp</code>，它会由<code>npm</code>帮你安装到<code>$&#123;your_projects&#125;/node_modules/</code>中，并且通过<code>node-pre-gyp/package.json</code>中的<code>bin</code>元素，建立软连接到<code>$&#123;your_projects&#125;/node_modules/.bin</code>中。这样，<code>node\npm</code>环境中就有了<code>node-pre-gyp</code>命令可以使用。至于<code>package.json#bin</code>的作用，详细参考官方文档<a href="https://link.zhihu.com/?target=https://docs.npmjs.com/cli/v6/configuring-npm/package-json%23bin">package.json | npm Docs (npmjs.com)</a>。</p>
<h2 id="node-pre-gyp-install"><a href="#node-pre-gyp-install" class="headerlink" title="node-pre-gyp install"></a><code>node-pre-gyp install</code></h2><p><code>node-pre-gyp</code>在上述的安装流程中，已经能够被我们在 CLI 中所使用。查看<code>node_modules/node-pre-gyp/bin/node-pre-gyp</code>文件（下文都将省略<code>$&#123;your_projects&#125;/</code>），用文本的形式打开。就是<code>node-pre-gyp</code>CLI 的执行过程，脚本中的主要内容为最后一行：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// start running the given commands!</span><br><span class="line">run();</span><br></pre></td></tr></table></figure>

<p>检查该函数的定义：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">run</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> command = prog.<span class="property">todo</span>.<span class="title function_">shift</span>();</span><br><span class="line">  <span class="keyword">if</span> (!command) &#123;</span><br><span class="line">    <span class="comment">// done!</span></span><br><span class="line">    completed = <span class="literal">true</span>;</span><br><span class="line">    log.<span class="title function_">info</span>(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  prog.<span class="property">commands</span>[command.<span class="property">name</span>](command.<span class="property">args</span>, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      log.<span class="title function_">error</span>(command.<span class="property">name</span> + <span class="string">&quot; error&quot;</span>);</span><br><span class="line">      log.<span class="title function_">error</span>(<span class="string">&quot;stack&quot;</span>, err.<span class="property">stack</span>);</span><br><span class="line">      <span class="title function_">errorMessage</span>();</span><br><span class="line">      log.<span class="title function_">error</span>(<span class="string">&quot;not ok&quot;</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>);</span><br><span class="line">      <span class="keyword">return</span> process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> args_array = [].<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (args_array.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="property">log</span>.<span class="title function_">apply</span>(<span class="variable language_">console</span>, args_array);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// now run the next command in the queue</span></span><br><span class="line">    process.<span class="title function_">nextTick</span>(run);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>prog</code>是什么？该文件往上查看定义，原来是：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> node_pre_gyp = <span class="built_in">require</span>(<span class="string">&quot;../&quot;</span>); <span class="comment">// 上一个目录作为模块引入</span></span><br><span class="line"><span class="keyword">var</span> log = <span class="built_in">require</span>(<span class="string">&quot;npmlog&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Process and execute the selected commands.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> prog = <span class="keyword">new</span> node_pre_gyp.<span class="title class_">Run</span>(); <span class="comment">// 来自于node_pre_gyp中的Run，而node_pre_gyp在上方</span></span><br></pre></td></tr></table></figure>

<p>继续检查上一个目录，发现并没又<code>indes.js</code>文件，熟悉<code>npm</code>的朋友应该知道要去看<code>package.json</code>中的<code>main</code>元素了：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    <span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;BSD-3-Clause&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./lib/node-pre-gyp.js&quot;</span><span class="punctuation">,</span> <span class="comment">// 模块是这个文件</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node-pre-gyp&quot;</span><span class="punctuation">,</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>查阅<code>lib/node-pre-gyp.js</code>代码中的 Run：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Run</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> self = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">commands</span> = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  commands.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">command</span>) &#123;</span><br><span class="line">    self.<span class="property">commands</span>[command] = <span class="keyword">function</span> (<span class="params">argv, callback</span>) &#123;</span><br><span class="line">      log.<span class="title function_">verbose</span>(<span class="string">&quot;command&quot;</span>, command, argv);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">&quot;./&quot;</span> + command)(self, argv, callback); <span class="comment">// 这里是核心</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>核心功能就是引入当前所在目录下的模块进行执行。例如，本次调用的是<code>node-pre-gyp install</code>，则会<code>require(./install)</code>，检查一下<code>node-pre-gyp.js</code>目录下，果然存在该<code>js</code>文件。继续阅读<code>install.js</code>源码。里面有几个函数的定义。咱们先不看内容，把函数名列举出来，猜测一下作用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 去下载平台编译好的二进制？</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">download</span>(<span class="params">uri,opts,callback</span>) &#123;...&#125;</span><br><span class="line"><span class="comment">// 把下载好的二进制放到对应目录？</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">place_binary</span>(<span class="params"><span class="keyword">from</span>,to,opts,callback</span>) &#123;...&#125;</span><br><span class="line"><span class="comment">// 进行构建。难道是没有下载，就调用node-gyp源码编译？</span></span><br><span class="line"><span class="comment">// 还有，node-pre-gyp又--fallback-to-build参数，也会调用这个？</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">do_build</span>(<span class="params">gyp,argv,callback</span>) &#123;...&#125;</span><br><span class="line"><span class="comment">// 打印回退出现的异常</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">print_fallback_error</span>(<span class="params">err,opts,package_json</span>) &#123;...&#125;</span><br><span class="line"><span class="comment">// 安装，核心没跑了</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">install</span>(<span class="params">gyp, argv, callback</span>) &#123;...&#125;</span><br></pre></td></tr></table></figure>

<p>首先看<code>download</code>的调用点是在<code>place_binary</code>中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">place_binary</span>(<span class="params"><span class="keyword">from</span>,to,opts,callback</span>) &#123; <span class="comment">// place_binary函数</span></span><br><span class="line">    <span class="title function_">download</span>(<span class="keyword">from</span>,opts,<span class="keyword">function</span>(<span class="params">err,req</span>) &#123; <span class="comment">// 调用了download</span></span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="title function_">callback</span>(err);</span><br><span class="line">        <span class="keyword">if</span> (!req) <span class="keyword">return</span> <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;empty req&quot;</span>));</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">        ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再看<code>place_binary</code>调用点是在<code>install</code>中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">install</span>(<span class="params">gyp, argv, callback</span>) &#123;</span><br><span class="line">  <span class="comment">// 省略部分...</span></span><br><span class="line">  <span class="keyword">var</span> should_do_source_build =</span><br><span class="line">    source_build === package_json.<span class="property">name</span> ||</span><br><span class="line">    source_build === <span class="literal">true</span> ||</span><br><span class="line">    source_build === <span class="string">&quot;true&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (should_do_source_build) &#123;</span><br><span class="line">    <span class="comment">// 源码编译</span></span><br><span class="line">    log.<span class="title function_">info</span>(<span class="string">&quot;build&quot;</span>, <span class="string">&quot;requesting source compile&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">do_build</span>(gyp, argv, callback);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 省略部分...</span></span><br><span class="line">    <span class="title function_">mkdirp</span>(to, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="title function_">after_place</span>(err);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">place_binary</span>(<span class="keyword">from</span>, to, opts, after_place); <span class="comment">// 调用点</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 省略部分...</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 省略部分...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过上述分析，整个大的处理流程如下：</p>
<ol>
<li>进入<code>install</code>函数</li>
<li>检查是否需要<code>build-from-source</code>。是则进，入<code>do_build</code>分支，进行源码编译；否则进入步骤 3。</li>
<li>检查是否启用<code>--fallback-to-build</code>参数，设定是否启用标志位。</li>
<li>解析编译好的二进制文件的选项配置，譬如二进制文件存放地址，也就是通过请求下载对应二进制包的地址，以及各种各样参数。所以说，为什么下载很慢，我们后文会重点关注下载地址。</li>
</ol>
<h3 id="下载二进制包"><a href="#下载二进制包" class="headerlink" title="下载二进制包"></a>下载二进制包</h3><p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-42de3994e7c42468d24506ef1dbdbe49_720w-1607839552207.jpg" alt="img"></p>
<p>根据流程，接下来我们进一步检查<code>versioning.js</code>文件，找到其中的<code>evaluate</code>函数，分析最后的<code>hosted_tarball</code>路径：</p>
<p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-1e4a760a3783229810e2a437e1330f37_720w-1607839554321.png" alt="img"></p>
<p><code>hosted_tarball</code>路径主要分为两个部分：1、<code>hosted_path</code>；2、<code>package_name</code>。</p>
<h3 id="hosted-path"><a href="#hosted-path" class="headerlink" title="hosted_path"></a>hosted_path</h3><p>经过源码分析来源路径为：</p>
<p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-9e93a984b0f0aeac5d8154f0aa1b387c_720w-1607839785926.jpg" alt="img"></p>
<p>我们自底向上分析。</p>
<p><code>host</code>变量取决于从环境变量中检查名称为<code>&#39;npm_config_&#39; + opts.module_name + &#39;_binary_host_mirror&#39;</code>的环境变量。如果不存在，则使用<code>package_json.binary.host</code>。正常使用的时候，我们并不会设定环境变量，所以这里就进入<code>package_json.binary</code>进行获取。这个<code>package_json</code>是<code>evaluate</code>函数被调用时候传入的，在<code>node-pre-gyp/install.js</code>中能够看到：</p>
<p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-2f28af0a80578001c17e86077832bc52_720w-1607839556588.jpg" alt="img"></p>
<p>一开始分析的时候，看到这里，本人以为<code>package_json</code>就是<code>node-pre-gyp/package.json</code>，于是本人去检查该<code>json</code>发现很奇怪，并没有 binary 属性，更别提 host 了。一番思考才明白，<code>node-pre-gyp install</code>的运行时调用者是谁呀？不是应该是<code>sqlite3</code>吗？所以这个地方的<code>require(&#39;./package.json&#39;)</code>实际上是指代的是<code>sqlite3/package.json</code>。查看<code>sqlite3/package.json</code>，果然发现了对应的元素：</p>
<p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-9123803894e4e7ba0df2b7eebc3be8f9_720w-1607839558202.jpg" alt="img"></p>
<p>在<code>binary</code>属性中，我们还能看到<code>remote_path</code>也在其中。</p>
<p>至此，<code>hosted_path</code>我们完成了简单的分析，我们可以得出一个结论：</p>
<p><strong><code>node-pre-gyp</code>下载二进制文件的路径，优先来源于对应模块的镜像地址，该镜像地址通过配置<code>&#39;npm_config_&#39; + 模块名 + &#39;_binary_host_mirror&#39;</code>来实现自定义；在没有定义镜像地址的情况下，读取模块<code>package.json</code>中的 binary 属性信息。</strong></p>
<p>当然，读者可以根据具体情况再进一步分析源码。</p>
<h3 id="package-name"><a href="#package-name" class="headerlink" title="package_name"></a>package_name</h3><p>其实，对于<code>hosted_path</code>的分析，我们也容易分析<code>package_name</code>了。</p>
<p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-66d92db546da24a98f6459e09d28611a_720w-1607839560356.jpg" alt="img"></p>
<p>自底向上分析，来自于<code>sqlite3/package.json</code>中<code>binary</code>属性中的<code>package_name</code>，内容见上图分析<code>host</code>。</p>
<h3 id="失败处理"><a href="#失败处理" class="headerlink" title="失败处理"></a>失败处理</h3><p><code>--fallback-to-build</code>参数表明了是否进行失败后下载源码进行编译，源码不再分析。</p>
<h3 id="从源码构建"><a href="#从源码构建" class="headerlink" title="从源码构建"></a>从源码构建</h3><h3 id="build-js"><a href="#build-js" class="headerlink" title="build.js"></a>build.js</h3><p>当我们提供了参数<code>--build-from-source</code>或是在下载编译好的二进制到本地出错的时提供了参数<code>--fallback-to-build</code>。node-pre-gyp 将进入<code>do_build</code>模块，进行源码编译。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function do_build(gyp,argv,callback) &#123;</span><br><span class="line">  var args = [&#x27;rebuild&#x27;].concat(argv);</span><br><span class="line">  gyp.todo.push( &#123; name: &#x27;build&#x27;, args: args &#125; );</span><br><span class="line">  process.nextTick(callback);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码中，<code>gyp</code>由调用 install 的时候，传入：</p>
<p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-62190c9f9976e3b3a7d7633d33129e85_720w-1607839562977.jpg" alt="img"></p>
<p>那么我们又将回到调用 install 的地方。实际上，gyp 就是 node-pre-gyp.js 导出的模块：</p>
<p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-e940f9f30e0b68edeb98aa34709263e0_720w-1607839564901.jpg" alt="img"></p>
<p>也就是说在<code>do_build</code>中进行操作就是，放置了一个<code>build</code>任务在队列中。所以我们按照先前的分析，直接去看<code>build.js</code></p>
<p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-c60cc43b95c212ee80dff2bb461597a2_720w-1607839566493.jpg" alt="img"></p>
<p>看源码调用了当前模块中的<code>do_build</code>，且其中最核心的就是<code>compile</code>模块：</p>
<p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-2f5857952a2e181a620ca9183fd5e76d_720w-1607839567958.jpg" alt="img"></p>
<h3 id="util-x2F-compile-js"><a href="#util-x2F-compile-js" class="headerlink" title="util&#x2F;compile.js"></a>util&#x2F;compile.js</h3><p>进入 compile 模块，直接找到对应的<code>run_gyp</code>函数，代码很短，不难看出进行构建调用了<code>node-gyp</code></p>
<p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-97c9d95fdb3ea2d7c9e55a7311377fc3_720w-1607839569753.jpg" alt="img"></p>
<p>上述代码，会先考略<code>node-webkit</code>构建。但是我们核心的还是使用<code>node-gyp</code>，所以 else 中，会进行<code>node-gyp</code>的工具的检查工作。最后调用命令行执行<code>node-gyp</code>。于是，node 原生模块的安装工作，进入了新的阶段：<code>node-gyp</code>。</p>
<h2 id="node-gyp-build"><a href="#node-gyp-build" class="headerlink" title="node-gyp build"></a><code>node-gyp build</code></h2><p>上文提到我们已经进入了<code>node-gyp</code>的范畴，会调用<code>node-gyp build</code>操作。当然，这个命令同样是在安装<code>node-gyp</code>依赖的时候已经完成了安装，并且进行<code>node_modules/.bin/</code>软连接操作。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  <span class="string">&quot;bin&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;node-gyp&quot;</span>: <span class="string">&quot;bin/node-gyp.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<p>我们进入该<code>js</code>进行分析</p>
<p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-8b31e792c069648f4518bd2bf4de384c_720w-1607839571435.jpg" alt="img"></p>
<p>实际上，<code>node-gyp</code>这段的命令行代码，和<code>node-pre-gyp</code>非常相似！所以我们也不去深入分析调用命令行了。直接在 lib 文件夹下面的<code>build.js</code>。在该<code>js</code>中，核心的方法为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">build</span> (gyp, argv, callback) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在该方法中，还编写了几个<strong>内部函数</strong>，作为了功能的划分：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// function build (gyp, argv, callback) 内部函数</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Load the &quot;config.gypi&quot; file that was generated during &quot;configure&quot;.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">loadConfigGypi</span> () &#123;...&#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * On Windows, find the first build/*.sln file.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">findSolutionFile</span> () &#123;...&#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Uses node-which to locate the msbuild / make executable.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">doWhich</span> () &#123;...&#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Search for the location of &quot;msbuild.exe&quot; file on Windows.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">findMsbuild</span> () &#123;...&#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Actually spawn the process and compile the module.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">doBuild</span> () &#123;...&#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Invoked after the make/msbuild command exits.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">onExit</span> (code, signal) &#123;...&#125;</span><br></pre></td></tr></table></figure>

<p>不得不说，<code>build</code>写的真心不错，看起来很舒服。这里为了方便读者快速阅读，我整理这些函数的调用图：</p>
<p><img data-src="/%E8%BD%AC%E8%BD%BD-node-pre-gyp%E4%BB%A5%E5%8F%8Anode-gyp%E7%9A%84%E6%BA%90%E7%A0%81%E7%AE%80%E5%8D%95%E8%A7%A3%E6%9E%90%EF%BC%88%E4%BB%A5%E5%AE%89%E8%A3%85sqlite3%E4%B8%BA%E4%BE%8B%EF%BC%89/v2-bf94b9960c86eaf29b542f860b3d4ab1_720w-1607839573628.jpg" alt="img"></p>
<p>整个调用流程图个人认为足够进行安装的时候的一场分析了。至于每个内部函数的功能，有空继续更新本文吧。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/9/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/11/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2016 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Bowen</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">448k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">6:47</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/bitbw" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.14.0/source/js/comments.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.14.0/source/js/utils.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.14.0/source/js/motion.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.14.0/source/js/next-boot.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.14.0/source/js/pjax.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.14.0/source/js/third-party/search/local-search.min.js"></script>



  <script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.14.0/source/js/third-party/fancybox.min.js"></script>


  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  <script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://blog.bitbw.top/page/10/"}</script>
  <script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.14.0/source/js/third-party/quicklink.min.js"></script>
<script src="https://unpkg.com/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '64px',
  right: '32px',
  left: 'unset',
  time: '0.3s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"bitbw","repo":"gitalk-store","client_id":"081dca720868e966811f","client_secret":"1ee6c9b1069968b2227532b2cc671858c25ef2b6","admin_user":"bitbw","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"4065e8cbb1e607e1dc8e81e55bc43eb9"}</script>
<script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.14.0/source/js/third-party/comments/gitalk.min.js"></script>

</body>
</html>
